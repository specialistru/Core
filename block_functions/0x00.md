–ü–æ–ª–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ 374 –±–ª–æ–∫–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ block_functions (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—ã–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –±–ª–æ–∫)

–ö–∞–∂–¥—ã–π –±–ª–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç:
* –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
* –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
* –ü—Ä–æ—Ç–æ—Ç–∏–ø—ã
* –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
* –ú–µ—Ç—Ä–∏–∫–∏
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

---

{
  "id": "20.4",
  "internal_id": "core_storage_row_column_json_indexes",
  "title": "–Ø–¥—Ä–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: row-store, column-store, JSON-store –∏ –∏–Ω–¥–µ–∫—Å—ã",
  "package": "20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ",
  "description": "...",
  "functions": [
    {
      "name": "storage_row_insert",
      "prototype": "bool storage_row_insert(table_t *table, const row_t *row);",
      "description": "–í—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ row-store.",
      "returns": "true"
    },
    ...
  ],
  "structures": [...],
  "metrics": [...],
  "security": [...],
  "dependencies": [...],
  "tests": [...]
}

---

## üß© –ë–ª–æ–∫ 0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `entry_point_main`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–≠—Ç–æ—Ç –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –û–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–µ—Ä–≤–∏—á–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞, –∑–∞–ø—É—Å–∫ –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, observability), –∞ —Ç–∞–∫–∂–µ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Å–∏–≥–Ω–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –≤—ã–≤–æ–¥ –≤–µ—Ä—Å–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –ø—Ä–æ—Ü–µ—Å—Å–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| -------------------------- | ------------------------------------------------- | ------------------------------------------------------------------------------------- | ----------------- |
| `main`                     | `int main(int argc, char **argv);`                | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª. | –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è    |
| `startup_bootstrap`        | `bool startup_bootstrap(void);`                   | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.               | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `register_signal_handlers` | `void register_signal_handlers(void);`            | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ `SIGINT`, `SIGTERM`, `SIGSEGV`.                    | `void`            |
| `print_banner`             | `void print_banner(void);`                        | –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏, —Å–±–æ—Ä–∫–µ, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ –¥–∞—Ç–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.                   | `void`            |
| `shutdown_gracefully`      | `void shutdown_gracefully(void);`                 | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –æ—á–∏—Å—Ç–∫—É —Ä–µ—Å—É—Ä—Å–æ–≤.                            | `void`            |
| `parse_command_line`       | `bool parse_command_line(int argc, char **argv);` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (—Ñ–ª–∞–≥–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞).                   | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `dump_debug_info`          | `void dump_debug_info(void);`                     | –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.                             | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool daemon_mode;
  char config_path[256];
  bool show_version;
  bool dry_run;
} startup_options_t;

typedef struct {
  uint64_t start_time_ns;
  uint32_t pid;
  char hostname[64];
} db_runtime_info_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `startup_duration_ns` ‚Äî –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* `startup_success{status="ok|fail"}` ‚Äî —Å—Ç–∞—Ç—É—Å –∑–∞–ø—É—Å–∫–∞
* `fatal_errors_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–±—Ä–∞–±–æ—Ç–∫–∞ `argv[]` —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (lock-—Ñ–∞–π–ª)
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥ root (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ —è–≤–Ω–æ)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞ (core_config)`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞`
* `0.8 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è observability-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_main_startup_success`
* `test_main_signal_handling`
* `test_main_invalid_args`
* `test_main_shutdown_sequence`

---

–ñ–¥—É –∫–æ–º–∞–Ω–¥—ã **"–¥–∞"**, —á—Ç–æ–±—ã –ø—Ä–∏—Å–ª–∞—Ç—å –±–ª–æ–∫ **0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `core_config`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, –ø–∞—Ä—Å–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —è–¥—Ä–∞. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç hot-reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ö–µ–º—ã –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                                     | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç             |
| ------------------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------ | ---------------------- |
| `config_init`       | `bool config_init(const char *config_path);`                                 | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª.       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ      |
| `config_get_string` | `const char *config_get_string(const char *key, const char *default_value);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.                     | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ `default` |
| `config_get_int`    | `int config_get_int(const char *key, int default_value);`                    | –ü–æ–ª—É—á–∞–µ—Ç —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.                   | –ó–Ω–∞—á–µ–Ω–∏–µ –∏–ª–∏ `default` |
| `config_get_bool`   | `bool config_get_bool(const char *key, bool default_value);`                 | –ü–æ–ª—É—á–∞–µ—Ç –±—É–ª–µ–≤–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞.                          | `true`/`false`         |
| `config_reload`     | `bool config_reload(void);`                                                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç live reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ      |
| `config_free`       | `void config_free(void);`                                                    | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å, –∑–∞–Ω—è—Ç—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.                   | `void`                 |
| `config_dump`       | `void config_dump(FILE *out);`                                               | –í—ã–≤–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –ª–æ–≥ –∏–ª–∏ —Ñ–∞–π–ª.                | `void`                 |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char key[128];
  char value[512];
} config_entry_t;

typedef struct {
  config_entry_t entries[1024];
  size_t entry_count;
  bool allow_reload;
} config_store_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `config_reload_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ hot reload-–æ–≤
* `config_invalid_keys_total` ‚Äî —á–∏—Å–ª–æ –Ω–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
* `config_parse_duration_ns` ‚Äî –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É
* –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (whitelist)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞`
* `7.15 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ live reload`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_config_load_valid_file`
* `test_config_missing_key`
* `test_config_reload_runtime`
* `test_config_safety_invalid_file`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å **–±–ª–æ–∫ 0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π (init modules)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π (init modules)

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `module_loader`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∏–ª–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö –º–æ–¥—É–ª–µ–π —Å–∏—Å—Ç–µ–º—ã: –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Å–µ—Ç–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è, observability, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Ç.–¥. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ –∏ –ª–æ–≥–∏–∫—É graceful failure.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| --------------------- | ------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- | -------------------- |
| `module_loader_init`  | `bool module_loader_init(void);`                                                            | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.        | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `module_register`     | `bool module_register(const char *name, bool (*init_fn)(void), bool (*shutdown_fn)(void));` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–æ–¥—É–ª—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.                   | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `module_shutdown_all` | `void module_shutdown_all(void);`                                                           | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –≤ –ø–æ—Ä—è–¥–∫–µ –æ–±—Ä–∞—Ç–Ω–æ–º –∑–∞–≥—Ä—É–∑–∫–µ. | `void`               |
| `module_is_loaded`    | `bool module_is_loaded(const char *name);`                                                  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–≥—Ä—É–∂–µ–Ω –ª–∏ –º–æ–¥—É–ª—å.                                          | `true` –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω |
| `module_get_status`   | `const char *module_get_status(const char *name);`                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –º–æ–¥—É–ª—è: `loaded`, `error`, `not_found`.       | –°—Ç–∞—Ç—É—Å               |
| `module_dump_state`   | `void module_dump_state(FILE *out);`                                                        | –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –≤ –ª–æ–≥/—Ñ–∞–π–ª.                     | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  bool (*init_fn)(void);
  bool (*shutdown_fn)(void);
  bool initialized;
} module_entry_t;

typedef struct {
  module_entry_t modules[128];
  size_t count;
} module_registry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `module_init_duration{name}` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ –º–æ–¥—É–ª—é
* `module_failures_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
* `module_loaded_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* –ò–∑–æ–ª—è—Ü–∏—è —Å–±–æ–µ–≤ –æ–¥–Ω–æ–≥–æ –º–æ–¥—É–ª—è (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ)
* –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∏ API –º–æ–¥—É–ª—è

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞`
* `9.x ‚Äî –í–Ω–µ—à–Ω–∏–µ –º–æ–¥—É–ª–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_module_register_valid`
* `test_module_init_shutdown_sequence`
* `test_module_failure_isolation`
* `test_module_status_report`

---

–ì–æ—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **–±–ª–æ–∫ 0.4 ‚Äî CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.4 ‚Äî CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `cli_interface`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ—Ç–ª–∞–¥–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø—É—Å–∫ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –≤—ã–≤–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã, –∑–∞–≥—Ä—É–∑–∫—É/–≤—ã–≥—Ä—É–∑–∫—É —Å—Ö–µ–º, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, shutdown, metrics, reload).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ---------------------- | --------------------------------------------------------------------------------- | ----------------------------------------------------- | ----------------- |
| `cli_main_loop`        | `int cli_main_loop(void);`                                                        | –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π REPL-—Ü–∏–∫–ª CLI.       | –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è    |
| `cli_execute_line`     | `bool cli_execute_line(const char *line);`                                        | –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –∫–æ–º–∞–Ω–¥—ã (SQL –∏–ª–∏ meta-–∫–æ–º–∞–Ω–¥–∞). | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `cli_print_prompt`     | `void cli_print_prompt(void);`                                                    | –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –¥–ª—è –≤–≤–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `db> `).  | `void`            |
| `cli_register_command` | `void cli_register_command(const char *name, bool (*handler)(const char *args));` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é CLI-–∫–æ–º–∞–Ω–¥—É.            | `void`            |
| `cli_show_help`        | `void cli_show_help(void);`                                                       | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏ –æ–ø–∏—Å–∞–Ω–∏—è.        | `void`            |
| `cli_exit`             | `void cli_exit(void);`                                                            | –ó–∞–≤–µ—Ä—à–∞–µ—Ç CLI-—Å–µ—Å—Å–∏—é.                                 | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char command[64];
  bool (*handler)(const char *args);
} cli_command_t;

typedef struct {
  cli_command_t commands[128];
  size_t command_count;
  bool running;
} cli_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `cli_command_total{name}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ
* `cli_session_duration` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å CLI-—Å–µ—Å—Å–∏–∏
* `cli_error_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞–ø—Ä–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (`DROP`, `SHUTDOWN`)
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ (SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏, –∫–æ–º–∞–Ω–¥–Ω—ã–µ —Ü–µ–ø–æ—á–∫–∏)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RBAC: CLI-–∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `3.12 ‚Äî SQL Executor`
* `3.9 ‚Äî Rule-based –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä`
* `14.2 ‚Äî CLI-—É—Ç–∏–ª–∏—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_cli_execute_sql`
* `test_cli_meta_command_shutdown`
* `test_cli_register_custom_command`
* `test_cli_interactive_prompt`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.5 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.5 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `startup_controller`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—â–∏–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã: –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø–µ—Ä–µ—Ö–æ–¥–æ–º –≤ —Ä–∞–±–æ—á–∏–π —Ä–µ–∂–∏–º, –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç     |
| ------------------------ | -------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- | -------------- |
| `startup_controller_run` | `int startup_controller_run(void);`                                        | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞, –≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å—Ç–∞—Ç—É—Å–∞. | –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è |
| `startup_register_stage` | `void startup_register_stage(const char *name, bool (*init_fn)(void));`    | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —ç—Ç–∞–ø –∑–∞–ø—É—Å–∫–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.                          | `void`         |
| `shutdown_register_hook` | `void shutdown_register_hook(const char *name, void (*cleanup_fn)(void));` | –î–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑—ã–≤–∞–µ–º—É—é –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.                                         | `void`         |
| `shutdown_run_hooks`     | `void shutdown_run_hooks(void);`                                           | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.                                  | `void`         |
| `startup_set_ready`      | `void startup_set_ready(void);`                                            | –ü–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –≤ —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å).                                   | `void`         |
| `startup_failed`         | `void startup_failed(const char *reason);`                                 | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É —Å—Ç–∞—Ä—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å.                           | `void`         |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  bool (*init_fn)(void);
  bool initialized;
} startup_stage_t;

typedef struct {
  char name[64];
  void (*cleanup_fn)(void);
} shutdown_hook_t;

typedef struct {
  startup_stage_t stages[64];
  shutdown_hook_t shutdown_hooks[64];
  size_t stage_count;
  size_t hook_count;
  bool is_ready;
} startup_state_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `startup_stage_duration{name}` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–∞–ø–∞
* `shutdown_hooks_executed_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤
* `startup_ready_flag` ‚Äî –±—É–ª–µ–≤—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –º–æ–¥—É–ª–µ–π (fail-fast)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ shutdown
* –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ —Å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_startup_sequence`
* `test_shutdown_hooks_order`
* `test_startup_failures`
* `test_startup_ready_flag`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `component_initializer`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–ª—é—á–µ–≤—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞ –°–£–ë–î: —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ---------------------- | ------------------------------------------------------------------- | ------------------------------------------------------------------ | ----------------- |
| `component_init_all`   | `bool component_init_all(void);`                                    | –ó–∞–ø—É—Å–∫–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å–µ—Ö —è–¥—Ä–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `component_register`   | `void component_register(const char *name, bool (*init_fn)(void));` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –µ–≥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.               | `void`            |
| `component_get_status` | `const char *component_get_status(const char *name);`               | –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: `initialized`, `error`, `not_found`.   | –°—Ç—Ä–æ–∫–∞ —Å—Ç–∞—Ç—É—Å–∞    |
| `component_is_ready`   | `bool component_is_ready(const char *name);`                        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≥–æ—Ç–æ–≤ –ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫ —Ä–∞–±–æ—Ç–µ.                            | `true` –µ—Å–ª–∏ –≥–æ—Ç–æ–≤ |
| `component_deinit_all` | `void component_deinit_all(void);`                                  | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.                                | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  bool (*init_fn)(void);
  bool initialized;
} component_t;

typedef struct {
  component_t components[64];
  size_t count;
} component_registry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `component_init_duration{name}` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
* `component_ready_state{name}` ‚Äî —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
* `component_init_failures_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±–æ–µ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
* –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞`
* `0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π`
* `0.5 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞`
* `1.25 ‚Äî –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü`
* `2.1 ‚Äî MVCC`
* `7.1 ‚Äî –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫`
* `7.2 ‚Äî –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_component_registration`
* `test_component_init_sequence`
* `test_component_init_failure`
* `test_component_ready_check`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.7 ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è API** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.7 ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è API

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `api_router`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∞ —Ç–∞–∫–∂–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é REST/gRPC/WebSocket/CLI –∑–∞–ø—Ä–æ—Å–æ–≤. –û–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–µ—Å—Å–∏–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| -------------------- | ---------------------------------------------------------------------------------------- | ---------------------------------------------------------------- | ----------------- |
| `api_router_init`    | `bool api_router_init(void);`                                                            | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä API –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `api_register_route` | `bool api_register_route(const char *method, const char *path, api_handler_fn handler);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–∞—Ä—à—Ä—É—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GET /v1/health`).   | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `api_handle_request` | `int api_handle_request(api_request_t *req, api_response_t *res);`                       | –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.   | HTTP/gRPC –∫–æ–¥     |
| `api_reload_routes`  | `bool api_reload_routes(void);`                                                          | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ hot reload).      | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `api_shutdown`       | `void api_shutdown(void);`                                                               | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä.                   | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[8];  // GET, POST, etc.
  char path[128];
  int (*handler)(api_request_t *req, api_response_t *res);
} api_route_t;

typedef struct {
  api_route_t routes[256];
  size_t count;
} api_router_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `api_requests_total{method,path}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ API
* `api_response_duration{status}` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏
* `api_active_routes` ‚Äî —á–∏—Å–ª–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RBAC/ABAC –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç path traversal –∏ header injection
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `4.4 ‚Äî REST API`
* `4.5 ‚Äî GraphQL API`
* `4.11 ‚Äî gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å`
* `6.1 ‚Äî RBAC`
* `6.7 ‚Äî JWT —Ç–æ–∫–µ–Ω—ã`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_api_register_valid_route`
* `test_api_handle_known_route`
* `test_api_security_enforcement`
* `test_api_reload_route_table`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.8 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è observability-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.8 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è observability-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `observability_bootstrap`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∑–∞–ø—É—Å–∫ –ø–æ–¥—Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏: –º–µ—Ç—Ä–∏–∫–∏ (Prometheus/OpenMetrics), –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (stderr/syslog/binary), –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (OpenTelemetry). –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å observability-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —É–∂–µ –Ω–∞ —Ä–∞–Ω–Ω–µ–º —ç—Ç–∞–ø–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                               | –û–ø–∏—Å–∞–Ω–∏–µ                                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ------------------------ | -------------------------------------- | ----------------------------------------------------------------------- | ----------------- |
| `observability_init`     | `bool observability_init(void);`       | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã: –º–µ—Ç—Ä–∏–∫–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞, –ª–æ–≥–≥–∏–Ω–≥. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `metrics_start`          | `bool metrics_start(void);`            | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç Prometheus-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –º–µ—Ç—Ä–∏–∫.                   | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `tracing_start`          | `bool tracing_start(void);`            | –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É OpenTelemetry/Jaeger.                            | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `logging_init`           | `bool logging_init(const char *mode);` | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`stderr`, `syslog`, `binary`).                 | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `profiling_enable`       | `void profiling_enable(void);`         | –í–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.                           | `void`            |
| `observability_shutdown` | `void observability_shutdown(void);`   | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –≤—Å–µ observability-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.                       | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool metrics_enabled;
  bool tracing_enabled;
  bool logging_enabled;
  char logging_mode[16];  // "stderr", "syslog", "binary"
} observability_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `observability_init_duration` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* `metrics_exported_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
* `tracing_span_count` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–∞–Ω–æ–≤
* `logs_emitted_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –∑–∞–ø–∏—Å–µ–π –≤ –ª–æ–≥

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –∫–∞–Ω–∞–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫ (mTLS, ACL)
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –ø–æ —Ä–æ–ª—è–º/—Å–µ—Å—Å–∏—è–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —è–¥—Ä–∞`
* `7.1 ‚Äî –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫`
* `7.2 ‚Äî –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è`
* `7.3 ‚Äî –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤`
* `7.4 ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_observability_bootstrap`
* `test_metrics_start_success`
* `test_logging_binary_mode`
* `test_tracing_integration`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.9 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.9 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `system_threads_init`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤: –ø–æ—Ç–æ–∫–æ–≤ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏, –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á, —Å–±–æ—Ä—â–∏–∫–æ–≤ –º—É—Å–æ—Ä–∞ (GC), WAL-–≤–æ—Ä–∫–µ—Ä–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç NUMA-aware —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, CPU-affinity –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ------------------------- | ------------------------------------------------------------------------------------------- | ------------------------------------------------------------- | ----------------- |
| `system_threads_init_all` | `bool system_threads_init_all(void);`                                                       | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤ –Ω—É–∂–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.              | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `thread_spawn`            | `bool thread_spawn(const char *name, void *(*fn)(void *), void *arg, cpu_mask_t affinity);` | –°–æ–∑–¥–∞—ë—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –∏ CPU-affinity. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `thread_register`         | `void thread_register(const char *name, pthread_t tid);`                                    | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ.                       | `void`            |
| `thread_shutdown_all`     | `void thread_shutdown_all(void);`                                                           | –ü–æ—Å—ã–ª–∞–µ—Ç —Å–∏–≥–Ω–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ–º –ø–æ—Ç–æ–∫–∞–º –∏ –∂–¥—ë—Ç –∏—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è. | `void`            |
| `thread_get_status`       | `const char *thread_get_status(const char *name);`                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ—Ç–æ–∫–∞: `running`, `stopped`, `error`.      | –°—Ç–∞—Ç—É—Å            |
| `thread_dump_state`       | `void thread_dump_state(FILE *out);`                                                        | –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Ç–æ–∫–∞—Ö (–∏–º—è, PID, —Å—Ç–∞—Ç—É—Å).              | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  pthread_t tid;
  cpu_mask_t affinity;
  bool running;
} system_thread_t;

typedef struct {
  system_thread_t threads[128];
  size_t count;
} thread_registry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `system_thread_count` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
* `thread_status{name}` ‚Äî —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞
* `thread_lifetime{name}` ‚Äî –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –ø–æ—Ç–æ–∫–æ–≤
* `thread_affinity{name}` ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —è–¥—Ä–∞–º NUMA

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ—Ç–æ–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ CPU (–∏–∑ `resource_limits`)
* –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `0.5 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`
* `1.4 ‚Äî NUMA-aware –∞–ª–ª–æ–∫–∞—Ç–æ—Ä`
* `2.8 ‚Äî GC / Vacuum`
* `7.6 ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ latency/IOPS`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_thread_spawn_affinity`
* `test_thread_shutdown`
* `test_thread_status_tracking`
* `test_thread_registry_limit`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **0.10 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–≤–µ—Ä—Å–∏—è, ABI –∏ —Ç.–¥.)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 0.10 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–≤–µ—Ä—Å–∏—è, ABI –∏ —Ç.–¥.)

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `compatibility_checker`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, ABI, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤, –±–∏–Ω–∞—Ä–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏ –¥–≤–æ–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞ –°–£–ë–î –≤ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –ø–æ—Å–ª–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ------------------------------ | ----------------------------------------------------- | ---------------------------------------------------------------- | --------------------- |
| `compatibility_check_all`      | `bool compatibility_check_all(void);`                 | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏: –±–∏–Ω–∞—Ä–Ω—ã–µ, ABI, –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ     |
| `check_binary_version`         | `bool check_binary_version(const char *expected);`    | –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏—é –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ —Å –æ–∂–∏–¥–∞–µ–º–æ–π.                | `true` –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç |
| `check_config_schema_version`  | `bool check_config_schema_version(const char *file);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é —Å—Ö–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.                             | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ     |
| `check_storage_layout_version` | `bool check_storage_layout_version(void);`            | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é –∏ —Ñ–æ—Ä–º–∞—Ç layout –¥–∞–Ω–Ω—ã—Ö.                         | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ     |
| `check_abi_hash`               | `bool check_abi_hash(void);`                          | –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç ABI-—Ö—ç—à —Å —Ö—ç—à–µ–º, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.           | `true` –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ |
| `print_version_info`           | `void print_version_info(void);`                      | –í—ã–≤–æ–¥–∏—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–µ—Ä—Å–∏–∏ –∏ —Ñ–ª–∞–≥–∞—Ö —Å–±–æ—Ä–∫–∏.         | `void`                |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char compiled_version[32];
  char expected_version[32];
  uint32_t abi_hash;
  char build_flags[128];
} version_info_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `version_check_status` ‚Äî —Ñ–ª–∞–≥ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
* `abi_mismatch_detected_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ABI
* `startup_blocked_by_version` ‚Äî –ø—Ä–∏–∑–Ω–∞–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—É—Å–∫–∞ –ø–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ ABI —Ö—ç—à–∞ –∏—Å–∫–ª—é—á–∞–µ—Ç –∑–∞–ø—É—Å–∫ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤
* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–π
* –ó–∞—â–∏—Ç–∞ –æ—Ç downgrade-–∞—Ç–∞–∫–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞`
* `0.2 ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —è–¥—Ä–∞`
* `0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π`
* `11.8 ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_version_match`
* `test_abi_mismatch`
* `test_incompatible_config_schema`
* `test_storage_layout_check`

---

–ì–æ—Ç–æ–≤ –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –∏–∑ –ø–∞–∫–µ—Ç–∞ 0: **0.11 ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç –∑–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –¥–ª—è –ü–∞–∫–µ—Ç–∞ 0:

---

## üß© –ë–ª–æ–∫ 0.11 ‚Äî –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

**–ü–∞–∫–µ—Ç:** `0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç`
**Block ID:** `shutdown_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Ä–∞–±–æ—Ç—ã –°–£–ë–î. –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –≤—ã–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π, –æ—Å—Ç–∞–Ω–æ–≤–∫—É –ø–æ—Ç–æ–∫–æ–≤ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–Ω—è—Ç—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π, –∞ —Ç–∞–∫–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API –∏–ª–∏ CLI.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ----------------------------------------------------------- | ------------------------------------------------------------------- | ---------- |
| `shutdown_manager_run`      | `void shutdown_manager_run(int exit_code);`                 | –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–¥–æ–º.                 | `void`     |
| `shutdown_register_cleanup` | `void shutdown_register_cleanup(void (*cleanup_fn)(void));` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏ –¥–ª—è –≤—ã–∑–æ–≤–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏.             | `void`     |
| `shutdown_invoke_hooks`     | `void shutdown_invoke_hooks(void);`                         | –í—ã–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ. | `void`     |
| `shutdown_save_state`       | `void shutdown_save_state(void);`                           | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (WAL, —Å–µ—Å—Å–∏–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ).          | `void`     |
| `shutdown_log_summary`      | `void shutdown_log_summary(void);`                          | –õ–æ–≥–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—é–º–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è, —Ä–µ—Å—É—Ä—Å—ã, –æ—à–∏–±–∫–∏, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.         | `void`     |
| `shutdown_abort`            | `void shutdown_abort(const char *reason);`                  | –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å –≤—ã–≤–æ–¥–æ–º –ø—Ä–∏—á–∏–Ω—ã (panic).             | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void (*cleanup_fn)(void);
  char name[64];
} shutdown_hook_t;

typedef struct {
  shutdown_hook_t hooks[64];
  size_t hook_count;
  bool triggered;
  int exit_code;
} shutdown_state_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `shutdown_duration_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
* `shutdown_hook_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–≤–∞–Ω–Ω—ã—Ö —Ö—É–∫–æ–≤
* `shutdown_exit_code` ‚Äî –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
* `shutdown_clean` ‚Äî `true`, –µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±—ã–ª–æ —à—Ç–∞—Ç–Ω—ã–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
* –õ–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–≤
* –°–±—Ä–æ—Å —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.3 ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª–µ–π`
* `0.5 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å–∫–∞`
* `0.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`
* `0.9 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_shutdown_order`
* `test_shutdown_hooks_registration`
* `test_shutdown_panic_abort`
* `test_shutdown_state_saving`

---

–ü–∞–∫–µ—Ç 0 –∑–∞–≤–µ—Ä—à—ë–Ω ‚úÖ
–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É ‚Äî **–ü–∞–∫–µ—Ç 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **1.1 ‚Äî Row-store –¥–≤–∏–∂–æ–∫**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.1 ‚Äî Row-store –¥–≤–∏–∂–æ–∫

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `row_store_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∏–∂–æ–∫ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (row-oriented storage) –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π OLTP, —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø–æ–¥ in-memory –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –Ω–∏–∑–∫–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ point-lookup –æ–ø–µ—Ä–∞—Ü–∏–∏. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö insert/update/delete –∏ –Ω–µ–±–æ–ª—å—à–∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| ------------------------ | ------------------------------------------------------------------------------- | ------------------------------------------- | -------------------- |
| `row_store_init`         | `bool row_store_init(void);`                                                    | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–≤–∏–∂–æ–∫ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `row_store_create_table` | `row_table_t *row_store_create_table(const table_schema_t *schema);`            | –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É —Å row-oriented layout.      | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ç–∞–±–ª–∏—Ü—É |
| `row_store_insert`       | `bool row_store_insert(row_table_t *table, const row_t *row);`                  | –í—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É.            | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `row_store_update`       | `bool row_store_update(row_table_t *table, row_id_t id, const row_t *new_row);` | –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ ID.                     | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `row_store_delete`       | `bool row_store_delete(row_table_t *table, row_id_t id);`                       | –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ ID.                       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `row_store_scan`         | `row_iter_t *row_store_scan(row_table_t *table, const predicate_t *pred);`      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫ –ø–æ —É—Å–ª–æ–≤–∏—é.       | –ò—Ç–µ—Ä–∞—Ç–æ—Ä             |
| `row_store_free_table`   | `void row_store_free_table(row_table_t *table);`                                | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Ç–∞–±–ª–∏—Ü—ã.                | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t row_id;
  void *data;
} row_t;

typedef struct {
  row_t *rows;
  size_t row_count;
  table_schema_t *schema;
  rwlock_t lock;
} row_table_t;

typedef struct {
  size_t cursor;
  row_table_t *table;
  predicate_t *filter;
} row_iter_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `row_store_row_count{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ
* `row_store_insert_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—Å—Ç–∞–≤–∫–∏
* `row_store_point_lookup_latency_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ –ø–æ ID
* `row_store_scan_duration_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MVCC (—Å–º. –±–ª–æ–∫ 2.1) –¥–ª—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Å—Ç—Ä–æ–∫
* –ó–∞—â–∏—Ç–∞ –æ—Ç race condition –ø—Ä–∏ update/delete (rwlock)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.25 ‚Äî –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü`
* `2.1 ‚Äî MVCC –¥–≤–∏–∂–æ–∫`
* `3.12 ‚Äî SQL Executor`
* `6.3 ‚Äî Row-level Security`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_row_insert_and_read`
* `test_row_delete_and_gc`
* `test_row_scan_with_predicate`
* `test_row_update_consistency`
* `test_row_malformed_input`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.2 ‚Äî Column-store –¥–≤–∏–∂–æ–∫** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.2 ‚Äî Column-store –¥–≤–∏–∂–æ–∫

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `column_store_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

Column-store –¥–≤–∏–∂–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–æ–Ω–Ω–∞—Ä–Ω–æ–π —Ñ–æ—Ä–º–µ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Å–∫–∞–Ω–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —Å–∂–∞—Ç–∏–µ, –ø—Ä–æ–ø—É—Å–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (projection pushdown) –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é –Ω–∞ –∫–æ–ª–æ–Ω–∫–∞—Ö —Å –≤—ã—Å–æ–∫–æ–π —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| --------------------------- | ------------------------------------------------------------------------------------- | ----------------------------------------------------- | -------------------- |
| `column_store_init`         | `bool column_store_init(void);`                                                       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É column-store —Ç–∞–±–ª–∏—Ü.    | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `column_store_create_table` | `col_table_t *column_store_create_table(const table_schema_t *schema);`               | –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –≤ –∫–æ–ª–æ–Ω–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.                | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ç–∞–±–ª–∏—Ü—É |
| `column_store_append`       | `bool column_store_append(col_table_t *table, const column_batch_t *batch);`          | –î–æ–±–∞–≤–ª—è–µ—Ç –±–∞—Ç—á –∫–æ–ª–æ–Ω–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü—É.                     | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `column_store_scan`         | `col_iter_t *column_store_scan(col_table_t *table, const column_filter_t *filter);`   | –°–∫–∞–Ω–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∫–æ–ª–æ–Ω–Ω–∞—Ä–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤. | –ò—Ç–µ—Ä–∞—Ç–æ—Ä             |
| `column_store_get_column`   | `col_vector_t *column_store_get_column(col_table_t *table, const char *column_name);` | –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–æ–ª–æ–Ω–∫–µ.          | –ö–æ–ª–æ–Ω–Ω–∞              |
| `column_store_free_table`   | `void column_store_free_table(col_table_t *table);`                                   | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Ç–∞–±–ª–∏—Ü—ã.                          | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void *data;
  size_t count;
  data_type_t type;
} col_vector_t;

typedef struct {
  col_vector_t *columns;
  size_t column_count;
  size_t row_count;
  table_schema_t *schema;
  rwlock_t lock;
} col_table_t;

typedef struct {
  col_table_t *table;
  column_filter_t *filter;
  size_t batch_size;
  size_t current_index;
} col_iter_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `column_store_row_count{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
* `column_store_append_latency_ns` ‚Äî –≤—Ä–µ–º—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–∞—Ç—á–∞
* `column_store_scan_throughput` ‚Äî —Å—Ç—Ä–æ–∫–∏/—Å –∑–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
* `column_skipped_bytes_total` ‚Äî –æ–±—ä—ë–º –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º—ã
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å row-level –∏ column-level security

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.6 ‚Äî –°–∂–∞—Ç–∏–µ (dictionary, delta, RLE)`
* `1.26 ‚Äî Layout-aware execution`
* `3.13 ‚Äî –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä`
* `5.1 ‚Äî HTAP –ø–æ–¥–¥–µ—Ä–∂–∫–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_column_append_batch`
* `test_column_projection_pruning`
* `test_column_scan_filter`
* `test_column_vector_consistency`
* `test_column_store_schema_mismatch`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.3 ‚Äî JSON store –¥–≤–∏–∂–æ–∫** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.3 ‚Äî JSON store –¥–≤–∏–∂–æ–∫

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `json_store_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

JSON store —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–±–æ—Ä–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –º–∞—Å—Å–∏–≤—ã, path-based —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, JSON-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã SQL –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –¥–ª—è semi-structured –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω—ã–π JSON-–¥–≤–∏–∂–æ–∫ –¥–ª—è OLTP –∏ OLAP –Ω–∞–≥—Ä—É–∑–æ–∫.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ----------------------- | ----------------------------------------------------------------------------------------------- | --------------------------------------------------- | ----------------- |
| `json_store_init`       | `bool json_store_init(void);`                                                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è JSON-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `json_store_insert`     | `bool json_store_insert(json_table_t *table, const char *json_doc);`                            | –í—Å—Ç–∞–≤–ª—è–µ—Ç JSON-–¥–æ–∫—É–º–µ–Ω—Ç –∫–∞–∫ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å.            | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `json_store_query`      | `json_result_t *json_store_query(json_table_t *table, const json_query_t *query);`              | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã–±–æ—Ä–∫—É –ø–æ JSON-path –≤—ã—Ä–∞–∂–µ–Ω–∏—é –∏ —Ñ–∏–ª—å—Ç—Ä—É. | –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ |
| `json_store_index`      | `bool json_store_index(json_table_t *table, const char *json_path);`                            | –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏ –≤–Ω—É—Ç—Ä–∏ JSON.       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `json_store_delete`     | `bool json_store_delete(json_table_t *table, const json_predicate_t *pred);`                    | –£–¥–∞–ª—è–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—é.         | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `json_store_update`     | `bool json_store_update(json_table_t *table, const json_predicate_t *pred, const char *patch);` | –ü—Ä–∏–º–µ–Ω—è–µ—Ç JSON Patch –∫ –ø–æ–¥—Ö–æ–¥—è—â–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º.       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `json_store_free_table` | `void json_store_free_table(json_table_t *table);`                                              | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Ç–∞–±–ª–∏—Ü—ã.                        | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char *json_raw;
  size_t length;
  uint64_t internal_id;
} json_doc_t;

typedef struct {
  json_doc_t *documents;
  size_t doc_count;
  json_index_t *indexes;
  table_schema_t *schema;
  rwlock_t lock;
} json_table_t;

typedef struct {
  const char *json_path;
  const char *filter_expr;
} json_query_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `json_docs_total{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ JSON-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
* `json_query_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞
* `json_index_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö path-–∏–Ω–¥–µ–∫—Å–æ–≤
* `json_doc_size_avg` ‚Äî —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω–æ–≥–æ JSON (UTF-8, schema-aware)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ row-level –∏ field-level security
* –ó–∞—â–∏—Ç–∞ –æ—Ç JSON-–∏–Ω—ä–µ–∫—Ü–∏–π –≤ path-–≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.11 ‚Äî Inverted Index`
* `3.2 ‚Äî JSON SQL-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è`
* `4.23 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ JSON`
* `5.1 ‚Äî HTAP –ø–æ–¥–¥–µ—Ä–∂–∫–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_json_insert_valid`
* `test_json_path_query`
* `test_json_index_usage`
* `test_json_delete_predicate`
* `test_json_update_patch`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.4 ‚Äî NUMA-aware –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –∏ CPU-affinity** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.4 ‚Äî NUMA-aware –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –∏ CPU-affinity

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `numa_allocator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç NUMA-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏ CPU-affinity –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ –∏ –∑–∞–¥–∞—á. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏, –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ----------------------- | ----------------------------------------------------- | ---------------------------------------------------------- | ----------------- |
| `numa_allocator_init`   | `bool numa_allocator_init(void);`                     | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç NUMA-–∫–∞—Ä—Ç—É —É–∑–ª–æ–≤ –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —è–¥–µ—Ä.       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `numa_alloc_on_node`    | `void *numa_alloc_on_node(size_t size, int node_id);` | –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–º NUMA-—É–∑–ª–µ.                     | –£–∫–∞–∑–∞—Ç–µ–ª—å         |
| `numa_thread_bind`      | `bool numa_thread_bind(pthread_t tid, int cpu_id);`   | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CPU-affinity –¥–ª—è –ø–æ—Ç–æ–∫–∞.                     | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `numa_get_node_for_cpu` | `int numa_get_node_for_cpu(int cpu_id);`              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç NUMA-—É–∑–µ–ª, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω CPU.             | ID —É–∑–ª–∞           |
| `numa_free`             | `void numa_free(void *ptr, size_t size);`             | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é NUMA-–ø–∞–º—è—Ç—å.                  | `void`            |
| `numa_local_alloc`      | `void *numa_local_alloc(size_t size);`                | –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º NUMA-—É–∑–ª–µ –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞. | –£–∫–∞–∑–∞—Ç–µ–ª—å         |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  int cpu_id;
  int numa_node;
  bool available;
} cpu_info_t;

typedef struct {
  cpu_info_t cpus[256];
  size_t cpu_count;
  int default_node;
} numa_topology_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `numa_alloc_total_bytes{node}` ‚Äî –æ–±—ä—ë–º –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø–æ NUMA-—É–∑–ª–∞–º
* `numa_affinity_set_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö affinity
* `numa_cross_node_access_total` ‚Äî —á–∏—Å–ª–æ –∫—Ä–æ—Å—Å-—É–∑–ª–æ–≤—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤
* `numa_memory_locality_ratio` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —è–¥—Ä–∞–º –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
* –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–Ω–µ NUMA-–¥–∏–∞–ø–∞–∑–æ–Ω–∞
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø–æ –ø—Ä–æ—Ñ–∏–ª—é (resource limits)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.9 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤`
* `8.12 ‚Äî Prefetch engine / memory locality`
* `16.2 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è CPU –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏/—Ç–µ–Ω–∞–Ω—Ç–∞–º–∏`
* `16.3 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏ (RAM quotas)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_numa_alloc_on_specific_node`
* `test_numa_thread_affinity`
* `test_numa_free_and_reuse`
* `test_numa_locality_balance`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.5 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ PAX / Apache Arrow** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.5 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ PAX / Apache Arrow

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `pax_arrow_layout`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–≤—É—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏:

* **PAX (Partition Attributes Across)** ‚Äî –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö OLTP/OLAP —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
* **Apache Arrow** ‚Äî –∫—ç—à-—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –∫–æ–ª–æ–Ω–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –Ω–∞—Ç–∏–≤–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏ (PyArrow, Gandiva, etc.)

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç—Ç–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ zero-copy –æ–±—Ä–∞–±–æ—Ç–∫—É.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ------------------------- | ----------------------------------------------------------------------------------- | --------------------------------------------------- | ----------------- |
| `pax_create_block`        | `pax_block_t *pax_create_block(const table_schema_t *schema);`                      | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π PAX-–±–ª–æ–∫ –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ö–µ–º–µ.           | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–ª–æ–∫ |
| `pax_insert_row`          | `bool pax_insert_row(pax_block_t *block, const row_t *row);`                        | –í—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ PAX-–±–ª–æ–∫.                        | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `pax_scan_column`         | `col_vector_t *pax_scan_column(pax_block_t *block, const char *column_name);`       | –ü–æ–ª—É—á–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä –ø–æ –∫–æ–ª–æ–Ω–∫–µ –±–µ–∑ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫. | –ö–æ–ª–æ–Ω–Ω–∞           |
| `arrow_serialize_batch`   | `bool arrow_serialize_batch(arrow_batch_t *batch, uint8_t **out, size_t *out_len);` | –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç Arrow-–±–∞—Ç—á –≤ –±–∏–Ω–∞—Ä–Ω—ã–π –±—É—Ñ–µ—Ä.            | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `arrow_deserialize_batch` | `arrow_batch_t *arrow_deserialize_batch(const uint8_t *buf, size_t len);`           | –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç Arrow-–±–∞—Ç—á –∏–∑ –±—É—Ñ–µ—Ä–∞.                 | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –±–∞—Ç—á |
| `arrow_export_schema`     | `char *arrow_export_schema(const table_schema_t *schema);`                          | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å—Ö–µ–º—É –≤ Arrow-compatible —Ñ–æ—Ä–º–∞—Ç.        | JSON-—Å—Ç—Ä–æ–∫–∞       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void **columns;  // –º–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–µ–∫—Ç–æ—Ä—ã –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º
  size_t row_count;
  size_t column_count;
  table_schema_t *schema;
} pax_block_t;

typedef struct {
  void *arrow_array;     // opaque pointer
  void *arrow_schema;    // opaque pointer
  size_t record_count;
} arrow_batch_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `pax_blocks_created_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö PAX-–±–ª–æ–∫–æ–≤
* `arrow_batches_serialized_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–π Arrow
* `pax_row_insert_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—Å—Ç–∞–≤–∫–∏ —Å—Ç—Ä–æ–∫–∏
* `arrow_batch_size_bytes_avg` ‚Äî —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä Arrow-–±–∞—Ç—á–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –ø–µ—Ä–µ–¥ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ Arrow-–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ zero-copy –ø–µ—Ä–µ–¥–∞—á–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.26 ‚Äî Layout-aware execution`
* `3.13 ‚Äî –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä`
* `4.25 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ Parquet (–Ω–∞ –æ—Å–Ω–æ–≤–µ Arrow)`
* `5.20 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_pax_block_creation_and_insert`
* `test_pax_column_projection`
* `test_arrow_batch_roundtrip`
* `test_arrow_schema_conversion`
* `test_arrow_invalid_buffer_input`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.6 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ frame-of-reference / –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.6 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ frame-of-reference / –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `vector_compression`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ **Frame-of-Reference (FOR)**, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏**. –≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ column-store, Arrow, time-series –∏ snapshot –¥–≤–∏–∂–∫–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                      | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| -------------------------------- | --------------------------------------------------------------------------------- | ------------------------------------------------------ | ----------------- |
| `for_compress`                   | `bool for_compress(const int64_t *input, size_t count, for_block_t *out_block);`  | –°–∂–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ int64\_t –∑–Ω–∞—á–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º FOR. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `for_decompress`                 | `bool for_decompress(const for_block_t *block, int64_t *out);`                    | –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –º–∞—Å—Å–∏–≤ –∏–∑ FOR-–±–ª–æ–∫–∞.                        | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ |
| `for_get_reference`              | `int64_t for_get_reference(const for_block_t *block);`                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞.                     | –ó–Ω–∞—á–µ–Ω–∏–µ          |
| `for_compress_vector`            | `bool for_compress_vector(const col_vector_t *input, for_block_t *out_block);`    | –°–∂–∏–º–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä –∫–æ–ª–æ–Ω–Ω—ã.                                | `true`            |
| `for_decompress_vector`          | `bool for_decompress_vector(const for_block_t *block, col_vector_t *out_vector);` | –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –≤–µ–∫—Ç–æ—Ä.                                     | `true`            |
| `for_estimate_compression_ratio` | `float for_estimate_compression_ratio(const int64_t *input, size_t count);`       | –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è.                | float (0.0‚Äì1.0)   |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  int64_t reference;
  uint32_t *deltas;
  size_t count;
  uint8_t bit_width;
} for_block_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `for_compression_ratio{table,column}` ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∂–∞—Ç–∏—è
* `for_block_count_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ FOR-–±–ª–æ–∫–æ–≤
* `for_decompression_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—é
* `for_failures_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è delta –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ –ø—Ä–∏ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ safe memory API (zeroed alloc, checked free)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.2 ‚Äî Column-store –¥–≤–∏–∂–æ–∫`
* `1.5 ‚Äî PAX / Apache Arrow –ø–æ–¥–¥–µ—Ä–∂–∫–∞`
* `5.10 ‚Äî Time Series –¥–≤–∏–∂–æ–∫`
* `8.13 ‚Äî Format-aware execution`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_for_block_compression_decompression`
* `test_for_vector_accuracy`
* `test_for_overflow_handling`
* `test_for_estimator_accuracy`
* `test_for_zero_delta_block`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.7 ‚Äî –°–∂–∞—Ç–∏–µ: dictionary, delta, RLE** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.7 ‚Äî –°–∂–∞—Ç–∏–µ: dictionary, delta, RLE

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `compression_engines`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —Å–∂–∞—Ç–∏—è, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–ª—è in-memory —Ö—Ä–∞–Ω–µ–Ω–∏—è:

* **Dictionary compression** ‚Äî –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏;
* **Delta encoding** ‚Äî –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫;
* **Run-Length Encoding (RLE)** ‚Äî –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ —Å —á–∞—Å—Ç—ã–º–∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π.

–≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã —É–º–µ–Ω—å—à–∞—é—Ç –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏ –∏ –ø–æ–≤—ã—à–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ OLTP –Ω–∞–≥—Ä—É–∑–∫–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------ | ------------------------------------------------------------------------------------ | ----------------------------------------------------- | ---------- |
| `dict_compress`    | `bool dict_compress(const char **input, size_t count, dict_block_t *out_block);`     | –°–∂–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞—Ä—å.             | `true`     |
| `dict_decompress`  | `bool dict_decompress(const dict_block_t *block, char **output);`                    | –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Å–ª–æ–≤–∞—Ä—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.   | `true`     |
| `delta_compress`   | `bool delta_compress(const int64_t *input, size_t count, delta_block_t *out_block);` | –°–∂–∏–º–∞–µ—Ç —á–∏—Å–ª–æ–≤–æ–π –≤–µ–∫—Ç–æ—Ä —Å –ø–æ–º–æ—â—å—é –¥–µ–ª—å—Ç–∞-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è. | `true`     |
| `delta_decompress` | `bool delta_decompress(const delta_block_t *block, int64_t *output);`                | –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –¥–µ–ª—å—Ç–∞-–±–ª–æ–∫ –≤ –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.           | `true`     |
| `rle_compress`     | `bool rle_compress(const int64_t *input, size_t count, rle_block_t *out_block);`     | –°–∂–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é RLE.                       | `true`     |
| `rle_decompress`   | `bool rle_decompress(const rle_block_t *block, int64_t *output);`                    | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ RLE-–±–ª–æ–∫–∞.                | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char **dictionary;
  uint16_t *indexes;
  size_t dict_size;
  size_t count;
} dict_block_t;

typedef struct {
  int64_t base;
  int32_t *deltas;
  size_t count;
} delta_block_t;

typedef struct {
  int64_t *values;
  uint32_t *run_lengths;
  size_t run_count;
} rle_block_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `compression_ratio{algorithm,column}` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è
* `compression_latency_ns{algorithm}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
* `decompression_latency_ns{algorithm}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
* `compressed_bytes_total{algorithm}` ‚Äî –æ–±—â–∏–π –æ–±—ä—ë–º —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∏–Ω–¥–µ–∫—Å–∞–º –∏ run-length
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤ —Å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º–æ–π (CRC32)
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–æ–≤ —Å zero-padding

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.2 ‚Äî Column-store`
* `1.6 ‚Äî Frame-of-reference`
* `5.10 ‚Äî Time Series`
* `8.15 ‚Äî –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ –≥–æ—Ä—è—á–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_dict_compression_uniqueness`
* `test_delta_compress_roundtrip`
* `test_rle_on_repeat_values`
* `test_rle_sparse_distribution`
* `test_dict_overflow_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.8 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: B+ Tree** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.8 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: B+ Tree

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `b_plus_tree_index`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å B+ Tree, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞, –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –∏ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä–æ–∫–∞–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ row-store, column-store –∏ JSON store –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∏ –≤—Ç–æ—Ä–∏—á–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –¥–µ—Ä–µ–≤–∞, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤—Å—Ç–∞–≤–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ------------------- | --------------------------------------------------------------------------- | ------------------------------------------------------ | --------------------- |
| `bptree_create`     | `bptree_t *bptree_create(data_type_t key_type);`                            | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π B+ Tree –∏–Ω–¥–µ–∫—Å –ø–æ —Ç–∏–ø—É –∫–ª—é—á–∞.            | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∏–Ω–¥–µ–∫—Å   |
| `bptree_insert`     | `bool bptree_insert(bptree_t *tree, key_t key, row_id_t row_id);`           | –í—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª—é—á –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫–∏. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ     |
| `bptree_find`       | `bool bptree_find(bptree_t *tree, key_t key, row_id_t *out);`               | –ù–∞—Ö–æ–¥–∏—Ç —Å—Ç—Ä–æ–∫—É –ø–æ —Ç–æ—á–Ω–æ–º—É –∫–ª—é—á—É.                       | `true`, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω   |
| `bptree_range_scan` | `bptree_iter_t *bptree_range_scan(bptree_t *tree, key_t start, key_t end);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –∑–Ω–∞—á–µ–Ω–∏–π.             | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∏—Ç–µ—Ä–∞—Ç–æ—Ä |
| `bptree_delete`     | `bool bptree_delete(bptree_t *tree, key_t key);`                            | –£–¥–∞–ª—è–µ—Ç –∫–ª—é—á –∏–∑ –¥–µ—Ä–µ–≤–∞.                                | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ     |
| `bptree_destroy`    | `void bptree_destroy(bptree_t *tree);`                                      | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –¥–µ—Ä–µ–≤–æ –∏ –µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.                     | `void`                |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct bptree_node_t {
  bool is_leaf;
  size_t key_count;
  key_t *keys;
  union {
    struct bptree_node_t **children;
    row_id_t *row_ids;
  };
} bptree_node_t;

typedef struct {
  bptree_node_t *root;
  data_type_t key_type;
  size_t height;
} bptree_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `bptree_height` ‚Äî –≤—ã—Å–æ—Ç–∞ –¥–µ—Ä–µ–≤–∞
* `bptree_node_count` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤
* `bptree_lookup_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞
* `bptree_range_scan_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
* –ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ split/merge
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–µ—Ä–µ–≤–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏ –≤—Å—Ç–∞–≤–∫–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.1 ‚Äî Row-store`
* `1.2 ‚Äî Column-store`
* `3.12 ‚Äî SQL Executor`
* `6.3 ‚Äî Row-level Security`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_bptree_insert_and_find`
* `test_bptree_delete_leaf_entry`
* `test_bptree_range_scan_correctness`
* `test_bptree_rebalance_after_split`
* `test_bptree_duplicate_key_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.9 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Hash Index** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.9 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Hash Index

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `hash_index`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **Hash Index** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ç–æ—á–Ω–æ–º—É –∫–ª—é—á—É. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è `point lookup` –æ–ø–µ—Ä–∞—Ü–∏–π (–≤—Å—Ç–∞–≤–∫–∞, —á—Ç–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ) —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **O(1)** –≤ —Å—Ä–µ–¥–Ω–µ–º —Å–ª—É—á–∞–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–∞–∫–µ—Ç–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–ª–ª–∏–∑–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| -------------------- | -------------------------------------------------------------------------- | -------------------------------------------------- | -------------------- |
| `hash_index_create`  | `hash_index_t *hash_index_create(data_type_t key_type);`                   | –°–æ–∑–¥–∞—ë—Ç –ø—É—Å—Ç–æ–π —Ö–µ—à-–∏–Ω–¥–µ–∫—Å –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ç–∏–ø—É –∫–ª—é—á–∞. | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∏–Ω–¥–µ–∫—Å  |
| `hash_index_insert`  | `bool hash_index_insert(hash_index_t *index, key_t key, row_id_t row_id);` | –í—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª—é—á –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫–∏.   | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `hash_index_find`    | `bool hash_index_find(hash_index_t *index, key_t key, row_id_t *out);`     | –ò—â–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ —Ç–æ—á–Ω–æ–º—É –∫–ª—é—á—É.                      | `true`, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ |
| `hash_index_delete`  | `bool hash_index_delete(hash_index_t *index, key_t key);`                  | –£–¥–∞–ª—è–µ—Ç –∫–ª—é—á –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.            | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `hash_index_resize`  | `bool hash_index_resize(hash_index_t *index, size_t new_capacity);`        | –†–∞—Å—à–∏—Ä—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∏ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∞–∫–µ—Ç—ã.       | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `hash_index_destroy` | `void hash_index_destroy(hash_index_t *index);`                            | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Ö–µ—à-–∏–Ω–¥–µ–∫—Å–∞.                   | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct hash_entry_t {
  key_t key;
  row_id_t row_id;
  struct hash_entry_t *next;  // for chaining
} hash_entry_t;

typedef struct {
  hash_entry_t **buckets;
  size_t bucket_count;
  data_type_t key_type;
  size_t size;
} hash_index_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `hash_index_size{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
* `hash_index_collisions_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –∫–æ–ª–ª–∏–∑–∏–π
* `hash_index_load_factor` ‚Äî —Ç–µ–∫—É—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏
* `hash_index_resize_count` ‚Äî —á–∏—Å–ª–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ (max chain length)
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤ –∫–ª—é—á–µ–π (strict typing)
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–æ–π—á–∏–≤—ã—Ö —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏–π —Å seed'–æ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.1 ‚Äî Row-store`
* `3.12 ‚Äî SQL Executor`
* `2.1 ‚Äî MVCC` (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏)
* `6.3 ‚Äî Row-level Security`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_hash_index_insert_and_lookup`
* `test_hash_index_collision_handling`
* `test_hash_index_resize_during_load`
* `test_hash_index_type_mismatch`
* `test_hash_index_deletion_integrity`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.10 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Bitmap Index** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.10 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Bitmap Index

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `bitmap_index`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

Bitmap Index –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º —Å –Ω–∏–∑–∫–æ–π –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ–ª–∞–≥–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å—Ç–∞—Ç—É—Å—ã). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∏ —É—Å–∫–æ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è WHERE –∏ GROUP BY —á–µ—Ä–µ–∑ –ø–æ–±–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç          |
| ------------------------- | --------------------------------------------------------------------------------------- | --------------------------------------------------- | ------------------- |
| `bitmap_index_create`     | `bitmap_index_t *bitmap_index_create(const char *column_name);`                         | –°–æ–∑–¥–∞—ë—Ç bitmap-–∏–Ω–¥–µ–∫—Å –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏.        | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∏–Ω–¥–µ–∫—Å |
| `bitmap_index_insert`     | `bool bitmap_index_insert(bitmap_index_t *index, value_t value, row_id_t row_id);`      | –î–æ–±–∞–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –±–∏—Ç–æ–≤—É—é –º–∞—Å–∫—É. | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ   |
| `bitmap_index_get_bitmap` | `bitmap_t *bitmap_index_get_bitmap(bitmap_index_t *index, value_t value);`              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∏—Ç–æ–≤—É—é –º–∞—Å–∫—É –¥–ª—è –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.    | `bitmap_t*`         |
| `bitmap_index_remove`     | `bool bitmap_index_remove(bitmap_index_t *index, row_id_t row_id);`                     | –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ –≤—Å–µ—Ö –±–∏—Ç–º–∞–ø–æ–≤.                    | `true`              |
| `bitmap_index_scan`       | `row_id_t *bitmap_index_scan(bitmap_index_t *index, value_t value, size_t *out_count);` | –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é.                  | –ú–∞—Å—Å–∏–≤ row\_id      |
| `bitmap_index_destroy`    | `void bitmap_index_destroy(bitmap_index_t *index);`                                     | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –∏ –µ–≥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.                 | `void`              |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  value_t value;
  bitmap_t *bitset;
} bitmap_entry_t;

typedef struct {
  char column_name[64];
  bitmap_entry_t *entries;
  size_t entry_count;
  size_t row_capacity;
} bitmap_index_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `bitmap_index_entry_count{column}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
* `bitmap_index_memory_bytes` ‚Äî –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏, –∑–∞–Ω—è—Ç–æ–π –±–∏—Ç–º–∞–ø–∞–º–∏
* `bitmap_filter_hits_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
* `bitmap_merge_latency_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–±–∏—Ç–æ–≤–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –º–∞—Å–æ–∫ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∏—Ç–æ–≤–æ–π –∫–∞—Ä—Ç—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ MVCC –±–∏—Ç–º–∞–ø—ã

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.2 ‚Äî Column-store`
* `3.9 ‚Äî Rule-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è` (pushdown —Ñ–∏–ª—å—Ç—Ä—ã)
* `3.13 ‚Äî –°—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä`
* `5.5 ‚Äî ROLLUP / CUBE –∞–≥—Ä–µ–≥–∞—Ü–∏–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_bitmap_insert_and_filter`
* `test_bitmap_removal_consistency`
* `test_bitmap_scan_accuracy`
* `test_bitmap_memory_usage`
* `test_bitmap_overflow_protection`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.11 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Inverted Index** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.11 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Inverted Index

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `inverted_index`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

Inverted Index –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∏ –ø–æ–ª—É—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (JSON, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ª–æ–≥–æ–≤), –ø–æ–∑–≤–æ–ª—è—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —Ç–æ–∫–µ–Ω–∞–º, –ø–æ–∏—Å–∫–æ–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç—ã –≤–∏–¥–∞ `CONTAINS`, `MATCH`, `LIKE`, `REGEXP`.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç          |
| ------------------------ | -------------------------------------------------------------------------------------------- | -------------------------------------------------- | ------------------- |
| `inverted_index_create`  | `inverted_index_t *inverted_index_create(const char *column);`                               | –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º.              | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –∏–Ω–¥–µ–∫—Å |
| `inverted_index_insert`  | `bool inverted_index_insert(inverted_index_t *index, row_id_t row_id, const char *text);`    | –¢–æ–∫–µ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å.             | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ   |
| `inverted_index_query`   | `row_id_t *inverted_index_query(inverted_index_t *index, const char *query, size_t *count);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é.           | –ú–∞—Å—Å–∏–≤ row\_id      |
| `inverted_index_remove`  | `bool inverted_index_remove(inverted_index_t *index, row_id_t row_id);`                      | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–æ–∫–µ–Ω—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π. | `true`              |
| `inverted_index_stats`   | `void inverted_index_stats(inverted_index_t *index, FILE *out);`                             | –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–æ–∫–µ–Ω–∞–º –∏ —Ä–∞–∑–º–µ—Ä—É.           | `void`              |
| `inverted_index_destroy` | `void inverted_index_destroy(inverted_index_t *index);`                                      | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–Ω–¥–µ–∫—Å–∞.                 | `void`              |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char *token;
  row_id_t *postings;
  size_t count;
} inverted_token_entry_t;

typedef struct {
  inverted_token_entry_t *entries;
  size_t entry_count;
  char column[64];
} inverted_index_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `inverted_index_token_count{column}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
* `inverted_index_posting_list_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ posting list
* `inverted_query_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞
* `inverted_index_size_bytes` ‚Äî –æ–±—â–∏–π –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ —Å —É—á—ë—Ç–æ–º RLS (row-level security)
* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏/–≥–ª—É–±–∏–Ω–µ)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.3 ‚Äî JSON store`
* `3.2 ‚Äî SQL JSON / MATCH_RECOGNIZE`
* `5.6 ‚Äî –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏`
* `6.3 ‚Äî Row-level security`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_inverted_tokenization`
* `test_inverted_query_result_accuracy`
* `test_inverted_index_removal`
* `test_inverted_index_size_control`
* `test_inverted_match_regex_safety`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.12 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Adaptive Indexing** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.12 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è: Adaptive Indexing

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `adaptive_indexing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é (adaptive indexing)**, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã "–Ω–∞ –ª–µ—Ç—É" –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –¥–æ—Å—Ç—É–ø–∞. –≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –≤—Ä–µ–º—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å—Ö–µ–º—ã, —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —è–≤–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏–∑–¥–µ—Ä–∂–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                      | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                                     | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------ | -------------------- |
| `adaptive_index_init`            | `bool adaptive_index_init(void);`                                                                                              | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—É –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏.             | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ    |
| `adaptive_index_track_access`    | `void adaptive_index_track_access(const char *table, const char *column, const predicate_t *pred);`                            | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–æ–Ω–∫–µ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º.              | `void`               |
| `adaptive_index_build_if_needed` | `void adaptive_index_build_if_needed(const char *table, const char *column);`                                                  | –†–µ—à–∞–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å, –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ.     | `void`               |
| `adaptive_index_query`           | `bool adaptive_index_query(const char *table, const char *column, const predicate_t *pred, row_id_t **result, size_t *count);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞.       | `true`, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ |
| `adaptive_index_evict`           | `void adaptive_index_evict(const char *table, const char *column);`                                                            | –£–¥–∞–ª—è–µ—Ç –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∏–ª–∏ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã.         | `void`               |
| `adaptive_index_stats`           | `void adaptive_index_stats(FILE *out);`                                                                                        | –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: –≥–¥–µ, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–∏–µ –∏–Ω–¥–µ–∫—Å—ã –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã. | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char column[64];
  uint64_t access_count;
  bool is_indexed;
  bitmap_index_t *bitmap_index;
} adaptive_index_entry_t;

typedef struct {
  adaptive_index_entry_t entries[512];
  size_t count;
} adaptive_index_catalog_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `adaptive_index_created_total{column}` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
* `adaptive_index_access_count{column}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –∫–æ–ª–æ–Ω–∫–µ
* `adaptive_index_query_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å
* `adaptive_index_evicted_total` ‚Äî —á–∏—Å–ª–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RLS –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –¥–∞–Ω–Ω—ã–º —á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
* –ó–∞—â–∏—Ç–∞ –æ—Ç DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
* –õ–∏–º–∏—Ç –Ω–∞ —Ä–∞–∑–º–µ—Ä –∏–Ω–¥–µ–∫—Å–∞ –∏ TTL-—ç–≤–∏–∫—à–Ω

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.2 ‚Äî Column-store`
* `1.10 ‚Äî Bitmap Index`
* `3.9 ‚Äî Rule-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è`
* `8.10 ‚Äî Feedback-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_adaptive_index_creation_on_access`
* `test_adaptive_index_query_accuracy`
* `test_adaptive_index_eviction_policy`
* `test_adaptive_index_stats_output`
* `test_adaptive_index_limit_enforcement`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.13 ‚Äî TTL, Eviction, Auto-tiering** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.13 ‚Äî TTL, Eviction, Auto-tiering

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `ttl_eviction_tiering`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (TTL)**, **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (auto-tiering)** –∏ **—ç–≤–∏–∫—à–Ω–∞ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä—è—á–∏–º–∏, —Ç—ë–ø–ª—ã–º–∏ –∏ —Ö–æ–ª–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ in-memory/SSD/NVMe —Å–ª–æ—è—Ö, –∞ —Ç–∞–∫–∂–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç       |
| ----------------------- | ----------------------------------------------------------------------------------------- | ------------------------------------------------------ | ---------------- |
| `ttl_manager_init`      | `bool ttl_manager_init(void);`                                                            | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—É TTL –∏ —ç–≤–∏–∫—à–Ω–∞.               | `true`           |
| `ttl_register_table`    | `bool ttl_register_table(const char *table, ttl_policy_t policy);`                        | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π TTL.                  | `true`           |
| `ttl_check_and_evict`   | `size_t ttl_check_and_evict(uint64_t current_time_ns);`                                   | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ TTL.                      | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö |
| `auto_tiering_scan`     | `bool auto_tiering_scan(const char *table);`                                              | –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–æ—Ä—è—á–µ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –º–µ–∂–¥—É —Å–ª–æ—è–º–∏. | `true`           |
| `mark_data_temperature` | `void mark_data_temperature(const char *table, row_id_t row, temperature_level_t level);` | –û—Ç–º–µ—á–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–æ "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ" –¥–æ—Å—Ç—É–ø–∞.              | `void`           |
| `tiering_stats_dump`    | `void tiering_stats_dump(FILE *out);`                                                     | –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —É—Ä–æ–≤–Ω—è–º —Ö—Ä–∞–Ω–µ–Ω–∏—è.                | `void`           |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  TEMP_HOT,
  TEMP_WARM,
  TEMP_COLD
} temperature_level_t;

typedef struct {
  uint64_t ttl_ns;
  bool auto_evict;
} ttl_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ttl_evicted_rows_total{table}` ‚Äî —É–¥–∞–ª–µ–Ω–æ —Å—Ç—Ä–æ–∫ –ø–æ TTL
* `tiering_transition_count{from,to}` ‚Äî –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏
* `data_temperature_distribution{level}` ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ "—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ"
* `ttl_check_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è TTL

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º MVCC
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ row-level security –ø—Ä–∏ —ç–≤–∏–∫—à–Ω–µ
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è min temperature)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.22 ‚Äî –ì–æ—Ä—è—á–∏–µ –∏ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`
* `1.24 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º—ã —ç–≤–∏–∫—à–Ω–∞ (LRU / ARC)`
* `2.8 ‚Äî GC / Vacuum`
* `8.15 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π –ø–æ –≥–æ—Ä—è—á–µ—Å—Ç–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_ttl_eviction_triggered`
* `test_tier_transition_hot_to_cold`
* `test_ttl_policy_registration`
* `test_temperature_metrics_accuracy`
* `test_eviction_mvcc_consistency`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.14 ‚Äî –ê–≤—Ç–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (sharding, partitioning, planner)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.14 ‚Äî –ê–≤—Ç–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (sharding, partitioning, planner)

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `auto_rebalancing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏ –∏ –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**, **–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏**, **–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è** –∏ **–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**. –û–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü, –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–ª–∞–Ω—ã –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | --------------------------------------------------------------------------------- | ------------------------------------------------------- | ---------- |
| `sharding_planner_init`     | `bool sharding_planner_init(void);`                                               | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —à–∞—Ä–¥–∏–Ω–≥–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.    | `true`     |
| `table_shard_plan`          | `shard_plan_t *table_shard_plan(const char *table);`                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω —à–∞—Ä–¥–∏–Ω–≥–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.           | –ü–ª–∞–Ω       |
| `trigger_auto_rebalance`    | `bool trigger_auto_rebalance(void);`                                              | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –ø–æ –Ω–æ–¥–∞–º/—à–∞—Ä–¥–∞–º. | `true`     |
| `rebalance_table_fragments` | `bool rebalance_table_fragments(const char *table);`                              | –ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã.                      | `true`     |
| `partition_create`          | `bool partition_create(const char *table, const partition_rule_t *rule);`         | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É.           | `true`     |
| `partition_move`            | `bool partition_move(const char *table, uint32_t part_id, uint32_t target_node);` | –ú–∏–≥—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏—é –Ω–∞ –¥—Ä—É–≥–æ–π —É–∑–µ–ª.                      | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint32_t shard_id;
  uint32_t node_id;
  range_t key_range;
} shard_assignment_t;

typedef struct {
  shard_assignment_t *assignments;
  size_t count;
} shard_plan_t;

typedef struct {
  char column[64];
  range_t range;
  uint32_t target_node;
} partition_rule_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `rebalance_operations_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–µ–±–∞–ª–∞–Ω—Å–æ–≤
* `fragment_migration_latency` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
* `data_skew_ratio{table}` ‚Äî –¥–∏—Å–±–∞–ª–∞–Ω—Å –æ–±—ä—ë–º–∞ –º–µ–∂–¥—É —à–∞—Ä–¥/—É–∑–ª–∞–º–∏
* `partition_count_total{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏ (MVCC, snapshot)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞
* ACL-–∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–∞—Ä—Ç–∏—Ü–∏–π (–¥–ª—è multi-tenant)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.25 ‚Äî –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü`
* `2.20 ‚Äî Snapshot ‚Üî Replica –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è`
* `16.1 ‚Äî Multi-tenant —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ`
* `20.4 ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rebalance_trigger`
* `test_shard_plan_consistency`
* `test_partition_creation_and_move`
* `test_rebalance_under_load`
* `test_skew_detection_accuracy`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.15 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (AS OF)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.15 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (AS OF)

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `system_versioned_tables`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **SYSTEM VERSIONED** —Ç–∞–±–ª–∏—Ü, –ø–æ–∑–≤–æ–ª—è—è –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ (`AS OF TIMESTAMP`, `AS OF SYSTEM TIME`). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å SQL:2011 Temporal Tables.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç          |
| --------------------------- | ------------------------------------------------------------------------------------------------------- | ------------------------------------------------------- | ------------------- |
| `versioned_table_enable`    | `bool versioned_table_enable(const char *table);`                                                       | –í–∫–ª—é—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.         | `true` –ø—Ä–∏ —É—Å–ø–µ—Ö–µ   |
| `versioned_table_insert`    | `bool versioned_table_insert(versioned_table_t *table, const row_t *row, uint64_t timestamp);`          | –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π.   | `true`              |
| `versioned_table_get_as_of` | `row_t *versioned_table_get_as_of(versioned_table_t *table, row_id_t id, uint64_t ts);`                 | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É, –∞–∫—Ç—É–∞–ª—å–Ω—É—é –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.        | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É |
| `versioned_scan_range`      | `versioned_iter_t *versioned_scan_range(versioned_table_t *table, uint64_t ts_start, uint64_t ts_end);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ —Å—Ç—Ä–æ–∫–∞–º, –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ. | –ò—Ç–µ—Ä–∞—Ç–æ—Ä            |
| `versioned_gc`              | `size_t versioned_gc(versioned_table_t *table, uint64_t ts_cutoff);`                                    | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫.                        | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö    |
| `versioned_table_disable`   | `void versioned_table_disable(const char *table);`                                                      | –û—Ç–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.                        | `void`              |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  row_id_t row_id;
  row_t *version_chain;      // —Å–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π (MVCC)
  uint64_t valid_from;
  uint64_t valid_to;
} versioned_row_t;

typedef struct {
  versioned_row_t *rows;
  size_t row_count;
  table_schema_t *schema;
} versioned_table_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `versioned_rows_total{table}` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –≤–µ—Ä—Å–∏–π —Å—Ç—Ä–æ–∫
* `as_of_queries_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ AS OF –∑–∞–ø—Ä–æ—Å–æ–≤
* `version_chain_length_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Ü–µ–ø–æ—á–∫–∏ –≤–µ—Ä—Å–∏–π
* `versioned_gc_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –≤–µ—Ä—Å–∏–π –ø–æ session snapshot / MVCC
* –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ "–±—É–¥—É—â–∏–º" –≤–µ—Ä—Å–∏—è–º
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å row-level security

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.1 ‚Äî Row-store`
* `2.1 ‚Äî MVCC –¥–≤–∏–∂–æ–∫`
* `2.5 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snapshot'–∞–º–∏`
* `15.2 ‚Äî AS OF Query Engine`
* `12.11 ‚Äî –ö–∞—Ç–∞–ª–æ–≥ –≤–µ—Ä—Å–∏–π —Ç–∞–±–ª–∏—Ü`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_as_of_single_row_lookup`
* `test_version_chain_consistency`
* `test_versioned_scan_interval`
* `test_gc_cutoff_versions`
* `test_as_of_mvcc_integration`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.16 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –ø–∞–º—è—Ç–∏ (NUMA-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.16 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –ø–∞–º—è—Ç–∏ (NUMA-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `large_memory_support`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (100 –ì–ë ‚Äî —Ç–µ—Ä–∞–±–∞–π—Ç—ã) –≤ —É—Å–ª–æ–≤–∏—è—Ö –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö NUMA-—Å–∏—Å—Ç–µ–º. –†–µ–∞–ª–∏–∑—É–µ—Ç NUMA-aware –≤—ã–¥–µ–ª–µ–Ω–∏–µ, –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ NUMA-–Ω–æ–¥–∞–º, –ª–µ–Ω–∏–≤—É—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –≥–æ—Ä—è—á–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –ø–∞–º—è—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | -------------------------------------------------------- | ----------------------------------------------------------- | ---------- |
| `memory_topology_init`       | `bool memory_topology_init(void);`                       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç NUMA-—Ç–æ–ø–æ–ª–æ–≥–∏—é –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É–∑–ª–∞—Ö –ø–∞–º—è—Ç–∏.  | `true`     |
| `large_alloc`                | `void *large_alloc(size_t size, int numa_node);`         | –í—ã–¥–µ–ª—è–µ—Ç –∫—Ä—É–ø–Ω—ã–π —Ä–µ–≥–∏–æ–Ω –ø–∞–º—è—Ç–∏ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º NUMA-—É–∑–ª–µ.      | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `large_free`                 | `void large_free(void *ptr, size_t size);`               | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª—ë–Ω–Ω—É—é –ø–∞–º—è—Ç—å.                        | `void`     |
| `memory_prefault_pages`      | `void memory_prefault_pages(void *region, size_t size);` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –ø–∞–º—è—Ç—å (–≤ —Ç.—á. hugetlb). | `void`     |
| `memory_get_node_stats`      | `memory_stats_t memory_get_node_stats(int numa_node);`   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ —É–∑–ª–µ.            | –°—Ç—Ä—É–∫—Ç—É—Ä–∞  |
| `memory_bind_current_thread` | `void memory_bind_current_thread(int numa_node);`        | –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –∫ NUMA-–Ω–æ–¥–µ.                      | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  size_t total_bytes;
  size_t used_bytes;
  size_t page_faults;
  size_t huge_pages;
} memory_stats_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `memory_usage_bytes{node}` ‚Äî –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏ –ø–æ NUMA-–Ω–æ–¥–∞–º
* `huge_pages_used{node}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö HugeTLB
* `page_faults_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ page faults
* `memory_alloc_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –±–ª–æ–∫–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –≤—ã–¥–µ–ª–µ–Ω–∏—è
* –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä HugeTLB
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–≤–æ—Ç –ø–∞–º—è—Ç–∏ –Ω–∞ –Ω–æ–¥—É –∏ —Ç–µ–Ω–∞–Ω—Ç–∞ (multi-tenant isolation)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.4 ‚Äî NUMA-aware –∞–ª–ª–æ–∫–∞—Ç–æ—Ä`
* `1.18 ‚Äî Layout-aware execution`
* `8.12 ‚Äî Prefetch engine`
* `16.3 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_large_alloc_and_access`
* `test_numa_memory_distribution`
* `test_memory_stats_accuracy`
* `test_prefault_effectiveness`
* `test_multi_node_allocation`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.17 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ CPU/IOPS/Memory (multi-tenant)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.17 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ CPU/IOPS/Memory (multi-tenant)

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `resource_limits`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫, IOPS) –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ tenant-–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ multi-tenant –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–æ–∫, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ---------------------- | ----------------------------------------------------------------------- | ------------------------------------------------ | --------------------- |
| `resource_limits_init` | `bool resource_limits_init(void);`                                      | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—É –ª–∏–º–∏—Ç–æ–≤ –∏ –∫–≤–æ—Ç.        | `true`                |
| `set_tenant_quota`     | `bool set_tenant_quota(const char *tenant_id, resource_quota_t quota);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ tenant-–∞.    | `true`                |
| `enforce_cpu_quota`    | `bool enforce_cpu_quota(const char *tenant_id, uint32_t used_ns);`      | –ü—Ä–∏–º–µ–Ω—è–µ—Ç CPU-–∫–≤–æ—Ç—É –∏ –º–æ–∂–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. | `true`, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω |
| `enforce_memory_quota` | `bool enforce_memory_quota(const char *tenant_id, size_t used_bytes);`  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–æ –ø–∞–º—è—Ç–∏.           | `true`, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω |
| `enforce_iops_quota`   | `bool enforce_iops_quota(const char *tenant_id, uint32_t op_count);`    | –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.        | `true`, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω |
| `get_quota_stats`      | `resource_quota_t get_quota_stats(const char *tenant_id);`              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∑–∞–≥—Ä—É–∑–∫—É –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º.         | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–∏–º–∏—Ç–æ–≤     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t cpu_ns_limit;
  size_t memory_limit_bytes;
  uint32_t iops_limit;
} resource_quota_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `quota_cpu_usage_ns{tenant}` ‚Äî –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU
* `quota_memory_usage_bytes{tenant}` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
* `quota_iops_total{tenant}` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ I/O
* `quota_violations_total{tenant}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π –ª–∏–º–∏—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç —à—É–º–Ω—ã—Ö —Å–æ—Å–µ–¥–µ–π (noisy neighbor isolation)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (soft/hard limits)
* –û—Ç—á—ë—Ç—ã –æ–± –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö –∫–≤–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∞—É–¥–∏—Ç-–ª–æ–≥–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `16.1 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multi-tenant —Å—Ä–µ–¥—ã`
* `1.16 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –ø–∞–º—è—Ç–∏`
* `0.9 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤`
* `7.6 ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ latency –∏ throughput`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_quota_enforcement_under_load`
* `test_tenant_quota_limits_set_get`
* `test_memory_quota_eviction`
* `test_cpu_budget_tracking`
* `test_iops_throttling_behavior`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.18 ‚Äî –ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª –∏ Page Cache** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.18 ‚Äî –ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª –∏ Page Cache

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `buffer_pool`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–±—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª –∏ –∫—ç—à —Å—Ç—Ä–∞–Ω–∏—Ü** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å NVMe/SSD-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö–æ–ª–æ–¥–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –±–ª–æ–∫–æ–≤, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è dirty-—Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º LRU/ARC.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ------------------------- | ------------------------------------------------------ | ------------------------------------------------ | --------------------- |
| `buffer_pool_init`        | `bool buffer_pool_init(size_t max_size_bytes);`        | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.   | `true`                |
| `buffer_pool_get_page`    | `page_t *buffer_pool_get_page(page_id_t pid);`         | –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–∑ –∫—ç—à–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å –¥–∏—Å–∫–∞. | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É |
| `buffer_pool_mark_dirty`  | `void buffer_pool_mark_dirty(page_id_t pid);`          | –ü–æ–º–µ—á–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é.          | `void`                |
| `buffer_pool_evict_pages` | `size_t buffer_pool_evict_pages(size_t target_count);` | –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É LRU/ARC.           | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö      |
| `buffer_pool_flush_dirty` | `size_t buffer_pool_flush_dirty(void);`                | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç dirty-—Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –¥–∏—Å–∫.       | –ö–æ–ª-–≤–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö     |
| `buffer_pool_stats_dump`  | `void buffer_pool_stats_dump(FILE *out);`              | –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: hit/miss, dirty, eviction.   | `void`                |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  page_id_t id;
  void *data;
  bool dirty;
  bool pinned;
  uint64_t last_access_ts;
} buffer_page_t;

typedef struct {
  buffer_page_t *pages;
  size_t max_pages;
  size_t current_count;
  eviction_policy_t policy;
} buffer_pool_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `buffer_pool_hit_ratio` ‚Äî –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–Ω–∏–π –∫ –ø—Ä–æ–º–∞—Ö–∞–º
* `buffer_pool_dirty_pages` ‚Äî —á–∏—Å–ª–æ –≥—Ä—è–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
* `buffer_pool_evictions_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–≤–∏–∫—à–Ω–æ–≤
* `buffer_pool_flush_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏ –Ω–∞ –¥–∏—Å–∫

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ dirty-—Å—Ç—Ä–∞–Ω–∏—Ü (atomic flush)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ journal-before-write (WAL sync)
* ACL –Ω–∞ —É—Ä–æ–≤–Ω–µ page\_id –ø—Ä–∏ multi-tenant –∏–∑–æ–ª—è—Ü–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.21 ‚Äî –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏ low-level storage API`
* `1.24 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º—ã —ç–≤–∏–∫—à–Ω–∞ (LRU, ARC)`
* `2.3 ‚Äî WAL TX Layer`
* `2.14 ‚Äî Crash Recovery`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_page_load_and_cache`
* `test_page_mark_dirty_and_flush`
* `test_eviction_lru_behavior`
* `test_eviction_arc_behavior`
* `test_stats_hit_miss_tracking`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.19 ‚Äî WAL (write-ahead logging)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.19 ‚Äî WAL (write-ahead logging)

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `write_ahead_log`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ (WAL)** ‚Äî –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ WAL –¥–æ –∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –ø–æ—Å–ª–µ —Å–±–æ—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ WAL-–ø–∏—Å–∞—Ç–µ–ª–∏, –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ snapshot-—Å–∏—Å—Ç–µ–º–æ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------ | -------------------------------------------------- | ---------------------------------------------------- | ---------- |
| `wal_init`         | `bool wal_init(const char *path);`                 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç WAL-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.  | `true`     |
| `wal_append_entry` | `bool wal_append_entry(const wal_entry_t *entry);` | –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ WAL (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ/—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ). | `true`     |
| `wal_flush`        | `bool wal_flush(void);`                            | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ WAL –Ω–∞ –¥–∏—Å–∫.     | `true`     |
| `wal_compact`      | `bool wal_compact(void);`                          | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏–ª–∏ –∑–∞–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏.            | `true`     |
| `wal_replay`       | `bool wal_replay(snapshot_context_t *ctx);`        | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ WAL –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ.        | `true`     |
| `wal_shutdown`     | `void wal_shutdown(void);`                         | –ó–∞–≤–µ—Ä—à–∞–µ—Ç WAL-—Å–µ—Å—Å–∏—é –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.          | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t lsn;
  uint32_t tx_id;
  uint32_t op_type;
  void *payload;
  size_t payload_size;
} wal_entry_t;

typedef struct {
  int fd;
  uint64_t last_lsn;
  rwlock_t lock;
} wal_file_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `wal_lsn_current` ‚Äî —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –∂—É—Ä–Ω–∞–ª–∞
* `wal_append_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏
* `wal_flush_size_bytes` ‚Äî –æ–±—ä—ë–º —Å–±—Ä–∞—Å—ã–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* `wal_replay_duration_ns` ‚Äî –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –∂—É—Ä–Ω–∞–ª–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º –∑–∞–ø–∏—Å–µ–π
* Atomic fsync —Å fdatasync –∏ fallocate
* –ó–∞—â–∏—Ç–∞ –æ—Ç WAL-replay –∞—Ç–∞–∫ (—Å–º. –±–ª–æ–∫ 2.24)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.3 ‚Äî WAL TX Layer`
* `2.14 ‚Äî Crash Recovery`
* `1.20 ‚Äî Snapshot-—Å–∏—Å—Ç–µ–º–∞`
* `1.18 ‚Äî –ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª`
* `7.13 ‚Äî –°–∏–≥–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_wal_append_and_flush`
* `test_wal_replay_integrity`
* `test_wal_compaction_behavior`
* `test_wal_write_concurrency`
* `test_wal_fs_failure_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.20 ‚Äî Snapshot-—Å–∏—Å—Ç–µ–º–∞** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.20 ‚Äî Snapshot-—Å–∏—Å—Ç–µ–º–∞

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `snapshot_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω–∏—è **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤ (snapshots)** —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ü–µ–ª–µ–π –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è **copy-on-write** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, **diff-based snapshots**, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WAL –¥–ª—è **point-in-time recovery**.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| -------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- | ------------ |
| `snapshot_create`          | `bool snapshot_create(const char *path);`                                     | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π snapshot —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.   | `true`       |
| `snapshot_load`            | `bool snapshot_load(const char *path);`                                       | –ó–∞–≥—Ä—É–∂–∞–µ—Ç snapshot –∏–∑ –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.                      | `true`       |
| `snapshot_diff`            | `bool snapshot_diff(const char *from, const char *to, snapshot_diff_t *out);` | –í—ã—á–∏—Å–ª—è–µ—Ç –¥–µ–ª—å—Ç—É –º–µ–∂–¥—É –¥–≤—É–º—è snapshot-–∞–º–∏.                      | `true`       |
| `snapshot_mark_dirty_page` | `void snapshot_mark_dirty_page(page_id_t pid);`                               | –û—Ç–º–µ—á–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞–∫ –∏–∑–º–µ–Ω—ë–Ω–Ω—É—é —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ snapshot. | `void`       |
| `snapshot_list`            | `char **snapshot_list(size_t *count);`                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö snapshot-–æ–≤.                        | –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ |
| `snapshot_delete`          | `bool snapshot_delete(const char *name);`                                     | –£–¥–∞–ª—è–µ—Ç snapshot –∏ –µ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.                              | `true`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  page_id_t *changed_pages;
  size_t page_count;
  uint64_t base_lsn;
} snapshot_diff_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `snapshot_count_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö snapshot-–æ–≤
* `snapshot_create_duration_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è snapshot
* `snapshot_size_bytes{name}` ‚Äî —Ä–∞–∑–º–µ—Ä snapshot-–∞ –Ω–∞ –¥–∏—Å–∫–µ
* `snapshot_load_latency_ns` ‚Äî –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ snapshot

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è snapshot-–æ–≤ (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ TDE)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
* –ó–∞—â–∏—Ç–∞ –æ—Ç rollback-–∞—Ç–∞–∫–∏ (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ LSN –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.19 ‚Äî WAL`
* `2.5 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snapshot‚Äô–∞–º–∏`
* `2.13 ‚Äî Instant backup/restore`
* `2.20 ‚Äî Replica snapshot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_snapshot_create_and_restore`
* `test_snapshot_diff_generation`
* `test_snapshot_corruption_detection`
* `test_snapshot_list_and_delete`
* `test_snapshot_dirty_page_tracking`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.21 ‚Äî –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏ low-level storage API** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.21 ‚Äî –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏ low-level storage API

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `storage_api`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API –¥–æ—Å—Ç—É–ø–∞ –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É**: —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Å—Ç—Ä–∞–Ω–∏—Ü, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞, –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ NVMe-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º –∏ –±–ª–æ—á–Ω—ã–º –æ–±–ª–∞—Å—Ç—è–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WAL, snapshot, –±—É—Ñ–µ—Ä–Ω—ã–º –ø—É–ª–æ–º –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —ç–≤–∏–∫—à–Ω–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç atomic I/O, async prefetch, sparse-—Ñ–∞–π–ª—ã –∏ fallocate.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç      |
| --------------------- | ---------------------------------------------------------------------------- | ---------------------------------- | --------------- |
| `storage_open_file`   | `int storage_open_file(const char *path, bool writeable);`                   | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª.        | File descriptor |
| `storage_pread`       | `ssize_t storage_pread(int fd, void *buf, size_t len, off_t offset);`        | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ.     | –ö–æ–ª-–≤–æ –±–∞–π—Ç     |
| `storage_pwrite`      | `ssize_t storage_pwrite(int fd, const void *buf, size_t len, off_t offset);` | –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö.         | –ö–æ–ª-–≤–æ –±–∞–π—Ç     |
| `storage_fsync`       | `bool storage_fsync(int fd);`                                                | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫. | `true`          |
| `storage_fallocate`   | `bool storage_fallocate(int fd, size_t size);`                               | –í—ã–¥–µ–ª—è–µ—Ç –º–µ—Å—Ç–æ –ø–æ–¥ —Ñ–∞–π–ª.           | `true`          |
| `storage_unlink_file` | `bool storage_unlink_file(const char *path);`                                | –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª —Å –¥–∏—Å–∫–∞.              | `true`          |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  int fd;
  char path[256];
  bool writeable;
  size_t size;
} storage_file_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `storage_io_latency_ns{op}` ‚Äî –≤—Ä–µ–º—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏
* `storage_fallocate_bytes_total` ‚Äî –æ–±—ä—ë–º preallocated
* `storage_error_count{op}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ I/O
* `storage_fd_count` ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Ç–µ–π (path traversal protection)
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (unlink+fsync)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ñ–∞–π–ª–æ–≤—ã–º ACL

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.18 ‚Äî –ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª`
* `1.19 ‚Äî WAL`
* `1.20 ‚Äî Snapshot`
* `10.4 ‚Äî Stress-—Ç–µ—Å—Ç—ã I/O`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_storage_read_write_consistency`
* `test_storage_file_creation_and_unlink`
* `test_storage_fsync_and_crash_recovery`
* `test_storage_fallocate_behavior`
* `test_storage_permission_safety`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.22 ‚Äî –ì–æ—Ä—è—á–∏–µ –∏ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, temperature tracking** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.22 ‚Äî –ì–æ—Ä—è—á–∏–µ –∏ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, temperature tracking

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `hot_cold_data_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ **"—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã" –¥–∞–Ω–Ω—ã—Ö** (hot/warm/cold), —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ–± –∏—Ö —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏, —ç–≤–∏–∫—à–µ–Ω–µ, –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —á–∞—Å—Ç–æ—Ç—É –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å—Ç—Ä–æ–∫–∞–º, –∫–æ–ª–æ–Ω–∫–∞–º, —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ in-memory –∏ NVMe —Ä–µ—Å—É—Ä—Å–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ------------------------------------------------------------ | ---------------------------------------------------------- | ---------- |
| `temperature_tracker_init`  | `bool temperature_tracker_init(void);`                       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.         | `true`     |
| `temperature_record_access` | `void temperature_record_access(object_id_t id);`            | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É (—Å—Ç—Ä–∞–Ω–∏—Ü–∞, —Å—Ç—Ä–æ–∫–∞, –∫–æ–ª–æ–Ω–∫–∞). | `void`     |
| `temperature_get_level`     | `temperature_level_t temperature_get_level(object_id_t id);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (hot/warm/cold).          | –£—Ä–æ–≤–µ–Ω—å    |
| `temperature_decay_all`     | `void temperature_decay_all(uint64_t now);`                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–Ω–∏–∂–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.     | `void`     |
| `temperature_promote`       | `void temperature_promote(object_id_t id);`                  | –ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –æ–±—ä–µ–∫—Ç–∞ –≤—Ä—É—á–Ω—É—é.              | `void`     |
| `temperature_dump_stats`    | `void temperature_dump_stats(FILE *out);`                    | –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã.           | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  TEMP_COLD,
  TEMP_WARM,
  TEMP_HOT
} temperature_level_t;

typedef struct {
  object_id_t id;
  temperature_level_t level;
  uint64_t last_access_ns;
  uint32_t access_count;
} temperature_entry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `temperature_level_distribution{level}` ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
* `temperature_promotions_total` ‚Äî —á–∏—Å–ª–æ –ø–æ–≤—ã—à–µ–Ω–∏–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
* `temperature_decay_cycles_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö decay-—Ü–∏–∫–ª–æ–≤
* `hot_data_evictions_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–≤–∏–∫—à–Ω–æ–≤ –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –≥–æ—Ä—è—á–∏—Ö —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å multi-tenant –∏–∑–æ–ª—è—Ü–∏–µ–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.13 ‚Äî TTL, Eviction, Auto-tiering`
* `1.24 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º—ã —ç–≤–∏–∫—à–Ω–∞ (LRU, ARC)`
* `8.15 ‚Äî –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ –≥–æ—Ä—è—á–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö`
* `7.6 ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–µ—Ä–∂–µ–∫ –¥–æ—Å—Ç—É–ø–∞`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_temperature_tracking_accuracy`
* `test_temperature_decay_behavior`
* `test_temperature_promotion_priority`
* `test_temperature_eviction_interaction`
* `test_temperature_distribution_reporting`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.23 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL –∏ retention –ø–æ–ª–∏—Ç–∏–∫–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.23 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL –∏ retention –ø–æ–ª–∏—Ç–∏–∫–∏

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `retention_policies`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–ø–æ–ª–∏—Ç–∏–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è (retention policies)** –∏ **–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è (TTL)**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü, –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ –∫–æ–ª–æ–Ω–æ–∫, –≤–∫–ª—é—á–∞—è —Ä–µ–∂–∏–º—ã: `delete`, `archive`, `move_to_cold`, `notify`.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| --------------------------- | --------------------------------------------------------------------------------------------- | ------------------------------------------------------ | ------------ |
| `retention_policy_register` | `bool retention_policy_register(const char *table, retention_policy_t policy);`               | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é retention-–ø–æ–ª–∏—Ç–∏–∫—É –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.     | `true`       |
| `retention_policy_apply`    | `size_t retention_policy_apply(const char *table, uint64_t current_ts);`                      | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –∏ —É–¥–∞–ª—è–µ—Ç/–∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ.        | –ö–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫ |
| `retention_policy_check`    | `retention_action_t retention_policy_check(uint64_t ts_inserted, retention_policy_t policy);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (`keep`, `delete`, `archive`, ...) | –î–µ–π—Å—Ç–≤–∏–µ     |
| `retention_stats_dump`      | `void retention_stats_dump(FILE *out);`                                                       | –ü–µ—á–∞—Ç–∞–µ—Ç —Å–≤–æ–¥–∫—É –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–ª–∏—Ç–∏–∫–∞–º.                 | `void`       |
| `retention_policy_update`   | `bool retention_policy_update(const char *table, retention_policy_t new_policy);`             | –û–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è.                           | `true`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  RETENTION_KEEP,
  RETENTION_DELETE,
  RETENTION_ARCHIVE,
  RETENTION_MOVE_TO_COLD,
  RETENTION_NOTIFY
} retention_action_t;

typedef struct {
  uint64_t ttl_ns;
  retention_action_t action;
  bool notify_only;
} retention_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `retention_applied_total{table}` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
* `retention_deleted_total` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —É–¥–∞–ª–µ–Ω–æ
* `retention_archived_total` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ
* `retention_policy_count` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ retention —Å MVCC
* –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –≤—ã—Å–æ–∫–∏–º –¥–æ—Å—Ç—É–ø–æ–º
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å dry-run –∏ –∞—É–¥–∏—Ç–∞ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.13 ‚Äî TTL, Eviction, Auto-tiering`
* `1.22 ‚Äî –ì–æ—Ä—è—á–∏–µ –∏ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ`
* `2.8 ‚Äî Vacuum / GC`
* `7.8 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Alertmanager` (–¥–ª—è `RETENTION_NOTIFY`)

---

### üß™ –¢–µ—Å—Ç—ã

* `test_retention_policy_application`
* `test_retention_check_decision_logic`
* `test_retention_notify_hook`
* `test_retention_policy_update`
* `test_retention_metrics_consistency`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.24 ‚Äî LRU / ARC eviction –∞–ª–≥–æ—Ä–∏—Ç–º—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.24 ‚Äî LRU / ARC eviction –∞–ª–≥–æ—Ä–∏—Ç–º—ã

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `eviction_algorithms`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏ –∏ –±—É—Ñ–µ—Ä–Ω–æ–≥–æ –ø—É–ª–∞:

* **LRU (Least Recently Used)** ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∏–º–µ–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.
* **ARC (Adaptive Replacement Cache)** ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —Å–æ–≤–º–µ—â–∞—é—â–∏–π –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ LRU –∏ LFU –¥–ª—è –ª—É—á—à–µ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ "–ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏" —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º, —Å—Ç—Ä–æ–∫–∞–º, JSON-–¥–æ–∫—É–º–µ–Ω—Ç–∞–º –∏ –¥—Ä—É–≥–∏–º –∫–µ—à–∏—Ä—É–µ–º—ã–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ---------------------------- | ------------------------------------------------------------------ | ----------------------------------------------- | --------------------- |
| `eviction_policy_lru_create` | `eviction_policy_t *eviction_policy_lru_create(size_t capacity);`  | –°–æ–∑–¥–∞—ë—Ç LRU-–º–µ–Ω–µ–¥–∂–µ—Ä —Å –∑–∞–¥–∞–Ω–Ω–æ–π —ë–º–∫–æ—Å—Ç—å—é.       | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –º–µ–Ω–µ–¥–∂–µ—Ä |
| `eviction_policy_arc_create` | `eviction_policy_t *eviction_policy_arc_create(size_t capacity);`  | –°–æ–∑–¥–∞—ë—Ç ARC-–º–µ–Ω–µ–¥–∂–µ—Ä.                           | –£–∫–∞–∑–∞—Ç–µ–ª—å             |
| `eviction_access`            | `void eviction_access(eviction_policy_t *policy, object_id_t id);` | –û—Ç–º–µ—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π.             | `void`                |
| `eviction_evict`             | `object_id_t eviction_evict(eviction_policy_t *policy);`           | –í—ã–±–∏—Ä–∞–µ—Ç –Ω–∞–∏–º–µ–Ω–µ–µ –ø–æ–ª–µ–∑–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è. | ID –æ–±—ä–µ–∫—Ç–∞            |
| `eviction_remove`            | `void eviction_remove(eviction_policy_t *policy, object_id_t id);` | –£–¥–∞–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ —É—á—ë—Ç–∞.                        | `void`                |
| `eviction_stats`             | `void eviction_stats(eviction_policy_t *policy, FILE *out);`       | –ü–µ—á–∞—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.        | `void`                |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  object_id_t id;
  uint64_t last_access_ts;
  uint64_t frequency;
} eviction_entry_t;

typedef struct {
  eviction_entry_t *entries;
  size_t capacity;
  size_t current_size;
  eviction_mode_t mode;  // LRU / ARC
} eviction_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `eviction_hits_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞—á–Ω—ã—Ö –ø–æ–ø–∞–¥–∞–Ω–∏–π (reuse)
* `eviction_misses_total` ‚Äî –ø—Ä–æ–º–∞—Ö–æ–≤
* `eviction_count_total` ‚Äî —á–∏—Å–ª–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
* `eviction_hit_ratio` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ (hit/miss)

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ pinned-—Ñ–ª–∞–≥–æ–≤ (–∑–∞–ø—Ä–µ—Ç —ç–≤–∏–∫—à–Ω–∞)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å tenant-–∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø—Ä–∏ shared buffer pool

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.18 ‚Äî –ë—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª`
* `1.13 ‚Äî TTL –∏ –∞–≤—Ç–æ-tiering`
* `1.22 ‚Äî Temperature tracking`
* `16.3 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ –ø–∞–º—è—Ç–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_lru_eviction_order`
* `test_arc_adaptive_behavior`
* `test_eviction_access_and_remove`
* `test_eviction_stats_accuracy`
* `test_eviction_pinned_object_protection`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **1.25 ‚Äî –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 1.25 ‚Äî –î–≤–∏–∂–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `table_storage_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è (row-store, column-store, JSON store) –≤ –µ–¥–∏–Ω—É—é –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é **—Ç–∞–±–ª–∏—Ü—ã**. –£–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö, –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π, –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å—Ç—Ä–æ–∫–∞–º, –∫–æ–ª–æ–Ω–∫–∞–º, —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –∏ –ø–∞—Ä—Ç–∏—Ü–∏—è–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç layout-aware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, hot/cold split, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç        |
| ------------------- | --------------------------------------------------------------------------- | ----------------------------------------------------------- | ----------------- |
| `table_create`      | `table_t *table_create(const table_schema_t *schema, storage_mode_t mode);` | –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (row/column/JSON).      | –£–∫–∞–∑–∞—Ç–µ–ª—å         |
| `table_insert`      | `bool table_insert(table_t *table, const row_t *row);`                      | –í—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É.                                 | `true`            |
| `table_scan`        | `table_iter_t *table_scan(table_t *table, const predicate_t *filter);`      | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É.                          | –ò—Ç–µ—Ä–∞—Ç–æ—Ä          |
| `table_get_columns` | `const col_vector_t **table_get_columns(table_t *table);`                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –∫–æ–ª–æ–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ). | –ú–∞—Å—Å–∏–≤ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π |
| `table_get_name`    | `const char *table_get_name(const table_t *table);`                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è —Ç–∞–±–ª–∏—Ü—ã.                                     | –ò–º—è               |
| `table_free`        | `void table_free(table_t *table);`                                          | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã —Ç–∞–±–ª–∏—Ü—ã.                                | `void`            |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  STORAGE_ROW,
  STORAGE_COLUMN,
  STORAGE_JSON
} storage_mode_t;

typedef struct {
  char name[64];
  storage_mode_t mode;
  void *storage_backend;  // —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–≤–∏–∂–æ–∫ (row_table_t, col_table_t, json_table_t)
  table_schema_t *schema;
  index_list_t *indexes;
} table_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `table_row_count{table}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫
* `table_storage_mode{table}` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º —Ö—Ä–∞–Ω–µ–Ω–∏—è
* `table_scan_latency_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–ª–Ω–æ–≥–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
* `table_insert_throughput` ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –≤—Å—Ç–∞–≤–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Ö–µ–º—ã –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å row-level security

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.1 ‚Äî Row-store`
* `1.2 ‚Äî Column-store`
* `1.3 ‚Äî JSON store`
* `1.8‚Äì1.12 ‚Äî –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è`
* `2.1 ‚Äî MVCC`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_table_create_row_and_insert`
* `test_table_scan_column_filter`
* `test_table_free_and_destroy`
* `test_table_get_columns_layout`
* `test_table_insert_schema_mismatch`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º –±–ª–æ–∫–æ–º –ø–∞–∫–µ—Ç–∞ 1: **1.26 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ layout-aware execution** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç –ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å –ø–∞–∫–µ—Ç–∞ 1:

---

## üß© –ë–ª–æ–∫ 1.26 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ layout-aware execution

**–ü–∞–∫–µ—Ç:** `1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ`
**Block ID:** `layout_aware_execution`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **layout-aware –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ–¥ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü (row/column/PAX/Arrow), –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –¥–∞–Ω–Ω—ã–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º –∏ SQL-–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç     |
| ----------------------------- | ---------------------------------------------------------------------------------------------- | --------------------------------------------------- | -------------- |
| `layout_aware_init`           | `bool layout_aware_init(void);`                                                                | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥—Å–∏—Å—Ç–µ–º—É layout-–∞–¥–∞–ø—Ç–∞—Ü–∏–π.         | `true`         |
| `layout_detect`               | `storage_mode_t layout_detect(const table_t *table);`                                          | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã.      | –†–µ–∂–∏–º          |
| `layout_select_scan_strategy` | `scan_strategy_t layout_select_scan_strategy(const table_t *table, const query_hint_t *hint);` | –í—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.        | –°—Ç—Ä–∞—Ç–µ–≥–∏—è      |
| `layout_select_aggregator`    | `aggregator_t *layout_select_aggregator(const table_t *table, const agg_request_t *agg);`      | –í—ã–±–∏—Ä–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç layout.         | –£–∫–∞–∑–∞—Ç–µ–ª—å      |
| `layout_supports_projection`  | `bool layout_supports_projection(const table_t *table);`                                       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å projection pushdown.          | `true`/`false` |
| `layout_optimize_filtering`   | `bool layout_optimize_filtering(const table_t *table, predicate_t *filter);`                   | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø–æ–¥ layout (bitmap, vectorized). | `true`         |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  STRATEGY_ROW_SCAN,
  STRATEGY_COLUMN_VECTOR,
  STRATEGY_PAX_BLOCK,
  STRATEGY_ARROW_STREAM
} scan_strategy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `layout_execution_strategy{table}` ‚Äî –≤—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
* `projection_pushdown_applied_total` ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ü–∏–π
* `layout_mismatch_penalty_ns` ‚Äî –∏–∑–¥–µ—Ä–∂–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞
* `layout_vectorized_ratio` ‚Äî –¥–æ–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–æ–Ω–∫–∞–º –ø—Ä–∏ layout-aware –ø—Ä–æ–µ–∫—Ü–∏—è—Ö
* –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–æ —Ç–∏–ø—É —Ç–∞–±–ª–∏—Ü—ã
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É session-level –∏ tenant-level

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.2 ‚Äî Column-store`
* `1.5 ‚Äî PAX / Arrow`
* `3.9 ‚Äî Rule-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è`
* `8.13 ‚Äî Format-aware execution`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_layout_scan_selection`
* `test_layout_projection_pruning`
* `test_layout_filter_conversion`
* `test_layout_strategy_vectorized`
* `test_layout_on_mixed_storage`

---

‚úÖ –ü–∞–∫–µ—Ç **1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**, –Ω–∞—á–∏–Ω–∞—è —Å **2.1 ‚Äî MVCC (Compressed Chains + Snapshot Isolation)**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.1 ‚Äî MVCC (Compressed Chains + Snapshot Isolation)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `mvcc_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–º–Ω–æ–≥–æ–≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º (MVCC)** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **compressed version chains** –∏ **snapshot isolation**. –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–∏—Ç —Ü–µ–ø–æ—á–∫—É –≤–µ—Ä—Å–∏–π, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Å—Å–∏–π. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –ø–æ–¥–¥–µ—Ä–∂–∫—É rollback, GC –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å snapshot-–¥–≤–∏–∂–∫–æ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------------- | ---------------------------------------------------------------------------------- | --------------------------------------------------------- | ---------- |
| `mvcc_init`                | `bool mvcc_init(void);`                                                            | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π MVCC-–∫–æ–Ω—Ç–µ–∫—Å—Ç.                  | `true`     |
| `mvcc_begin_tx`            | `tx_ctx_t *mvcc_begin_tx(isolation_level_t level);`                                | –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –∑–∞–¥–∞–Ω–Ω—ã–º —É—Ä–æ–≤–Ω–µ–º –∏–∑–æ–ª—è—Ü–∏–∏.          | –ö–æ–Ω—Ç–µ–∫—Å—Ç   |
| `mvcc_commit_tx`           | `bool mvcc_commit_tx(tx_ctx_t *tx);`                                               | –§–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –∏ –ø—Ä–æ–¥–≤–∏–≥–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π snapshot.    | `true`     |
| `mvcc_rollback_tx`         | `bool mvcc_rollback_tx(tx_ctx_t *tx);`                                             | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.                      | `true`     |
| `mvcc_get_visible_version` | `const row_version_t *mvcc_get_visible_version(row_chain_t *chain, tx_ctx_t *tx);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏, –≤–∏–¥–∏–º—É—é –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `mvcc_append_version`      | `bool mvcc_append_version(row_chain_t *chain, row_t *new_version, tx_ctx_t *tx);`  | –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏.                            | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t tx_id;
  uint64_t begin_ts;
  uint64_t commit_ts;
  isolation_level_t level;
} tx_ctx_t;

typedef struct {
  row_t *version;
  uint64_t begin_ts;
  uint64_t end_ts;
  tx_id_t created_by;
} row_version_t;

typedef struct {
  row_version_t *versions;
  size_t count;
} row_chain_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `mvcc_version_chain_length_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Ü–µ–ø–æ—á–∫–∏ –≤–µ—Ä—Å–∏–π
* `mvcc_active_tx_count` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* `mvcc_commit_latency_ns` ‚Äî –≤—Ä–µ–º—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* `mvcc_gc_removed_versions_total` ‚Äî —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç phantom reads (SI / SERIALIZABLE)
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å rollback-to-savepoint
* –ò–∑–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ —á–µ—Ä–µ–∑ snapshot timestamp

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî Transaction Manager`
* `2.4 ‚Äî –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏`
* `2.8 ‚Äî Garbage Collection`
* `1.15 ‚Äî SYSTEM VERSIONED`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_mvcc_visibility_read_committed`
* `test_mvcc_snapshot_isolation_read`
* `test_mvcc_conflict_write_write`
* `test_mvcc_rollback_and_gc`
* `test_mvcc_chain_compression`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.2 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (TX Manager)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.2 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (TX Manager)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `transaction_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä (TX Manager)**, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: –æ—Ç–∫—Ä—ã—Ç–∏–µ, —Ñ–∏–∫—Å–∞—Ü–∏—è, –æ—Ç–∫–∞—Ç, —É—á—ë—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ. –Ø–≤–ª—è–µ—Ç—Å—è —è–¥—Ä–æ–º —Å–∏—Å—Ç–µ–º MVCC, WAL, —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------- | ---------------------------------------------- | ---------- |
| `tx_manager_init`        | `bool tx_manager_init(void);`                                    | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. | `true`     |
| `tx_begin`               | `tx_ctx_t *tx_begin(isolation_level_t level);`                   | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.                      | –ö–æ–Ω—Ç–µ–∫—Å—Ç   |
| `tx_commit`              | `bool tx_commit(tx_ctx_t *tx);`                                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç commit –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç snapshot.         | `true`     |
| `tx_abort`               | `bool tx_abort(tx_ctx_t *tx);`                                   | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.                         | `true`     |
| `tx_register_dependency` | `bool tx_register_dependency(tx_ctx_t *tx, tx_id_t depends_on);` | –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.      | `true`     |
| `tx_get_status`          | `tx_status_t tx_get_status(tx_id_t tx_id);`                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.       | –°—Ç–∞—Ç—É—Å     |
| `tx_release_context`     | `void tx_release_context(tx_ctx_t *tx);`                         | –£–¥–∞–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.       | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  TX_ACTIVE,
  TX_COMMITTED,
  TX_ABORTED,
  TX_FAILED
} tx_status_t;

typedef struct {
  tx_id_t tx_id;
  tx_status_t status;
  uint64_t start_ts;
  uint64_t commit_ts;
  isolation_level_t level;
  bool readonly;
} tx_ctx_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tx_active_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* `tx_commit_rate` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ —É—Å–ø–µ—à–Ω—ã—Ö —Ñ–∏–∫—Å–∞—Ü–∏–π
* `tx_abort_rate` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ –æ—Ç–∫–∞—Ç–æ–≤
* `tx_dependency_count` ‚Äî —á–∏—Å–ª–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É TX

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (RBAC)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å long-running TX
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å watchdog –¥–ª—è TX leak detection

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC`
* `2.4 ‚Äî –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏`
* `2.9 ‚Äî –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π`
* `2.10 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç–∏`
* `7.13 ‚Äî Error/abort handler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_tx_begin_commit_abort`
* `test_tx_dependency_graph_integrity`
* `test_tx_status_transitions`
* `test_tx_conflict_resolution`
* `test_tx_context_cleanup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.3 ‚Äî –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (WAL TX Layer)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.3 ‚Äî –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (WAL TX Layer)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `wal_tx_layer`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–≠—Ç–æ—Ç –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π –ø–æ–≤–µ—Ä—Ö WAL** ‚Äî –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é, —É–ø–∞–∫–æ–≤–∫—É –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ñ–∏–∫—Å–∞—Ü–∏—é LSN, –∑–∞—â–∏—Ç—É –æ—Ç –ø–æ—Ç–µ—Ä—å –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö. –û–Ω —Å–≤—è–∑—ã–≤–∞–µ—Ç TX Manager —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º –∂—É—Ä–Ω–∞–ª–æ–º –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ –∏ snapshot-–¥–≤–∏–∂–∫–æ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏       | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------- | ---------------------------------------------------- | ---------------------------------------------------------- | ---------- |
| `wal_tx_begin`    | `bool wal_tx_begin(tx_ctx_t *tx);`                   | –ù–∞—á–∏–Ω–∞–µ—Ç –∑–∞–ø–∏—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ WAL.                          | `true`     |
| `wal_tx_log_op`   | `bool wal_tx_log_op(tx_ctx_t *tx, wal_entry_t *op);` | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω—É –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –±—É—Ñ–µ—Ä WAL.                      | `true`     |
| `wal_tx_commit`   | `bool wal_tx_commit(tx_ctx_t *tx);`                  | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ WAL –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. | `true`     |
| `wal_tx_rollback` | `bool wal_tx_rollback(tx_ctx_t *tx);`                | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ WAL.                | `true`     |
| `wal_tx_flush`    | `bool wal_tx_flush(tx_ctx_t *tx);`                   | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±—É—Ñ–µ—Ä WAL –Ω–∞ –¥–∏—Å–∫.                | `true`     |
| `wal_tx_recover`  | `bool wal_tx_recover(snapshot_context_t *ctx);`      | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–∑ WAL.           | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  tx_id_t tx_id;
  wal_entry_t *entries;
  size_t entry_count;
  bool committed;
} wal_tx_buffer_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `wal_tx_ops_buffered{tx_id}` ‚Äî —á–∏—Å–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –±—É—Ñ–µ—Ä–µ
* `wal_tx_flush_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Å–±—Ä–æ—Å–∞
* `wal_tx_commit_lsn` ‚Äî LSN –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* `wal_tx_recovery_duration` ‚Äî –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è TX

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ atomic fsync –ø—Ä–∏ —Ñ–∏–∫—Å–∞—Ü–∏–∏
* –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π + CRC –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç re-commit / double-execute

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.19 ‚Äî WAL (write-ahead log)`
* `2.1 ‚Äî MVCC`
* `2.2 ‚Äî TX Manager`
* `2.14 ‚Äî Crash Recovery`
* `2.15 ‚Äî WAL-based backup`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_wal_tx_commit_sequence`
* `test_wal_tx_buffering_and_flush`
* `test_wal_tx_rollback_behavior`
* `test_wal_tx_crash_recovery`
* `test_wal_tx_concurrent_transactions`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.4 ‚Äî –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (RC, RR, SI, SERIALIZABLE)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.4 ‚Äî –£—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (RC, RR, SI, SERIALIZABLE)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `isolation_levels`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö **—É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º ANSI SQL –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –°–£–ë–î:

* **Read Committed (RC)**
* **Repeatable Read (RR)**
* **Snapshot Isolation (SI)**
* **Serializable**

–ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ—á–∫–∞–º–∏ —á—Ç–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç                |
| --------------------------- | ----------------------------------------------------------------------- | ------------------------------------------------- | ------------------------- |
| `isolation_set_level`       | `void isolation_set_level(tx_ctx_t *tx, isolation_level_t level);`      | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.    | `void`                    |
| `isolation_visible_version` | `bool isolation_visible_version(tx_ctx_t *tx, row_version_t *v);`       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫–∏ –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. | `true`, –µ—Å–ª–∏ –≤–∏–¥–∏–º–∞       |
| `isolation_allow_write`     | `bool isolation_allow_write(tx_ctx_t *tx, row_id_t id);`                | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –¥–∞–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ.  | `true`, –µ—Å–ª–∏ –º–æ–∂–Ω–æ        |
| `isolation_check_conflict`  | `bool isolation_check_conflict(tx_ctx_t *tx, tx_id_t other);`           | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.  | `true`, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç     |
| `isolation_snapshot_equals` | `bool isolation_snapshot_equals(const tx_ctx_t *a, const tx_ctx_t *b);` | –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç snapshots –¥–≤—É—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.             | `true`, –µ—Å–ª–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  ISOLATION_READ_COMMITTED,
  ISOLATION_REPEATABLE_READ,
  ISOLATION_SNAPSHOT,
  ISOLATION_SERIALIZABLE
} isolation_level_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `isolation_level_usage{level}` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
* `tx_conflict_detected_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
* `tx_blocked_due_to_isolation` ‚Äî —á–∏—Å–ª–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* `snapshot_equality_checks_total` ‚Äî –≤—ã–∑–æ–≤—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è snapshot-–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MVCC
* –ó–∞—â–∏—Ç–∞ –æ—Ç phantom reads –ø—Ä–∏ SERIALIZABLE
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥—Ä–∞—Ñ–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC –¥–≤–∏–∂–æ–∫`
* `2.2 ‚Äî Transaction Manager`
* `2.9 ‚Äî –ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π`
* `2.10 ‚Äî –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å / fallback`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rc_visibility_rules`
* `test_rr_snapshot_consistency`
* `test_si_write_conflict_detection`
* `test_serializable_prevention_phantom`
* `test_snapshot_equals_behavior`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.5 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snapshot'–∞–º–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.5 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ snapshot'–∞–º–∏

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `snapshot_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–º–∏ snapshot-–∞–º–∏**, –æ—Ç—Ä–∞–∂–∞—é—â–∏–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ snapshot isolation, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∫–∏ AS OF-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é snapshot-–æ–≤, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç     |
| --------------------------- | ------------------------------------------------------------------------------------ | ------------------------------------------------- | -------------- |
| `snapshot_create_tx`        | `snapshot_t *snapshot_create_tx(tx_ctx_t *tx);`                                      | –°–æ–∑–¥–∞—ë—Ç snapshot –≤ –º–æ–º–µ–Ω—Ç –Ω–∞—á–∞–ª–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.      | Snapshot       |
| `snapshot_get_visible_txns` | `bool snapshot_get_visible_txns(const snapshot_t *s, tx_id_t *list, size_t *count);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –≤–∏–¥–∏–º—ã—Ö –≤ snapshot. | `true`         |
| `snapshot_advance_global`   | `void snapshot_advance_global(uint64_t new_ts);`                                     | –ü—Ä–æ–¥–≤–∏–≥–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π snapshot timestamp.         | `void`         |
| `snapshot_is_visible`       | `bool snapshot_is_visible(const snapshot_t *s, uint64_t version_ts);`                | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –≤–∏–¥–Ω–∞ –ª–∏ –≤–µ—Ä—Å–∏—è –≤ snapshot.            | `true`/`false` |
| `snapshot_serialize`        | `bool snapshot_serialize(const snapshot_t *s, void *buf, size_t buf_size);`          | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç snapshot –≤ –±–∏–Ω–∞—Ä–Ω—É—é —Ñ–æ—Ä–º—É.              | `true`         |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t timestamp;
  tx_id_t *active_tx_ids;
  size_t active_count;
} snapshot_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `snapshot_created_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö snapshot-–æ–≤
* `snapshot_visible_txns_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –≤–∏–¥–∏–º—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* `snapshot_advancements_total` ‚Äî –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ snapshot
* `snapshot_visibility_checks_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤–∏–¥–∏–º–æ—Å—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ tenant-–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö snapshot-–æ–≤
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ advance snapshot
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ read-only snapshot-—Ä–µ–∂–∏–º–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC –¥–≤–∏–∂–æ–∫`
* `2.2 ‚Äî Transaction Manager`
* `1.20 ‚Äî Snapshot-—Å–∏—Å—Ç–µ–º–∞ (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å)`
* `15.2 ‚Äî AS OF –∑–∞–ø—Ä–æ—Å—ã`
* `12.18 ‚Äî –ö–∞—Ç–∞–ª–æ–≥ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_snapshot_visibility_with_commits`
* `test_snapshot_advancement_and_gc`
* `test_snapshot_binary_roundtrip`
* `test_snapshot_txn_filtering`
* `test_snapshot_isolation_enforcement`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.6 ‚Äî –°–∏—Å—Ç–µ–º–∞ rollback/undo –ª–æ–≥–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.6 ‚Äî –°–∏—Å—Ç–µ–º–∞ rollback/undo –ª–æ–≥–æ–≤

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `rollback_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É **–æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π (rollback)** –Ω–∞ –æ—Å–Ω–æ–≤–µ **undo-–ª–æ–≥–æ–≤**, —Å–æ—Ö—Ä–∞–Ω—è—é—â–∏—Ö –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ç—Ä–æ–∫, —Å—Ç—Ä–∞–Ω–∏—Ü –∏–ª–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, savepoint-–æ—Ç–∫–∞—Ç–∞—Ö, –æ—Ç–º–µ–Ω–µ DML –∏ —á–∞—Å—Ç–∏—á–Ω–æ ‚Äî –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------- | ---------- |
| `undo_log_init`             | `bool undo_log_init(void);`                                              | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏—Å—Ç–µ–º—É undo-–ª–æ–≥–æ–≤.                            | `true`     |
| `undo_log_capture`          | `bool undo_log_capture(tx_ctx_t *tx, const row_t *before, row_id_t id);` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é —Å—Ç—Ä–æ–∫–∏ –ø–µ—Ä–µ–¥ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.        | `true`     |
| `undo_log_apply`            | `bool undo_log_apply(tx_ctx_t *tx);`                                     | –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Ç–∫–∞—Ç –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –≤ undo-–ª–æ–≥–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.          | `true`     |
| `undo_log_clear`            | `void undo_log_clear(tx_ctx_t *tx);`                                     | –£–¥–∞–ª—è–µ—Ç undo-–∑–∞–ø–∏—Å–∏ –ø–æ—Å–ª–µ commit.                             | `void`     |
| `undo_log_replay_for_crash` | `bool undo_log_replay_for_crash(void);`                                  | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ—Ç–∫–∞—Ç –¥–ª—è –≤—Å–µ—Ö –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ—Å–ª–µ —Å–±–æ—è. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  row_id_t id;
  row_t *previous_version;
} undo_entry_t;

typedef struct {
  tx_id_t tx_id;
  undo_entry_t *entries;
  size_t entry_count;
} undo_log_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `undo_log_entries_total{tx}` ‚Äî —á–∏—Å–ª–æ undo-–∑–∞–ø–∏—Å–µ–π
* `undo_log_apply_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–∫–∞—Ç–∞
* `undo_log_replay_count` ‚Äî —á–∏—Å–ª–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ—Å–ª–µ —Å–±–æ—è
* `undo_log_size_bytes{tx}` ‚Äî –æ–±—ä—ë–º undo-–±—É—Ñ–µ—Ä–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –°—Ç—Ä–æ–≥–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å write-before-update
* –ó–∞—â–∏—Ç–∞ –æ—Ç rollback —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
* –ü—Ä–æ–≤–µ—Ä–∫–∞ ownership –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ undo

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC`
* `2.2 ‚Äî TX Manager`
* `2.14 ‚Äî Crash Recovery`
* `2.7 ‚Äî Savepoint/rollback-to`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_undo_capture_and_apply`
* `test_undo_log_cleanup_after_commit`
* `test_rollback_during_write_conflict`
* `test_crash_recovery_with_undo`
* `test_rollback_row_level_accuracy`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.7 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ savepoint / rollback-to** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.7 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ savepoint / rollback-to

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `savepoint_manager`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **savepoint-–æ–≤** –∏ **—á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ (`ROLLBACK TO`)** –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ª–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö, —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö –∏ SQL-–∫–æ–º–∞–Ω–¥–∞—Ö `SAVEPOINT`, `RELEASE`, `ROLLBACK TO`.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| ----------------------- | ------------------------------------------------------------- | ----------------------------------------------------- | ------------ |
| `savepoint_create`      | `bool savepoint_create(tx_ctx_t *tx, const char *name);`      | –°–æ–∑–¥–∞—ë—Ç savepoint —Å –∏–º–µ–Ω–µ–º –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. | `true`       |
| `savepoint_rollback_to` | `bool savepoint_rollback_to(tx_ctx_t *tx, const char *name);` | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ savepoint.  | `true`       |
| `savepoint_release`     | `bool savepoint_release(tx_ctx_t *tx, const char *name);`     | –£–¥–∞–ª—è–µ—Ç savepoint (–±–µ–∑ –æ—Ç–∫–∞—Ç–∞).                       | `true`       |
| `savepoint_list`        | `char **savepoint_list(tx_ctx_t *tx, size_t *count);`         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö savepoint-–æ–≤.              | –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ |
| `savepoint_clear_all`   | `void savepoint_clear_all(tx_ctx_t *tx);`                     | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ savepoint-—ã –ø—Ä–∏ commit/abort.             | `void`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  size_t undo_checkpoint;
  uint64_t timestamp;
} savepoint_t;

typedef struct {
  savepoint_t savepoints[32];
  size_t count;
} savepoint_stack_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `savepoints_created_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
* `savepoints_rollback_success` ‚Äî —á–∏—Å–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–∫–∞—Ç–æ–≤
* `savepoints_release_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–∏–π –±–µ–∑ –æ—Ç–∫–∞—Ç–∞
* `savepoints_conflict_errors` ‚Äî –æ—à–∏–±–∫–∏ rollback –ø–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∏–º–µ–Ω–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ rollback-to: –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ undo/MVCC
* –ò–∑–æ–ª—è—Ü–∏—è savepoint-–æ–≤ –ø–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç rollback –¥–æ —Ç–æ—á–µ–∫ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (invalid nesting)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî TX Manager`
* `2.6 ‚Äî Undo –ª–æ–≥`
* `3.18 ‚Äî SQL-—Ç—Ä–∏–≥–≥–µ—Ä—ã`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_savepoint_create_and_list`
* `test_savepoint_rollback_to`
* `test_savepoint_release_behavior`
* `test_rollback_chain_correctness`
* `test_invalid_savepoint_name_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.8 ‚Äî GC / Vacuum / –æ—á–∏—Å—Ç–∫–∞ –≤–µ—Ä—Å–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.8 ‚Äî GC / Vacuum / –æ—á–∏—Å—Ç–∫–∞ –≤–µ—Ä—Å–∏–π

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `mvcc_garbage_collector`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–æ—á–∏—Å—Ç–∫–∏ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π —Å—Ç—Ä–æ–∫** (garbage collection / vacuum), –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –≤ —Ü–µ–ø–æ—á–∫–∞—Ö MVCC. –£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–Ω—ã –Ω–∏ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ç–µ–º —Å–∞–º—ã–º —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø–∞–º—è—Ç—å –∏ —É—Å–∫–æ—Ä—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç       |
| ------------------------ | ------------------------------------------------------ | ----------------------------------------------- | ---------------- |
| `gc_init`                | `bool gc_init(void);`                                  | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞. | `true`           |
| `gc_collect_table`       | `size_t gc_collect_table(table_t *table);`             | –û—á–∏—â–∞–µ—Ç –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ.    | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö |
| `gc_is_version_obsolete` | `bool gc_is_version_obsolete(const row_version_t *v);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –≤–µ—Ä—Å–∏—è –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–∞.        | `true`, –µ—Å–ª–∏ –¥–∞  |
| `gc_run_periodic`        | `void gc_run_periodic(void);`                          | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π —Ü–∏–∫–ª –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.           | `void`           |
| `gc_notify_tx_end`       | `void gc_notify_tx_end(tx_id_t tx_id);`                | –£–≤–µ–¥–æ–º–ª—è–µ—Ç GC –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.          | `void`           |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t safe_gc_ts;
  tx_id_t *active_tx_ids;
  size_t count;
} gc_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `gc_versions_collected_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
* `gc_cycle_duration_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞ GC
* `gc_safe_ts_advance_rate` ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è safe timestamp
* `gc_per_table_stats{table}` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è–µ—Ç –≤–µ—Ä—Å–∏—é, –≤–∏–¥–∏–º—É—é —Ö–æ—Ç—å –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç race-condition —Å snapshot-–∏–∑–æ–ª—è—Ü–∏–µ–π
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SYSTEM VERSIONED —Ç–∞–±–ª–∏—Ü–∞–º–∏ (1.15)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC`
* `2.2 ‚Äî Transaction Manager`
* `2.5 ‚Äî Snapshot`
* `1.13 ‚Äî TTL/Eviction`
* `15.8 ‚Äî Retention for versions`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_gc_removes_obsolete_versions`
* `test_gc_respects_active_snapshots`
* `test_gc_periodic_triggering`
* `test_gc_per_table_limits`
* `test_gc_transaction_end_notification`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.9 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (conflict graph)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.9 ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (conflict graph)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `tx_conflict_graph`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (conflict graph)**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è deadlock-–æ–≤, —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ä—è–¥–∫–∞ –∫–æ–º–º–∏—Ç–æ–≤ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------------- | --------------------------------------------------------- | -------------------------------------------------- | ---------- |
| `conflict_graph_init`      | `bool conflict_graph_init(void);`                         | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.         | `true`     |
| `conflict_graph_add_edge`  | `bool conflict_graph_add_edge(tx_id_t from, tx_id_t to);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–æ—Ç ‚Üí –∫).                 | `true`     |
| `conflict_graph_has_cycle` | `bool conflict_graph_has_cycle(tx_id_t start);`           | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ü–∏–∫–ª–∞, —É–∫–∞–∑—ã–≤–∞—é—â–µ–≥–æ –Ω–∞ deadlock. | `true`     |
| `conflict_graph_remove_tx` | `void conflict_graph_remove_tx(tx_id_t tx);`              | –£–¥–∞–ª—è–µ—Ç —É–∑–µ–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –≤—Å–µ –µ—ë –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.      | `void`     |
| `conflict_graph_dump`      | `void conflict_graph_dump(FILE *out);`                    | –ü–µ—á–∞—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –≥—Ä–∞—Ñ –≤ DOT-—Ñ–æ—Ä–º–∞—Ç–µ.               | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct conflict_node {
  tx_id_t tx_id;
  tx_id_t *depends_on;
  size_t count;
} conflict_node_t;

typedef struct {
  conflict_node_t *nodes;
  size_t node_count;
} conflict_graph_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tx_conflict_edges_total` ‚Äî —á–∏—Å–ª–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* `tx_deadlock_detected_total` ‚Äî —á–∏—Å–ª–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö deadlock-–æ–≤
* `conflict_graph_node_count` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –≥—Ä–∞—Ñ–µ
* `conflict_graph_cycle_detection_time_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ —Ü–∏–∫–ª–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç self-edge / duplicate-edge
* –ö–æ–Ω—Ç—Ä–æ–ª—å TTL –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (auto-expire)
* –í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ –ø—Ä–∏ dump / debug

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî Transaction Manager`
* `2.4 ‚Äî Isolation Levels`
* `2.10 ‚Äî Serializable fallback`
* `3.12 ‚Äî SQL Executor`
* `7.13 ‚Äî Watchdog –∏ TX leak detector`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_conflict_graph_add_and_remove`
* `test_conflict_graph_cycle_detection`
* `test_conflict_graph_multiple_dependencies`
* `test_conflict_graph_dump_format`
* `test_conflict_graph_gc_of_nodes`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.10 ‚Äî –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å / fallback –∫ SERIALIZABLE** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.10 ‚Äî –°–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å / fallback –∫ SERIALIZABLE

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `serializable_fallback`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è **—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ–π –∏–∑–æ–ª—è—Ü–∏–∏** —á–µ—Ä–µ–∑ fallback-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏. –ï—Å–ª–∏ –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å, –æ–Ω–∞ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º stricter-—Ä–µ–∂–∏–º–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –≥—Ä–∞—Ñ–æ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, snapshot isolation –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| ------------------------------ | --------------------------------------------------------------------- | -------------------------------------------------- | --------------------- |
| `serializable_check_conflicts` | `bool serializable_check_conflicts(tx_ctx_t *tx);`                    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ä—É—à–∞–µ—Ç –ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç—å. | `true`, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç |
| `serializable_fallback_retry`  | `bool serializable_fallback_retry(tx_ctx_t *tx);`                     | –ü–æ–≤—Ç–æ—Ä—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ —Ä–µ–∂–∏–º–µ SERIALIZABLE.        | `true`                |
| `serializable_promote_level`   | `void serializable_promote_level(tx_ctx_t *tx);`                      | –ü–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ–∫—É—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.      | `void`                |
| `serializable_abort_with_log`  | `void serializable_abort_with_log(tx_ctx_t *tx, const char *reason);` | –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã.       | `void`                |
| `serializable_validate_graph`  | `bool serializable_validate_graph(tx_ctx_t *tx);`                     | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥—Ä–∞—Ñ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–∏–∫–ª–æ–≤.    | `true`, –µ—Å–ª–∏ –≤–∞–ª–∏–¥–µ–Ω  |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  tx_id_t tx_id;
  bool promoted;
  bool retry_allowed;
  uint64_t validation_ts;
} serializable_info_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `serializable_conflicts_total` ‚Äî –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã
* `serializable_fallbacks_total` ‚Äî —Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ
* `serializable_retry_success_rate` ‚Äî —É—Å–ø–µ—à–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
* `serializable_graph_validation_time_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç phantom read –∏ write skew
* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π abort –ø—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≥–∞—Ä–∞–Ω—Ç–∏–π —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–æ—Å—Ç–∏
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å audit-–ª–æ–≥–æ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏—á–∏–Ω –æ—Ç–∫–∞—Ç–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.4 ‚Äî Isolation Levels`
* `2.9 ‚Äî Conflict Graph`
* `2.2 ‚Äî Transaction Manager`
* `2.11 ‚Äî Transaction Retry Engine`
* `7.13 ‚Äî –ê–≤–∞—Ä–∏–π–Ω—ã–π watchdog`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_serializable_violation_detection`
* `test_serializable_retry_with_promotion`
* `test_serializable_graph_validation`
* `test_serializable_abort_logging`
* `test_serializable_fallback_success`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.11 ‚Äî –ü–æ–≤—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.11 ‚Äî –ü–æ–≤—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `tx_retry_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–ø–æ–≤—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (transaction retry)** –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, —Å–±–æ–µ–≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ write-write –∫–æ–ª–ª–∏–∑–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å snapshot isolation, fallback –Ω–∞ SERIALIZABLE –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç-–≥—Ä–∞—Ñ–æ–º. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, –ª–∏–º–∏—Ç–∞–º–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç         |
| --------------------------- | ------------------------------------------------------------------- | --------------------------------------------------- | ------------------ |
| `tx_retry_enabled`          | `bool tx_retry_enabled(const tx_ctx_t *tx);`                        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–∑—Ä–µ—à—ë–Ω –ª–∏ retry –¥–ª—è –¥–∞–Ω–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. | `true`             |
| `tx_retry_register_failure` | `void tx_retry_register_failure(tx_ctx_t *tx, const char *reason);` | –§–∏–∫—Å–∏—Ä—É–µ—Ç –ø—Ä–∏—á–∏–Ω—É –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Å—á—ë—Ç—á–∏–∫ retry.   | `void`             |
| `tx_retry_should_retry`     | `bool tx_retry_should_retry(const tx_ctx_t *tx);`                   | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–Ω–æ –ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. | `true`, –µ—Å–ª–∏ –º–æ–∂–Ω–æ |
| `tx_retry_execute`          | `bool tx_retry_execute(tx_ctx_t *tx, tx_fn_t fn, void *ctx);`       | –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ callback.  | `true`             |
| `tx_retry_clear`            | `void tx_retry_clear(tx_ctx_t *tx);`                                | –û—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç retry –ø–æ—Å–ª–µ —É—Å–ø–µ—Ö–∞.                | `void`             |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint32_t retry_count;
  uint64_t last_failure_ts;
  char last_reason[128];
  bool allow_retry;
} tx_retry_info_t;

typedef bool (*tx_fn_t)(tx_ctx_t *tx, void *ctx);
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tx_retry_attempts_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–≤—Ç–æ—Ä–æ–≤
* `tx_retry_success_total` ‚Äî —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä—ã
* `tx_retry_failures_by_reason{reason}` ‚Äî –ø—Ä–∏—á–∏–Ω—ã –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
* `tx_retry_backoff_ns_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤ (max\_retry)
* –°–±—Ä–æ—Å MVCC-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–∏–º–∏—Ç–∞–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî Transaction Manager`
* `2.10 ‚Äî Serializable Fallback`
* `2.4 ‚Äî Isolation Levels`
* `3.12 ‚Äî SQL Executor`
* `7.13 ‚Äî Watchdog / Timeout control`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_tx_retry_on_serializable_conflict`
* `test_tx_retry_max_limit_exceeded`
* `test_tx_retry_exponential_backoff`
* `test_tx_retry_callback_execution`
* `test_tx_retry_context_cleanup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.12 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (Consistency Validator)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.12 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (Consistency Validator)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `tx_consistency_validator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–ª–æ–≥–∏—á–µ—Å–∫—É—é –∏ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**, –≤–∫–ª—é—á–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å MVCC-—Ü–µ–ø–æ—á–µ–∫, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ snapshot-–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ write-write –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å undo/wal –æ–ø–µ—Ä–∞—Ü–∏–π. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ commit, –ø—Ä–∏ –æ—Ç–∫–∞—Ç–∞—Ö, –≤ —Ä–µ–∂–∏–º–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –∏ –ø—Ä–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------- | --------------------------------------------------------- | --------------------------------------------------------- | ---------- |
| `tx_validate_consistency`       | `bool tx_validate_consistency(const tx_ctx_t *tx);`       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.    | `true`     |
| `tx_validate_mvcc_chain`        | `bool tx_validate_mvcc_chain(const row_chain_t *chain);`  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏ –Ω–µ–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–æ—Å—Ç—å MVCC-—Ü–µ–ø–æ—á–∫–∏. | `true`     |
| `tx_validate_snapshot_range`    | `bool tx_validate_snapshot_range(const tx_ctx_t *tx);`    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç snapshot-–ø–æ–∫—Ä—ã—Ç–∏–µ —á–∏—Ç–∞–µ–º—ã—Ö –≤–µ—Ä—Å–∏–π.              | `true`     |
| `tx_validate_undo_integrity`    | `bool tx_validate_undo_integrity(const tx_ctx_t *tx);`    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ undo-–ª–æ–≥–∏ –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã.                   | `true`     |
| `tx_validate_logical_conflicts` | `bool tx_validate_logical_conflicts(const tx_ctx_t *tx);` | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ write/write –∏–ª–∏ phantom –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.   | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool mvcc_ok;
  bool snapshot_ok;
  bool undo_ok;
  bool conflicts_ok;
  char details[256];
} tx_validation_result_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tx_validation_errors_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π
* `tx_validation_duration_ns` ‚Äî –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
* `tx_mvcc_chain_error_count` ‚Äî –æ—à–∏–±–∫–∏ –≤ —Ü–µ–ø–æ—á–∫–∞—Ö –≤–µ—Ä—Å–∏–π
* `tx_snapshot_mismatch_total` ‚Äî –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è snapshot-–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç commit –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å fallback engine –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å soft-fail (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –±–µ–∑ abort)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC`
* `2.5 ‚Äî Snapshot`
* `2.6 ‚Äî Undo`
* `2.3 ‚Äî WAL TX Layer`
* `2.10 ‚Äî Serializable fallback`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_tx_mvcc_chain_validation`
* `test_tx_snapshot_range_validation`
* `test_tx_undo_corruption_detection`
* `test_tx_logical_conflict_validation`
* `test_tx_validator_failure_reporting`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.13 ‚Äî –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ Point-in-Time Recovery** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.13 ‚Äî –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ Point-in-Time Recovery

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `point_in_time_recovery`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã** –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ LSN (Log Sequence Number) —Å –ø–æ–º–æ—â—å—é snapshot-–æ–≤ –∏ WAL. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–π, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö `AS OF`-–∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **diff-based restore**, –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ skip-–±–ª–æ–∫–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| ----------------------------- | ---------------------------------------------------------- | ---------------------------------------------------------- | ----------- |
| `pit_restore_from_lsn`        | `bool pit_restore_from_lsn(uint64_t target_lsn);`          | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ë–î –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ LSN.                      | `true`      |
| `pit_restore_from_timestamp`  | `bool pit_restore_from_timestamp(uint64_t target_ts);`     | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–µ.                         | `true`      |
| `pit_restore_dry_run`         | `bool pit_restore_dry_run(uint64_t ts, pit_plan_t *plan);` | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.                   | `true`      |
| `pit_get_available_snapshots` | `char **pit_get_available_snapshots(size_t *count);`       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ snapshot-–æ–≤.                             | –ú–∞—Å—Å–∏–≤ –∏–º—ë–Ω |
| `pit_validate_integrity`      | `bool pit_validate_integrity(const pit_plan_t *plan);`     | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ WAL –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º. | `true`      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char snapshot_name[128];
  uint64_t snapshot_lsn;
  uint64_t restore_lsn;
  bool requires_wal_replay;
} pit_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `pit_restore_duration_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
* `pit_wal_replay_lag_bytes` ‚Äî –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö WAL –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
* `pit_integrity_errors_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
* `pit_snapshot_used{name}` ‚Äî snapshot, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏ PITR

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º (ts > now)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º snapshot + WAL
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ read-only –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.20 ‚Äî Snapshot-—Å–∏—Å—Ç–µ–º–∞`
* `2.3 ‚Äî WAL TX Layer`
* `2.5 ‚Äî Snapshot –º–µ–Ω–µ–¥–∂–µ—Ä`
* `15.2 ‚Äî AS OF –∑–∞–ø—Ä–æ—Å—ã`
* `7.12 ‚Äî Panic/Error Handler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_pit_restore_lsn_exact_match`
* `test_pit_restore_with_wal_gap`
* `test_pit_dry_run_plan_generation`
* `test_pit_snapshot_selection_logic`
* `test_pit_integrity_validation_errors`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.14 ‚Äî Crash Recovery (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.14 ‚Äî Crash Recovery (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤)

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `crash_recovery`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã**, —Å–±–æ—è –ø–∏—Ç–∞–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —É–∑–ª–∞ –∏–ª–∏ –ø–∞–¥–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é **WAL**, **snapshot**, **undo-–ª–æ–≥–æ–≤** –∏ **–∫–∞—Ç–∞–ª–æ–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **idempotent** –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, —Ñ–æ–Ω–æ–≤—ã–π reapply –∏ multi-node –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                       | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç           |
| --------------------------------- | ---------------------------------------------------- | -------------------------------------------------- | -------------------- |
| `crash_recovery_run`              | `bool crash_recovery_run(void);`                     | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.     | `true`, –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ |
| `crash_recovery_replay_wal`       | `bool crash_recovery_replay_wal(uint64_t from_lsn);` | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏ WAL –Ω–∞—á–∏–Ω–∞—è —Å –∑–∞–¥–∞–Ω–Ω–æ–≥–æ LSN.      | `true`               |
| `crash_recovery_apply_undo`       | `bool crash_recovery_apply_undo(void);`              | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ—Ç–∫–∞—Ç—ã –¥–ª—è –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.     | `true`               |
| `crash_recovery_validate_catalog` | `bool crash_recovery_validate_catalog(void);`        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. | `true`               |
| `crash_recovery_report`           | `void crash_recovery_report(FILE *out);`             | –ü–µ—á–∞—Ç–∞–µ—Ç –æ—Ç—á—ë—Ç –æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏.                   | `void`               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t last_valid_lsn;
  tx_id_t *incomplete_tx;
  size_t incomplete_count;
  bool wal_corrupted;
  bool snapshot_available;
} crash_recovery_state_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `crash_recovery_duration_ns` ‚Äî –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
* `crash_recovery_incomplete_tx_total` ‚Äî –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
* `crash_recovery_wal_applied_bytes` ‚Äî –æ–±—ä—ë–º –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö WAL-–∑–∞–ø–∏—Å–µ–π
* `crash_recovery_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ WAL –∏ snapshot –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
* –í–∞–ª–∏–¥–∞—Ü–∏—è rollback —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø—Ä–æ—Ç–∏–≤ undo
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (idempotent replay)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.3 ‚Äî WAL TX Layer`
* `2.6 ‚Äî Undo –ª–æ–≥–∏`
* `2.5 ‚Äî Snapshot Manager`
* `2.12 ‚Äî TX Consistency Validator`
* `7.13 ‚Äî –ê–≤–∞—Ä–∏–π–Ω—ã–π watchdog`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_crash_recovery_clean_shutdown`
* `test_crash_recovery_with_pending_tx`
* `test_crash_recovery_missing_snapshot`
* `test_crash_recovery_idempotency`
* `test_crash_recovery_corrupted_wal_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **2.15 ‚Äî WAL-based backup –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 2.15 ‚Äî WAL-based backup –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

**–ü–∞–∫–µ—Ç:** `2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å`
**Block ID:** `wal_replication_backup`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ—Ç–æ–∫–æ–≤—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ WAL**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É WAL-–∑–∞–ø–∏—Å–µ–π –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏, —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ —Å–Ω—ç–ø—à–æ—Ç—ã –∏ Point-in-Time Recovery. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –≥–µ–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | -------------------------------------------- | ---------------------------------------------- | ---------- |
| `wal_backup_create`            | `bool wal_backup_create(const char *path);`  | –°–æ–∑–¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π backup —Å snapshot –∏ WAL.        | `true`     |
| `wal_replication_send_loop`    | `void wal_replication_send_loop(void);`      | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª –ø–µ—Ä–µ–¥–∞—á–∏ WAL –Ω–∞ —Ä–µ–ø–ª–∏–∫–∏.        | `void`     |
| `wal_replication_receive_loop` | `void wal_replication_receive_loop(void);`   | –ü–æ–ª—É—á–∞–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç WAL –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ.           | `void`     |
| `wal_backup_restore`           | `bool wal_backup_restore(const char *path);` | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –∏–∑ WAL backup.         | `true`     |
| `wal_replication_ack`          | `bool wal_replication_ack(uint64_t lsn);`    | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ WAL-–∑–∞–ø–∏—Å–µ–π –Ω–∞ —Ä–µ–ø–ª–∏–∫–µ. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t lsn;
  uint64_t timestamp;
  char node_id[64];
  bool acknowledged;
} wal_replica_status_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `wal_replication_lag_bytes` ‚Äî –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∏
* `wal_backup_duration_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è backup
* `wal_transferred_bytes_total` ‚Äî –æ–±—â–∏–π –æ–±—ä—ë–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* `wal_replication_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–¥–∞—á–∏ WAL

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–µ—Ä–µ–¥–∞—á–∞ WAL —á–µ—Ä–µ–∑ TLS/mTLS
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ replay protection (idempotent WAL)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ backup/restore –æ–ø–µ—Ä–∞—Ü–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.19 ‚Äî WAL (write-ahead log)`
* `2.3 ‚Äî WAL TX Layer`
* `2.13 ‚Äî Point-in-Time Recovery`
* `2.14 ‚Äî Crash Recovery`
* `4.3 ‚Äî gRPC / Streaming replication protocol`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_wal_replication_lag_detection`
* `test_wal_backup_and_restore_roundtrip`
* `test_wal_replication_throughput`
* `test_wal_acknowledgement_logic`
* `test_wal_stream_corruption_handling`

---

‚úÖ –ü–∞–∫–µ—Ç **2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **3. SQL –∏ –Ø–∑—ã–∫–∏**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **3.1 ‚Äî –ü–∞—Ä—Å–µ—Ä SQL (ANSI 2011+)**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.1 ‚Äî –ü–∞—Ä—Å–µ—Ä SQL (ANSI 2011+)

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_parser_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π **–ø–∞—Ä—Å–µ—Ä SQL**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç **ANSI SQL:2011+**, –≤–∫–ª—é—á–∞—è –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, CTE, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, `MERGE`, `FILTER`, `LATERAL`, JSON-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ (AST) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç         |
| -------------------------- | --------------------------------------------------------------- | ------------------------------------------------------ | ------------------ |
| `sql_parse`                | `sql_ast_t *sql_parse(const char *query, sql_error_t *err);`    | –†–∞–∑–±–∏—Ä–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –∏ —Å—Ç—Ä–æ–∏—Ç AST.                     | AST –∏–ª–∏ `NULL`     |
| `sql_parse_statement_list` | `sql_stmt_list_t *sql_parse_statement_list(const char *query);` | –†–∞–∑–±–∏—Ä–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ SQL-–≤—ã—Ä–∞–∂–µ–Ω–∏—è (batch).         | –°–ø–∏—Å–æ–∫             |
| `sql_parse_free`           | `void sql_parse_free(sql_ast_t *ast);`                          | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –¥–µ—Ä–µ–≤–∞ AST.                        | `void`             |
| `sql_parser_set_mode`      | `void sql_parser_set_mode(sql_mode_t mode);`                    | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º —Ä–∞–∑–±–æ—Ä–∞ (ANSI, Oracle, JSON-only). | `void`             |
| `sql_validate_syntax`      | `bool sql_validate_syntax(const char *sql, sql_error_t *err);`  | –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –±–µ–∑ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è AST.        | `true` –∏–ª–∏ `false` |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  SQL_MODE_ANSI,
  SQL_MODE_ORACLE,
  SQL_MODE_JSON_EXT
} sql_mode_t;

typedef struct {
  int code;
  char message[256];
  size_t position;
} sql_error_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_parse_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–∑–±–æ—Ä–∞
* `sql_parse_error_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
* `sql_ast_depth_max` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞ AST
* `sql_parse_batch_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ batch

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –Ω–∞ —ç—Ç–∞–ø–µ –ª–µ–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã AST –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DoS
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º sandbox-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ SQL)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.2 ‚Äî SQL AST`
* `3.5 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä`
* `3.12 ‚Äî SQL Executor`
* `19.1 ‚Äî –§–æ—Ä–º–∞—Ç SQL-–∑–∞–ø—Ä–æ—Å–æ–≤`
* `6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (RLS/CLS)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_sql_parse_basic_select`
* `test_sql_parse_window_functions`
* `test_sql_parse_cte_and_lateral`
* `test_sql_parse_json_syntax`
* `test_sql_parse_invalid_error_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.2 ‚Äî AST –¥–µ—Ä–µ–≤–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.2 ‚Äî AST –¥–µ—Ä–µ–≤–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_ast_structures`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä **–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–≥–æ –¥–µ—Ä–µ–≤–∞ (AST)**, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ SQL-–ø–∞—Ä—Å–µ—Ä–æ–º. AST –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤: `SELECT`, `FROM`, `WHERE`, `JOIN`, –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, –∞–≥—Ä–µ–≥–∞—Ç—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –æ–∫–æ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º—ã –∏ –¥—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º SQL.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ------------------------------------------------------------ | ---------------------------------- | ---------- |
| `ast_create_node`    | `ast_node_t *ast_create_node(ast_node_type_t type);`         | –°–æ–∑–¥–∞—ë—Ç —É–∑–µ–ª AST –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞.   | AST —É–∑–µ–ª   |
| `ast_add_child`      | `void ast_add_child(ast_node_t *parent, ast_node_t *child);` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥—É–∑–µ–ª –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º—É. | `void`     |
| `ast_clone_subtree`  | `ast_node_t *ast_clone_subtree(const ast_node_t *root);`     | –ö–ª–æ–Ω–∏—Ä—É–µ—Ç –ø–æ–¥–¥–µ—Ä–µ–≤–æ AST.           | –ù–æ–≤—ã–π AST  |
| `ast_node_to_string` | `char *ast_node_to_string(const ast_node_t *node);`          | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç AST-—É–∑–µ–ª –≤ —Å—Ç—Ä–æ–∫—É SQL. | –°—Ç—Ä–æ–∫–∞     |
| `ast_destroy`        | `void ast_destroy(ast_node_t *node);`                        | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –¥–µ—Ä–µ–≤–æ AST.            | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  AST_SELECT,
  AST_FROM,
  AST_WHERE,
  AST_JOIN,
  AST_EXPR,
  AST_FUNC_CALL,
  AST_WINDOW,
  AST_LITERAL,
  AST_IDENTIFIER,
  // ...
} ast_node_type_t;

typedef struct ast_node_t {
  ast_node_type_t type;
  struct ast_node_t **children;
  size_t child_count;
  union {
    char *text;
    int64_t int_val;
    double float_val;
    // ...
  } value;
} ast_node_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ast_node_count_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ
* `ast_max_depth` ‚Äî –≥–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
* `ast_cloned_subtree_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–¥–¥–µ—Ä–µ–≤—å–µ–≤
* `ast_stringify_duration_ns` ‚Äî –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL –∏–∑ AST

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≥–ª—É–±–∏–Ω—ã –¥–µ—Ä–µ–≤–∞ –∏ —á–∏—Å–ª–∞ —É–∑–ª–æ–≤
* –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —É–∑–ª–æ–≤ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å—Å—ã–ª–æ–∫ –∏ –≤–ª–∞–¥–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –ø—Ä–∏ destroy

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.5 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä`
* `3.6 ‚Äî Rule Rewriter`
* `3.12 ‚Äî SQL Executor`
* `19.1 ‚Äî SQL-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_ast_node_creation_and_linking`
* `test_ast_clone_deep_structure`
* `test_ast_to_string_reconstruction`
* `test_ast_invalid_type_handling`
* `test_ast_destroy_memory_leak_check`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_window_functions`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π SQL** (WINDOW FUNCTIONS) –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å ANSI SQL:2011. –í–∫–ª—é—á–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—Ä–µ–π–º–æ–≤ (`ROWS`, `RANGE`), —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, PARTITION BY, –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ–≤–µ—Ä—Ö –æ–∫–æ–Ω –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`RANK`, `ROW_NUMBER`, `LAG`, `LEAD`, `NTILE`, `PERCENT_RANK`, `CUME_DIST` –∏ –¥—Ä.). –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------------- | ---------------------------------------------- | ---------- |
| `window_func_prepare`    | `bool window_func_prepare(sql_plan_t *plan, window_clause_t *wc);`     | –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.     | `true`     |
| `window_func_compute`    | `bool window_func_compute(window_context_t *ctx);`                     | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –æ–∫–Ω—É.        | `true`     |
| `window_func_register`   | `bool window_func_register(const char *name, window_impl_t *impl);`    | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. | `true`     |
| `window_func_reset`      | `void window_func_reset(window_context_t *ctx);`                       | –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–∫–Ω–∞ –º–µ–∂–¥—É –ø–∞—Ä—Ç–∏—è–º–∏ –¥–∞–Ω–Ω—ã—Ö.    | `void`     |
| `window_func_dump_state` | `void window_func_dump_state(const window_context_t *ctx, FILE *out);` | –í—ã–≤–æ–¥–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–∫–Ω–∞ –¥–ª—è –¥–µ–±–∞–≥–∞.             | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  bool (*init)(void **state);
  bool (*step)(void *state, const row_t *row);
  bool (*final)(void *state, value_t *result);
  bool (*frame)(void *state, const row_t *start, const row_t *end);
} window_impl_t;

typedef struct {
  window_impl_t *impl;
  partition_t *partition;
  order_spec_t *order;
  frame_spec_t *frame;
  void *state;
} window_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `window_function_calls_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –ø–æ —Ç–∏–ø—É —Ñ—É–Ω–∫—Ü–∏–∏
* `window_partition_count` ‚Äî —á–∏—Å–ª–æ partition-–æ–≤
* `window_computation_latency_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
* `window_state_memory_bytes` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –æ–∫–æ–Ω–Ω—ã–º –¥–≤–∏–∂–∫–æ–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ RANGE/ROWS OFFSET
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ partition-–æ–≤
* –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ –æ–∫–æ–Ω–Ω–æ–π —Ä–∞–º–∫–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.2 ‚Äî AST`
* `3.5 ‚Äî Optimizer`
* `3.12 ‚Äî SQL Executor`
* `5.2 ‚Äî Runtime Aggregator`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_window_row_number_partition_order`
* `test_window_rank_dense_rank_behavior`
* `test_window_lag_lead_defaults`
* `test_window_frame_range_unbounded`
* `test_window_custom_function_registration`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ FILTER, MERGE, LATERAL, JSON —Ñ—É–Ω–∫—Ü–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ FILTER, MERGE, LATERAL, JSON —Ñ—É–Ω–∫—Ü–∏–π

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_advanced_clauses`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö SQL-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ —Ñ—É–Ω–∫—Ü–∏–π, –≤—Ö–æ–¥—è—â–∏—Ö –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç SQL:2011+ –∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ BI/OLAP-–∑–∞–ø—Ä–æ—Å–∞—Ö:

* `FILTER (WHERE ‚Ä¶)` –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* `MERGE` (insert/update/delete –ø–æ —É—Å–ª–æ–≤–∏—é)
* `LATERAL` –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã
* `JSON` —Ñ—É–Ω–∫—Ü–∏–∏ (parse, extract, query, json\_table)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –±–æ–ª–µ–µ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω—ã–µ, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∏ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç                |
| ----------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------------------ | ------------------------- |
| `sql_filter_apply`      | `bool sql_filter_apply(agg_context_t *ctx, const row_t *row);`                          | –ü—Ä–∏–º–µ–Ω—è–µ—Ç FILTER-–∫–ª–∞—É–∑—É –∫ –∞–≥—Ä–µ–≥–∞—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.          | `true`, –µ—Å–ª–∏ row –≤–∫–ª—é—á–µ–Ω–∞ |
| `sql_merge_execute`     | `bool sql_merge_execute(sql_stmt_t *stmt, tx_ctx_t *tx);`                               | –í—ã–ø–æ–ª–Ω—è–µ—Ç MERGE-–æ–ø–µ—Ä–∞—Ü–∏—é (match/insert/update/delete). | `true`                    |
| `sql_lateral_bind`      | `bool sql_lateral_bind(subquery_t *sq, const row_t *outer);`                            | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π —Å—Ç—Ä–æ–∫–∏ —Å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–º.     | `true`                    |
| `sql_json_eval`         | `json_value_t *sql_json_eval(const char *expr, const row_t *row);`                      | –í—ã–ø–æ–ª–Ω—è–µ—Ç JSON-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∫ –¥–∞–Ω–Ω—ã–º —Å—Ç—Ä–æ–∫–∏.              | JSON-—Ä–µ–∑—É–ª—å—Ç–∞—Ç            |
| `sql_json_table_expand` | `bool sql_json_table_expand(const char *json, json_table_spec_t *spec, rowset_t *out);` | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç JSON –≤ —Ç–∞–±–ª–∏—Ü—É.                            | `true`                    |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *path;
  json_path_mode_t mode;
  json_type_t expected;
} json_table_column_t;

typedef struct {
  json_table_column_t *columns;
  size_t column_count;
} json_table_spec_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_filter_applied_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö FILTER
* `sql_merge_affected_rows` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö MERGE
* `sql_lateral_invocations` ‚Äî –≤—ã–∑–æ–≤–æ–≤ lateral-–ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤
* `sql_json_eval_errors` ‚Äî –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è JSON-—Å—Ö–µ–º –ø–µ—Ä–µ–¥ expand
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –≥–ª—É–±–∏–Ω—É —Ä–µ–∫—É—Ä—Å–∏–π –≤ LATERAL
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MERGE –ø–æ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞ –∏ –∫–ª—é—á–µ–≤—ã–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.2 ‚Äî AST`
* `3.12 ‚Äî SQL Executor`
* `5.3 ‚Äî JSON runtime`
* `15.10 ‚Äî –ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ (MERGE-level ACL)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_sql_filter_aggregate_behavior`
* `test_sql_merge_insert_update_delete`
* `test_sql_lateral_nested_subquery`
* `test_sql_json_eval_and_extract`
* `test_sql_json_table_to_rowset`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.5 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä SQL (Cost-based + Rule-based)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.5 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä SQL (Cost-based + Rule-based)

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_optimizer`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π **–æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**:

* **Cost-based**: –≤—ã–±–∏—Ä–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ü–µ–Ω–æ–∫ —Å—Ç–æ–∏–º–æ—Å—Ç–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ NDV.
* **Rule-based**: –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ AST/–ø–ª–∞–Ω–æ–≤ –ø–æ –Ω–∞–±–æ—Ä–∞–º —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª (pushdown, simplification, join reorder –∏ –¥—Ä.).

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–µ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—é –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –¥–∞–Ω–Ω—ã—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | -------------------------------------------------------------- | ---------------------------------------------- | ---------- |
| `optimizer_generate_plan` | `sql_plan_t *optimizer_generate_plan(sql_ast_t *ast);`         | –°—Ç—Ä–æ–∏—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. | –ü–ª–∞–Ω       |
| `optimizer_estimate_cost` | `double optimizer_estimate_cost(sql_plan_t *plan);`            | –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–ª–∞–Ω–∞.                     | –°—Ç–æ–∏–º–æ—Å—Ç—å  |
| `optimizer_apply_rules`   | `bool optimizer_apply_rules(sql_ast_t *ast);`                  | –ü—Ä–∏–º–µ–Ω—è–µ—Ç rule-based —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.            | `true`     |
| `optimizer_register_rule` | `void optimizer_register_rule(rule_t *rule);`                  | –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ —Ä–µ–µ—Å—Ç—Ä.              | `void`     |
| `optimizer_reoptimize`    | `bool optimizer_reoptimize(sql_plan_t *plan, feedback_t *fb);` | –ü–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω –ø–æ runtime feedback.     | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  bool (*apply)(sql_ast_t *ast);
  uint32_t priority;
} rule_t;

typedef struct {
  double estimated_cost;
  double actual_cost;
  uint64_t cardinality;
  uint64_t rows_scanned;
} feedback_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `optimizer_plan_cost_total` ‚Äî —Å—É–º–º–∞—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—Å–µ—Ö –ø–ª–∞–Ω–æ–≤
* `optimizer_rule_applied_total{name}` ‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –∫–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ
* `optimizer_reoptimize_triggered` ‚Äî —á–∏—Å–ª–æ –≤—ã–∑–æ–≤–æ–≤ reoptimize
* `optimizer_estimation_error_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ –æ—Ü–µ–Ω–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ AST
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.2 ‚Äî AST`
* `3.6 ‚Äî Rule Rewriter`
* `3.12 ‚Äî SQL Executor`
* `8.14 ‚Äî Plan Caching`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_optimizer_cost_vs_rule_consistency`
* `test_optimizer_join_reorder_ndv`
* `test_optimizer_pushdown_rules`
* `test_optimizer_feedback_adaptation`
* `test_optimizer_infinite_recursion_protection`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.6 ‚Äî Rule Rewriter / Pushdown Engine** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.6 ‚Äî Rule Rewriter / Pushdown Engine

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_rule_rewriter`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Rule Rewriter)** –∏ **Pushdown Engine** ‚Äî –º–æ–¥—É–ª—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∞–≤–∏–ª –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤: —É–ø—Ä–æ—â–µ–Ω–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –ø—Ä–µ–¥–∏–∫–∞—Ç–Ω—ã–π pushdown, —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–π, —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–µ–π, –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ —Ç.–¥.

–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –¥–æ –∏ –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–ª–∞–Ω–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ AST –∏ IR —É—Ä–æ–≤–Ω—è—Ö, —Å–æ–≤–º–µ—Å—Ç–∏–º —Å rule-based –∏ cost-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------- | ----------------------------------------------------- | ----------------------------------------------- | ---------- |
| `rewriter_apply_all`            | `bool rewriter_apply_all(sql_ast_t *ast);`            | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è.  | `true`     |
| `rewriter_pushdown_predicates`  | `bool rewriter_pushdown_predicates(sql_ast_t *ast);`  | –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç —Ñ–∏–ª—å—Ç—Ä—ã –±–ª–∏–∂–µ –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö.    | `true`     |
| `rewriter_eliminate_projection` | `bool rewriter_eliminate_projection(sql_ast_t *ast);` | –£–¥–∞–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç–æ–ª–±—Ü—ã –∏–∑ SELECT.       | `true`     |
| `rewriter_register_rule`        | `void rewriter_register_rule(rule_t *rule);`          | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ.          | `void`     |
| `rewriter_simplify_expressions` | `bool rewriter_simplify_expressions(sql_ast_t *ast);` | –£–ø—Ä–æ—â–∞–µ—Ç –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –∏ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  bool (*apply)(sql_ast_t *ast);
  uint32_t priority;
} rule_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `rewrite_rules_applied_total{name}` ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞
* `rewrite_pushdown_success_rate` ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö pushdown‚Äô–æ–≤
* `rewrite_projection_eliminated_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ü–∏–π
* `rewrite_expr_simplified_total` ‚Äî —á–∏—Å–ª–æ —É–ø—Ä–æ—â—ë–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–æ/–ø–æ—Å–ª–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è)
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (RLS/CLS)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.2 ‚Äî AST`
* `3.5 ‚Äî SQL Optimizer`
* `3.1 ‚Äî SQL Parser`
* `6.5 ‚Äî –ü—Ä–∞–≤–∞ –Ω–∞ –∫–æ–ª–æ–Ω–∫–∏`
* `19.1 ‚Äî SQL Normalizer`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rewriter_pushdown_where_and_join`
* `test_rewriter_projection_pruning`
* `test_rewriter_expression_simplification`
* `test_rewriter_rule_registration`
* `test_rewriter_invalid_transformation_protection`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.7 ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ SQL-–ø–ª–∞–Ω–∞ (Planner)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.7 ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ SQL-–ø–ª–∞–Ω–∞ (Planner)

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_planner`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Planner)**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ (AST) –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π **–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∑–∞–ø—Ä–æ—Å–∞ (IR)**. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–≤—è–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã, –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –∞–≥—Ä–µ–≥–∞—Ç–æ–≤, —Å–∫–∞–Ω–æ–≤ –∏ –≥–æ—Ç–æ–≤–∏—Ç –¥–µ—Ä–µ–≤–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç      |
| ------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------- | --------------- |
| `planner_generate_logical_plan` | `sql_plan_t *planner_generate_logical_plan(sql_ast_t *ast);` | –°—Ç—Ä–æ–∏—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –∏–∑ AST.                       | –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω |
| `planner_bind_tables`           | `bool planner_bind_tables(sql_plan_t *plan);`                | –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—Ö–µ–º—ã –∫ –ø–ª–∞–Ω—É.                 | `true`          |
| `planner_optimize_joins`        | `bool planner_optimize_joins(sql_plan_t *plan);`             | –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. | `true`          |
| `planner_resolve_indexes`       | `bool planner_resolve_indexes(sql_plan_t *plan);`            | –ò—â–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è WHERE/ORDER BY.          | `true`          |
| `planner_finalize_plan`         | `sql_plan_t *planner_finalize_plan(sql_plan_t *plan);`       | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π.            | –§–∏–∑–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  sql_ast_t *ast;
  sql_plan_node_t *root;
  uint64_t estimated_rows;
  double estimated_cost;
  bool is_finalized;
} sql_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `planner_plan_nodes_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –ø–ª–∞–Ω–∞
* `planner_index_usage_rate` ‚Äî –¥–æ–ª—è –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
* `planner_join_reorder_events` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö join-–ø–æ—Ä—è–¥–∫–æ–≤
* `planner_physical_plan_latency_ns` ‚Äî –≤—Ä–µ–º—è —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—É—Ç–µ–π –ø–ª–∞–Ω–æ–≤ (fail-safe fallback)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multi-tenant –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –≤ –ø–ª–∞–Ω–∞—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.2 ‚Äî AST`
* `3.5 ‚Äî Optimizer`
* `3.6 ‚Äî Rule Rewriter`
* `3.12 ‚Äî SQL Executor`
* `1.8 ‚Äî –ò–Ω–¥–µ–∫—Å—ã`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_planner_logical_plan_generation`
* `test_planner_join_ordering_heuristics`
* `test_planner_index_resolution`
* `test_planner_plan_validation_failures`
* `test_planner_finalize_physical_correctness`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.8 ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è IR –∏ –¥–µ—Ä–µ–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ SQL** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.8 ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è IR –∏ –¥–µ—Ä–µ–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ SQL

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_ir_generator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (IR)** –∏ –¥–µ—Ä–µ–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ SQL (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `sql_op_t`, `sql_op_node_t`, `sql_ir_t`) –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞. –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –≤–∫–ª—é—á–∞—è `scan`, `join`, `filter`, `aggregate`, `sort`, `project`, `limit`, `sink`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç pipeline execution, –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –ø–æ—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------------------- | ------------------------------------ | ---------- |
| `ir_generate_from_plan` | `sql_ir_t *ir_generate_from_plan(const sql_plan_t *plan);`        | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–µ—Ä–µ–≤–æ IR –∏–∑ SQL-–ø–ª–∞–Ω–∞.   | IR         |
| `ir_node_create`        | `sql_op_node_t *ir_node_create(sql_op_t op);`                     | –°–æ–∑–¥–∞—ë—Ç —É–∑–µ–ª –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ IR.           | –£–∑–µ–ª       |
| `ir_add_child`          | `void ir_add_child(sql_op_node_t *parent, sql_op_node_t *child);` | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–æ–ø–µ—Ä–∞—Ç–æ—Ä –≤ –¥–µ—Ä–µ–≤–æ IR.   | `void`     |
| `ir_set_attributes`     | `void ir_set_attributes(sql_op_node_t *node, attr_map_t *attrs);` | –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.     | `void`     |
| `ir_validate`           | `bool ir_validate(const sql_ir_t *ir);`                           | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã IR. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  OP_SCAN,
  OP_FILTER,
  OP_PROJECT,
  OP_AGGREGATE,
  OP_SORT,
  OP_JOIN,
  OP_LIMIT,
  OP_SINK
} sql_op_t;

typedef struct sql_op_node_t {
  sql_op_t op;
  attr_map_t *attributes;
  struct sql_op_node_t **children;
  size_t child_count;
} sql_op_node_t;

typedef struct {
  sql_op_node_t *root;
  size_t total_ops;
} sql_ir_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_ir_op_count_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ IR
* `sql_ir_validation_failures` ‚Äî –æ—à–∏–±–∫–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ IR
* `sql_ir_node_depth_max` ‚Äî –≥–ª—É–±–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
* `sql_ir_pipeline_ready_total` ‚Äî —á–∏—Å–ª–æ IR, –ø—Ä–∏–≥–æ–¥–Ω—ã—Ö –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ DAG –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ü–∏–∫–ª–æ–≤
* –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å IR –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DoS

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.7 ‚Äî SQL Planner`
* `3.5 ‚Äî Optimizer`
* `3.12 ‚Äî SQL Executor`
* `8.13 ‚Äî Streaming Execution Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_ir_generation_from_logical_plan`
* `test_ir_node_hierarchy_and_attributes`
* `test_ir_operator_dag_validation`
* `test_ir_pipeline_flag_detection`
* `test_ir_illegal_operator_error_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.9 ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ UPDATE, DELETE, INSERT** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.9 ‚Äî –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ UPDATE, DELETE, INSERT

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_dml_plan_generator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **–≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**: `INSERT`, `UPDATE`, `DELETE`, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É `INSERT ... SELECT`, UPSERT (—Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏), —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤. –§–æ—Ä–º–∏—Ä—É–µ—Ç IR-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è DML-–¥–µ–π—Å—Ç–≤–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å MVCC.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------------- | ------------------------------------------------------- | ----------------------------------- | ---------- |
| `dml_plan_generate_insert` | `sql_ir_t *dml_plan_generate_insert(sql_stmt_t *stmt);` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IR-–ø–ª–∞–Ω –¥–ª—è INSERT.      | IR         |
| `dml_plan_generate_update` | `sql_ir_t *dml_plan_generate_update(sql_stmt_t *stmt);` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IR-–ø–ª–∞–Ω –¥–ª—è UPDATE.      | IR         |
| `dml_plan_generate_delete` | `sql_ir_t *dml_plan_generate_delete(sql_stmt_t *stmt);` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IR-–ø–ª–∞–Ω –¥–ª—è DELETE.      | IR         |
| `dml_plan_bind_targets`    | `bool dml_plan_bind_targets(sql_ir_t *ir);`             | –°–≤—è–∑—ã–≤–∞–µ—Ç —Ü–µ–ª–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–∫–æ–ª–æ–Ω–∫–∏.  | `true`     |
| `dml_plan_attach_triggers` | `bool dml_plan_attach_triggers(sql_ir_t *ir);`          | –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç BEFORE/AFTER —Ç—Ä–∏–≥–≥–µ—Ä—ã. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  table_t *target;
  column_t **columns;
  size_t column_count;
  bool use_upsert;
  bool skip_conflicts;
} dml_plan_metadata_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `dml_plan_ops_generated_total{type}` ‚Äî —á–∏—Å–ª–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–æ —Ç–∏–ø—É (insert/update/delete)
* `dml_plan_trigger_attach_time_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
* `dml_plan_target_resolution_failures` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü
* `dml_upsert_conflict_skips` ‚Äî —á–∏—Å–ª–æ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã –∏ –ø–æ–ª—è (RLS/CLS)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (require TX)
* –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏ —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.7 ‚Äî SQL Planner`
* `3.8 ‚Äî IR Generator`
* `3.14 ‚Äî SQL Triggers`
* `2.1 ‚Äî MVCC`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_dml_insert_values_and_select`
* `test_dml_update_partial_columns`
* `test_dml_delete_with_predicates`
* `test_dml_plan_trigger_integration`
* `test_dml_upsert_conflict_resolution`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.10 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (DSL)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.10 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (DSL)

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_procedure_dsl`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (DSL)**, —Å—Ö–æ–∂–µ–≥–æ —Å PL/SQL/ABAP. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –≤–∫–ª—é—á–∞—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ü–∏–∫–ª—ã, —É—Å–ª–æ–≤–∏—è, –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –∏ –¥–æ—Å—Ç—É–ø –∫ SQL. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, –ø–∞–∫–µ—Ç–æ–≤ –∏ –∑–∞–¥–∞—á ETL.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ---------------------------------------------------------------------- | ------------------------------------------------ | ---------- |
| `dsl_parse_procedure`   | `dsl_proc_t *dsl_parse_procedure(const char *code);`                   | –†–∞–∑–±–∏—Ä–∞–µ—Ç —Ç–µ–∫—Å—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤ AST DSL.             | –ü—Ä–æ—Ü–µ–¥—É—Ä–∞  |
| `dsl_execute_procedure` | `bool dsl_execute_procedure(dsl_proc_t *proc, tx_ctx_t *tx);`          | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–µ–ª–æ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. | `true`     |
| `dsl_register_function` | `bool dsl_register_function(const char *name, dsl_func_t *func);`      | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤–Ω–µ—à–Ω—é—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—ã–∑–æ–≤–∞ –∏–∑ DSL.  | `true`     |
| `dsl_eval_expression`   | `value_t dsl_eval_expression(const dsl_expr_t *expr, dsl_ctx_t *ctx);` | –í—ã—á–∏—Å–ª—è–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ DSL.                       | –ó–Ω–∞—á–µ–Ω–∏–µ   |
| `dsl_emit_error`        | `void dsl_emit_error(const char *msg, int line);`                      | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º.       | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  dsl_stmt_t *statements;
  size_t stmt_count;
} dsl_proc_t;

typedef struct {
  const char *name;
  value_t (*fn)(const value_t *args, size_t count);
} dsl_func_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `dsl_procedure_executions_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–æ—Ü–µ–¥—É—Ä
* `dsl_error_raised_total{proc}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* `dsl_tx_commands_executed` ‚Äî —á–∏—Å–ª–æ SQL-–∫–æ–º–∞–Ω–¥ –≤–Ω—É—Ç—Ä–∏ DSL
* `dsl_external_function_calls` ‚Äî –≤—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (sandbox) –¥–ª—è —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö DSL-—Ñ—É–Ω–∫—Ü–∏–π
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç–∞–º —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç (ACL/Scope)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤, —Å—Ç–µ–∫–∞ –∏ —Ä–µ–∫—É—Ä—Å–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.12 ‚Äî SQL Executor`
* `4.9 ‚Äî UDF/UDAF engine`
* `2.2 ‚Äî Transaction Manager`
* `6.7 ‚Äî Access Policy Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_dsl_parse_and_execute_basic`
* `test_dsl_variables_and_conditions`
* `test_dsl_transactional_control_flow`
* `test_dsl_function_integration`
* `test_dsl_error_handling_and_trace`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.11 ‚Äî –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ CTE** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.11 ‚Äî –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ CTE

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_cte_subqueries`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤**, **–∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**, –∞ —Ç–∞–∫–∂–µ **Common Table Expressions (CTE)**, –≤–∫–ª—é—á–∞—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ CTE. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã—Ä–∞–∂–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∫–∏, –∏–µ—Ä–∞—Ä—Ö–∏–∏, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ view-like –±–ª–æ–∫–∏ –≤ —Å–æ—Å—Ç–∞–≤–µ –æ–¥–Ω–æ–≥–æ SQL-–∑–∞–ø—Ä–æ—Å–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| ----------------------- | --------------------------------------------------------------------------------- | --------------------------------- | ----------- |
| `cte_register`          | `bool cte_register(sql_ctx_t *ctx, const char *name, sql_ast_t *expr);`           | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç CTE –ø–æ –∏–º–µ–Ω–∏.        | `true`      |
| `cte_resolve_reference` | `sql_ast_t *cte_resolve_reference(sql_ctx_t *ctx, const char *name);`             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç AST –¥–ª—è CTE –ø–æ —Å—Å—ã–ª–∫–µ. | AST         |
| `cte_execute_recursive` | `bool cte_execute_recursive(sql_ast_t *seed, sql_ast_t *step, rowset_t *result);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE.        | `true`      |
| `subquery_execute`      | `rowset_t *subquery_execute(sql_ast_t *expr, const row_t *outer);`                | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π –ø–æ–¥–∑–∞–ø—Ä–æ—Å.    | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |
| `subquery_bind_context` | `bool subquery_bind_context(sql_ast_t *subq, const row_t *outer);`                | –°–≤—è–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.     | `true`      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  sql_ast_t *expression;
  bool recursive;
} cte_entry_t;

typedef struct {
  cte_entry_t *entries;
  size_t count;
} cte_registry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `cte_registered_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CTE –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
* `cte_recursive_iterations_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
* `subquery_executions_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤
* `subquery_correlated_depth_max` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö CTE
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏–º—ë–Ω/—Å–∫–æ—É–ø–∞ –ø—Ä–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ CTE
* –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ –≤ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.2 ‚Äî AST`
* `3.7 ‚Äî Planner`
* `3.12 ‚Äî SQL Executor`
* `6.5 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞–º`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_cte_basic_non_recursive`
* `test_cte_recursive_hierarchy`
* `test_cte_shadowing_and_naming`
* `test_subquery_scalar_and_table`
* `test_subquery_correlation_and_bind`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.12 ‚Äî SQL Executor: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.12 ‚Äî SQL Executor: –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_executor`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**, –æ—Ç–≤–µ—á–∞—é—â–∏–π –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —Å—Ç—Ä–∏–º–∏–Ω–≥, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã, DML-–æ–ø–µ—Ä–∞—Ü–∏–∏, –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –∞–≥—Ä–µ–≥–∞—Ç—ã, LIMIT/OFFSET, JOIN, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ç.–¥.

–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ IR –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | --------------------------------------------------------------- | ------------------------------------------------------- | ---------- |
| `executor_run_plan` | `result_iter_t *executor_run_plan(sql_ir_t *ir, tx_ctx_t *tx);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–ø–ª–∞–Ω –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É. | –ò—Ç–µ—Ä–∞—Ç–æ—Ä   |
| `executor_step`     | `bool executor_step(result_iter_t *iter, row_t *out);`          | –ü–æ–ª—É—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.                   | `true`     |
| `executor_reset`    | `void executor_reset(result_iter_t *iter);`                     | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.                     | `void`     |
| `executor_finalize` | `void executor_finalize(result_iter_t *iter);`                  | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.                         | `void`     |
| `executor_run_dml`  | `bool executor_run_dml(sql_ir_t *ir, tx_ctx_t *tx);`            | –í—ã–ø–æ–ª–Ω—è–µ—Ç DML-–ø–ª–∞–Ω (INSERT/UPDATE/DELETE).              | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  sql_ir_t *plan;
  operator_state_t *ops;
  tx_ctx_t *tx;
  size_t position;
} result_iter_t;

typedef struct {
  void *op_state;
  bool (*next)(void *op_state, row_t *out);
  void (*destroy)(void *op_state);
} operator_state_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `executor_rows_returned_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
* `executor_operator_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ IR
* `executor_memory_usage_bytes` ‚Äî –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
* `executor_parallel_pipelines_total` ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –æ–±—ä—ë–º –≤—ã–¥–µ–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (RLS/CLS)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è LIMIT/OFFSET

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.8 ‚Äî IR Generator`
* `3.9 ‚Äî DML Planner`
* `3.11 ‚Äî –ü–æ–¥–∑–∞–ø—Ä–æ—Å—ã –∏ CTE`
* `2.2 ‚Äî –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏`
* `5.2 ‚Äî –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã –∏ –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_executor_run_select`
* `test_executor_dml_insert_update_delete`
* `test_executor_iterator_reset_finalize`
* `test_executor_streaming_pipeline`
* `test_executor_rls_filtering`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.13 ‚Äî –°–∫–∞–ª—è—Ä–Ω—ã–µ –∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SQL** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.13 ‚Äî –°–∫–∞–ª—è—Ä–Ω—ã–µ –∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ SQL

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_builtin_functions`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Å–∫–∞–ª—è—Ä–Ω—ã—Ö –∏ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π SQL**, –≤–∫–ª—é—á–∞—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ, —Å—Ç—Ä–æ–∫–æ–≤—ã–µ, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ, –±—É–ª–µ–≤—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (`SUM`, `AVG`, `MIN`, `MAX`, `COUNT`, `GROUPING`, `STDDEV`, `MEDIAN`, `MODE`, –∏ –¥—Ä). –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä—è—Ç—å –Ω–∞–±–æ—Ä —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö UDF/UDAF.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | -------------------------------------------------------------------------------------------- | ------------------------------------------- | ---------- |
| `sql_fn_register_scalar` | `bool sql_fn_register_scalar(const char *name, sql_scalar_fn_t *fn);`                        | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é —Å–∫–∞–ª—è—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.       | `true`     |
| `sql_fn_register_agg`    | `bool sql_fn_register_agg(const char *name, sql_agg_fn_t *fn);`                              | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.      | `true`     |
| `sql_fn_eval_scalar`     | `bool sql_fn_eval_scalar(const char *name, const value_t *args, size_t argc, value_t *out);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–ª—è—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.                | `true`     |
| `sql_fn_eval_agg_step`   | `bool sql_fn_eval_agg_step(const char *name, void *state, const value_t *args);`             | –í—ã–ø–æ–ª–Ω—è–µ—Ç —à–∞–≥ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.                    | `true`     |
| `sql_fn_eval_agg_final`  | `bool sql_fn_eval_agg_final(const char *name, void *state, value_t *out);`                   | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  bool (*fn)(const value_t *args, size_t argc, value_t *out);
} sql_scalar_fn_t;

typedef struct {
  bool (*step)(void *state, const value_t *args);
  bool (*final)(void *state, value_t *out);
  size_t state_size;
} sql_agg_fn_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_function_calls_total{name}` ‚Äî –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π
* `sql_aggregate_rows_processed{name}` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–æ–∫ –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç
* `sql_fn_eval_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞
* `sql_fn_errors_total{name}` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –¥–æ –≤—ã–∑–æ–≤–∞
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ UDF –ø–æ —Å–∫–æ—É–ø—É

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `4.9 ‚Äî UDF / Sandbox`
* `5.2 ‚Äî Aggregation Engine`
* `6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞`
* `19.4 ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_sql_builtin_scalar_math`
* `test_sql_builtin_aggregates_group_by`
* `test_sql_agg_state_finalization`
* `test_sql_fn_eval_argument_validation`
* `test_sql_fn_register_and_invoke_custom`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.14 ‚Äî SQL —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ exec hooks** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.14 ‚Äî SQL —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ exec hooks

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_triggers_hooks`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **SQL-—Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ exec hooks**, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (`BEFORE`, `AFTER`, `INSTEAD OF`) –Ω–∞ `INSERT`, `UPDATE`, `DELETE`. –¢–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è **–≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ —Ö—É–∫–∏** –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª, –∞—É–¥–∏—Ç-–ª–æ–≥–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ------------------------------------------------------------------------------------------ | ----------------------------------- | ---------- |
| `trigger_register`       | `bool trigger_register(trigger_def_t *def);`                                               | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –≤ —Å—Ö–µ–º–µ. | `true`     |
| `trigger_execute`        | `bool trigger_execute(trigger_event_t event, const row_t *old_row, const row_t *new_row);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –ø–æ —Å–æ–±—ã—Ç–∏—é.       | `true`     |
| `trigger_invoke_hooks`   | `bool trigger_invoke_hooks(exec_phase_t phase, tx_ctx_t *tx);`                             | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ö—É–∫–∏ –¥–æ/–ø–æ—Å–ª–µ DML.        | `true`     |
| `trigger_list_for_table` | `trigger_def_t **trigger_list_for_table(const char *table, size_t *count);`                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤.        | –ú–∞—Å—Å–∏–≤     |
| `trigger_unregister`     | `bool trigger_unregister(const char *name);`                                               | –£–¥–∞–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –∏–∑ —Å–∏—Å—Ç–µ–º—ã.         | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  TRIG_BEFORE_INSERT,
  TRIG_AFTER_INSERT,
  TRIG_BEFORE_UPDATE,
  TRIG_AFTER_UPDATE,
  TRIG_BEFORE_DELETE,
  TRIG_AFTER_DELETE,
  TRIG_INSTEAD_OF
} trigger_event_t;

typedef struct {
  char name[64];
  char table[64];
  trigger_event_t event;
  char *dsl_code;
} trigger_def_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `trigger_invocations_total{event}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
* `trigger_execution_failures` ‚Äî —á–∏—Å–ª–æ –æ—à–∏–±–æ–∫ –≤ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö
* `hook_latency_ns{phase}` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ —Ö—É–∫–æ–≤ –ø–æ —Ñ–∞–∑–µ
* `trigger_registered_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ DSL –≤ sandbox-–º–æ–¥–µ
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–∞–º—è—Ç–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.10 ‚Äî DSL –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫`
* `3.9 ‚Äî DML –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫`
* `6.7 ‚Äî Access Policy Engine`
* `5.4 ‚Äî –ê—É–¥–∏—Ç / –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π`
* `2.2 ‚Äî Transaction Manager`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_trigger_before_insert_prevent`
* `test_trigger_after_update_logging`
* `test_trigger_instead_of_on_view`
* `test_trigger_hook_phase_sequence`
* `test_trigger_sandbox_error_propagation`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **3.15 ‚Äî –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ, percentiles** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 3.15 ‚Äî –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ, percentiles

**–ü–∞–∫–µ—Ç:** `3. SQL –∏ –Ø–∑—ã–∫–∏`
**Block ID:** `sql_analytics_functions`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ SQL**, –≤–∫–ª—é—á–∞—è —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∫–≤–∞–Ω—Ç–∏–ª–∏, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `PERCENT_RANK`, `CUME_DIST`, `NTILE`, `MEDIAN`, `PERCENTILE_CONT`, `PERCENTILE_DISC`, `CORR`, `COVAR_POP`, `COVAR_SAMP`, `REGR_SLOPE`, `REGR_INTERCEPT` –∏ –¥—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ BI/OLAP –∑–∞–¥–∞—á–∞—Ö, –æ–∫–æ–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏—è—Ö –∏ time-series –∞–Ω–∞–ª–∏–∑–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ------------------------------------------------------------------------------- | ------------------------------------ | ---------- |
| `analytics_fn_register` | `bool analytics_fn_register(const char *name, analytics_fn_t *fn);`             | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é.  | `true`     |
| `analytics_fn_eval`     | `bool analytics_fn_eval(const char *name, analytics_ctx_t *ctx, value_t *out);` | –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ñ—É–Ω–∫—Ü–∏–∏.         | `true`     |
| `analytics_ctx_create`  | `analytics_ctx_t *analytics_ctx_create(void);`                                  | –°–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.          | –ö–æ–Ω—Ç–µ–∫—Å—Ç   |
| `analytics_ctx_add_row` | `bool analytics_ctx_add_row(analytics_ctx_t *ctx, const row_t *row);`           | –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞. | `true`     |
| `analytics_ctx_reset`   | `void analytics_ctx_reset(analytics_ctx_t *ctx);`                               | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.                | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  bool (*compute)(analytics_ctx_t *ctx, value_t *out);
} analytics_fn_t;

typedef struct {
  vector_t *rows;
  double *intermediate;
  size_t count;
} analytics_ctx_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `analytics_function_calls_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –ø–æ —Ç–∏–ø—É
* `analytics_memory_usage_bytes` ‚Äî –æ–±—ä—ë–º –ø–æ—Ç—Ä–µ–±–ª—è–µ–º–æ–π –ø–∞–º—è—Ç–∏
* `analytics_percentile_distribution{level}` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–∞–Ω—Ç–∏–ª–∏
* `analytics_execution_time_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —á–∏—Å–ª–∞ —Å—Ç—Ä–æ–∫ –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–º –æ–∫–Ω–µ
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã –ø—Ä–∏ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–∏
* –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.3 ‚Äî –û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏`
* `3.13 ‚Äî SQL —Ñ—É–Ω–∫—Ü–∏–∏`
* `5.2 ‚Äî Aggregation Engine`
* `19.3 ‚Äî BI/OLAP runtime`
* `6.6 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_analytics_percent_rank_and_ntile`
* `test_analytics_percentile_cont_disc`
* `test_analytics_corr_and_regression`
* `test_analytics_ctx_memory_bounds`
* `test_analytics_invalid_type_handling`

---

‚úÖ –ü–∞–∫–µ—Ç **3. SQL –∏ –Ø–∑—ã–∫–∏** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **4.1 ‚Äî JDBC, ODBC –∏ CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.1 ‚Äî JDBC, ODBC –∏ CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `jdbc_odbc_cli_interface`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –°–£–ë–î —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã JDBC, ODBC –∏ CLI**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ BI –∏ middleware. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥—Ä–∞–π–≤–µ—Ä—ã, –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –∏ API –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL, –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —á—Ç–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –æ—à–∏–±–æ–∫.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç              |
| --------------------- | ------------------------------------------------------------------------------------- | ---------------------------------- | ----------------------- |
| `jdbc_connect`        | `db_connection_t *jdbc_connect(const char *url, const char *user, const char *pass);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç JDBC-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.     | –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ |
| `odbc_execute_query`  | `bool odbc_execute_query(db_connection_t *conn, const char *sql);`                    | –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ ODBC.   | `true`                  |
| `cli_open_session`    | `cli_session_t *cli_open_session(void);`                                              | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç CLI-—Å–µ—Å—Å–∏—é.         | CLI-—Å–µ—Å—Å–∏—è              |
| `cli_run_interactive` | `void cli_run_interactive(cli_session_t *session);`                                   | –ó–∞–ø—É—Å–∫–∞–µ—Ç REPL-—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å CLI. | `void`                  |
| `jdbc_close`          | `void jdbc_close(db_connection_t *conn);`                                             | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç JDBC-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.         | `void`                  |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char hostname[128];
  int port;
  char user[64];
  char database[64];
  bool ssl;
} db_connection_t;

typedef struct {
  db_connection_t *conn;
  char last_command[1024];
} cli_session_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `jdbc_connection_count` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ JDBC-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
* `odbc_query_latency_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
* `cli_session_count` ‚Äî —á–∏—Å–ª–æ CLI-—Å–µ—Å—Å–∏–π
* `interface_errors_total{type}` ‚Äî –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS/mTLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å, JWT, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
* –ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Å—Å–∏–π, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ä–æ–ª—è–º –∏ –ø—Ä–∞–≤–∞–º –¥–æ—Å—Ç—É–ø–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `6.1 ‚Äî RBAC/ABAC`
* `4.7 ‚Äî Network Protocol Layer`
* `7.3 ‚Äî Structured Logging`
* `4.5 ‚Äî Error Translator`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_jdbc_connection_and_query`
* `test_odbc_query_execution`
* `test_cli_interactive_sql_session`
* `test_interface_authentication_failures`
* `test_error_propagation_to_client`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.2 ‚Äî REST –∏ GraphQL API** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.2 ‚Äî REST –∏ GraphQL API

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `rest_graphql_api`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –¥–æ—Å—Ç—É–ø –∫ –°–£–ë–î —á–µ—Ä–µ–∑ **REST API –∏ GraphQL**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏, —Å—Ö–µ–º–∞–º–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —á–µ—Ä–µ–∑ HTTP/HTTPS. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç OpenAPI, introspection, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –ø–∞–≥–∏–Ω–∞—Ü–∏—é, –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –º—É—Ç–∞—Ü–∏–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, BI-—Å–∏—Å—Ç–µ–º–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ----------------------------------------------------------------------------------------- | --------------------------------------- | ---------- |
| `rest_handle_request`       | `http_response_t *rest_handle_request(http_request_t *req);`                              | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç REST-–∑–∞–ø—Ä–æ—Å.               | HTTP-–æ—Ç–≤–µ—Ç |
| `graphql_execute`           | `graphql_response_t *graphql_execute(const char *query, const json_t *variables);`        | –í—ã–ø–æ–ª–Ω—è–µ—Ç GraphQL-–∑–∞–ø—Ä–æ—Å.               | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `graphql_introspect_schema` | `json_t *graphql_introspect_schema(void);`                                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ö–µ–º—É GraphQL –≤ –≤–∏–¥–µ JSON.   | JSON-—Å—Ö–µ–º–∞ |
| `rest_register_route`       | `bool rest_register_route(const char *method, const char *path, rest_handler_t handler);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π REST endpoint.       | `true`     |
| `graphql_register_type`     | `bool graphql_register_type(const graphql_type_t *type);`                                 | –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–∏–ø GraphQL. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[8];
  char path[256];
  http_headers_t headers;
  json_t *body;
} http_request_t;

typedef struct {
  int status;
  http_headers_t headers;
  json_t *body;
} http_response_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `rest_requests_total{method}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ REST-–∑–∞–ø—Ä–æ—Å–æ–≤
* `graphql_query_duration_ns` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
* `graphql_field_resolution_failures` ‚Äî –æ—à–∏–±–∫–∏ –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –ø–æ–ª–µ–π
* `rest_status_codes_total{code}` ‚Äî –æ—Ç–≤–µ—Ç—ã –ø–æ HTTP-–∫–æ–¥–∞–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth2, JWT, API Token
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CORS, CSRF, HTTPS-only —Ä–µ–∂–∏–º
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ GraphQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≥–ª—É–±–∏–Ω–µ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (introspection-safe)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.1 ‚Äî RBAC / ABAC`
* `4.7 ‚Äî HTTP Router`
* `3.12 ‚Äî SQL Executor`
* `7.4 ‚Äî JSON Structured Logging`
* `4.6 ‚Äî Schema Registry API`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rest_get_and_post_queries`
* `test_graphql_query_with_variables`
* `test_graphql_introspection_protection`
* `test_rest_authentication_jwt`
* `test_graphql_mutation_and_subscriptions`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.3 ‚Äî gRPC / Streaming Replication Protocol** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.3 ‚Äî gRPC / Streaming Replication Protocol

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `grpc_streaming_replication`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π **gRPC-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ –ø–æ—Ç–æ–∫–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ WAL-–∑–∞–ø–∏—Å–µ–π, –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö, —Å–æ–±—ã—Ç–∏–π –∏ –∫–æ–º–∞–Ω–¥ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –°–£–ë–î –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç bidirectional streaming, TLS, compression, –æ–±—Ä–∞—Ç–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------- | ------------------------------------------------------------------------- | ------------------------------------------- | ---------- |
| `grpc_start_replication_server` | `bool grpc_start_replication_server(uint16_t port);`                      | –ó–∞–ø—É—Å–∫–∞–µ—Ç gRPC-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Ä–µ–ø–ª–∏–∫.  | `true`     |
| `grpc_connect_replica`          | `grpc_channel_t *grpc_connect_replica(const char *host, uint16_t port);`  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Ä–µ–ø–ª–∏–∫–æ–π.        | –ö–∞–Ω–∞–ª      |
| `grpc_stream_send_wal`          | `bool grpc_stream_send_wal(grpc_channel_t *ch, const wal_record_t *rec);` | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WAL-–∑–∞–ø–∏—Å—å –≤ –ø–æ—Ç–æ–∫.              | `true`     |
| `grpc_stream_recv_loop`         | `void grpc_stream_recv_loop(grpc_channel_t *ch);`                         | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏—ë–º –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π. | `void`     |
| `grpc_send_ack`                 | `bool grpc_send_ack(grpc_channel_t *ch, uint64_t lsn);`                   | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–∏—ë–º WAL.                     | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  grpc_channel_t *channel;
  bool connected;
  uint64_t last_ack_lsn;
} grpc_replica_t;

typedef struct {
  uint64_t lsn;
  uint64_t timestamp;
  uint8_t *payload;
  size_t size;
} wal_record_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `grpc_replication_lag_bytes` ‚Äî –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –ø–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
* `grpc_wal_records_sent_total` ‚Äî —á–∏—Å–ª–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
* `grpc_stream_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –ø–æ—Ç–æ–∫–∞
* `grpc_reconnect_attempts_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TLS/mTLS –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ä–µ–ø–ª–∏–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ firewall-friendly —Ä–µ–∂–∏–º–æ–≤ (–ø–æ—Ä—Ç/—Ç–æ–∫–µ–Ω)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.15 ‚Äî WAL-based replication`
* `7.2 ‚Äî TLS Security Layer`
* `4.7 ‚Äî Network Layer`
* `6.1 ‚Äî RBAC/ACL`
* `7.5 ‚Äî Alerting: replication failures`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_grpc_replication_server_startup`
* `test_grpc_stream_send_receive`
* `test_grpc_ack_and_lag_tracking`
* `test_grpc_tls_and_authentication`
* `test_grpc_network_reconnect_and_resume`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.4 ‚Äî OpenAPI –∏ —Å—Ö–µ–º–∞ introspection** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.4 ‚Äî OpenAPI –∏ —Å—Ö–µ–º–∞ introspection

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `openapi_schema_introspection`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é **OpenAPI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π**, –∞ —Ç–∞–∫–∂–µ introspection-–¥–≤–∏–∂–æ–∫, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –≤–Ω–µ—à–Ω–∏–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º –ø–æ–ª—É—á–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö, —Ç–∏–ø–æ–≤ –∏ –æ—à–∏–±–æ–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–∏ OpenAPI 3.0 –∏ 3.1, —ç–∫—Å–ø–æ—Ä—Ç —Å—Ö–µ–º—ã –≤ JSON/YAML, –æ–ø–∏—Å–∞–Ω–∏–µ REST/GraphQL/CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | --------------------------------------------------------------------- | ----------------------------------------------- | ---------- |
| `openapi_generate_schema`   | `json_t *openapi_generate_schema(void);`                              | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—É—é OpenAPI-—Å—Ö–µ–º—É.                | JSON       |
| `openapi_export_schema`     | `bool openapi_export_schema(const char *path, openapi_format_t fmt);` | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É –≤ —Ñ–∞–π–ª (JSON/YAML).          | `true`     |
| `openapi_register_endpoint` | `bool openapi_register_endpoint(const rest_handler_t *h);`            | –î–æ–±–∞–≤–ª—è–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –≤ —Å—Ö–µ–º—É.    | `true`     |
| `openapi_introspect_table`  | `json_t *openapi_introspect_table(const char *table);`                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∫–∞–∫ OpenAPI schema. | JSON       |
| `openapi_serve_docs`        | `void openapi_serve_docs(void);`                                      | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π UI –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.       | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  OPENAPI_FORMAT_JSON,
  OPENAPI_FORMAT_YAML
} openapi_format_t;

typedef struct {
  char path[256];
  char method[8];
  char summary[256];
  char description[1024];
  json_t *request_schema;
  json_t *response_schema;
} rest_handler_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `openapi_generated_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã
* `openapi_schema_size_bytes` ‚Äî —Ä–∞–∑–º–µ—Ä —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–π —Å—Ö–µ–º—ã
* `openapi_introspection_requests` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ introspection-–∑–∞–ø—Ä–æ—Å–æ–≤
* `openapi_docs_served_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ UI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ introspection –ø–æ —Ä–æ–ª—è–º
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º –ø–æ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π —Å —Ç–æ–∫–µ–Ω–æ–º –¥–æ—Å—Ç—É–ø–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.2 ‚Äî REST –∏ GraphQL API`
* `4.7 ‚Äî HTTP Router`
* `6.1 ‚Äî RBAC`
* `4.6 ‚Äî Schema API`
* `7.4 ‚Äî Structured Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_openapi_schema_generation_json_yaml`
* `test_openapi_introspect_table_columns`
* `test_openapi_export_and_validate_file`
* `test_openapi_docs_ui_endpoint`
* `test_openapi_role_based_visibility`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.5 ‚Äî API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π (Schema Registry)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.5 ‚Äî API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π (Schema Registry)

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `schema_registry_api`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –ë–î**, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫, –∏–Ω–¥–µ–∫—Å–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏ —Ç–∏–ø–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **online schema evolution**, –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –æ–±—Ä–∞—Ç–∏–º—ã–µ ALTER-–æ–ø–µ—Ä–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UI, REST/GraphQL API, –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ DSL.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ------------------------------------------------------ | --------------------------------------------------------------------------- | ---------- |
| `schema_create_table`    | `bool schema_create_table(const table_def_t *def);`    | –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é.                                                | `true`     |
| `schema_alter_table`     | `bool schema_alter_table(const alter_def_t *def);`     | –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã (–¥–æ–±–∞–≤–∏—Ç—å/—É–¥–∞–ª–∏—Ç—å/–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É –∏ —Ç.–ø.). | `true`     |
| `schema_drop_table`      | `bool schema_drop_table(const char *name);`            | –£–¥–∞–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –ø–æ –∏–º–µ–Ω–∏.                                                   | `true`     |
| `schema_list_objects`    | `json_t *schema_list_objects(const char *filter);`     | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Å—Ö–µ–º—ã.                                    | JSON       |
| `schema_validate_change` | `bool schema_validate_change(const alter_def_t *def);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.                                 | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  column_def_t *columns;
  size_t column_count;
  index_def_t *indexes;
  size_t index_count;
} table_def_t;

typedef struct {
  char table_name[64];
  alter_op_t operation;
  column_def_t column;
} alter_def_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `schema_alter_operations_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã
* `schema_object_count{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Ç–∏–ø—É (table, view, index)
* `schema_change_duration_ns` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
* `schema_validation_failures` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ö–µ–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (DDL-level ACL)
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ö–µ–º—ã –∏ –∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π —Å –æ—Ç–∫–∞—Ç–æ–º (reversible schema change)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.4 ‚Äî OpenAPI / Introspection`
* `6.1 ‚Äî RBAC / Access Control`
* `10.7 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –º–∏–≥—Ä–∞—Ü–∏–π`
* `3.2 ‚Äî AST / SQL DDL`
* `5.5 ‚Äî Locking Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_schema_create_and_list_tables`
* `test_schema_alter_add_and_drop_column`
* `test_schema_drop_with_dependencies`
* `test_schema_validate_conflicting_alter`
* `test_schema_reversible_alter_and_rollback`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.6 ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ Webhook-–∏ –∏ —Å–æ–±—ã—Ç–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.6 ‚Äî –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ Webhook-–∏ –∏ —Å–æ–±—ã—Ç–∏—è

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `webhooks_async_events`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö Webhook-–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π–Ω–æ–π –º–æ–¥–µ–ª–∏**, –ø–æ–∑–≤–æ–ª—è—é—â–µ–π –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º, –∞–≤–∞—Ä–∏–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —á–µ—Ä–µ–∑ HTTP POST, JSON payload, retries —Å backoff, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é –∏ –ø–æ–¥–ø–∏—Å–∏ (HMAC, JWT).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | -------------------------------------------------- | ------------------------------------------ | ---------- |
| `webhook_register`      | `bool webhook_register(const webhook_def_t *def);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π webhook.                | `true`     |
| `webhook_emit_event`    | `bool webhook_emit_event(const event_t *evt);`     | –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –ø–æ —Å–æ–±—ã—Ç–∏—é. | `true`     |
| `webhook_dispatch_loop` | `void webhook_dispatch_loop(void);`                | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π.         | `void`     |
| `webhook_retry_failed`  | `void webhook_retry_failed(void);`                 | –ü–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫.           | `void`     |
| `webhook_unregister`    | `bool webhook_unregister(const char *name);`       | –£–¥–∞–ª—è–µ—Ç webhook –∏–∑ —Å–∏—Å—Ç–µ–º—ã.                | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char url[256];
  char event_filter[64];
  bool hmac_enabled;
  char secret_key[128];
} webhook_def_t;

typedef struct {
  char event_type[64];
  char source[64];
  json_t *payload;
  uint64_t timestamp;
} event_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `webhook_events_sent_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø—É
* `webhook_delivery_failures` ‚Äî –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
* `webhook_retry_attempts` ‚Äî —á–∏—Å–ª–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
* `webhook_avg_latency_ms` ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–ø–∏—Å—å –∫–∞–∂–¥–æ–≥–æ webhook HMAC-SHA256 / JWT
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS-only, CORS, origin restrictions
* –ò–∑–æ–ª—è—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ —Å–∫–æ—É–ø–∞–º –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–æ–ª—è–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.2 ‚Äî REST API`
* `3.14 ‚Äî SQL Triggers`
* `7.4 ‚Äî Structured Logging`
* `6.1 ‚Äî RBAC / Access Engine`
* `10.6 ‚Äî Task Scheduler / Event Queue`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_webhook_register_and_dispatch`
* `test_webhook_event_filtering`
* `test_webhook_retry_with_backoff`
* `test_webhook_signature_verification`
* `test_webhook_unregistration_cleanup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.7 ‚Äî HTTP/2 –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∏ —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.7 ‚Äî HTTP/2 –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∏ —Ä–æ—É—Ç–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `http2_router`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π **–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä HTTP/2-–∑–∞–ø—Ä–æ—Å–æ–≤**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —Ä–∞–∑–±–æ—Ä, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ REST/gRPC/WebSocket/GraphQL –≤—ã–∑–æ–≤–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏, —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é, wildcard, middleware-—Ñ–∏–ª—å—Ç—Ä—ã, –∞ —Ç–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –º–µ—Ç–æ–¥–∞–º (GET, POST, PUT –∏ —Ç.–¥.).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | ------------------------------------------------------------------------------------------ | ----------------------------------------- | ---------- |
| `http_router_register`       | `bool http_router_register(const char *method, const char *path, http_handler_t handler);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—É—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫.           | `true`     |
| `http_router_dispatch`       | `http_response_t *http_router_dispatch(http_request_t *req);`                              | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç. | –û—Ç–≤–µ—Ç      |
| `http_router_add_middleware` | `bool http_router_add_middleware(http_middleware_t mw);`                                   | –î–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä.           | `true`     |
| `http_parse_headers`         | `bool http_parse_headers(const char *raw, http_headers_t *out);`                           | –†–∞–∑–±–∏—Ä–∞–µ—Ç HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏.                 | `true`     |
| `http_upgrade_protocol`      | `bool http_upgrade_protocol(http_request_t *req);`                                         | –í—ã–ø–æ–ª–Ω—è–µ—Ç upgrade –¥–æ WebSocket/gRPC.      | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[8];
  char path[256];
  http_headers_t headers;
  json_t *body;
} http_request_t;

typedef struct {
  int status;
  http_headers_t headers;
  json_t *body;
} http_response_t;

typedef bool (*http_handler_t)(const http_request_t *req, http_response_t *resp);
typedef bool (*http_middleware_t)(http_request_t *req);
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `http_requests_total{method,path}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
* `http_dispatch_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
* `http_middleware_invocations_total` ‚Äî —á–∏—Å–ª–æ –≤—ã–∑–æ–≤–æ–≤ middleware
* `http_upgrade_attempts{protocol}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ protocol upgrade

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CORS, rate limiting, IP allowlist/denylist
* –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ Content-Type
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ mTLS, scope-based routing

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.2 ‚Äî REST / GraphQL API`
* `4.3 ‚Äî gRPC Streaming`
* `6.1 ‚Äî RBAC / Access Engine`
* `7.4 ‚Äî Structured Logging`
* `4.6 ‚Äî Webhook Dispatch`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_http_router_path_matching`
* `test_http_router_method_routing`
* `test_http_router_middleware_sequence`
* `test_http_router_protocol_upgrade`
* `test_http_router_header_parsing`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.8 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CDC (Change Data Capture)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.8 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CDC (Change Data Capture)

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `cdc_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **Change Data Capture (CDC)** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ —ç–∫—Å–ø–æ—Ä—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É —á–µ—Ä–µ–∑ **Kafka**, **Pulsar**, **Redis Streams**, **Debezium**, –∞ —Ç–∞–∫–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π **Changefeed API**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –∞—É–¥–∏—Ç–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å DWH, ETL, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ –±—Ä–æ–∫–µ—Ä–∞–º–∏ —Å–æ–±—ã—Ç–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | -------------------------------------------------------- | ----------------------------------------------------- | ---------- |
| `cdc_register_stream`   | `bool cdc_register_stream(const cdc_stream_def_t *def);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫ CDC –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è. | `true`     |
| `cdc_emit_change`       | `bool cdc_emit_change(const cdc_event_t *event);`        | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.                         | `true`     |
| `cdc_flush_buffer`      | `void cdc_flush_buffer(void);`                           | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±—É—Ñ–µ—Ä CDC.                   | `void`     |
| `cdc_encode_event`      | `json_t *cdc_encode_event(const cdc_event_t *event);`    | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ JSON.                           | JSON       |
| `cdc_unregister_stream` | `bool cdc_unregister_stream(const char *stream_name);`   | –û—Ç–∫–ª—é—á–∞–µ—Ç –ø–æ—Ç–æ–∫.                                      | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char stream_name[64];
  char table_name[64];
  char format[16]; // json, avro, protobuf
  char transport[32]; // kafka, redis, pulsar
  bool include_old_values;
} cdc_stream_def_t;

typedef struct {
  char table[64];
  char op[8]; // INSERT, UPDATE, DELETE
  json_t *old_row;
  json_t *new_row;
  uint64_t timestamp;
} cdc_event_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `cdc_events_emitted_total{op}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø—É (INSERT, UPDATE, DELETE)
* `cdc_stream_lag_ms{name}` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –ø–æ—Ç–æ–∫—É
* `cdc_buffer_size_bytes` ‚Äî –æ–±—ä—ë–º –±—É—Ñ–µ—Ä–∞ CDC
* `cdc_encoding_errors_total` ‚Äî –æ—à–∏–±–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ CDC –ø–æ —Ä–æ–ª—è–º
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫ –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º (RLS/CLS)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.14 ‚Äî WAL Engine`
* `5.4 ‚Äî –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π`
* `4.6 ‚Äî Webhook/Event Layer`
* `6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞`
* `8.15 ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CDC`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_cdc_register_emit_and_flush`
* `test_cdc_json_encoding_integrity`
* `test_cdc_kafka_transport_mock`
* `test_cdc_filter_and_old_value_control`
* `test_cdc_unregistration_cleanup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.9 ‚Äî –í–Ω–µ—à–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ UDF-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Lua/WASM/C++)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.9 ‚Äî –í–Ω–µ—à–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ UDF-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Lua/WASM/C++)

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `udf_external_runtime`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–≤–Ω–µ—à–Ω–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (UDF/UDAF)** –∏ **–ø—Ä–æ—Ü–µ–¥—É—Ä**, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ —è–∑—ã–∫–∞—Ö **Lua**, **WASM**, **C/C++** (—á–µ—Ä–µ–∑ sandbox API). –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å SQL –∏ DSL, –ø–µ—Ä–µ–¥–∞—á—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Ç–∏–ø–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | ------------------------------------------------------------------------------------- | --------------------------------- | ---------- |
| `udf_register_lua`  | `bool udf_register_lua(const char *name, const char *code);`                          | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç Lua-—Ñ—É–Ω–∫—Ü–∏—é.         | `true`     |
| `udf_register_wasm` | `bool udf_register_wasm(const char *name, const uint8_t *binary, size_t size);`       | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç WASM-–º–æ–¥—É–ª—å.         | `true`     |
| `udf_register_c`    | `bool udf_register_c(const char *name, void *fn_ptr);`                                | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç C-—Ñ—É–Ω–∫—Ü–∏—é —á–µ—Ä–µ–∑ API. | `true`     |
| `udf_execute`       | `bool udf_execute(const char *name, const value_t *args, size_t argc, value_t *out);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç UDF –ø–æ –∏–º–µ–Ω–∏.           | `true`     |
| `udf_sandbox_limit` | `void udf_sandbox_limit(udf_limits_t *limits);`                                       | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã –∏–∑–æ–ª—è—Ü–∏–∏.    | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  size_t memory_limit_bytes;
  uint64_t timeout_ns;
  bool allow_syscalls;
} udf_limits_t;

typedef struct {
  char name[64];
  char lang[8]; // lua, wasm, c
  void *code_blob;
  udf_limits_t limits;
} udf_entry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `udf_invocations_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ UDF –ø–æ –∏–º–µ–Ω–∏
* `udf_runtime_errors_total{lang}` ‚Äî –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* `udf_avg_exec_time_ns{name}` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* `udf_memory_usage_bytes` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–∞–º—è—Ç—å –≤ sandbox

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ sandbox (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π runtime)
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏, –ø–∞–º—è—Ç–∏, —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
* –ò–∑–æ–ª—è—Ü–∏—è per-session –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å UDF ACL

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.13 ‚Äî SQL —Ñ—É–Ω–∫—Ü–∏–∏`
* `3.10 ‚Äî DSL –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫`
* `6.6 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞`
* `8.16 ‚Äî Sandbox Runtime`
* `19.5 ‚Äî UDF Profiler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_udf_lua_execution_and_return`
* `test_udf_wasm_module_limits`
* `test_udf_c_sandbox_call`
* `test_udf_isolation_memory_and_timeout`
* `test_udf_acl_permission_denied`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **4.10 ‚Äî ETL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (S3, Parquet, CSV, XML)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 4.10 ‚Äî ETL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (S3, Parquet, CSV, XML)

**–ü–∞–∫–µ—Ç:** `4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏`
**Block ID:** `etl_external_sources`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö** –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É **ETL (Extract-Transform-Load)** –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏–∑ —Ñ–æ—Ä–º–∞—Ç–æ–≤: **CSV, JSON, Parquet, XML**, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –≤ **–ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, S3 –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –æ–±–ª–∞—á–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (MinIO, GCS)**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É, –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é, –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫, –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º, –ø–∞—Ä—Å–∏–Ω–≥, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –æ—Ç—á—ë—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | -------------------------------------------------------------------------------------- | -------------------------------------- | ---------- |
| `etl_import_file`   | `bool etl_import_file(const etl_job_t *job);`                                          | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª –≤ —Ç–∞–±–ª–∏—Ü—É.      | `true`     |
| `etl_export_file`   | `bool etl_export_file(const etl_job_t *job);`                                          | –í—ã–≥—Ä—É–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –≤–æ –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª.     | `true`     |
| `etl_detect_schema` | `table_def_t *etl_detect_schema(const char *file_path, etl_format_t format);`          | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ö–µ–º—É –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ–∞–π–ª–∞. | –°—Ö–µ–º–∞      |
| `etl_transform_row` | `bool etl_transform_row(const row_t *in, row_t *out, const transform_rules_t *rules);` | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.       | `true`     |
| `etl_validate_row`  | `bool etl_validate_row(const row_t *row);`                                             | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  ETL_CSV, ETL_PARQUET, ETL_JSON, ETL_XML
} etl_format_t;

typedef struct {
  char source_uri[256];
  char target_table[64];
  etl_format_t format;
  bool header_present;
  bool autodetect_schema;
  transform_rules_t *rules;
} etl_job_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `etl_rows_imported_total{format}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
* `etl_parse_errors_total{format}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
* `etl_transformation_time_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫–∏
* `etl_s3_bandwidth_bytes` ‚Äî –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ S3

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É—Ç—è–º (ACL, scope-based URI)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –ª–∏–º–∏—Ç–æ–≤ —Å—Ç—Ä–æ–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS/S3 credentials encryption

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.1 ‚Äî –¢–∞–±–ª–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ`
* `3.9 ‚Äî DML –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫`
* `7.4 ‚Äî Logging`
* `6.1 ‚Äî RBAC / –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞`
* `19.1 ‚Äî –§–æ—Ä–º–∞—Ç—ã –∏ –ø–∞—Ä—Å–µ—Ä—ã`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_etl_import_csv_with_schema`
* `test_etl_detect_schema_json_and_xml`
* `test_etl_parquet_roundtrip_export_import`
* `test_etl_row_transformation_with_rules`
* `test_etl_s3_integration_mock_and_access_control`

---

‚úÖ –ü–∞–∫–µ—Ç **4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **5. BI, ML –∏ OLAP**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **5.1 ‚Äî –¢–∞–±–ª–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 5.1 ‚Äî –¢–∞–±–ª–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π

**–ü–∞–∫–µ—Ç:** `5. BI, ML –∏ OLAP`
**Block ID:** `columnar_storage_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ **–∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö, –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö –∏ BI-–Ω–∞–≥—Ä—É–∑–æ–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ**, **—Å–∂–∞—Ç–∏–µ**, **–ø–∞–º—è—Ç—å-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–º–ø–æ–Ω–æ–≤–∫—É**, **Pushdown-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é**, **–≥—Ä—É–ø–ø–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã** –∏ **–æ—Ç–ª–æ–∂–µ–Ω–Ω—É—é –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—é**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ HTAP-–Ω–∞–≥—Ä—É–∑–∫–∞—Ö, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö, OLAP-–∫—É–±–∞—Ö –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π ML-–ø–æ–¥—Å–∏—Å—Ç–µ–º–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | -------------------------------------------------------------------------------------------- | ---------------------------------------------- | ---------- |
| `column_store_create`    | `column_store_t *column_store_create(const table_def_t *def);`                               | –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–µ –∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.            | –•—Ä–∞–Ω–∏–ª–∏—â–µ  |
| `column_store_insert`    | `bool column_store_insert(column_store_t *store, const row_t *row);`                         | –í—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É, —Ä–∞–∑–±–∏–≤–∞—è –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º.        | `true`     |
| `column_store_scan`      | `column_cursor_t *column_store_scan(const column_store_t *store, const filter_t *filter);`   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫—É—Ä—Å–æ—Ä –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ñ–∏–ª—å—Ç—Ä–æ–º. | –ö—É—Ä—Å–æ—Ä     |
| `column_store_aggregate` | `agg_result_t *column_store_aggregate(const column_store_t *store, const agg_plan_t *plan);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–π –ø–ª–∞–Ω.                     | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `column_store_free`      | `void column_store_free(column_store_t *store);`                                             | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å.                            | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  column_t **columns;
  size_t column_count;
  compression_scheme_t compression;
  encoding_t encoding;
} column_store_t;

typedef struct {
  column_id_t column;
  agg_func_t func;
} agg_plan_t;

typedef struct {
  value_t *values;
  size_t count;
} agg_result_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `columnar_rows_scanned_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
* `columnar_filter_pushdown_hits` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–ª–æ–Ω–æ–∫
* `columnar_compression_ratio_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è —Å—Ç–µ–ø–µ–Ω—å —Å–∂–∞—Ç–∏—è
* `columnar_aggregation_time_ns` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ RLS/CLS
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–ª–æ–Ω–æ–∫
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–≥—Ä–µ–≥–∞—Ç–∞–º (masking/policy)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.6 ‚Äî –°–∂–∞—Ç–∏–µ –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ`
* `3.12 ‚Äî SQL Executor`
* `5.2 ‚Äî Aggregation Engine`
* `6.5 ‚Äî Column-level Security`
* `7.1 ‚Äî Memory Profiler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_column_store_creation_and_insert`
* `test_column_store_filter_and_scan`
* `test_column_store_aggregate_sum_avg`
* `test_columnar_compression_ratio`
* `test_column_store_rls_column_masking`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **5.2 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 5.2 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ü–∞–∫–µ—Ç:** `5. BI, ML –∏ OLAP`
**Block ID:** `aggregation_window_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¥–≤–∏–∂–æ–∫ **–∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö –∏ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ `GROUP BY`, `ROLLUP`, `CUBE`, `HAVING`, –∞ —Ç–∞–∫–∂–µ –æ–∫–æ–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π `OVER(PARTITION BY ... ORDER BY ...)`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç stream-based –∞–≥—Ä–µ–≥–∞—Ü–∏—é, —Å–∫–æ–ª—å–∑—è—â–∏–µ –æ–∫–Ω–∞, –∫–∞–¥—Ä–æ–≤—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã, —Ä–∞–∑–±–∏–µ–Ω–∏–µ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –≥—Ä—É–ø–ø–∞–º. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ SQL, BI, time-series –∏ ML-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| ------------------------ | ------------------------------------------------------------------------------------- | -------------------------------- | ----------- |
| `agg_engine_group_by`    | `agg_result_t *agg_engine_group_by(const rowset_t *input, const group_spec_t *spec);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –≥—Ä—É–ø–ø–∞–º.   | –†–µ–∑—É–ª—å—Ç–∞—Ç   |
| `agg_engine_window`      | `rowset_t *agg_engine_window(const rowset_t *input, const window_spec_t *spec);`      | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.       | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |
| `agg_engine_rollup`      | `agg_result_t *agg_engine_rollup(const rowset_t *input, const rollup_spec_t *spec);`  | –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–Ω–æ–≥–æ–º–µ—Ä–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é. | –†–µ–∑—É–ª—å—Ç–∞—Ç   |
| `agg_engine_register`    | `bool agg_engine_register(const char *name, agg_impl_t *impl);`                       | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. | `true`      |
| `agg_engine_free_result` | `void agg_engine_free_result(agg_result_t *res);`                                     | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏. | `void`      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  column_id_t *group_keys;
  size_t key_count;
  agg_plan_t *aggregates;
  size_t agg_count;
} group_spec_t;

typedef struct {
  column_id_t *partition_by;
  column_id_t *order_by;
  frame_spec_t frame;
} window_spec_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `agg_groups_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥—Ä—É–ø–ø
* `window_frame_evals_total` ‚Äî —á–∏—Å–ª–æ –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω
* `agg_engine_memory_bytes` ‚Äî –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏ –Ω–∞ –∞–≥—Ä–µ–≥–∞—Ç—ã
* `agg_operator_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –ø–æ RLS
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –ø–æ –ø–æ–ª–∏—Ç–∏–∫–∞–º
* –ò–∑–æ–ª—è—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º –∞–≥—Ä–µ–≥–∞—Ç–∞–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.1 ‚Äî Column Store`
* `3.13 ‚Äî SQL Aggregate Functions`
* `3.3 ‚Äî –û–∫–æ–Ω–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è`
* `6.5 ‚Äî Row/Column Level Security`
* `7.1 ‚Äî Execution Profiler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_agg_group_by_single_and_multi_key`
* `test_window_partition_and_sorting`
* `test_rollup_and_cube_aggregation`
* `test_register_custom_aggregate`
* `test_frame_boundaries_rows_vs_range`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **5.3 ‚Äî –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ OLAP-–∫—É–±—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 5.3 ‚Äî –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ OLAP-–∫—É–±—ã

**–ü–∞–∫–µ—Ç:** `5. BI, ML –∏ OLAP`
**Block ID:** `materialized_views_olap_cubes`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (MV)** –∏ **OLAP-–∫—É–±–æ–≤**, –ø–æ–∑–≤–æ–ª—è—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å, –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é, `REFRESH MATERIALIZED VIEW`, –∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Å `ROLLUP`/`CUBE`.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| --------------------- | ---------------------------------------------- | ---------------------------------------- | ----------- |
| `mv_create`           | `bool mv_create(const mv_def_t *def);`         | –°–æ–∑–¥–∞—ë—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ. | `true`      |
| `mv_refresh`          | `bool mv_refresh(const char *view_name);`      | –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ MV.                   | `true`      |
| `mv_query_substitute` | `bool mv_query_substitute(sql_ast_t *query);`  | –ü–æ–¥–º–µ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ MV, –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ.  | `true`      |
| `cube_define`         | `bool cube_define(const cube_def_t *def);`     | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç OLAP-–∫—É–±.                     | `true`      |
| `cube_query`          | `rowset_t *cube_query(const cube_query_t *q);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –∫—É–±—É.                 | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char query[1024];
  bool auto_refresh;
  interval_t refresh_interval;
} mv_def_t;

typedef struct {
  char name[64];
  column_id_t *dimensions;
  size_t dim_count;
  agg_plan_t *measures;
  size_t measure_count;
} cube_def_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `mv_refresh_duration_ns{name}` ‚Äî –≤—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è MV
* `mv_substitution_hits_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–¥–º–µ–Ω –∑–∞–ø—Ä–æ—Å–æ–≤
* `cube_query_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ OLAP-–∑–∞–ø—Ä–æ—Å–æ–≤
* `mv_storage_bytes{name}` ‚Äî –∑–∞–Ω–∏–º–∞–µ–º—ã–π –æ–±—ä—ë–º –Ω–∞ MV

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ MV –∏ –∫—É–±–∞–º
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ MV —Ç–æ–ª—å–∫–æ –ø–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º —Å–æ–±—ã—Ç–∏—è–º
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.2 ‚Äî Aggregation Engine`
* `3.7 ‚Äî SQL Planner`
* `6.5 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏`
* `19.2 ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π`
* `10.4 ‚Äî –§–æ–Ω–æ–≤—ã–π –æ–±–Ω–æ–≤–ª—è—é—â–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_mv_create_refresh_and_query`
* `test_mv_auto_refresh_timer_triggered`
* `test_mv_substitution_rules_and planner_integration`
* `test_cube_define_and_query_result`
* `test_cube_dimension_and_measure_resolution`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **5.4 ‚Äî –ê—É–¥–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥-—Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 5.4 ‚Äî –ê—É–¥–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥-—Ñ—É–Ω–∫—Ü–∏–∏

**–ü–∞–∫–µ—Ç:** `5. BI, ML –∏ OLAP`
**Block ID:** `data_audit_logging`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∞—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏** –∏ **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–æ–≥-—Ñ—É–Ω–∫—Ü–∏–∏**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º—ã `DML Audit`, `DDL Audit`, `Function Call Audit`, –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–µ —Ü–µ–ø–æ—á–∫–∏ (`immutable chain logs`), –∞ —Ç–∞–∫–∂–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∏ –≤—ã–∑–æ–≤–æ–≤ –≤ SQL –∏ DSL (`log_event`, `log_error`, `log_warn`, `log_structured`).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | -------------------------------------------------------------------------------------------- | ------------------------------------------------- | ---------- |
| `audit_log_dml`           | `void audit_log_dml(const char *op, const row_t *before, const row_t *after, tx_ctx_t *tx);` | –õ–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ (INSERT/UPDATE/DELETE). | `void`     |
| `audit_log_ddl`           | `void audit_log_ddl(const char *sql, user_t *user);`                                         | –§–∏–∫—Å–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã.                        | `void`     |
| `log_event`               | `void log_event(const char *op, uint64_t time_ns, size_t size);`                             | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.                   | `void`     |
| `log_structured`          | `void log_structured(const char *json);`                                                     | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ JSON.             | `void`     |
| `audit_log_function_call` | `void audit_log_function_call(const char *name, const value_t *args, size_t argc);`          | –ê—É–¥–∏—Ç –≤—ã–∑–æ–≤–∞ UDF/SQL-—Ñ—É–Ω–∫—Ü–∏–∏.                     | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char user[64];
  char session_id[64];
  uint64_t timestamp;
  char op[16];
  json_t *data;
} audit_entry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `audit_log_entries_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –ø–æ —Ç–∏–ø—É (dml/ddl/func)
* `audit_log_latency_ns` ‚Äî –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–∞
* `log_event_invocations_total{op}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ `log_event`
* `log_structured_errors_total` ‚Äî –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ –∑–∞–ø–∏—Å–∏ (write-once logs)
* –ü–æ–ª–∏—Ç–∏–∫–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ –∞—É–¥–∏—Ç-–ª–æ–≥–∞—Ö
* –ü–æ–¥–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –∏ —Ü–µ–ø–æ—á–∫–∞ —Ö—ç—à–µ–π (integrity chain)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî Transaction Manager`
* `3.14 ‚Äî SQL Triggers`
* `4.6 ‚Äî Webhook Events`
* `6.6 ‚Äî Access Policy Engine`
* `7.4 ‚Äî Structured Logging Layer`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_audit_log_insert_update_delete`
* `test_audit_ddl_log_schema_change`
* `test_log_event_latency_and_format`
* `test_log_structured_json_validation`
* `test_function_call_audit_with_args`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **5.5 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML: SQL-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∏ runtime ONNX/PyTorch** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 5.5 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ML: SQL-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∏ runtime ONNX/PyTorch

**–ü–∞–∫–µ—Ç:** `5. BI, ML –∏ OLAP`
**Block ID:** `ml_integration_runtime`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞–º–∏ **–º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è** ‚Äî ONNX, PyTorch, TensorFlow. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å **ML-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å** –ø—Ä—è–º–æ –∏–∑ SQL –∏–ª–∏ DSL, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–¥–µ–ª—å –∫–∞–∫ UDF-—Ñ—É–Ω–∫—Ü–∏—é (`INFER(...)`), –∞ —Ç–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ñ–∏—á–µ–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç CPU-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, GPU (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ), batching, –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–æ–¥–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | ------------------------------------------------------------------------------------------------------ | ------------------------------------------------ | ---------- |
| `ml_model_register` | `bool ml_model_register(const ml_model_def_t *def);`                                                   | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–æ–¥–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ.                   | `true`     |
| `ml_model_infer`    | `bool ml_model_infer(const char *model_name, const value_t *features, size_t count, value_t *result);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç ML-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –ø–æ –ø—Ä–∏–∑–Ω–∞–∫–∞–º.              | `true`     |
| `ml_model_reload`   | `bool ml_model_reload(const char *model_name);`                                                        | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–æ–¥–µ–ª—å —Å –¥–∏—Å–∫–∞ –∏–ª–∏ blob-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞. | `true`     |
| `ml_list_models`    | `json_t *ml_list_models(void);`                                                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π.             | JSON       |
| `ml_infer_sql_fn`   | `bool ml_infer_sql_fn(const value_t *args, size_t argc, value_t *out);`                                | SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è `INFER(...)`.                  | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char path[256];
  char format[8]; // onnx, torch, tf
  bool enable_gpu;
  size_t batch_size;
} ml_model_def_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ml_inference_calls_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –ø–æ –º–æ–¥–µ–ª–∏
* `ml_inference_latency_ns{name}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
* `ml_model_memory_bytes{name}` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–∞–º—è—Ç—å –º–æ–¥–µ–ª–∏
* `ml_model_reload_success_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö reload

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—É—Ç–µ–π –∏ –ø–æ–¥–ø–∏—Å—å –º–æ–¥–µ–ª–µ–π
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–∑–æ–≤–∞ INFER —á–µ—Ä–µ–∑ RBAC/ACL
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–π–º–∞—É—Ç—ã

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.9 ‚Äî UDF Runtime`
* `5.1 ‚Äî Columnar Engine`
* `6.1 ‚Äî Access Policies`
* `19.6 ‚Äî ML Model Format Parser`
* `8.14 ‚Äî –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ SIMD runtime`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_ml_register_and_infer_single_row`
* `test_ml_batch_inference_with_column_input`
* `test_ml_model_reload_and_swap`
* `test_ml_sql_infer_expression_usage`
* `test_ml_acl_and_resource_limits`

---

‚úÖ –ü–∞–∫–µ—Ç **5. BI, ML –∏ OLAP** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **6.1 ‚Äî RBAC / ABAC –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.1 ‚Äî RBAC / ABAC –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `rbac_abac_policy_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ä–æ–ª–µ–≤—É—é (RBAC)** –∏ **–∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—É—é (ABAC)** –º–æ–¥–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–æ–ª–µ–π, —Å–µ—Å—Å–∏–π, –æ–±—ä–µ–∫—Ç–æ–≤, –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –∞—É–¥–∏—Ç –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–∞–º, –∫–æ–ª–æ–Ω–∫–∞–º, —Å—Ç—Ä–æ–∫–∞–º, —Ñ—É–Ω–∫—Ü–∏—è–º, —Å—Ö–µ–º–∞–º –∏ API.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ----------------------------------------------------------------------------------------------- | ------------------------------- | ---------- |
| `rbac_assign_role`   | `bool rbac_assign_role(const char *user, const char *role);`                                    | –ù–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.    | `true`     |
| `abac_define_policy` | `bool abac_define_policy(const abac_policy_t *policy);`                                         | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–æ–≤—É—é ABAC-–ø–æ–ª–∏—Ç–∏–∫—É. | `true`     |
| `rbac_check_access`  | `bool rbac_check_access(const char *user, const char *object, const char *action);`             | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É.     | `true`     |
| `abac_evaluate`      | `bool abac_evaluate(const abac_context_t *ctx, const abac_policy_t *policy);`                   | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É ABAC.        | `true`     |
| `access_log_event`   | `void access_log_event(const char *user, const char *object, const char *action, bool result);` | –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –¥–æ—Å—Ç—É–ø–∞.       | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char user[64];
  char role[64];
} rbac_assignment_t;

typedef struct {
  char name[64];
  char expression[256]; // e.g., user.department == row.department
} abac_policy_t;

typedef struct {
  json_t *attributes;
  char user[64];
} abac_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `rbac_access_granted_total{role}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ —Ä–æ–ª—è–º
* `abac_policy_eval_failures` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ ABAC
* `access_denied_total{object}` ‚Äî –æ—Ç–∫–∞–∑–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º
* `rbac_roles_per_user_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Ä–æ–ª–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞: –æ–±—ä–µ–∫—Ç ‚Üí –¥–µ–π—Å—Ç–≤–∏–µ ‚Üí –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –¥–æ—Å—Ç—É–ø–∞
* –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.2 ‚Äî Row-Level Security`
* `6.3 ‚Äî Column-Level Security`
* `4.1 ‚Äî JDBC/ODBC Access`
* `7.4 ‚Äî Structured Access Logs`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rbac_role_assignment_and_check`
* `test_abac_policy_expression_eval`
* `test_access_log_entry_written`
* `test_access_denied_for_missing_role`
* `test_abac_complex_policy_with_attributes`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **6.2 ‚Äî –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ (RLS)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.2 ‚Äî –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ (RLS)

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `row_level_security`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ (Row-Level Security, RLS)**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ RLS-–ø—Ä–∞–≤–∏–ª–∞, –ø—Ä–µ–¥–∏–∫–∞—Ç—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å, –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ runtime-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç          |
| ------------------------- | ------------------------------------------------------------------------------ | -------------------------------- | ------------------- |
| `rls_define_policy`       | `bool rls_define_policy(const rls_policy_t *policy);`                          | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é RLS-–ø–æ–ª–∏—Ç–∏–∫—É. | `true`              |
| `rls_attach_to_table`     | `bool rls_attach_to_table(const char *table, const char *policy_name);`        | –ù–∞–∑–Ω–∞—á–∞–µ—Ç RLS –∫ —Ç–∞–±–ª–∏—Ü–µ.         | `true`              |
| `rls_eval_row_visibility` | `bool rls_eval_row_visibility(const row_t *row, const rls_context_t *ctx);`    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏.      | `true`              |
| `rls_filter_rowset`       | `rowset_t *rls_filter_rowset(const rowset_t *rows, const rls_context_t *ctx);` | –§–∏–ª—å—Ç—Ä—É–µ—Ç –Ω–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ –ø–æ RLS.    | –§–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä |
| `rls_list_policies`       | `json_t *rls_list_policies(const char *table);`                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ç–∞–±–ª–∏—Ü—ã. | JSON                |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char predicate[256]; // SQL-–ø—Ä–µ–¥–∏–∫–∞—Ç
  bool apply_on_select;
  bool apply_on_update;
  bool apply_on_delete;
} rls_policy_t;

typedef struct {
  char user[64];
  json_t *session_attributes;
} rls_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `rls_rows_filtered_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
* `rls_eval_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ RLS
* `rls_policies_per_table_avg` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É
* `rls_policy_match_rate` ‚Äî –¥–æ–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (executor pushdown)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ deny-by-default –∏ fallback-–ø—Ä–∞–≤–∏–ª
* RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã –≤–æ –≤—Ä–µ–º—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.1 ‚Äî RBAC / ABAC`
* `3.12 ‚Äî SQL Executor`
* `5.1 ‚Äî –¢–∞–±–ª–∏—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ`
* `6.3 ‚Äî Column-Level Security`
* `7.4 ‚Äî Structured Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_rls_policy_definition_and_binding`
* `test_rls_filtering_on_select_and_update`
* `test_rls_predicate_eval_per_row`
* `test_rls_context_attribute_propagation`
* `test_rls_access_denied_default_fallback`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **6.3 ‚Äî –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–ª–æ–Ω–æ–∫ (CLS)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.3 ‚Äî –ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–ª–æ–Ω–æ–∫ (CLS)

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `column_level_security`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **Column-Level Security (CLS)** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—Ç–¥–µ–ª—å–Ω—ã–º –∫–æ–ª–æ–Ω–∫–∞–º —Ç–∞–±–ª–∏—Ü –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–µ–π, –ø–æ–ª–∏—Ç–∏–∫ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π, –ø–æ–ª–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –∫–æ–ª–æ–Ω–æ–∫, –∑–∞–ø—Ä–µ—Ç –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∫ –≥—Ä—É–ø–ø–∞–º –∫–æ–ª–æ–Ω–æ–∫ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ executor-–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç             |
| ------------------------- | ------------------------------------------------------------------------------------------------------------- | -------------------------------- | ---------------------- |
| `cls_define_policy`       | `bool cls_define_policy(const cls_policy_t *policy);`                                                         | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é CLS-–ø–æ–ª–∏—Ç–∏–∫—É. | `true`                 |
| `cls_check_column_access` | `bool cls_check_column_access(const char *user, const char *table, const char *column, cls_action_t action);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–ª–æ–Ω–∫–µ.      | `true`                 |
| `cls_apply_masking`       | `value_t cls_apply_masking(const char *column, const value_t *original);`                                     | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ.          | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
| `cls_list_policies`       | `json_t *cls_list_policies(const char *table);`                                                               | –°–ø–∏—Å–æ–∫ CLS-–ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.  | JSON                   |
| `cls_eval_expression`     | `bool cls_eval_expression(const cls_policy_t *policy, const cls_context_t *ctx);`                             | –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏.    | `true`                 |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  CLS_ACTION_READ,
  CLS_ACTION_WRITE
} cls_action_t;

typedef struct {
  char name[64];
  char table[64];
  char column[64];
  char condition[256];  // –ü—Ä–µ–¥–∏–∫–∞—Ç –∏–ª–∏ —Ä–æ–ª—å
  char mask_expr[128];  // –ü—Ä–∏–º–µ—Ä: `'****'` –∏–ª–∏ `NULL`
} cls_policy_t;

typedef struct {
  char user[64];
  json_t *session_attributes;
} cls_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `cls_column_masked_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
* `cls_access_denied_total{column}` ‚Äî –æ—Ç–∫–∞–∑–æ–≤ –≤ –¥–æ—Å—Ç—É–ø–µ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º
* `cls_policy_eval_failures` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª–∏—Ç–∏–∫–∏
* `cls_policy_count_per_table` ‚Äî —á–∏—Å–ª–æ CLS-–ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è –∏ deny-by-default
* CLS –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö –¥–æ—Å—Ç—É–ø–∞ (SQL, API, UDF)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `SELECT`, `UPDATE`, `MERGE` –∏ `INSERT`

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.1 ‚Äî RBAC/ABAC Engine`
* `6.2 ‚Äî Row-Level Security`
* `3.12 ‚Äî SQL Executor`
* `4.1 ‚Äî JDBC/ODBC Access`
* `7.4 ‚Äî Access Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_cls_read_masking_policy`
* `test_cls_write_access_denied`
* `test_cls_expression_eval_with_context`
* `test_cls_column_hidden_from_projection`
* `test_cls_masking_function_behavior`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **6.4 ‚Äî TLS / mTLS –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.4 ‚Äî TLS / mTLS –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `tls_connection_security`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **TLS –∏ mTLS** (–≤–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è) –¥–ª—è –∑–∞—â–∏—Ç—ã –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∫—É TLS 1.2/1.3, –∑–∞–≥—Ä—É–∑–∫—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ä–æ—Ç–∞—Ü–∏—é –∫–ª—é—á–µ–π, –∑–∞–ø—Ä–µ—Ç —Å–ª–∞–±—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å HTTP/2, gRPC, JDBC –∏ WebSocket.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| ------------------------- | ---------------------------------------------------------- | ------------------------------------------- | ------------ |
| `tls_init_context`        | `tls_ctx_t *tls_init_context(const tls_config_t *config);` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç TLS-–∫–æ–Ω—Ç–µ–∫—Å—Ç.                | TLS-–∫–æ–Ω—Ç–µ–∫—Å—Ç |
| `tls_wrap_socket`         | `int tls_wrap_socket(tls_ctx_t *ctx, int fd);`             | –û–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–æ–∫–µ—Ç –≤ TLS.                    | fd           |
| `tls_verify_peer`         | `bool tls_verify_peer(tls_ctx_t *ctx);`                    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Ç–∞.               | `true`       |
| `tls_reload_certificates` | `bool tls_reload_certificates(tls_ctx_t *ctx);`            | –û–±–Ω–æ–≤–ª—è–µ—Ç TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã.  | `true`       |
| `tls_shutdown`            | `void tls_shutdown(tls_ctx_t *ctx);`                       | –ó–∞–≤–µ—Ä—à–∞–µ—Ç TLS-—Å–µ—Å—Å–∏—é –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã. | `void`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char cert_file[256];
  char key_file[256];
  char ca_file[256];
  bool require_client_cert;
  bool allow_tls13;
} tls_config_t;

typedef struct {
  int socket_fd;
  void *ssl_ctx;
  void *ssl_session;
} tls_ctx_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tls_connections_total{protocol}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* `tls_verification_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
* `tls_handshake_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è
* `tls_reload_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* mTLS —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∫–ª–∏–µ–Ω—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
* –û—Ç–∫–ª—é—á–µ–Ω–∏–µ SSLv2/v3, TLS < 1.2
* –ó–∞—â–∏—Ç–∞ –æ—Ç MITM, –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏ downgrade-–∞—Ç–∞–∫

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.7 ‚Äî HTTP Router / Network Stack`
* `4.3 ‚Äî gRPC Streaming`
* `6.1 ‚Äî RBAC / ACL`
* `7.4 ‚Äî Logging TLS Events`
* `8.8 ‚Äî Watchdog & Hot Reload`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_tls_server_client_connection`
* `test_tls_verification_with_custom_ca`
* `test_mtls_bidirectional_authentication`
* `test_tls_reload_certificate_at_runtime`
* `test_tls_handshake_failure_and_logging`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **6.5 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º –∏ —Ç–∞–±–ª–∏—Ü–∞–º (Access Policy Engine)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.5 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º –∏ —Ç–∞–±–ª–∏—Ü–∞–º (Access Policy Engine)

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `access_policy_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–≤–∏–∂–æ–∫ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º**, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü, –∫–æ–ª–æ–Ω–æ–∫, —Å—Ç—Ä–æ–∫ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –≤–∏–¥–µ, –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ —Ü–µ–ø–æ—á–∫–∏, –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏—Ö –Ω–∞ —Å—Ç–∞–¥–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É `ALLOW`, `DENY`, `MASK`, `FILTER`, `TRANSFORM`, –≤–∫–ª—é—á–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–∏–≤—è–∑–∫—É –∫ —Ä–æ–ª—è–º, –≥—Ä—É–ø–ø–∞–º, IP, —á–∞—Å–∞–º –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–µ—Å—Å–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------------------------------------- | --------------------------------------- | ---------- |
| `access_policy_register` | `bool access_policy_register(const policy_def_t *def);`                                        | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é –ø–æ–ª–∏—Ç–∏–∫—É –¥–æ—Å—Ç—É–ø–∞.    | `true`     |
| `access_policy_evaluate` | `bool access_policy_evaluate(const access_context_t *ctx, const policy_def_t *def);`           | –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫—É –ø–æ–ª–∏—Ç–∏–∫–∏.              | `true`     |
| `access_policy_apply`    | `bool access_policy_apply(const access_context_t *ctx, access_decision_t *decision);`          | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Ä–µ—à–µ–Ω–∏–µ. | `true`     |
| `access_policy_list`     | `json_t *access_policy_list(const char *object);`                                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞.  | JSON       |
| `access_policy_audit`    | `void access_policy_audit(const access_context_t *ctx, const policy_def_t *def, bool result);` | –õ–æ–≥–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏.      | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char object[64];       // table, column, function
  char expression[256];  // —É—Å–ª–æ–≤–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
  char action[16];       // ALLOW, DENY, MASK, FILTER
} policy_def_t;

typedef struct {
  char user[64];
  char role[64];
  char object[64];
  char operation[16];
  json_t *attributes;
} access_context_t;

typedef struct {
  bool allow;
  bool mask;
  bool filter;
  char reason[128];
} access_decision_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `access_policy_evaluated_total{object}` ‚Äî —á–∏—Å–ª–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫
* `access_policy_denied_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤
* `access_policy_mask_applied_total` ‚Äî —á–∏—Å–ª–æ –º–∞—Å–∫–∏—Ä–æ–≤–æ–∫
* `access_policy_audit_logs_total` ‚Äî –ª–æ–≥–æ–≤ –ø–æ–ª–∏—Ç–∏–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ä—è–¥–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª (precedence)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ deny-by-default –∏ fallback behavior
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç policy bypass (hard bindings)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.1 ‚Äî RBAC / ABAC Engine`
* `6.2 ‚Äî RLS`
* `6.3 ‚Äî CLS`
* `3.12 ‚Äî SQL Executor`
* `7.4 ‚Äî Structured Access Audit`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_access_policy_allow_vs_deny`
* `test_access_policy_mask_condition`
* `test_access_policy_dynamic_expression_eval`
* `test_access_policy_chain_resolution`
* `test_access_policy_audit_logging_and context propagation`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ UDF –∏ API –≤—ã–∑–æ–≤–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ UDF –∏ API –≤—ã–∑–æ–≤–æ–≤

**–ü–∞–∫–µ—Ç:** `6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `udf_api_security_policies`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Å–∏—Å—Ç–µ–º—É –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ UDF/UDAF, –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–æ–º –∫ UDF –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—ã–∑–æ–≤–∞ (SQL/REST/gRPC), –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤, sandbox-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—é –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, throttle –ø–æ —á–∞—Å—Ç–æ—Ç–µ –≤—ã–∑–æ–≤–æ–≤ –∏ –∞—É–¥–∏—Ç –≤—ã–∑–æ–≤–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | ------------------------------------------------------------------------------------- | --------------------------------- | ---------- |
| `udf_policy_register`     | `bool udf_policy_register(const udf_policy_t *policy);`                               | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –≤—ã–∑–æ–≤–∞ UDF. | `true`     |
| `udf_policy_check_access` | `bool udf_policy_check_access(const udf_context_t *ctx, const udf_policy_t *policy);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–∞–≤–æ –≤—ã–∑–æ–≤–∞.           | `true`     |
| `udf_policy_apply_limits` | `bool udf_policy_apply_limits(const udf_context_t *ctx);`                             | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è sandbox.    | `true`     |
| `udf_log_invocation`      | `void udf_log_invocation(const char *fn, const udf_context_t *ctx, bool result);`     | –õ–æ–≥–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤ UDF/API.           | `void`     |
| `udf_throttle_check`      | `bool udf_throttle_check(const udf_context_t *ctx);`                                  | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —á–∞—Å—Ç–æ—Ç—ã –≤—ã–∑–æ–≤–∞.  | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char role[64];
  char source[16]; // sql, rest, grpc
  size_t max_calls_per_min;
  bool require_tls;
  bool allow_side_effects;
} udf_policy_t;

typedef struct {
  char user[64];
  char session_id[64];
  char fn_name[64];
  json_t *args;
  uint64_t timestamp;
} udf_context_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `udf_invocations_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
* `udf_invocation_denied_total{name}` ‚Äî –æ—Ç–∫–∞–∑–æ–≤ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ
* `udf_throttle_blocked_total` ‚Äî –≤—ã–∑–æ–≤–æ–≤, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ —á–∞—Å—Ç–æ—Ç–µ
* `udf_api_policy_mismatches` ‚Äî –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ source (REST, SQL, GRPC) –∏ IP
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ç–∏–ø—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ stateful –∏ side-effect —Ñ—É–Ω–∫—Ü–∏—è–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.9 ‚Äî –í–Ω–µ—à–Ω–∏–µ UDF`
* `6.1 ‚Äî RBAC/ABAC`
* `5.5 ‚Äî ML Inference Runtime`
* `7.4 ‚Äî Structured Logging`
* `8.12 ‚Äî Sandbox Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_udf_policy_registration_and_check`
* `test_udf_policy_deny_by_source`
* `test_udf_throttle_limit_exceeded`
* `test_udf_argument_validation_and audit`
* `test_udf_invocation_tls_requirement`

---

‚úÖ –ü–∞–∫–µ—Ç **6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **7. Observability –∏ DevOps**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **7.1 ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫ –ø–∞–º—è—Ç–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫–∏ (Flamegraph / Timeline)**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 7.1 ‚Äî –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫ –ø–∞–º—è—Ç–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫–∏ (Flamegraph / Timeline)

**–ü–∞–∫–µ—Ç:** `7. Observability –∏ DevOps`
**Block ID:** `memory_cpu_profiler`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫ –ø–∞–º—è—Ç–∏ –∏ CPU**, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–±–æ—Ä –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é **Flamegraph**, **timeline-–≥—Ä–∞—Ñ–∏–∫–æ–≤**, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–ª–ª–æ–∫–∞—Ü–∏–π, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –ø–æ —Ç–∏–∫–∞–º, –≥–æ—Ä—è—á–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, bottlenecks –∏ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | ---------------------------------------------------------------------------- | ---------------------------------- | ---------- |
| `profiler_start`               | `void profiler_start(void);`                                                 | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫—É.            | `void`     |
| `profiler_stop`                | `void profiler_stop(void);`                                                  | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å. | `void`     |
| `profiler_snapshot_flamegraph` | `json_t *profiler_snapshot_flamegraph(void);`                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π Flamegraph.     | JSON       |
| `profiler_record_allocation`   | `void profiler_record_allocation(void *ptr, size_t size, const char *func);` | –£—á–∏—Ç—ã–≤–∞–µ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏—é –ø–∞–º—è—Ç–∏.        | `void`     |
| `profiler_emit_timeline_event` | `void profiler_emit_timeline_event(const char *phase, uint64_t time_ns);`    | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É.        | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *function;
  size_t total_allocs;
  size_t bytes_total;
  uint64_t exec_time_ns;
} flame_node_t;

typedef struct {
  uint64_t timestamp;
  char phase[32]; // start, end, yield, block
} timeline_event_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `memory_usage_peak_bytes` ‚Äî –ø–∏–∫–æ–≤–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
* `flamegraph_hotspot{function}` ‚Äî –≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏ CPU
* `timeline_event_count{phase}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª–µ
* `allocation_rate_bytes_per_sec` ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å –∞–ª–ª–æ–∫–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
* –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ —Å–µ—Å—Å–∏—è–º/—Ä–æ–ª—è–º
* –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `7.2 ‚Äî OpenTelemetry Collector`
* `8.2 ‚Äî Execution Engine`
* `10.2 ‚Äî Test/Soak Harness`
* `8.11 ‚Äî –ê–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏`
* `7.4 ‚Äî Structured Logging / Export`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_profiler_start_stop_and_snapshot`
* `test_profiler_memory_allocation_tracking`
* `test_profiler_timeline_event_sequence`
* `test_flamegraph_output_structure`
* `test_profiler_concurrent_sessions`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **7.2 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry, Prometheus –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 7.2 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry, Prometheus –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

**–ü–∞–∫–µ—Ç:** `7. Observability –∏ DevOps`
**Block ID:** `opentelemetry_prometheus_tracing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏**: **Prometheus**, **OpenTelemetry**, **Jaeger**, **Zipkin**, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫, –ª–æ–≥–æ–≤, —Å–ø–∞–Ω–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤, SQL-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, —Å–µ—Ç–µ–≤—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä—ã, sampling, span-–∫–æ–º–ø–æ–∑–∏—Ü–∏—é, —Ç–µ–≥–∏, trace-id propagation –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------ | ---------- |
| `telemetry_export_prometheus` | `void telemetry_export_prometheus(void);`                                           | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus. | `void`     |
| `telemetry_trace_start`       | `trace_span_t *telemetry_trace_start(const char *operation);`                       | –ù–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—ã–π —Å–ø–∞–Ω.                       | –°–ø–∞–Ω       |
| `telemetry_trace_end`         | `void telemetry_trace_end(trace_span_t *span);`                                     | –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å–ø–∞–Ω.                    | `void`     |
| `telemetry_trace_tag`         | `void telemetry_trace_tag(trace_span_t *span, const char *key, const char *value);` | –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–≥ –≤ —Å–ø–∞–Ω.                      | `void`     |
| `telemetry_attach_context`    | `void telemetry_attach_context(tx_ctx_t *tx, trace_span_t *span);`                  | –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.      | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[32];
  char operation[64];
  uint64_t start_ns;
  uint64_t end_ns;
  json_t *tags;
} trace_span_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `otel_spans_started_total{operation}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞—á–∞—Ç—ã—Ö —Å–ø–∞–Ω–æ–≤
* `otel_spans_duration_ns{operation}` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ø–∞–Ω–æ–≤
* `prometheus_metrics_exposed_total` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –º–µ—Ç—Ä–∏–∫
* `trace_propagation_failures` ‚Äî –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ trace context

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è trace –ø–æ —Ä–æ–ª—è–º –∏ –ø–æ–ª–∏—Ç–∏–∫–µ
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ sampling / rate limits
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å secured endpoints (TLS)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `7.1 ‚Äî Profiler Engine`
* `3.12 ‚Äî SQL Executor`
* `6.1 ‚Äî RBAC / ACL`
* `4.2 ‚Äî REST –∏ GraphQL API`
* `7.4 ‚Äî Logging Subsystem`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_trace_span_creation_and_tagging`
* `test_trace_export_to_jaeger_format`
* `test_prometheus_metrics_http_output`
* `test_trace_context_propagation_across_layers`
* `test_trace_sampling_limits_and filters`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **7.3 ‚Äî –°–ª–æ–π structured logging –∏ —ç–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ (JSON / Binary / syslog)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 7.3 ‚Äî –°–ª–æ–π structured logging –∏ —ç–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ (JSON / Binary / syslog)

**–ü–∞–∫–µ—Ç:** `7. Observability –∏ DevOps`
**Block ID:** `structured_logging_layer`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç—ã **JSON**, **–±–∏–Ω–∞—Ä–Ω—ã–π**, **syslog**, **stderr**, –∞ —Ç–∞–∫–∂–µ —ç–∫—Å–ø–æ—Ä—Ç –≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, journald, Loki, Fluentbit). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ (`INFO`, `WARN`, `ERROR`, `DEBUG`), –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω–æ—Å—Ç—å, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –º–æ–¥—É–ª—é, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–ª—è –∏ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------ | ------------------------------------------------------------------------ | --------------------------------------------- | ---------- |
| `log_init`   | `bool log_init(log_config_t *cfg);`                                      | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ª–æ–≥-—Å–∏—Å—Ç–µ–º—É.                   | `true`     |
| `log_event`  | `void log_event(const char *op, uint64_t time_ns, size_t size);`         | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.           | `void`     |
| `log_json`   | `void log_json(const char *level, const char *component, json_t *data);` | –õ–æ–≥–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.            | `void`     |
| `log_binary` | `void log_binary(const log_record_t *rec);`                              | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π –ª–æ–≥.                      | `void`     |
| `log_flush`  | `void log_flush(void);`                                                  | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –ª–æ–≥–æ–≤ –Ω–∞ –¥–∏—Å–∫ –∏–ª–∏ —Å–æ–∫–µ—Ç. | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool enable_json;
  bool enable_binary;
  bool enable_syslog;
  char file_path[256];
  char syslog_tag[64];
  int level;
} log_config_t;

typedef struct {
  uint64_t timestamp;
  char level[8];
  char module[32];
  char message[256];
  uint32_t thread_id;
} log_record_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `log_events_total{level,module}` ‚Äî —á–∏—Å–ª–æ –ª–æ–≥–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—é
* `log_write_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏ –ª–æ–≥–∞
* `log_queue_size` ‚Äî —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –ª–æ–≥–æ–≤
* `log_flush_operations_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–±—Ä–æ—Å–æ–≤ –Ω–∞ –¥–∏—Å–∫

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ)
* –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –º–æ–¥—É–ª—è–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ trusted mode –∏ write-only –ª–æ–≥–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `7.1 ‚Äî Profiler`
* `6.5 ‚Äî Access Policy Audit`
* `2.3 ‚Äî WAL Engine`
* `3.12 ‚Äî SQL Executor`
* `8.9 ‚Äî Syslog Integration`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_log_init_and_modes`
* `test_log_event_latency_accuracy`
* `test_log_json_structure_integrity`
* `test_log_binary_format_and replayability`
* `test_log_level_filtering_and flush`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **7.4 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –∞–ª–µ—Ä—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Alertmanager —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 7.4 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –∞–ª–µ—Ä—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Alertmanager —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)

**–ü–∞–∫–µ—Ç:** `7. Observability –∏ DevOps`
**Block ID:** `alerting_monitoring_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–ª–µ—Ä—Ç–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**, —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å **Prometheus Alertmanager**, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã, –ø–æ—Ä–æ–≥–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å webhook/Slack/email. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å–æ–±—ã—Ç–∏—è, –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —É—Å–ª–æ–≤–∏—è, –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è (notify, suppress, escalate).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------- | ----------------------------------------------------------- | ------------------------------------- | ---------- |
| `alert_rule_register`  | `bool alert_rule_register(const alert_rule_t *rule);`       | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –∞–ª–µ—Ä—Ç–∞.          | `true`     |
| `alert_evaluate`       | `void alert_evaluate(const telemetry_snapshot_t *metrics);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª.       | `void`     |
| `alert_dispatch_event` | `void alert_dispatch_event(const alert_event_t *event);`    | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∞–ª–µ—Ä—Ç —á–µ—Ä–µ–∑ webhook/email. | `void`     |
| `alert_rule_list`      | `json_t *alert_rule_list(void);`                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª.             | JSON       |
| `alert_silence`        | `bool alert_silence(const char *rule_id, duration_t dur);`  | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞.         | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[64];
  char expression[256]; // e.g. memory_usage_bytes > 1GB
  char severity[16];
  char action[64]; // notify_slack, webhook, email
  bool enabled;
} alert_rule_t;

typedef struct {
  char rule_id[64];
  char message[256];
  char status[16]; // firing, resolved
  uint64_t timestamp;
} alert_event_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `alerts_firing_total{severity}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤
* `alert_evaluation_duration_ns` ‚Äî –≤—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ª–æ–≤–∏–π
* `alert_dispatch_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
* `alerts_silenced_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–ª–µ—Ä—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∞–≤–∏–ª–∞–º (RBAC)
* –ü–æ–¥–ø–∏—Å—å webhook-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
* –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ (rate limit, debounce, jitter)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `7.2 ‚Äî Telemetry / Prometheus`
* `6.1 ‚Äî RBAC Engine`
* `4.6 ‚Äî Webhooks / Email Sender`
* `7.3 ‚Äî Structured Logging`
* `8.10 ‚Äî Timer / Cron Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_alert_rule_registration_and_eval`
* `test_alert_condition_triggering`
* `test_alert_silence_and_restore`
* `test_alert_dispatch_to_webhook_mock`
* `test_alert_expression_parsing_errors`

---

‚úÖ –ü–∞–∫–µ—Ç **7. Observability –∏ DevOps** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **8.1 ‚Äî –í–µ–∫—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ pipeline-–∞–≥—Ä–µ–≥–∞—Ü–∏—è**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.1 ‚Äî –í–µ–∫—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ pipeline-–∞–≥—Ä–µ–≥–∞—Ü–∏—è

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `vectorized_pipeline_execution`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤–µ–∫—Ç–æ—Ä–Ω–æ–µ (columnar) –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –∏ **pipeline-–∞–≥—Ä–µ–≥–∞—Ü–∏—é** –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ —Å–º–µ—à–∞–Ω–Ω—ã—Ö HTAP-–Ω–∞–≥—Ä—É–∑–∫–∞—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å—Ç—Ä–æ–∫, —Å–ª–∏—è–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (`fusion`), –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–Ω—ã–µ –ø–∞–π–ø–ª–∞–π–Ω—ã (`map ‚Üí filter ‚Üí agg`).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| ----------------------------- | --------------------------------------------------------------------------------------------- | ----------------------------------- | ----------- |
| `vector_exec_pipeline`        | `rowset_t *vector_exec_pipeline(const pipeline_plan_t *plan);`                                | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π pipeline.       | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |
| `vector_filter_apply`         | `uint64_t vector_filter_apply(const column_batch_t *batch, const filter_expr_t *expr);`       | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä.         | –ú–∞—Å–∫–∞       |
| `vector_aggregate_execute`    | `agg_result_t *vector_aggregate_execute(const batch_t *batch, const agg_plan_t *plan);`       | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –±–∞—Ç—á—É.        | –†–µ–∑—É–ª—å—Ç–∞—Ç   |
| `vector_batch_from_table`     | `column_batch_t *vector_batch_from_table(const table_t *table, size_t offset, size_t limit);` | –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–ª–æ–Ω–Ω—ã –≤ –±–∞—Ç—á–µ.          | –ö–æ–ª–æ–Ω–Ω—ã     |
| `vector_exec_fusion_optimize` | `bool vector_exec_fusion_optimize(pipeline_plan_t *plan);`                                    | –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç pipeline —á–µ—Ä–µ–∑ fusion. | `true`      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  column_t **columns;
  size_t column_count;
  size_t row_count;
} column_batch_t;

typedef struct {
  operator_t *stages;
  size_t stage_count;
} pipeline_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `vector_exec_time_ns{stage}` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–∞
* `vector_batch_size_avg` ‚Äî —Å—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
* `vector_simd_utilization` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SIMD
* `vector_pipeline_fusion_count` ‚Äî —á–∏—Å–ª–æ fusion-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç SIMD-–∏–Ω—ä–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ runtime alignment
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–ª–æ–Ω–∫–∞–º (CLS) –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö memcpy / vector-lib —Ñ—É–Ω–∫—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.1 ‚Äî Columnar Storage Engine`
* `5.2 ‚Äî Aggregation Engine`
* `3.12 ‚Äî SQL Executor`
* `8.14 ‚Äî SIMD runtime`
* `7.1 ‚Äî Profiler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_vector_pipeline_basic_execution`
* `test_vector_filter_pushdown_and_eval`
* `test_vector_agg_pipeline_sum_avg`
* `test_vector_batch_scan_and layout`
* `test_vector_exec_fusion_optimizer`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.2 ‚Äî –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–∂–æ–∏–Ω—ã –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.2 ‚Äî –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–∂–æ–∏–Ω—ã –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `adaptive_join_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (join)** —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **hash join**, **merge join**, **index-nested loop join**, **grace hash join**, –∞ —Ç–∞–∫–∂–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Ä–∞–Ω—Ç–∞–π–º-–∞–Ω–∞–ª–∏–∑–∞. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥–∏–∫–∞—Ç–∏–≤–Ω—ã–π pushdown, reuse –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| ---------------------------- | --------------------------------------------------------------------------------------------------- | ----------------------------------------- | ------------ |
| `join_plan_select_algorithm` | `join_algorithm_t join_plan_select_algorithm(const join_stats_t *stats);`                           | –í—ã–±–∏—Ä–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.             | –ê–ª–≥–æ—Ä–∏—Ç–º     |
| `join_execute`               | `rowset_t *join_execute(const join_plan_t *plan);`                                                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–ª–∞–Ω—É. | –†–µ–∑—É–ª—å—Ç–∞—Ç    |
| `join_build_hash_table`      | `hash_table_t *join_build_hash_table(const rowset_t *input, const join_key_t *key);`                | –°—Ç—Ä–æ–∏—Ç —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É –¥–ª—è hash join.         | Hash-—Ç–∞–±–ª–∏—Ü–∞ |
| `join_merge_streams`         | `rowset_t *join_merge_streams(const rowset_t *left, const rowset_t *right, const join_key_t *key);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç merge join.                     | –†–µ–∑—É–ª—å—Ç–∞—Ç    |
| `join_runtime_switch`        | `bool join_runtime_switch(join_plan_t *plan, const join_stats_t *updated);`                         | –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –Ω–∞ –ª–µ—Ç—É.            | `true`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  JOIN_HASH,
  JOIN_MERGE,
  JOIN_NESTED_LOOP,
  JOIN_GRACE_HASH
} join_algorithm_t;

typedef struct {
  size_t left_rows;
  size_t right_rows;
  double selectivity;
  bool left_indexed;
  bool right_indexed;
} join_stats_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `join_algorithm_selected_total{type}` ‚Äî –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞
* `join_execution_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è join
* `join_selectivity_observed_avg` ‚Äî —Å—Ä–µ–¥–Ω—è—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
* `join_runtime_switches_total` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤ —Ä–∞–Ω—Ç–∞–π–º–µ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å—Ö–µ–º
* –ó–∞—â–∏—Ç–∞ –æ—Ç DoS –ø—Ä–∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—è—Ö
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ–µ–¥–∏–Ω—è–µ–º—ã–º —Ç–∞–±–ª–∏—Ü–∞–º (RLS/CLS)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `1.8 ‚Äî –ò–Ω–¥–µ–∫—Å—ã (B+Tree / Hash)`
* `8.1 ‚Äî –í–µ–∫—Ç–æ—Ä–Ω—ã–π –¥–≤–∏–∂–æ–∫`
* `5.2 ‚Äî Aggregation Engine`
* `7.1 ‚Äî Profiler`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_join_hash_vs_merge_vs_loop_selection`
* `test_join_hash_build_and_probe`
* `test_join_merge_sort_ordering`
* `test_join_runtime_switch_with_threshold`
* `test_join_with_rls_and_index_constraints`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.3 ‚Äî –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –∏ re-optimization –Ω–∞ –ª–µ—Ç—É** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.3 ‚Äî –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –∏ re-optimization –Ω–∞ –ª–µ—Ç—É

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `plan_cache_reoptimizer`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤** –∏ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–Ω–µ–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã (`plan reuse`), –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫ –Ω–æ–≤—ã–º –¥–∞–Ω–Ω—ã–º, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –Ω–∞ –±–æ–ª–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–ª–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤ –∏ –≤—Ö–æ–¥–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ----------------------------------------------------------------------------------- | ----------------------------------- | ---------- |
| `plan_cache_lookup`         | `exec_plan_t *plan_cache_lookup(const sql_digest_t *digest);`                       | –ü–æ–∏—Å–∫ –ø–ª–∞–Ω–∞ –≤ –∫—ç—à–µ.                 | –ü–ª–∞–Ω       |
| `plan_cache_store`          | `bool plan_cache_store(const sql_digest_t *digest, const exec_plan_t *plan);`       | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–ª–∞–Ω –≤ –∫—ç—à.               | `true`     |
| `plan_evaluate_runtime`     | `bool plan_evaluate_runtime(exec_plan_t *plan, const runtime_feedback_t *fb);`      | –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞.      | `true`     |
| `plan_reoptimize_if_needed` | `bool plan_reoptimize_if_needed(exec_plan_t **plan, const runtime_feedback_t *fb);` | –ü–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. | `true`     |
| `plan_cache_invalidate`     | `void plan_cache_invalidate(const sql_digest_t *digest);`                           | –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.    | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char sql_text[1024];
  uint64_t hash;
} sql_digest_t;

typedef struct {
  double rows_processed;
  double time_ns;
  double selectivity;
} runtime_feedback_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `plan_cache_hits_total` ‚Äî —á–∏—Å–ª–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à
* `plan_cache_misses_total` ‚Äî —á–∏—Å–ª–æ –ø—Ä–æ–º–∞—Ö–æ–≤
* `plan_reoptimize_total` ‚Äî —á–∏—Å–ª–æ –ø–µ—Ä–µ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π
* `plan_invalidated_total` ‚Äî —á–∏—Å–ª–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –ø–ª–∞–Ω–æ–≤ –ø–æ —Å–µ—Å—Å–∏—è–º/—Ä–æ–ª–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
* –ü–æ–¥–ø–∏—Å—å digest –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–ª–∞–Ω–∞ –ø—Ä–∏ RLS/CLS –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.7 ‚Äî SQL Planner`
* `3.8 ‚Äî Cost-Based Optimizer`
* `3.12 ‚Äî SQL Executor`
* `8.2 ‚Äî Join Engine`
* `7.1 ‚Äî Profiler / Timeline`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_plan_cache_lookup_and_store`
* `test_plan_runtime_feedback_trigger`
* `test_plan_reoptimization_accuracy`
* `test_plan_invalidation_on_schema_change`
* `test_plan_cache_isolation_per_role`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.4 ‚Äî –§–æ—Ä–º–∞—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (Parquet, Arrow-aware)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.4 ‚Äî –§–æ—Ä–º–∞—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ (Parquet, Arrow-aware)

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `format_aware_execution_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É—á–µ—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**: **Parquet**, **Apache Arrow**, **ORC**, **columnar row groups**, –≤–∫–ª—é—á–∞—è zero-copy –ø–∞—Ä—Å–∏–Ω–≥, predicate pushdown –∏ –ø—Ä—è–º–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–æ–Ω–∫–∞—Ö –±–µ–∑ –ø–æ–ª–Ω–æ–π –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –∞–≥—Ä–µ–≥–∞—Ü–∏—é –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–¥ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ materialization.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç  |
| ------------------------------- | ------------------------------------------------------------------------------------------------ | ---------------------------------------------- | ----------- |
| `format_exec_parquet_scan`      | `rowset_t *format_exec_parquet_scan(const char *path, const filter_t *filter);`                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ Parquet-—Ñ–∞–π–ª—É.       | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |
| `format_exec_arrow_scan`        | `rowset_t *format_exec_arrow_scan(const uint8_t *buffer, size_t size, const filter_t *filter);`  | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Arrow-–¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏. | –ù–∞–±–æ—Ä —Å—Ç—Ä–æ–∫ |
| `format_column_filter_pushdown` | `bool format_column_filter_pushdown(format_block_t *block, const filter_t *filter);`             | –ü—Ä–∏–º–µ–Ω—è–µ—Ç pushdown-—Ñ–∏–ª—å—Ç—Ä.                     | `true`      |
| `format_exec_batch_extract`     | `column_batch_t *format_exec_batch_extract(format_block_t *block, size_t offset, size_t limit);` | –ò–∑–≤–ª–µ–∫–∞–µ—Ç –±–∞—Ç—á –±–µ–∑ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏.               | –ö–æ–ª–æ–Ω–∫–∏     |
| `format_exec_decode_value`      | `value_t format_exec_decode_value(const uint8_t *data, format_type_t type);`                     | –î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.                 | –ó–Ω–∞—á–µ–Ω–∏–µ    |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  FORMAT_PARQUET,
  FORMAT_ARROW,
  FORMAT_ORC
} format_type_t;

typedef struct {
  format_type_t type;
  const uint8_t *raw;
  size_t size;
  column_meta_t *columns;
  size_t column_count;
} format_block_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `format_exec_time_ns{type}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* `format_filter_pushdown_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
* `format_zero_copy_reads_total` ‚Äî zero-copy —á—Ç–µ–Ω–∏–π
* `format_block_scan_bytes` ‚Äî –æ–±—â–∏–π –æ–±—ä–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
* –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –±–∞–π—Ç–æ–≤ (sandbox IO)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–ª–æ–Ω–æ–∫ –∏ –ø–æ–ª–µ–π (CLS)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.18 ‚Äî Columnar Layout`
* `8.1 ‚Äî Vectorized Execution`
* `5.1 ‚Äî Column Store`
* `3.12 ‚Äî SQL Executor`
* `19.2 ‚Äî –§–æ—Ä–º–∞—Ç—ã Parquet/Arrow/ORC`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_format_parquet_scan_with_filter`
* `test_arrow_scan_and_column_projection`
* `test_format_filter_pushdown_effectiveness`
* `test_batch_extraction_no_materialization`
* `test_format_decode_value_edge_cases`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.5 ‚Äî SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ —è–¥—Ä–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.5 ‚Äî SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ —è–¥—Ä–µ

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `simd_parallel_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (SIMD)** –∏ **–º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞ –°–£–ë–î. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ **AVX2**, **AVX-512**, **SSE4**, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (pthreads, lock-free —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, task pools). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∞–≥—Ä–µ–≥–∞—Ç–æ–≤, –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤, —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø–∞—Ä—Å–∏–Ω–≥–∞, –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏, –∞ —Ç–∞–∫–∂–µ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ —Å–∫–∞–Ω–æ–≤, join, —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫ –∏ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------------------------------------------- | --------------------------------------- | ---------- |
| `simd_filter_vector`     | `uint64_t simd_filter_vector(const column_t *col, const filter_expr_t *expr);`                       | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥–∏–∫–∞—Ç —Å SIMD.              | –ú–∞—Å–∫–∞      |
| `simd_aggregate_batch`   | `bool simd_aggregate_batch(const column_batch_t *batch, const agg_plan_t *plan, agg_result_t *res);` | –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –±–∞—Ç—á –≤ SIMD.                 | `true`     |
| `parallel_execute_task`  | `bool parallel_execute_task(task_fn_t fn, void *ctx);`                                               | –ó–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ thread-pool.         | `true`     |
| `parallel_scan_table`    | `rowset_t *parallel_scan_table(const table_t *table, const filter_t *filter);`                       | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã.      | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `simd_decompress_column` | `bool simd_decompress_column(column_t *col, encoding_t enc);`                                        | –î–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –∫–æ–ª–æ–Ω–∫–∏ SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  column_t **columns;
  size_t column_count;
  size_t row_count;
} column_batch_t;

typedef bool (*task_fn_t)(void *);
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `simd_instructions_used_total` ‚Äî —á–∏—Å–ª–æ SIMD-–æ–ø–µ—Ä–∞—Ü–∏–π
* `parallel_tasks_executed_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
* `simd_filter_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ SIMD-—Ñ–∏–ª—å—Ç—Ä–∞
* `parallel_scan_threads_avg` ‚Äî —á–∏—Å–ª–æ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤ SIMD (alignment)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ shared memory
* –ó–∞—â–∏—Ç–∞ –æ—Ç race-condition –∏ deadlock —á–µ—Ä–µ–∑ lock-free design

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.1 ‚Äî Vectorized Execution`
* `8.14 ‚Äî SIMD runtime`
* `8.11 ‚Äî Memory Allocator`
* `2.3 ‚Äî WAL Writer (multithread)`
* `7.1 ‚Äî Profiler Engine`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_simd_filter_correctness_vs_scalar`
* `test_simd_aggregate_vs_reference`
* `test_parallel_task_execution_and_sync`
* `test_parallel_table_scan_consistency`
* `test_simd_decompression_speedup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.6 ‚Äî Zero-copy snapshot –∏ clone —Ç–∞–±–ª–∏—Ü** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.6 ‚Äî Zero-copy snapshot –∏ clone —Ç–∞–±–ª–∏—Ü

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `zero_copy_snapshot_clone`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤ (snapshot)** –∏ **–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü (clone)** –±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **zero-copy**, **copy-on-write (COW)** –∏ **immutable snapshot chains**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–ø–∏–∏ —Ç–∞–±–ª–∏—Ü, —Å—Ö–µ–º –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, —Ç–µ—Å—Ç–∞—Ö, —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ –æ—Ç–∫–∞—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –±–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------- | ------------------------------------------------------------------ | -------------------------------------- | ---------- |
| `snapshot_create`      | `snapshot_t *snapshot_create(const db_t *db);`                     | –°–æ–∑–¥–∞—ë—Ç snapshot –≤—Å–µ–π –ë–î.              | Snapshot   |
| `snapshot_table_clone` | `table_t *snapshot_table_clone(const table_t *src);`               | –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –±–µ–∑ –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö.    | –¢–∞–±–ª–∏—Ü–∞    |
| `snapshot_restore`     | `bool snapshot_restore(const snapshot_t *snap);`                   | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.             | `true`     |
| `snapshot_diff`        | `json_t *snapshot_diff(const snapshot_t *a, const snapshot_t *b);` | –í—ã—á–∏—Å–ª—è–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É snapshot-–∞–º–∏. | JSON       |
| `snapshot_free`        | `void snapshot_free(snapshot_t *snap);`                            | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç snapshot.                  | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[64];
  timestamp_t created_at;
  db_state_ref_t *state;
  bool is_immutable;
} snapshot_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `snapshot_count_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö snapshot-–æ–≤
* `snapshot_creation_latency_ns` ‚Äî –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è snapshot
* `clone_table_memory_bytes_saved` ‚Äî –æ–±—ä—ë–º —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
* `snapshot_diff_evaluation_ns` ‚Äî –≤—Ä–µ–º—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è snapshot-–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* Snapshot —Ç–æ–ª—å–∫–æ –≤ read-only —Å–µ—Å—Å–∏—è—Ö
* –ü–æ–¥–ø–∏—Å—å snapshot-–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∏—Ö –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º (ACL)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.4 ‚Äî Snapshot Engine`
* `2.2 ‚Äî MVCC Chains`
* `1.10 ‚Äî Table Engine`
* `8.11 ‚Äî Memory Manager`
* `10.5 ‚Äî Regression Test Snapshot`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_snapshot_create_and_restore`
* `test_zero_copy_clone_consistency`
* `test_snapshot_diff_precision`
* `test_clone_table_writable_view`
* `test_snapshot_cleanup_and_reuse`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.7 ‚Äî –†–µ–∂–∏–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (Critical <500–Ω—Å)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.7 ‚Äî –†–µ–∂–∏–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ (Critical <500–Ω—Å)

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `critical_latency_mode`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **—Ä–µ–∂–∏–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π**, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π –Ω–∞ <500 –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ fast-path –∫–æ–¥—ã, –ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏, –æ—Ç–∫–∞–∑ –æ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–π, inlined-–≤—ã—á–∏—Å–ª–µ–Ω–∏—è, NUMA-–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ layout-—ã –∏ –Ω—É–ª–µ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ hot-—Ç–∞–±–ª–∏—Ü–∞—Ö, –∏–Ω–¥–µ–∫—Å–∞—Ö, —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | -------------------------------------------------------- | ----------------------------- | ---------- |
| `latency_mode_enter`        | `void latency_mode_enter(void);`                         | –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º. | `void`     |
| `latency_mode_exit`         | `void latency_mode_exit(void);`                          | –î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º.           | `void`     |
| `latency_exec_fast_path`    | `inline value_t latency_exec_fast_path(const op_t *op);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç inlined-–æ–ø–µ—Ä–∞—Ç–æ—Ä.   | –ó–Ω–∞—á–µ–Ω–∏–µ   |
| `latency_preallocate_slot`  | `void *latency_preallocate_slot(size_t size);`           | –ü—Ä–µ–¥–≤—ã–¥–µ–ª—è–µ—Ç —Å–ª–æ—Ç –±–µ–∑ malloc. | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `latency_mode_profile_tick` | `void latency_mode_profile_tick(uint64_t tick);`         | –û—Ç–º–µ—á–∞–µ—Ç —Ç–∞–∫—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è. | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool active;
  void *fast_arena;
  uint64_t current_tick;
} latency_mode_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `critical_latency_exec_ns{op}` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
* `latency_mode_active_sessions` ‚Äî —á–∏—Å–ª–æ —Å–µ—Å—Å–∏–π –≤ —Ä–µ–∂–∏–º–µ
* `fast_path_op_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ inlined-–æ–ø–µ—Ä–∞—Ü–∏–π
* `latency_arena_alloc_bytes` ‚Äî –æ–±—ä–µ–º –ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢–æ–ª—å–∫–æ –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
* –ù–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–Ω–µ—à–Ω—è—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–ª–∏ UDF
* –í—ã–¥–µ–ª–µ–Ω–Ω—ã–µ NUMA-core affinity / CPU-pinning

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.1 ‚Äî Vectorized Execution`
* `8.5 ‚Äî SIMD & Threading`
* `7.1 ‚Äî Profiler`
* `10.6 ‚Äî Critical Path Testing`
* `1.16 ‚Äî Memory Scaling (NUMA)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_latency_mode_entry_and_exit`
* `test_latency_fast_path_exec_under_500ns`
* `test_latency_slot_preallocation_alignment`
* `test_latency_mode_tick_accuracy`
* `test_latency_mode_conflict_with_normal_mode`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.8 ‚Äî Watchdog, limit-–∏ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.8 ‚Äî Watchdog, limit-–∏ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `watchdog_resource_guard`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º Watchdog-–∞ –∏ –ª–∏–º–∏—Ç–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤** –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫, –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU, –ø–∞–º—è—Ç–∏, IOPS. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å–µ—Å—Å–∏—è–º, –∑–∞–ø—Ä–æ—Å–∞–º, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ —Ä–æ–ª—è–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ runaway-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã, timebox execution, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Ç—è–∂–µ–ª—ã—Ö –ø–ª–∞–Ω–æ–≤ –¥–æ –∏—Ö –∑–∞–ø—É—Å–∫–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | ---------------------------------------------------------------------------------------------- | --------------------------------- | ---------- |
| `watchdog_start_session`  | `bool watchdog_start_session(const session_t *session);`                                       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Å—Å–∏–∏. | `true`     |
| `watchdog_track_resource` | `void watchdog_track_resource(const session_t *session, resource_type_t type, size_t amount);` | –£—á–∏—Ç—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞.  | `void`     |
| `watchdog_check_limits`   | `bool watchdog_check_limits(const session_t *session);`                                        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤.     | `true`     |
| `watchdog_kill_session`   | `void watchdog_kill_session(const session_t *session, const char *reason);`                    | –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.             | `void`     |
| `watchdog_adjust_limits`  | `bool watchdog_adjust_limits(const char *role, const limit_policy_t *policy);`                 | –ò–∑–º–µ–Ω—è–µ—Ç –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–æ–ª–∏.         | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  RESOURCE_CPU,
  RESOURCE_MEMORY,
  RESOURCE_IOPS,
  RESOURCE_TIME
} resource_type_t;

typedef struct {
  size_t max_cpu_ns;
  size_t max_memory_bytes;
  size_t max_iops;
  size_t max_exec_time_ns;
} limit_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `watchdog_violations_total{type}` ‚Äî —á–∏—Å–ª–æ –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ —Ä–µ—Å—É—Ä—Å—É
* `watchdog_sessions_terminated_total` ‚Äî –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
* `watchdog_resource_usage_avg` ‚Äî —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —Å–µ—Å—Å–∏—è–º
* `watchdog_limit_adjustment_events` ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ä–æ–ª–∏ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –ª–∏–º–∏—Ç—ã
* –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
* –ó–∞—â–∏—Ç–∞ —è–¥—Ä–∞ –æ—Ç —Å–∞–º–æ—Ç–µ—Ä–º–∏–Ω–∞—Ü–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.1 ‚Äî RBAC / ABAC`
* `7.2 ‚Äî Metrics & Telemetry`
* `8.7 ‚Äî Critical Latency Mode`
* `2.2 ‚Äî Transaction Manager`
* `10.4 ‚Äî Test Harness for Watchdog`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_watchdog_track_and_kill_cpu_limit`
* `test_watchdog_memory_exhaustion_control`
* `test_watchdog_iops_limit_under_load`
* `test_watchdog_time_limit_interrupt`
* `test_watchdog_policy_reload_and_apply`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.9 ‚Äî –ú–∏–∫—Ä–æ—è–¥–µ—Ä–Ω—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–∏–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.9 ‚Äî –ú–∏–∫—Ä–æ—è–¥–µ—Ä–Ω—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏ –∏ –ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–∏–µ

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `microkernel_memory_allocator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—è–¥–µ—Ä–Ω—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏**, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ in-memory –Ω–∞–≥—Ä—É–∑–∫—É, NUMA, hot-path –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞—Ç—á–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–∏–µ** (preallocation), **arena-based** –∏ **bump-pointer** —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, thread-local –ø—É–ª—ã, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞—â–∏—Ç—É –æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏, –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ —Å–µ—Å—Å–∏—è–º –∏ –ø–ª–∞–Ω–∞–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | ---------------------------------------------------------- | --------------------------------------- | ---------- |
| `mem_arena_create`  | `mem_arena_t *mem_arena_create(size_t size);`              | –°–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥–≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –∞—Ä–µ–Ω—É.           | –ê—Ä–µ–Ω–∞      |
| `mem_alloc_fast`    | `void *mem_alloc_fast(mem_arena_t *arena, size_t size);`   | –ë—ã—Å—Ç—Ä–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∏–∑ –∞—Ä–µ–Ω—ã.      | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `mem_free_all`      | `void mem_free_all(mem_arena_t *arena);`                   | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –≤—Å–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∞—Ä–µ–Ω—ã. | `void`     |
| `mem_profile_arena` | `mem_stats_t mem_profile_arena(const mem_arena_t *arena);` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.    | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `mem_arena_destroy` | `void mem_arena_destroy(mem_arena_t *arena);`              | –£–Ω–∏—á—Ç–æ–∂–∞–µ—Ç –∞—Ä–µ–Ω—É –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å.  | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void *base;
  size_t size;
  size_t used;
  bool numa_bound;
} mem_arena_t;

typedef struct {
  size_t total;
  size_t used;
  size_t free;
  size_t fragmentation_percent;
} mem_stats_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `memory_arena_usage_bytes{session}` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –∞—Ä–µ–Ω–æ–π
* `memory_alloc_latency_ns` ‚Äî –≤—Ä–µ–º—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
* `memory_fragmentation_percent` ‚Äî —É—Ä–æ–≤–µ–Ω—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
* `memory_preallocation_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã–µ prealloc

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* NUMA-affinity –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç out-of-bound –¥–æ—Å—Ç—É–ø–∞
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏ –∞—Ä–µ–Ω –ø–æ —Å–µ—Å—Å–∏—è–º –∏ –ø–ª–∞–Ω–∞–º
* –ê—É–¥–∏—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–π, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.5 ‚Äî SIMD & Threading`
* `1.16 ‚Äî NUMA-Aware Layout`
* `7.1 ‚Äî Profiler`
* `10.2 ‚Äî Stress & Leak Tests`
* `2.2 ‚Äî MVCC Chains (arena reuse)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_mem_arena_creation_and_allocation`
* `test_mem_alloc_fast_path_speed`
* `test_mem_profile_arena_accuracy`
* `test_mem_arena_thread_local_safety`
* `test_mem_arena_fragmentation_control`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.10 ‚Äî Timebox execution –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.10 ‚Äî Timebox execution –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `timebox_execution_limiter`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π** ‚Äî **Timebox Execution**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å –ª–∏–º–∏—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ (soft/hard), –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ, —Ç–∞–π–º–∞—É—Ç—ã, fallback, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç            |
| -------------------------- | ------------------------------------------------------------ | --------------------------------- | --------------------- |
| `timebox_set_limit`        | `void timebox_set_limit(session_t *s, uint64_t ns_limit);`   | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏.      | `void`                |
| `timebox_check`            | `bool timebox_check(session_t *s);`                          | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞.      | `true` –∏–ª–∏ `false`    |
| `timebox_enter_scope`      | `void timebox_enter_scope(session_t *s, const char *label);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–∏.     | `void`                |
| `timebox_exit_scope`       | `void timebox_exit_scope(session_t *s);`                     | –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é.       | `void`                |
| `timebox_abort_if_expired` | `bool timebox_abort_if_expired(session_t *s);`               | –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —Ç–∞–π–º–∞—É—Ç—É. | `true` –µ—Å–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t start_ns;
  uint64_t deadline_ns;
  char current_scope[64];
  bool expired;
} timebox_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `timebox_violations_total{scope}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π
* `timebox_avg_execution_ns{scope}` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* `timebox_scope_duration_ns` ‚Äî —Ç–µ–∫—É—â–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* `timebox_aborted_queries_total` ‚Äî –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞–ø—Ä–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∏—è timebox –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ —Ä–æ–ª—è–º/–æ–ø–µ—Ä–∞—Ü–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, SELECT < X ms)
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏ fallback-–ø–æ–≤–µ–¥–µ–Ω–∏–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.8 ‚Äî Watchdog`
* `3.12 ‚Äî SQL Executor`
* `6.1 ‚Äî Access Policies`
* `7.1 ‚Äî Profiler`
* `10.4 ‚Äî –¢–∞–π–º-–∞—É—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_timebox_limit_exceeded`
* `test_timebox_scope_nested_control`
* `test_timebox_abort_behavior`
* `test_timebox_metrics_reporting`
* `test_timebox_context_switch_safety`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.11 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –∏ NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.11 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –∏ NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `numa_memory_allocator`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **NUMA-aware –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **–ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–ª–∞—Å—Ç—è–º–∏ –ø–∞–º—è—Ç–∏** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π —É–∑–ª–æ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç NUMA-pinning, –º–µ–∂—É–∑–ª–æ–≤–æ–π rebalancing, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä—è—á–∏–º–∏ –∏ —Ö–æ–ª–æ–¥–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∫—É huge pages –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∞—Ä–µ–Ω–¥.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | -------------------------------------------------- | ------------------------------------------- | ---------- |
| `numa_alloc_local`   | `void *numa_alloc_local(size_t size);`             | –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º NUMA-—É–∑–ª–µ.      | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `numa_alloc_node`    | `void *numa_alloc_node(size_t size, int node_id);` | –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —É–∑–ª–µ.            | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `numa_bind_thread`   | `bool numa_bind_thread(int node_id);`              | –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ—Ç–æ–∫ –∫ NUMA-—É–∑–ª—É.              | `true`     |
| `numa_page_classify` | `int numa_page_classify(const void *ptr);`         | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø (–≥–æ—Ä—è—á–∞—è/—Ö–æ–ª–æ–¥–Ω–∞—è) —Å—Ç—Ä–∞–Ω–∏—Ü—ã. | –ö–ª–∞—Å—Å      |
| `numa_stats_collect` | `json_t *numa_stats_collect(void);`                | –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ NUMA-—Ä–∞–∑–º–µ—â–µ–Ω–∏—è.            | JSON       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  NUMA_CLASS_HOT,
  NUMA_CLASS_COLD,
  NUMA_CLASS_BALANCED
} numa_page_class_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `numa_allocations_total{node}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–¥–µ–ª–µ–Ω–∏–π –ø–æ NUMA-—É–∑–ª–∞–º
* `numa_hot_pages_ratio` ‚Äî –¥–æ–ª—è –≥–æ—Ä—è—á–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
* `numa_rebalance_operations_total` ‚Äî —á–∏—Å–ª–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π
* `numa_node_memory_usage_bytes` ‚Äî –ø–∞–º—è—Ç—å –ø–æ —É–∑–ª–∞–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ —Ç–æ–ª—å–∫–æ –≤ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö NUMA-–∑–æ–Ω–∞—Ö
* –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –º–µ–∂—É–∑–ª–æ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–∏–º –∞—Ä–µ–Ω–∞–º –∏ NUMA-–±–ª–æ–∫–∞–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.16 ‚Äî NUMA-aware Architecture`
* `8.9 ‚Äî Memory Arena`
* `7.1 ‚Äî Profiler`
* `2.2 ‚Äî MVCC Chains / Page Ownership`
* `10.2 ‚Äî Soak and Leak Tests`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_numa_local_vs_remote_latency`
* `test_numa_thread_binding_effect`
* `test_numa_classify_page_access_pattern`
* `test_numa_stats_correctness`
* `test_numa_rebalance_performance_gain`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.12 ‚Äî Sandboxed –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Lua / WASM / C UDF** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.12 ‚Äî Sandboxed –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Lua / WASM / C UDF

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `udf_sandbox_runtime`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ sandboxed-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π (UDF/UDAF)**, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ **Lua**, **WASM**, **C/C++**. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—É—é —Å—Ä–µ–¥—É —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –ø–∞–º—è—Ç–∏, –≤—Ä–µ–º–µ–Ω–∏, —Ä–µ—Å—É—Ä—Å–∞–º, API. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, —Ç–∞–π–º-–∞—É—Ç—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤, –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –≤ worker-–ø—Ä–æ—Ü–µ—Å—Å–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | --------------------------------------------------------------------- | ------------------------------------------ | ---------- |
| `udf_sandbox_init`      | `bool udf_sandbox_init(const udf_config_t *cfg);`                     | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç sandbox —Å—Ä–µ–¥—É.              | `true`     |
| `udf_sandbox_exec_lua`  | `value_t udf_sandbox_exec_lua(const char *src, json_t *args);`        | –í—ã–ø–æ–ª–Ω—è–µ—Ç Lua-—Ñ—É–Ω–∫—Ü–∏—é.                     | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `udf_sandbox_exec_wasm` | `value_t udf_sandbox_exec_wasm(const uint8_t *module, json_t *args);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç WASM-–º–æ–¥—É–ª—å.                     | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `udf_sandbox_exec_c`    | `value_t udf_sandbox_exec_c(const udf_c_fn_t fn, json_t *args);`      | –í—ã–ø–æ–ª–Ω—è–µ—Ç C-—Ñ—É–Ω–∫—Ü–∏—é –≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ. | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `udf_sandbox_terminate` | `void udf_sandbox_terminate(const char *session_id);`                 | –ü—Ä–µ—Ä—ã–≤–∞–µ—Ç UDF –ø–æ —Ç–∞–π–º-–∞—É—Ç—É –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—é.  | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  size_t max_instr;
  size_t max_memory;
  uint64_t timeout_ns;
  bool allow_network;
} udf_config_t;

typedef value_t (*udf_c_fn_t)(json_t *args);
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `udf_sandbox_invocations_total{lang}` ‚Äî –≤—ã–∑–æ–≤–æ–≤ UDF –ø–æ —è–∑—ã–∫–∞–º
* `udf_sandbox_violations_total` ‚Äî —á–∏—Å–ª–æ sandbox-–Ω–∞—Ä—É—à–µ–Ω–∏–π
* `udf_sandbox_timeout_total` ‚Äî –≤—ã–∑–æ–≤–æ–≤, –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –ø–æ —Ç–∞–π–º-–∞—É—Ç—É
* `udf_sandbox_exec_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–µ—Å–æ—á–Ω–∏—Ü–∞ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ syscall, —Å–µ—Ç–∏, —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
* –ñ–µ—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç –ø–æ CPU, –ø–∞–º—è—Ç–∏ –∏ –≤—Ä–µ–º–µ–Ω–∏
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞—Ä—É—à–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.6 ‚Äî UDF Access Policies`
* `8.10 ‚Äî Timebox Execution`
* `8.9 ‚Äî Memory Arena`
* `4.9 ‚Äî UDF API`
* `7.3 ‚Äî Structured Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_udf_lua_sandbox_basic`
* `test_udf_wasm_memory_violation`
* `test_udf_c_stack_overflow_protection`
* `test_udf_sandbox_timeout_and_abort`
* `test_udf_arg_pass_and_result_integrity`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.13 ‚Äî –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫—ç—à–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π reuse** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.


–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.13 ‚Äî –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –∫—ç—à–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π reuse

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `expression_cache_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –ø–æ–¥–≤—ã—Ä–∞–∂–µ–Ω–∏–π**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π **reuse** –≤—ã—Ä–∞–∂–µ–Ω–∏–π –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏, –≤–Ω—É—Ç—Ä–∏ batch-–æ–≤ –∏ –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤, –ø—Ä–æ–µ–∫—Ü–∏–π, –∞–≥—Ä–µ–≥–∞—Ç–æ–≤, UDF –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, TTL, eviction, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω reuse –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç         |
| ----------------------- | ---------------------------------------------------------------- | ------------------------------------ | ------------------ |
| `expr_cache_lookup`     | `bool expr_cache_lookup(const expr_t *expr, value_t *out);`      | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –∫—ç—à–µ. | `true` –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω |
| `expr_cache_store`      | `void expr_cache_store(const expr_t *expr, const value_t *val);` | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è.       | `void`             |
| `expr_cache_invalidate` | `void expr_cache_invalidate(const expr_t *expr);`                | –£–¥–∞–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –∫—ç—à–∞.           | `void`             |
| `expr_cache_gc`         | `size_t expr_cache_gc(uint64_t max_age_ns);`                     | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏.           | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö   |
| `expr_cache_stats`      | `json_t *expr_cache_stats(void);`                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∫—ç—à–∞.             | JSON               |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char hash[64]; // –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π digest –≤—ã—Ä–∞–∂–µ–Ω–∏—è
  timestamp_t created_at;
  value_t value;
} expr_cache_entry_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `expr_cache_hits_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à
* `expr_cache_misses_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–º–∞—Ö–æ–≤
* `expr_cache_size_entries` ‚Äî —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
* `expr_cache_evictions_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π
* –ò–∑–æ–ª—è—Ü–∏—è –∫—ç—à–µ–π –ø–æ —Å–µ—Å—Å–∏—è–º, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç UDF –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ race conditions

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.10 ‚Äî Expression Evaluator`
* `8.3 ‚Äî Plan Reoptimizer`
* `5.2 ‚Äî Aggregation Engine`
* `8.12 ‚Äî UDF Sandbox`
* `7.3 ‚Äî Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_expr_cache_lookup_hit_and_miss`
* `test_expr_cache_invalidate_on_change`
* `test_expr_cache_gc_policy_behavior`
* `test_expr_cache_uptime_effectiveness`
* `test_expr_cache_determinism_enforcement`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **8.14 ‚Äî SIMD runtime –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –≤–µ–∫—Ç–æ—Ä–∞–º–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 8.14 ‚Äî SIMD runtime –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –≤–µ–∫—Ç–æ—Ä–∞–º–∏

**–ü–∞–∫–µ—Ç:** `8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å`
**Block ID:** `simd_vector_runtime`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **SIMD runtime** ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –≤–µ–∫—Ç–æ—Ä–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **SSE4.2**, **AVX2**, **AVX-512**. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ, –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É, –∞–≥—Ä–µ–≥–∞—Ç—ã, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø–∞–∫–æ–≤–∫—É/—Ä–∞—Å–ø–∞–∫–æ–≤–∫—É, –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ null-–∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º –¥–≤–∏–∂–∫–µ, –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏, join-–∞—Ö, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –∞–≥—Ä–µ–≥–∞—Ç–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏       | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------- | ----------------------------------------------------- | -------------------------------- | ---------- |
| `simd_cmp_eq`     | `mask_t simd_cmp_eq(const vec_t *a, const vec_t *b);` | –ü–æ–±–∏—Ç–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ. | –ú–∞—Å–∫–∞      |
| `simd_add_vec`    | `vec_t simd_add_vec(const vec_t *a, const vec_t *b);` | –ü–æ–±–∏—Ç–æ–≤–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤.     | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `simd_mask_apply` | `void simd_mask_apply(vec_t *dst, const mask_t *m);`  | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∞—Å–∫—É.                 | `void`     |
| `simd_nullify`    | `void simd_nullify(vec_t *v, const mask_t *nulls);`   | –ó–∞–Ω—É–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ –º–∞—Å–∫–µ.      | `void`     |
| `simd_sum_vec`    | `int64_t simd_sum_vec(const vec_t *v);`               | –°—É–º–º–∞ –∑–Ω–∞—á–µ–Ω–∏–π –≤–µ–∫—Ç–æ—Ä–∞.          | –†–µ–∑—É–ª—å—Ç–∞—Ç  |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void *data;
  size_t len;
  simd_type_t type;
} vec_t;

typedef struct {
  uint8_t *bits;
  size_t len;
} mask_t;

typedef enum {
  SIMD_INT32,
  SIMD_INT64,
  SIMD_FLOAT32,
  SIMD_FLOAT64
} simd_type_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `simd_op_count_total{op}` ‚Äî —á–∏—Å–ª–æ SIMD –æ–ø–µ—Ä–∞—Ü–∏–π
* `simd_register_usage_percent` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SIMD —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
* `simd_null_mask_density` ‚Äî –ø–ª–æ—Ç–Ω–æ—Å—Ç—å null-–º–∞—Å–æ–∫
* `simd_exec_ns_per_batch` ‚Äî –≤—Ä–µ–º—è –Ω–∞ –ø–∞—Ä—Ç–∏—é

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∏ –¥–ª–∏–Ω—ã –≤–µ–∫—Ç–æ—Ä–æ–≤
* –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ fallback-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ CPU
* –ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∏–∑ UDF –∫ SIMD runtime

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.1 ‚Äî Vector Execution Engine`
* `8.5 ‚Äî Parallelism`
* `5.2 ‚Äî Aggregation Core`
* `3.10 ‚Äî Expression Evaluator`
* `10.6 ‚Äî CPU Feature Tests`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_simd_cmp_eq_correctness`
* `test_simd_add_and_mask_ops`
* `test_simd_sum_with_nulls`
* `test_simd_alignment_guarantees`
* `test_simd_fallback_no_avx`

---

‚úÖ –ü–∞–∫–µ—Ç **8. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **9.1 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ C/C++/WASM –º–æ–¥—É–ª–µ–π –∏ UDF/UDAF API**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 9.1 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ C/C++/WASM –º–æ–¥—É–ª–µ–π –∏ UDF/UDAF API

**–ü–∞–∫–µ—Ç:** `9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å`
**Block ID:** `udf_udaf_extension_api`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç **API –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –°–£–ë–î —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –º–æ–¥—É–ª–∏**, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∞ **C, C++ –∏–ª–∏ WebAssembly (WASM)**, –∞ —Ç–∞–∫–∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è **UDF (User Defined Functions)** –∏ **UDAF (User Defined Aggregate Functions)**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –∑–∞–≥—Ä—É–∑–∫—É, —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–∏–ø–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, sandbox, streaming –∏ stateful –æ–ø–µ—Ä–∞—Ü–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------------- | ------------------------------------ | ---------- |
| `udf_register_module`   | `bool udf_register_module(const char *path);`               | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–π –º–æ–¥—É–ª—å.            | `true`     |
| `udf_register_function` | `bool udf_register_function(const udf_decl_t *decl);`       | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é UDF/UDAF.       | `true`     |
| `udf_invoke`            | `value_t udf_invoke(const char *name, const json_t *args);` | –í—ã–∑—ã–≤–∞–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `udf_list`              | `json_t *udf_list(void);`                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π. | JSON       |
| `udf_unload_module`     | `void udf_unload_module(const char *path);`                 | –£–¥–∞–ª—è–µ—Ç –º–æ–¥—É–ª—å –∏–∑ —Å—Ä–µ–¥—ã.             | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char lang[8]; // "C", "WASM"
  char symbol[64];
  int arg_count;
  char arg_types[8][16];
  char return_type[16];
} udf_decl_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `udf_module_loads_total` ‚Äî —á–∏—Å–ª–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
* `udf_invocations_total{name}` ‚Äî —á–∏—Å–ª–æ –≤—ã–∑–æ–≤–æ–≤ –ø–æ –∏–º–µ–Ω–∏
* `udf_failures_total{type}` ‚Äî —á–∏—Å–ª–æ –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* `udf_module_memory_bytes` ‚Äî –æ–±—ä–µ–º –ø–∞–º—è—Ç–∏, –∑–∞–Ω—è—Ç—ã–π –º–æ–¥—É–ª—è–º–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ú–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
* WASM –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –ø–æ–ª–Ω–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü–µ (WASI-lite)
* C/C++ UDF –æ–±–µ—Ä–Ω—É—Ç—ã –≤ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã (guarded trampoline)

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `8.12 ‚Äî UDF Sandbox Runtime`
* `6.6 ‚Äî Access Policies for UDF`
* `4.9 ‚Äî External API Integration`
* `7.3 ‚Äî Structured Logging`
* `10.3 ‚Äî Extension Testing Framework`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_udf_module_register_and_list`
* `test_udf_invoke_args_and_return_types`
* `test_udf_c_function_sandbox_violation`
* `test_udf_udaf_stateful_accumulate_and_merge`
* `test_udf_module_unload_and_cleanup`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **9.2 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ dlopen / LoadLibrary –∏ sandbox API** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 9.2 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ dlopen / LoadLibrary –∏ sandbox API

**–ü–∞–∫–µ—Ç:** `9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å`
**Block ID:** `dynamic_extension_loader`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (extensions)** —á–µ—Ä–µ–∑ **`dlopen` (Linux)** –∏ **`LoadLibrary` (Windows)**, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è **sandboxed API** –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å —è–¥—Ä–æ–º –°–£–ë–î. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ö—É–∫–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é, –≤—ã–∑–æ–≤—ã –æ–±—Ä–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∏–∑–æ–ª—è—Ü–∏—é —Å—Ä–µ–¥—ã, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π ABI-—Å–ª–æ–π, lifecycle-–∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ---------------------------------------------------------- | ----------------------------------------- | ---------- |
| `ext_load_library`   | `bool ext_load_library(const char *path);`                 | –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.                     | `true`     |
| `ext_register_hook`  | `bool ext_register_hook(const char *hook, ext_fn_t fn);`   | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç callback-—Ö—É–∫.                | `true`     |
| `ext_invoke_hook`    | `value_t ext_invoke_hook(const char *hook, json_t *args);` | –í—ã–∑—ã–≤–∞–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö—É–∫.          | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `ext_list_loaded`    | `json_t *ext_list_loaded(void);`                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π. | JSON       |
| `ext_unload_library` | `void ext_unload_library(const char *path);`               | –í—ã–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ –æ—á–∏—â–∞–µ—Ç –ø–∞–º—è—Ç—å.    | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef value_t (*ext_fn_t)(json_t *args);

typedef struct {
  char name[64];
  char version[16];
  char path[256];
  bool active;
  uint64_t loaded_at;
} extension_info_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `extension_loads_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
* `extension_active_total` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
* `extension_hook_invocations_total{hook}` ‚Äî –≤—ã–∑–æ–≤—ã —Ö—É–∫–æ–≤
* `extension_crash_isolation_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã—Ö –∏–∑–æ–ª—è—Ü–∏–π –ø—Ä–∏ —Å–±–æ—è—Ö

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –ø–æ API (sandbox)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –∞—É–¥–∏—Ç –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –ø—É—Ç–µ–π
* –ò–∑–æ–ª—è—Ü–∏—è –∫—Ä–∞—à–µ–π —Å fallback –Ω–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `9.1 ‚Äî UDF/UDAF Extension API`
* `8.12 ‚Äî UDF Sandbox Runtime`
* `7.3 ‚Äî Logging / Crash Monitor`
* `10.3 ‚Äî Extension Testing`
* `6.6 ‚Äî Access Control for Extensions`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_ext_dlopen_and_symbol_resolution`
* `test_ext_hook_registration_and_call`
* `test_ext_crash_isolation_scenario`
* `test_ext_lifecycle_reload_and_unload`
* `test_ext_invalid_api_guarding`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **9.3 ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –ø–∞—Ä—Å–µ—Ä—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 9.3 ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è: –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –ø–∞—Ä—Å–µ—Ä—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ—Ç–æ–∫–æ–ª—ã

**–ü–∞–∫–µ—Ç:** `9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å`
**Block ID:** `builtin_extensions_core`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: **DSL-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫**, **custom-–ø–∞—Ä—Å–µ—Ä—ã**, **–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**, **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ SQL-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã**, **—Å–µ—Ç–µ–≤—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã**. –¢–∞–∫–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã, –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —è–¥—Ä–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------- | ------------------------------------------------------------------------- | ------------------------------------------------ | ---------- |
| `builtin_ext_register` | `bool builtin_ext_register(const builtin_ext_t *ext);`                    | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.              | `true`     |
| `builtin_ext_init_all` | `void builtin_ext_init_all(void);`                                        | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.        | `void`     |
| `builtin_ext_get`      | `const builtin_ext_t *builtin_ext_get(const char *name);`                 | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ –∏–º–µ–Ω–∏.                  | –£–∫–∞–∑–∞—Ç–µ–ª—å  |
| `builtin_ext_list`     | `json_t *builtin_ext_list(void);`                                         | –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π. | JSON       |
| `builtin_ext_override` | `bool builtin_ext_override(const char *name, const builtin_ext_t *impl);` | –ó–∞–º–µ–Ω—è–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.      | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char version[16];
  bool is_optional;
  void (*init_fn)(void);
  void (*shutdown_fn)(void);
} builtin_ext_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `builtin_ext_loaded_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
* `builtin_ext_init_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* `builtin_ext_overridden_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
* `builtin_ext_runtime_ns{name}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è init

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢–æ–ª—å–∫–æ —è–¥—Ä–æ –º–æ–∂–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å/–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º—ë–Ω –∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `0.2 ‚Äî System Loader`
* `3.3 ‚Äî DSL Parser`
* `3.12 ‚Äî SQL Executor`
* `4.4 ‚Äî Protocol Stack`
* `10.3 ‚Äî Extension Testing`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_builtin_ext_register_and_invoke`
* `test_builtin_ext_conflict_and_override`
* `test_builtin_ext_lifecycle_callbacks`
* `test_builtin_ext_listing_api`
* `test_builtin_ext_with_fallback_and errors`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **9.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL Wire Protocol –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 9.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL Wire Protocol –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª

**–ü–∞–∫–µ—Ç:** `9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å`
**Block ID:** `wire_protocol_support`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ PostgreSQL Wire Protocol (v3)** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –¥—Ä–∞–π–≤–µ—Ä–∞–º–∏ PostgreSQL, –∞ —Ç–∞–∫–∂–µ **–≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç handshake, —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π, auth, copy, query, prepare, execute –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------- | ---------- |
| `wire_pg_start`           | `bool wire_pg_start(int socket_fd);`                                         | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é PostgreSQL-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞. | `true`     |
| `wire_pg_handle_message`  | `bool wire_pg_handle_message(session_t *s, const uint8_t *msg, size_t len);` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.            | `true`     |
| `wire_bin_start`          | `bool wire_bin_start(int socket_fd);`                                        | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∏–Ω–∞—Ä–Ω—É—é —Å–µ—Å—Å–∏—é.             | `true`     |
| `wire_bin_send_result`    | `bool wire_bin_send_result(session_t *s, const result_t *res);`              | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.    | `true`     |
| `wire_protocol_negotiate` | `bool wire_protocol_negotiate(int fd, protocol_type_t *type);`               | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª.           | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  PROTO_PG,
  PROTO_BINARY
} protocol_type_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `wire_protocol_sessions_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º
* `wire_protocol_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ / –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏
* `wire_protocol_bytes_sent` ‚Äî –æ–±—â–∏–π –æ–±—ä—ë–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* `wire_protocol_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±–º–µ–Ω–∞ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS/mTLS –≤ –æ–±–æ–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö
* –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection –Ω–∞ —É—Ä–æ–≤–Ω–µ wire-layer
* –ò–∑–æ–ª—è—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ PG –∏ Binary –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤
* –ê—É–¥–∏—Ç –∫–æ–º–∞–Ω–¥ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.1 ‚Äî Network Server`
* `3.12 ‚Äî SQL Executor`
* `6.3 ‚Äî Auth / Roles`
* `7.3 ‚Äî Logging / Audit`
* `9.1 ‚Äî UDF API (–¥–ª—è copy/exec/prepare)`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_pg_wire_startup_and_auth`
* `test_pg_message_parse_execute`
* `test_wire_binary_negotiation_and_fallback`
* `test_wire_send_large_resultset`
* `test_wire_security_tls_handshake`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **9.5 ‚Äî DSL / UDF —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è ERP/ETL** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 9.5 ‚Äî DSL / UDF —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è ERP/ETL

**–ü–∞–∫–µ—Ç:** `9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å`
**Block ID:** `dsl_udf_erp_etl_extensions`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–¥–æ–º–µ–Ω–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (DSL)** –∏ **UDF-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ –∑–∞–¥–∞—á–∞—Ö **ERP, ETL, BPMN**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö DSL-—Ñ—É–Ω–∫—Ü–∏–π, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ–¥—É—Ä, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, pipeline-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –≤ –≥—Ä–∞—Ñ–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ---------------------------------------------------------------- | ------------------------------------------- | ---------- |
| `dsl_register_step`  | `bool dsl_register_step(const dsl_step_t *step);`                | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —à–∞–≥ DSL.      | `true`     |
| `dsl_execute_graph`  | `bool dsl_execute_graph(const dsl_graph_t *graph);`              | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å —Å—Ü–µ–Ω–∞—Ä–∏–π DSL.                | `true`     |
| `dsl_step_invoke`    | `value_t dsl_step_invoke(const char *name, const json_t *args);` | –í—ã–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —à–∞–≥.                    | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `dsl_graph_validate` | `bool dsl_graph_validate(const dsl_graph_t *graph);`             | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è.            | `true`     |
| `dsl_list_steps`     | `json_t *dsl_list_steps(void);`                                  | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —à–∞–≥–æ–≤. | JSON       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char type[16]; // "transform", "load", "trigger"
  udf_c_fn_t fn;
} dsl_step_t;

typedef struct {
  char graph_id[64];
  dsl_step_t *steps;
  size_t step_count;
} dsl_graph_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `dsl_graphs_executed_total` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–æ–≤
* `dsl_step_latency_ns{name}` ‚Äî —Å—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ —à–∞–≥–∞
* `dsl_errors_total{type}` ‚Äî –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* `dsl_custom_step_registered_total` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —à–∞–≥–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤ –≤—Ö–æ–¥–æ–≤/–≤—ã—Ö–æ–¥–æ–≤ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö DSL-—à–∞–≥–æ–≤ –Ω–∞ side-effect / –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* –ê—É–¥–∏—Ç –≤—Å–µ—Ö UDF/DSL –≤—ã–∑–æ–≤–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∂—É—Ä–Ω–∞–ª–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `9.1 ‚Äî UDF Extension API`
* `3.6 ‚Äî Execution Planner`
* `5.4 ‚Äî ETL Engine`
* `6.6 ‚Äî Access Control per Workflow`
* `7.3 ‚Äî Logging`

---

### üß™ –¢–µ—Å—Ç—ã

* `test_dsl_register_and_invoke_step`
* `test_dsl_execute_etl_graph_with_udf`
* `test_dsl_graph_validation_errors`
* `test_dsl_udf_integration_in_erp_case`
* `test_dsl_step_argument_validation`

---

‚úÖ –ü–∞–∫–µ—Ç **9. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **10.1 ‚Äî Unit-—Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–≤–∏–∂–æ–∫**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.1 ‚Äî Unit-—Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –¥–≤–∏–∂–æ–∫

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `unit_test_engine`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–≤–∏–∂–æ–∫ unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ —Å–±–æ—Ä–∫—É –∏ CI/CD-–ø–∞–π–ø–ª–∞–π–Ω. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –°–£–ë–î –Ω–∞ C, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∏–∫—Å—Ç—É—Ä, –º–æ–∫–æ–≤, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞, –∏–∑–æ–ª—è—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, JSON-–æ—Ç—á—ë—Ç—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å GitHub Actions / Ninja.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                        | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç                        |
| ------------------ | ----------------------------------------------- | --------------------------------------- | --------------------------------- |
| `test_register`    | `bool test_register(const test_case_t *test);`  | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç.                 | `true`                            |
| `test_run_all`     | `int test_run_all(void);`                       | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã. | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫                     |
| `test_run_filter`  | `int test_run_filter(const char *pattern);`     | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –ø–æ —à–∞–±–ª–æ–Ω—É.             | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫                     |
| `test_output_json` | `json_t *test_output_json(void);`               | –§–æ—Ä–º–∏—Ä—É–µ—Ç JSON-–æ—Ç—á—ë—Ç.                   | JSON                              |
| `test_assert`      | `void test_assert(bool cond, const char *msg);` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è.                       | `void` (–≤—ã–∑—ã–≤–∞–µ—Ç abort –ø—Ä–∏ false) |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  void (*fn)(void);
  const char *category;
} test_case_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `unit_tests_total{status}` ‚Äî –≤—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤, —É—Å–ø–µ—à–Ω—ã—Ö/–ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã—Ö
* `unit_test_failures_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
* `unit_test_avg_duration_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* `unit_test_coverage_percent{file}` ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –ø–∞–º—è—Ç–∏ —Ç–µ—Å—Ç–æ–≤ (—á–µ—Ä–µ–∑ –∞—Ä–µ–Ω—ã)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—Ñ–∏–Ω–∏—Ç-–ª—É–ø–æ–≤ —á–µ—Ä–µ–∑ watchdog
* –ß—ë—Ç–∫–∏–π sandbox –ø—Ä–∏ –≤—ã–∑–æ–≤–µ UDF –≤ —Ç–µ—Å—Ç–∞—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `10.3 ‚Äî Extension Testing Framework`
* `8.9 ‚Äî Arena Allocator`
* `7.1 ‚Äî Structured Logging`
* `10.4 ‚Äî Timeboxing / Timeout engine`
* `10.6 ‚Äî Fault Injection`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_mem_arena_allocation`
* `test_expr_evaluator_constants`
* `test_json_parser_minimal`
* `test_sql_tokenizer_keywords`
* `test_catalog_table_create_drop`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **10.2 ‚Äî Stress, Soak, Leak-—Ç–µ—Å—Ç—ã –∏ CI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.2 ‚Äî Stress, Soak, Leak-—Ç–µ—Å—Ç—ã –∏ CI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `stress_soak_leak_testing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ (stress)**, **–¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ (soak)** –∏ **—É—Ç–µ—á–µ—á–Ω–æ–≥–æ (leak)** —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö, –∞ —Ç–∞–∫–∂–µ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏, –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ CI-–ø–∞–π–ø–ª–∞–π–Ω –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –≤ background-—Ä–µ–∂–∏–º–µ, —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–µ–π.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç     |
| ------------------------ | ---------------------------------------------------------------- | ---------------------------------- | -------------- |
| `stress_test_run`        | `int stress_test_run(const stress_config_t *cfg);`               | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—é. | –ö–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ |
| `soak_test_schedule`     | `bool soak_test_schedule(const char *scenario, duration_t dur);` | –ü–ª–∞–Ω–∏—Ä—É–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç.         | `true`         |
| `leak_check_run`         | `bool leak_check_run(void);`                                     | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —É—Ç–µ—á–∫–∏.      | `true`         |
| `leak_report_json`       | `json_t *leak_report_json(void);`                                | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON-–æ—Ç—á—ë—Ç –æ–± —É—Ç–µ—á–∫–∞—Ö.  | JSON           |
| `stress_metrics_collect` | `json_t *stress_metrics_collect(void);`                          | –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Ç–µ—Å—Ç–∞.                 | JSON           |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *scenario;
  size_t max_threads;
  size_t duration_sec;
  bool enable_gc;
} stress_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `stress_ops_total{type}` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞—Ö
* `soak_runtime_duration_ns` ‚Äî –≤—Ä–µ–º—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã
* `leak_alloc_unfreed_bytes` ‚Äî –Ω–µ–æ—Å–≤–æ–±–æ–∂–¥—ë–Ω–Ω–∞—è –ø–∞–º—è—Ç—å
* `leak_fd_unclosed_count` ‚Äî —á–∏—Å–ª–æ –Ω–µ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –°—Ç—Ä–æ–≥–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–æ–≤
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≥—Ä–∞–Ω–∏—Ü –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –ø–æ—Ç–æ–∫–æ–≤
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å watchdog –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–æ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `10.1 ‚Äî Unit Test Engine`
* `8.9 ‚Äî Memory Allocator`
* `7.1 ‚Äî Profiler`
* `10.4 ‚Äî Timebox Execution`
* `10.6 ‚Äî Fault Injection`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `stress_insert_10M_rows_parallel`
* `soak_query_plan_reuse_stability`
* `leak_check_transaction_commit_abort`
* `soak_parallel_udf_execution`
* `leak_check_after_snapshot_restore`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **10.3 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.3 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `extension_testing_framework`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ä–∞—Å—à–∏—Ä—è–µ–º—É—é —Å—Ä–µ–¥—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –º–æ–¥—É–ª–µ–π**, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, UDF/UDAF –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –Ω–∞–¥—Å—Ç—Ä–æ–µ–∫. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è C/C++/Lua/WASM-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é —Å—Ä–µ–¥—É, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —è–¥—Ä–æ–º, –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–µ—Å—Ç—ã –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é —Ç–µ—Å—Ç–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç    |
| ----------------------- | ------------------------------------------------------ | --------------------------------------- | ------------- |
| `ext_test_register`     | `bool ext_test_register(const ext_test_case_t *test);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.           | `true`        |
| `ext_test_run_all`      | `int ext_test_run_all(void);`                          | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã. | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫ |
| `ext_test_run_file`     | `int ext_test_run_file(const char *path);`             | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞.               | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫ |
| `ext_test_context_init` | `bool ext_test_context_init(void);`                    | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É.          | `true`        |
| `ext_test_cleanup`      | `void ext_test_cleanup(void);`                         | –û—á–∏—â–∞–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤.               | `void`        |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  const char *module;
  void (*fn)(void);
} ext_test_case_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ext_tests_total{status}` ‚Äî —á–∏—Å–ª–æ —Ç–µ—Å—Ç–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É
* `ext_test_failures_total{module}` ‚Äî –ø—Ä–æ–≤–∞–ª—ã –ø–æ –º–æ–¥—É–ª—è–º
* `ext_test_runtime_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞
* `ext_test_context_reset_total` ‚Äî —á–∏—Å–ª–æ —Å–±—Ä–æ—Å–æ–≤ —Å—Ä–µ–¥—ã

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ sandbox-—Å—Ä–µ–¥–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
* UDF/UDAF –Ω–µ –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –¥—Ä—É–≥–∏–µ —Ç–µ—Å—Ç—ã –∏–ª–∏ —è–¥—Ä–æ
* –ü—Ä—è–º–∞—è –∏–∑–æ–ª—è—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –∏ –ø–∞–º—è—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `9.1 ‚Äî UDF/UDAF Extension API`
* `10.1 ‚Äî Unit Test Engine`
* `8.12 ‚Äî Sandbox Runtime`
* `6.6 ‚Äî Access Control for UDF`
* `7.3 ‚Äî Logging / Audit`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `ext_test_lua_sandbox_math_lib`
* `ext_test_c_udaf_state_persistence`
* `ext_test_wasm_memory_limit_violation`
* `ext_test_module_hooks_invocation_order`
* `ext_test_ext_context_reload_and_restore`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **10.4 ‚Äî Timebox, fault-injection –∏ —Ç–µ—Å—Ç—ã —Ç–∞–π–º–∞—É—Ç–æ–≤/—Å–±–æ–µ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.4 ‚Äî Timebox, fault-injection –∏ —Ç–µ—Å—Ç—ã —Ç–∞–π–º–∞—É—Ç–æ–≤/—Å–±–æ–µ–≤

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `timeout_fault_injection_tests`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤**, **–≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–±–æ–µ–≤ (fault-injection)** –∏ —Å–∏–º—É–ª—è—Ü–∏–∏ **–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —è–¥—Ä–∞ –∏ –º–æ–¥—É–ª–µ–π –ø—Ä–∏ –∑–∞–¥–µ—Ä–∂–∫–∞—Ö, –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö, –ø–æ—Ç–µ—Ä–µ —Ä–µ—Å—É—Ä—Å–æ–≤, —Å–±–æ—è—Ö –ø–∞–º—è—Ç–∏, –∫—Ä–∞—à–∞—Ö, race condition, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö –∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É, –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π –∏ —Ç–∞–π–º-–∞—É—Ç–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------------- | ----------------------------------------------- | ---------- |
| `fault_inject`           | `void fault_inject(const char *label);`                                | –í—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Å–±–æ–π.                  | `void`     |
| `timeout_trigger`        | `bool timeout_trigger(const char *scope, uint64_t ns);`                | –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–∞–π–º–∞—É—Ç –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.          | `true`     |
| `fault_register_handler` | `bool fault_register_handler(const char *label, fault_handler_fn fn);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ fault.               | `true`     |
| `fault_clear_all`        | `void fault_clear_all(void);`                                          | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ fault-–∏–Ω—ä–µ–∫—Ü–∏–∏.            | `void`     |
| `timeout_scope_enter`    | `void timeout_scope_enter(const char *label);`                         | –û–±–æ–∑–Ω–∞—á–∞–µ—Ç –æ–±–ª–∞—Å—Ç—å –Ω–∞—á–∞–ª–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏. | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef void (*fault_handler_fn)(void);

typedef struct {
  char label[64];
  uint64_t fault_count;
  bool enabled;
} fault_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `fault_injection_count{label}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω—ä–µ–∫—Ü–∏–π
* `timeout_violations_total{scope}` ‚Äî —á–∏—Å–ª–æ —Ç–∞–π–º-–∞—É—Ç–æ–≤ –ø–æ –æ–±–ª–∞—Å—Ç—è–º
* `fault_handler_invoked_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
* `timeout_execution_overruns_ns` ‚Äî —Å—É–º–º–∞—Ä–Ω–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* Fault-–∏–Ω—ä–µ–∫—Ü–∏–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å–±–æ—Ä–∫–µ
* –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—ä–µ–∫—Ü–∏–π
* –ó–∞–ø—Ä–µ—Ç –Ω–∞ fault-–∏–Ω—ä–µ–∫—Ü–∏–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥–µ

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `10.1 ‚Äî Unit Test Engine`
* `10.2 ‚Äî Stress/Leak/Soak Tests`
* `8.10 ‚Äî Timebox Execution`
* `7.1 ‚Äî Profiler`
* `6.6 ‚Äî Access Control`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_fault_injection_snapshot_failure`
* `test_timeout_trigger_on_index_join`
* `test_fault_memory_leak_under_gc`
* `test_fault_deadlock_detector_activation`
* `test_timeout_scope_nested_termination`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **10.5 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ snapshot-—Å—Ü–µ–Ω–∞—Ä–∏–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.5 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ snapshot-—Å—Ü–µ–Ω–∞—Ä–∏–∏

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `integration_snapshot_testing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞ **—Å–∫–≤–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**, –≤–∫–ª—é—á–∞—é—â–∏–µ –º–Ω–æ–≥–æ–º–æ–¥—É–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, SQL-–∑–∞–ø—Ä–æ—Å—ã, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **snapshot-—Ç–µ—Å—Ç–æ–≤** ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—é –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î –¥–æ/–ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π, –¥–ª—è —Ç–æ—á–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö, –ø–ª–∞–Ω–∞, —Å—Ö–µ–º –∏ –∂—É—Ä–Ω–∞–ª–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç      |
| ---------------------------- | ----------------------------------------------------------------- | ------------------------------------------------- | --------------- |
| `integration_test_register`  | `bool integration_test_register(const integration_test_t *test);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç.                 | `true`          |
| `integration_test_run_all`   | `int integration_test_run_all(void);`                             | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.           | –ö–æ–ª-–≤–æ –ø—Ä–æ–≤–∞–ª–æ–≤ |
| `snapshot_capture_state`     | `bool snapshot_capture_state(const char *label);`                 | –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î.                           | `true`          |
| `snapshot_compare_to`        | `bool snapshot_compare_to(const char *label);`                    | –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º. | `true`          |
| `integration_test_load_plan` | `bool integration_test_load_plan(const char *file);`              | –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.                      | `true`          |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  void (*fn)(void);
  const char *category;
} integration_test_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `integration_tests_total{status}` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
* `snapshot_compare_failures_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏
* `integration_test_runtime_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* `snapshot_state_diff_bytes` ‚Äî –æ–±—ä—ë–º —Ä–∞–∑–ª–∏—á–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è —Å—Ä–µ–¥—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π runtime/db instance)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ snapshot –∏ —á—Ç–µ–Ω–∏–∏ –∏—Ö
* –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–µ—Ç–∞- –∏ user-–¥–∞–Ω–Ω—ã—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.4 ‚Äî Snapshot Engine`
* `10.1 ‚Äî Unit Test Engine`
* `10.2 ‚Äî Stress / Leak / Soak Tests`
* `7.3 ‚Äî Structured Logging`
* `8.6 ‚Äî Zero-Copy Snapshot`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `integration_test_create_insert_query_snapshot`
* `integration_test_restore_and_compare_mvcc`
* `integration_test_join_with_snapshot_diff`
* `integration_test_etl_pipeline_consistency`
* `integration_test_schema_alteration_and_rollback`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–º –±–ª–æ–∫–æ–º **10.6 ‚Äî Fuzzing, Mutation, Crash-—Ç–µ—Å—Ç—ã –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 10.6 ‚Äî Fuzzing, Mutation, Crash-—Ç–µ—Å—Ç—ã –∏ –ø–æ–∫—Ä—ã—Ç–∏–µ

**–ü–∞–∫–µ—Ç:** `10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞`
**Block ID:** `fuzzing_mutation_crash_testing`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **fuzz-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, **–º—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**, **crash-—Ç–µ—Å—Ç–æ–≤** –∏ –∞–Ω–∞–ª–∏–∑–∞ **–ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–∏–ø–∞ **libFuzzer**, **AFL++**, **ASAN/TSAN/MSAN** –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã —Å–ª—É—á–∞–π–Ω—ã—Ö –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫ —Å–±–æ—è–º, –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º –≤—Ö–æ–¥–∞–º, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –æ—à–∏–±–∫–∞–º. –¢–∞–∫–∂–µ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–±–æ—Ä –ø–æ–∫—Ä—ã—Ç–∏—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ —Å—Ç—Ä–æ–∫/–±–ª–æ–∫–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç    |
| -------------------------- | ------------------------------------------------------------- | ----------------------------------- | ------------- |
| `fuzz_engine_run`          | `int fuzz_engine_run(const fuzz_config_t *cfg);`              | –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª fuzz-—Ç–µ—Å—Ç–æ–≤.         | –ö–æ–ª-–≤–æ –æ—à–∏–±–æ–∫ |
| `mutation_test_run`        | `int mutation_test_run(const mutation_scenario_t *scenario);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –º—É—Ç–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. | –û—à–∏–±–æ–∫        |
| `crash_simulate`           | `bool crash_simulate(const char *target);`                    | –ò–º–∏—Ç–∏—Ä—É–µ—Ç –∫—Ä–∞—à –¥–ª—è –±–ª–æ–∫–∞/–ø—Ä–æ—Ü–µ—Å—Å–∞.  | `true`        |
| `coverage_report_generate` | `json_t *coverage_report_generate(void);`                     | –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é.        | JSON          |
| `fuzz_input_register`      | `bool fuzz_input_register(fuzz_input_fn fn);`                 | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—Ö–æ–¥–æ–≤.      | `true`        |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *target;
  uint64_t duration_ns;
  bool with_asan;
} fuzz_config_t;

typedef struct {
  const char *file;
  const char *mutation_type;
} mutation_scenario_t;

typedef const char *(*fuzz_input_fn)(void);
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `fuzz_iterations_total{target}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
* `mutation_errors_total{type}` ‚Äî –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø–æ —Ç–∏–ø—É –º—É—Ç–∞—Ü–∏–∏
* `crash_simulations_total{component}` ‚Äî —á–∏—Å–ª–æ —ç–º—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–±–æ–µ–≤
* `code_coverage_percent{file}` ‚Äî –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* Fuzz –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ sandbox-–ø—Ä–æ—Ü–µ—Å—Å–∞—Ö —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–∞–º—è—Ç–∏ –∏ CPU
* –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –æ—Ç—á—ë—Ç–æ–≤ –∏ –ª–æ–≥–æ–≤
* –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `10.1 ‚Äî Unit Test Engine`
* `7.1 ‚Äî Profiler / Crash Tracker`
* `10.4 ‚Äî Fault Injection`
* `10.2 ‚Äî Leak/Soak Isolation`
* `7.4 ‚Äî Telemetry & Alertmanager`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `fuzz_json_parser_invalid_sequences`
* `mutation_index_scan_with_schema_change`
* `crash_simulate_during_snapshot_write`
* `fuzz_sql_executor_memory_violation`
* `coverage_generate_with_and_without_udf`

---

‚úÖ –ü–∞–∫–µ—Ç **10. –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **11.1 ‚Äî RBAC/ABAC, –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 11.1 ‚Äî RBAC/ABAC, –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**–ü–∞–∫–µ—Ç:** `11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `rbac_abac_access_encryption`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã **RBAC (Role-Based Access Control)** –∏ **ABAC (Attribute-Based Access Control)**, –≤–∫–ª—é—á–∞—è **–≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞**, –∞ —Ç–∞–∫–∂–µ **—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** (–≤ —Ç.—á. TDE ‚Äî Transparent Data Encryption). –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–æ–ª–µ–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å—Ç—Ä–æ–∫, —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π, –∞ —Ç–∞–∫–∂–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ (at rest), —Ç–∞–∫ –∏ –≤ –ø–∞–º—è—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç   |
| ------------------------- | ------------------------------------------------------------------- | --------------------------------- | ------------ |
| `access_grant_role`       | `bool access_grant_role(const char *user, const char *role);`       | –ù–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.      | `true`       |
| `access_check_permission` | `bool access_check_permission(const session_t *s, const char *op);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—é. | `true/false` |
| `abac_eval_policy`        | `bool abac_eval_policy(const abac_context_t *ctx);`                 | –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫—É ABAC-–ø–æ–ª–∏—Ç–∏–∫–∏.   | `true/false` |
| `encryption_apply_tde`    | `bool encryption_apply_tde(table_t *table);`                        | –ü—Ä–∏–º–µ–Ω—è–µ—Ç TDE –∫ —Ç–∞–±–ª–∏—Ü–µ.          | `true`       |
| `access_define_policy`    | `bool access_define_policy(const access_policy_t *policy);`         | –°–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É.       | `true`       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char user[64];
  char op[32];
  char resource[64];
  char condition[128]; // ABAC expression
} abac_context_t;

typedef struct {
  char name[64];
  char type[16]; // "row", "column", "table"
  char expression[256];
} access_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `access_policy_evaluations_total` ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–∏—Ç–∏–∫
* `access_denied_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫–∞–∑–æ–≤ –ø–æ —Ç–∏–ø—É
* `rbac_roles_granted_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ä–æ–ª–µ–π
* `encryption_tde_applied_total` ‚Äî —á–∏—Å–ª–æ —à–∏—Ñ—Ä—É–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–≤–æ–∑–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞: SQL, API, storage
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å key rotation, key vault, forward secrecy

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.2 ‚Äî Auth System`
* `3.12 ‚Äî SQL Executor`
* `1.10 ‚Äî Table Engine`
* `7.3 ‚Äî Logging / Audit Trail`
* `6.5 ‚Äî Security Profiles`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_rbac_grant_and_check`
* `test_abac_policy_evaluation_with_context`
* `test_access_policy_row_level_filter`
* `test_tde_encryption_applied_correctly`
* `test_access_denied_on_column_mask`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **11.2 ‚Äî TLS/mTLS, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø–µ—Ä–µ–¥–∞—á–∞ –∏ –∑–∞—â–∏—Ç–∞ –∫–∞–Ω–∞–ª–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 11.2 ‚Äî TLS/mTLS, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø–µ—Ä–µ–¥–∞—á–∞ –∏ –∑–∞—â–∏—Ç–∞ –∫–∞–Ω–∞–ª–æ–≤

**–ü–∞–∫–µ—Ç:** `11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `tls_mtls_channel_protection`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **TLS 1.3** –∏ **mTLS (Mutual TLS)** –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –≤–∫–ª—é—á–∞—è SQL, REST, gRPC, JDBC, WebSocket –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ wire-–ø—Ä–æ—Ç–æ–∫–æ–ª—ã. –†–µ–∞–ª–∏–∑—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤, –æ–±–º–µ–Ω –∫–ª—é—á–∞–º–∏, –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ–≤–µ—Ä–∏—è, forward secrecy, –∑–∞—â–∏—Ç—É –æ—Ç MITM-–∞—Ç–∞–∫ –∏ downgrade-–ø–æ–ø—ã—Ç–æ–∫. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞, —Ç–∞–∫ –∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö SDK.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------- | ----------------------------------------------- | ---------- |
| `tls_context_init`      | `bool tls_context_init(const tls_config_t *cfg);`     | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç TLS-–∫–æ–Ω—Ç–µ–∫—Å—Ç.                    | `true`     |
| `tls_accept_connection` | `int tls_accept_connection(int sock_fd);`             | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç handshake.     | TLS socket |
| `tls_client_connect`    | `int tls_client_connect(const char *host, int port);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç. | TLS socket |
| `tls_verify_peer`       | `bool tls_verify_peer(const tls_cert_t *cert);`       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç peer-–∞.                    | `true`     |
| `tls_shutdown`          | `void tls_shutdown(void);`                            | –ó–∞–≤–µ—Ä—à–∞–µ—Ç TLS-—Å–µ—Å—Å–∏—é –∏ –æ—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç.        | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char ca_path[256];
  char cert_path[256];
  char key_path[256];
  bool require_client_cert;
  bool enable_forward_secrecy;
} tls_config_t;

typedef struct {
  char subject[128];
  char issuer[128];
  bool trusted;
} tls_cert_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tls_connections_total{direction}` ‚Äî –≤—Ö–æ–¥—è—â–∏—Ö/–∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* `tls_handshake_failures_total` ‚Äî —á–∏—Å–ª–æ –Ω–µ—É–¥–∞—á–Ω—ã—Ö TLS handshakes
* `tls_certificate_verifications_total` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
* `tls_forward_secrecy_enabled_total` ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–π PFS

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ only-TLS —Ä–µ–∂–∏–º–æ–≤ (–±–µ–∑ fallback –Ω–∞ –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã)
* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ hostname + OCSP
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
* mTLS –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ re-auth –Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏—è—Ö

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.1 ‚Äî Network Layer`
* `6.2 ‚Äî Auth System`
* `9.4 ‚Äî Wire Protocol`
* `11.1 ‚Äî Access & Encryption`
* `7.3 ‚Äî Audit & Security Logs`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_tls_connection_accept_and_verify`
* `test_mtls_handshake_with_client_cert`
* `test_tls_cert_expiry_warning`
* `test_tls_reject_untrusted_peer`
* `test_tls_enable_forward_secrecy_flag`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **11.3 ‚Äî Row-level / column-level security –∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 11.3 ‚Äî Row-level / column-level security –∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–∞–∫–µ—Ç:** `11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `row_column_security_masking`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤**, –≤–∫–ª—é—á–∞—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ç—Ä–æ–∫ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/—Ä–æ–ª–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∫—Ä—ã—Ç–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤, —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Å–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞), –ø—Å–µ–≤–¥–æ–Ω–∏–º–∏–∑–∞—Ü–∏—é –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—É—é —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –∑–Ω–∞—á–µ–Ω–∏–π. –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ö–µ–º—ã –∏ –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫ –ª—é–±—ã–º SQL-–∑–∞–ø—Ä–æ—Å–∞–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç             |
| ----------------------------- | ---------------------------------------------------------------------------------------- | --------------------------------- | ---------------------- |
| `security_define_row_filter`  | `bool security_define_row_filter(const char *table, const char *expr);`                  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä —Å—Ç—Ä–æ–∫.       | `true`                 |
| `security_define_column_mask` | `bool security_define_column_mask(const char *column, const char *mask_expr);`           | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–∞—Å–∫—É –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞.  | `true`                 |
| `security_apply_row_filter`   | `bool security_apply_row_filter(session_t *s, const char *table);`                       | –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ.     | `true`                 |
| `security_apply_column_mask`  | `value_t security_apply_column_mask(session_t *s, const char *col, const value_t *val);` | –ú–∞—Å–∫–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–≤–æ–¥–µ.    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |
| `security_list_policies`      | `json_t *security_list_policies(void);`                                                  | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –º–∞—Å–æ–∫. | JSON                   |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char table[64];
  char column[64];
  char mask_expr[128];
  bool active;
} column_mask_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `row_filters_applied_total` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ
* `column_masks_applied_total` ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–ª–±—Ü–æ–≤ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–æ
* `mask_evaluation_errors_total` ‚Äî –æ—à–∏–±–∫–∏ –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏
* `security_policy_changes_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–∏—Ç–∏–∫

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–æ —ç—Ç–∞–ø–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
* –ó–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ subquery/CTE/UDF
* –ê—É–¥–∏—Ç –≤—Å–µ—Ö —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `11.1 ‚Äî Access Policies`
* `3.10 ‚Äî Expression Engine`
* `6.6 ‚Äî Session Context`
* `7.3 ‚Äî Audit Log`
* `3.12 ‚Äî SQL Executor`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_row_filter_applied_during_scan`
* `test_column_mask_applied_on_select`
* `test_mask_combination_with_expression`
* `test_policy_disable_and_restore`
* `test_row_filter_context_dependency`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **11.4 ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π, sandbox, UDF isolation** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 11.4 ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π, sandbox, UDF isolation

**–ü–∞–∫–µ—Ç:** `11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `sql_injection_sandbox_udf_isolation`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç **SQL-–∏–Ω—ä–µ–∫—Ü–∏–π**, **–æ–ø–∞—Å–Ω—ã—Ö UDF** –∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–ª–µ–∫—Å–∏—á–µ—Å–∫–∏–π –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å**, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —à–∞–±–ª–æ–Ω–æ–≤, –∑–∞–ø—É—Å–∫ UDF –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Å–æ—á–Ω–∏—Ü–µ, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π –≥—Ä–∞–Ω–∏—Ü –ø–∞–º—è—Ç–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç             |
| -------------------------- | ------------------------------------------------------- | --------------------------------------------- | ---------------------- |
| `sql_validate_input`       | `bool sql_validate_input(const char *sql);`             | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é SQL. | `true`                 |
| `sql_normalize_query`      | `char *sql_normalize_query(const char *sql);`           | –£–¥–∞–ª—è–µ—Ç –∏–Ω—ä–µ–∫—Ü–∏–∏ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å.        | –ù–æ–≤—ã–π SQL              |
| `udf_sandbox_check`        | `bool udf_sandbox_check(const udf_decl_t *udf);`        | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç UDF –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.                | `true`                 |
| `sandbox_execute_safe`     | `value_t sandbox_execute_safe(const udf_call_t *call);` | –ó–∞–ø—É—Å–∫–∞–µ—Ç UDF –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å—Ä–µ–¥–µ.             | –†–µ–∑—É–ª—å—Ç–∞—Ç              |
| `injection_pattern_detect` | `bool injection_pattern_detect(const char *sql);`       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∞—Ç–∞–∫.             | `true` –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  const char *code;
  const char *lang;
  bool pure;
  bool deterministic;
} udf_decl_t;

typedef struct {
  const udf_decl_t *udf;
  json_t *args;
} udf_call_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_injection_attempts_detected_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –∞—Ç–∞–∫
* `udf_sandbox_violations_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ sandbox –Ω–∞—Ä—É—à–µ–Ω–∏–π
* `sql_queries_normalized_total` ‚Äî —á–∏—Å–ª–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö SQL
* `udf_pure_violation_total` ‚Äî –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–±–æ—á–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–ª–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤—Å—Ç–∞–≤–æ–∫ —á–µ—Ä–µ–∑ bind-only
* –ò–∑–æ–ª—è—Ü–∏—è UDF –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–º—è—Ç–∏/—Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—ã–∑–æ–≤–∞–º
* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ UDF –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
* –ê–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö side-effects

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.10 ‚Äî SQL Parser`
* `8.12 ‚Äî UDF Sandbox Runtime`
* `11.1 ‚Äî Access Control`
* `7.3 ‚Äî Logging & Audit`
* `9.1 ‚Äî UDF/UDAF API`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_sql_injection_with_comment_escape`
* `test_sql_parameter_binding_only_mode`
* `test_udf_pure_function_behavior`
* `test_sandbox_block_syscall`
* `test_sql_normalizer_whitespace_reduction`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **11.5 ‚Äî –ê—É–¥–∏—Ç, immutable-–ª–æ–≥–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å DML/DDL** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 11.5 ‚Äî –ê—É–¥–∏—Ç, immutable-–ª–æ–≥–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å DML/DDL

**–ü–∞–∫–µ—Ç:** `11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å`
**Block ID:** `audit_immutable_logging_dml_ddl`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**, –≤–∫–ª—é—á–∞—è **DML**, **DDL**, **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é**, **—Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã**, **–¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º** –∏ **–≤—ã–∑–æ–≤—ã UDF**. –†–µ–∞–ª–∏–∑—É–µ—Ç **immutable –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ü–µ–ø–æ—á–µ—á–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`chain-of-trust`), –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –ø–æ–¥–ø–∏—Å—å—é –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–∂–∏–º—ã **policy-driven logging**, –æ–Ω–ª–∞–π–Ω-—ç–∫—Å–ø–æ—Ä—Ç –∏ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------- | ------------------------------------------------------ | ------------------------------------ | ---------- |
| `audit_log_event`     | `void audit_log_event(const audit_event_t *event);`    | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ –∞—É–¥–∏—Ç-–ª–æ–≥.      | `void`     |
| `audit_set_policy`    | `bool audit_set_policy(const audit_policy_t *policy);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –∞—É–¥–∏—Ç–∞.       | `true`     |
| `audit_export_json`   | `json_t *audit_export_json(time_range_t range);`       | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∞—É–¥–∏—Ç-–¥–∞–Ω–Ω—ã–µ.           | JSON       |
| `audit_chain_verify`  | `bool audit_chain_verify(void);`                       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç-—Ü–µ–ø–æ—á–∫–∏. | `true`     |
| `audit_trigger_alert` | `void audit_trigger_alert(const audit_event_t *e);`    | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ AlertManager.   | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char user[64];
  char action[64]; // SELECT, INSERT, UDF_CALL, etc.
  char object[64];
  timestamp_t ts;
  char hash[64];
} audit_event_t;

typedef struct {
  bool log_ddl;
  bool log_dml;
  bool log_udf;
  bool export_realtime;
} audit_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `audit_events_total{type}` ‚Äî —á–∏—Å–ª–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º
* `audit_chain_breaks_total` ‚Äî –æ—à–∏–±–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ü–µ–ø–æ—á–∫–∏
* `audit_exported_batches_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫—Å–ø–æ—Ä—Ç–æ–≤
* `audit_alerts_triggered_total` ‚Äî —á–∏—Å–ª–æ –∞–ª–µ—Ä—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π —Å —Ö–µ—à-—Ü–µ–ø–æ—á–∫–æ–π –∏ TSP
* –ü–æ–ª–∏—Ç–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—É–¥–∏—Ç–æ–º —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π
* –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.2 ‚Äî Auth / Roles`
* `11.1 ‚Äî Access Policies`
* `7.4 ‚Äî AlertManager`
* `4.8 ‚Äî Export Subsystem`
* `3.12 ‚Äî SQL Engine (hook points)`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_audit_log_dml_and_ddl`
* `test_audit_chain_integrity_failure`
* `test_audit_trigger_alert_on_drop`
* `test_audit_export_and_parse`
* `test_audit_policy_change_protection`

---

‚úÖ –ü–∞–∫–µ—Ç **11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **12.1 ‚Äî SQL API, JDBC/ODBC, CLI –∏ WebSocket**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 12.1 ‚Äî SQL API, JDBC/ODBC, CLI –∏ WebSocket

**–ü–∞–∫–µ—Ç:** `12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã`
**Block ID:** `sql_api_jdbc_odbc_cli_ws`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **SQL API** –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –°–£–ë–î: **JDBC**, **ODBC**, **CLI**, –∞ —Ç–∞–∫–∂–µ **WebSocket**-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –¥–ª—è realtime-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ø–æ—Ç–æ–∫–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∫—É—Ä—Å–æ—Ä–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Ç–æ—á–µ–∫. –í–∫–ª—é—á–∞–µ—Ç CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, batch-–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------- | ----------------------------------------------------------- | ------------------------------------------ | ---------- |
| `sql_api_execute`   | `result_t *sql_api_execute(session_t *s, const char *sql);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å –∏–∑ –ª—é–±–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `cli_start_session` | `int cli_start_session(int argc, char **argv);`             | –ó–∞–ø—É—Å–∫–∞–µ—Ç CLI-—Ä–µ–∂–∏–º –∫–ª–∏–µ–Ω—Ç–∞.               | –°—Ç–∞—Ç—É—Å     |
| `jdbc_connect`      | `bool jdbc_connect(const char *url, jdbc_session_t *out);`  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ JDBC.             | `true`     |
| `odbc_connect`      | `bool odbc_connect(const char *dsn, odbc_session_t *out);`  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç ODBC-—Å–µ—Å—Å–∏—é.                 | `true`     |
| `ws_sql_stream`     | `void ws_sql_stream(ws_session_t *ws, const char *query);`  | –°—Ç—Ä–∏–º–∏—Ç SQL-—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ WebSocket.        | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *dsn;
  const char *username;
  const char *password;
} odbc_session_t;

typedef struct {
  const char *url;
  const char *driver;
  bool secure;
} jdbc_session_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sql_requests_total{interface}` ‚Äî –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º
* `cli_sessions_total` ‚Äî —á–∏—Å–ª–æ CLI-—Å–µ—Å—Å–∏–π
* `ws_stream_open_total` ‚Äî —á–∏—Å–ª–æ WebSocket —Å—Ç—Ä–∏–º–æ–≤
* `sql_api_errors_total{type}` ‚Äî –æ—à–∏–±–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* TLS/mTLS –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—ã CLI –∏ WebSocket
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å–µ—Å—Å–∏—è–º, –≥–ª—É–±–∏–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `4.1 ‚Äî Network Layer`
* `3.12 ‚Äî SQL Executor`
* `6.2 ‚Äî Auth / Session`
* `4.6 ‚Äî Protocol Router`
* `7.3 ‚Äî Logging / CLI Telemetry`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_sql_execute_from_cli_batch`
* `test_jdbc_session_establish_and_query`
* `test_odbc_query_with_parameters`
* `test_ws_sql_stream_live_result`
* `test_sql_api_invalid_syntax_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **12.2 ‚Äî REST, gRPC, GraphQL –∏ OpenAPI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 12.2 ‚Äî REST, gRPC, GraphQL –∏ OpenAPI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

**–ü–∞–∫–µ—Ç:** `12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã`
**Block ID:** `rest_grpc_graphql_openapi`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤–Ω–µ—à–Ω–∏—Ö API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**: **REST**, **gRPC**, **GraphQL**, –∞ —Ç–∞–∫–∂–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ **OpenAPI**. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, SQL-–∑–∞–ø—Ä–æ—Å–∞–º, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ—Å—Å–∏—è–º–∏, CDC –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç JSON/Protobuf —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ JWT, TLS –∏ OpenAPI v3-—Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ------------------------------------------------------------ | -------------------------------- | ---------- |
| `rest_handle_request`   | `http_response_t *rest_handle_request(http_request_t *req);` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç REST-–∑–∞–ø—Ä–æ—Å.        | –û—Ç–≤–µ—Ç      |
| `grpc_process_call`     | `bool grpc_process_call(const grpc_call_t *call);`           | –í—ã–ø–æ–ª–Ω—è–µ—Ç gRPC-–≤—ã–∑–æ–≤.            | `true`     |
| `graphql_resolve_query` | `json_t *graphql_resolve_query(const char *query);`          | –í—ã–ø–æ–ª–Ω—è–µ—Ç GraphQL-–∑–∞–ø—Ä–æ—Å.        | JSON       |
| `openapi_generate_spec` | `json_t *openapi_generate_spec(void);`                       | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç OpenAPI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é. | JSON       |
| `api_authenticate_jwt`  | `bool api_authenticate_jwt(const char *token);`              | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç JWT-—Ç–æ–∫–µ–Ω.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[8];
  char path[256];
  json_t *body;
  char headers[16][2][128];
} http_request_t;

typedef struct {
  char service[64];
  char method[64];
  uint8_t *payload;
  size_t len;
} grpc_call_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `api_requests_total{protocol}` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
* `api_latency_ns{protocol}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
* `api_auth_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
* `openapi_spec_generated_total` ‚Äî —á–∏—Å–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ scopes
* TLS/mTLS, rate limits –∏ audit
* –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ per endpoint + CORS
* GraphQL depth limit –∏ whitelisting —Å—Ö–µ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `12.1 ‚Äî SQL API`
* `6.2 ‚Äî Auth System`
* `11.2 ‚Äî TLS/mTLS`
* `7.3 ‚Äî API Logging`
* `4.4 ‚Äî Protocol Multiplexer`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_rest_select_query_and_response`
* `test_grpc_schema_change_with_auth`
* `test_graphql_nested_object_resolve`
* `test_openapi_output_and validation`
* `test_jwt_token_expired_and_rejected`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **12.3 ‚Äî CDC, Changefeed –∏ streaming-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Kafka/Pulsar/Redis** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 12.3 ‚Äî CDC, Changefeed –∏ streaming-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Kafka/Pulsar/Redis

**–ü–∞–∫–µ—Ç:** `12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã`
**Block ID:** `cdc_streaming_kafka_pulsar_redis`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **CDC (Change Data Capture)**, **Changefeed** –∏ **–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö**: **Apache Kafka**, **Apache Pulsar**, **Redis Streams**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ç–∞–±–ª–∏—Ü (INSERT/UPDATE/DELETE), —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ–±—ã—Ç–∏–π (JSON, Avro, Protobuf), –æ—Ç–ø—Ä–∞–≤–∫—É –≤ –ø–æ—Ç–æ–∫–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ QoS (delivery semantics).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | ----------------------------------------------------------------------------- | --------------------------------------- | ---------- |
| `cdc_subscribe_table`     | `bool cdc_subscribe_table(const char *table, const cdc_config_t *cfg);`       | –í–∫–ª—é—á–∞–µ—Ç CDC –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã.               | `true`     |
| `cdc_emit_event`          | `bool cdc_emit_event(const cdc_event_t *event);`                              | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ —Å—Ç—Ä–∏–º.             | `true`     |
| `cdc_changefeed_register` | `bool cdc_changefeed_register(const char *feed, const cdc_filter_t *filter);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç Changefeed.                | `true`     |
| `cdc_stream_flush`        | `void cdc_stream_flush(const char *stream_id);`                               | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –±—É—Ñ–µ—Ä –≤ —Å—Ç—Ä–∏–º. | `void`     |
| `cdc_metrics_report`      | `json_t *cdc_metrics_report(void);`                                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É CDC.              | JSON       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char table[64];
  char stream[64]; // "kafka://...", "pulsar://...", "redis://..."
  char format[16]; // "json", "avro", etc.
  bool include_old;
} cdc_config_t;

typedef struct {
  char table[64];
  char op[8]; // "insert", "update", "delete"
  json_t *row;
  json_t *prev;
  timestamp_t ts;
} cdc_event_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `cdc_events_emitted_total{op}` ‚Äî –∫–æ–ª-–≤–æ —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–∏
* `cdc_stream_errors_total{backend}` ‚Äî –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
* `cdc_backlog_bytes` ‚Äî –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –ø–æ –æ–±—ä—ë–º—É
* `cdc_subscribers_active_total` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS/mTLS –∫ Kafka/Pulsar/Redis
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ feed/table
* –ê—É–¥–∏—Ç —Å–æ–±—ã—Ç–∏–π CDC –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.10 ‚Äî Table Engine`
* `4.5 ‚Äî Output Connectors`
* `6.2 ‚Äî Auth / Role Mapping`
* `7.3 ‚Äî Structured Logging`
* `5.3 ‚Äî Insert Engine / Hooks`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_cdc_insert_event_emission_kafka`
* `test_cdc_update_with_before_after`
* `test_cdc_feed_filtering_and_qos`
* `test_cdc_flush_behavior_under_load`
* `test_cdc_error_handling_in_pulsar`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **12.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (CSV, JSON, Parquet, S3)** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 12.4 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (CSV, JSON, Parquet, S3)

**–ü–∞–∫–µ—Ç:** `12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã`
**Block ID:** `external_sources_csv_json_parquet_s3`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–∏–º–ø–æ—Ä—Ç–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**: —Ñ–∞–π–ª–æ–≤ **CSV**, **JSON**, **Parquet**, **XML**, **Excel**, –∞ —Ç–∞–∫–∂–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â **S3** –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö API. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã, –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ—Ç–æ–∫–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (streaming ingest), –≤–∞–ª–∏–¥–∞—Ü–∏—é, –±–∞—Ç—á–∏–Ω–≥, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤, –∑–∞–≥—Ä—É–∑–∫—É —Å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º–∏ –∏ —ç–∫—Å–ø–æ—Ä—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | ---------------------------------------------------------------------------- | ------------------------------------------ | ---------- |
| `external_import_file`   | `bool external_import_file(const char *path, const import_config_t *cfg);`   | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏.                | `true`     |
| `external_export_table`  | `bool external_export_table(const char *table, const export_config_t *cfg);` | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –≤–æ –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª.      | `true`     |
| `external_scan_s3`       | `bool external_scan_s3(const char *uri, const s3_config_t *cfg);`            | –°–∫–∞–Ω–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç/–∫–∞—Ç–∞–ª–æ–≥ –≤ S3.             | `true`     |
| `external_detect_schema` | `json_t *external_detect_schema(const char *path);`                          | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ö–µ–º—É –¥–∞–Ω–Ω—ã—Ö.                   | JSON       |
| `external_list_formats`  | `json_t *external_list_formats(void);`                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤. | JSON       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char delimiter;
  bool header;
  bool strict;
  char format[16]; // "csv", "json", "parquet", etc.
} import_config_t;

typedef struct {
  char format[16];
  char destination[256];
  bool overwrite;
} export_config_t;

typedef struct {
  char access_key[64];
  char secret_key[64];
  char bucket[128];
  char region[32];
  bool secure;
} s3_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `external_files_imported_total{format}` ‚Äî —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ
* `external_export_errors_total{format}` ‚Äî –æ—à–∏–±–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
* `external_s3_bytes_read_total` ‚Äî –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –±–∞–π—Ç –∏–∑ S3
* `external_schema_autodetect_failures` ‚Äî —Å–±–æ–∏ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ —Å—Ö–µ–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –ø—É—Ç–∏/–æ–±—ä–µ–∫—Ç—ã, white-listing bucket-–æ–≤
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ (TLS) –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –ø—Ä–∞–≤–∞–º
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.4 ‚Äî ETL Engine`
* `4.5 ‚Äî Connectors`
* `6.6 ‚Äî Access Policy Engine`
* `7.3 ‚Äî Structured Logging`
* `1.10 ‚Äî Table Engine`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_import_csv_with_header_and_schema_match`
* `test_export_table_to_parquet_file`
* `test_import_json_from_s3_secure`
* `test_schema_detection_with_complex_types`
* `test_import_with_invalid_delimiter`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **12.5 ‚Äî Webhook –∏ –≤—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 12.5 ‚Äî Webhook –∏ –≤—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

**–ü–∞–∫–µ—Ç:** `12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã`
**Block ID:** `webhook_external_procedure_calls`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤—ã–∑–æ–≤–∞ –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä** –∏ **webhook-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏–∑–Ω—É—Ç—Ä–∏ –°–£–ë–î (–∏–∑ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤, SQL, UDF), –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –≤—ã–∑—ã–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ API, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ (async) –≤—ã–∑–æ–≤—ã, —à–∞–±–ª–æ–Ω—ã URL, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–≤–µ—Ç–æ–≤, retry-–ø–æ–ª–∏—Ç–∏–∫—É –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –æ—à–∏–±–æ–∫.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | -------------------------------------------------------------------------------- | ----------------------------------- | ---------- |
| `webhook_call_sync`       | `json_t *webhook_call_sync(const webhook_request_t *req);`                       | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ webhook. | –û—Ç–≤–µ—Ç      |
| `webhook_call_async`      | `bool webhook_call_async(const webhook_request_t *req);`                         | –ó–∞–ø—É—Å–∫–∞–µ—Ç async-–≤—ã–∑–æ–≤ –≤–Ω–µ—à–Ω–µ–≥–æ API. | `true`     |
| `webhook_define_template` | `bool webhook_define_template(const char *name, const webhook_template_t *tpl);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –≤—ã–∑–æ–≤–∞.         | `true`     |
| `webhook_list_templates`  | `json_t *webhook_list_templates(void);`                                          | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤.               | JSON       |
| `webhook_invoke_template` | `json_t *webhook_invoke_template(const char *name, const json_t *params);`       | –í—ã–∑—ã–≤–∞–µ—Ç —à–∞–±–ª–æ–Ω —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.      | –û—Ç–≤–µ—Ç      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[8];  // "GET", "POST"
  char url[256];
  json_t *headers;
  json_t *body;
  uint64_t timeout_ms;
} webhook_request_t;

typedef struct {
  char name[64];
  char url_template[256];
  char method[8];
  json_t *default_headers;
} webhook_template_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `webhook_requests_total{status}` ‚Äî –≤—ã–∑–æ–≤–æ–≤ –ø–æ —Å—Ç–∞—Ç—É—Å—É
* `webhook_failures_total{reason}` ‚Äî –æ—à–∏–±–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* `webhook_avg_response_time_ms` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
* `webhook_async_pending_total` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã—Ö async –≤—ã–∑–æ–≤–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ URL, IP, –¥–æ–º–µ–Ω–∞–º (white-list)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π (HMAC), –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (token, mTLS)
* –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —à–∞–±–ª–æ–Ω—ã –∏ runtime-invocation

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.2 ‚Äî Auth / Roles`
* `4.4 ‚Äî Protocol Layer`
* `9.1 ‚Äî UDF API`
* `11.1 ‚Äî Access Control`
* `7.3 ‚Äî Logging / Alert`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_webhook_post_with_json_payload`
* `test_webhook_async_trigger_on_insert`
* `test_webhook_template_param_resolution`
* `test_webhook_timeout_and_retry`
* `test_webhook_acl_restrictions`

---

‚úÖ –ü–∞–∫–µ—Ç **12. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ü—Ä–æ—Ç–æ–∫–æ–ª—ã** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **13.1 ‚Äî Views, Materialized Views, Adaptive Aggregates**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 13.1 ‚Äî Views, Materialized Views, Adaptive Aggregates

**–ü–∞–∫–µ—Ç:** `13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `views_materialized_adaptive_aggregates`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (views)**, **–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (materialized views)** –∏ **–∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤**. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞–¥ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –æ–±–Ω–æ–≤–ª—è—Ç—å –∏—Ö –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, —Å–æ–±—ã—Ç–∏—é –∏–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------- | ---------- |
| `view_create`        | `bool view_create(const char *name, const char *query);`                            | –°–æ–∑–¥–∞—ë—Ç –æ–±—ã—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.              | `true`     |
| `mview_create`       | `bool mview_create(const char *name, const char *query, const mview_opts_t *opts);` | –°–æ–∑–¥–∞—ë—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.    | `true`     |
| `aggregate_register` | `bool aggregate_register(const char *name, agg_fn_t fn);`                           | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ç–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é. | `true`     |
| `mview_refresh`      | `bool mview_refresh(const char *name);`                                             | –û–±–Ω–æ–≤–ª—è–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.  | `true`     |
| `view_resolve`       | `const char *view_resolve(const char *name);`                                       | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç SQL —Ç–µ–ª–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.          | SQL-—Å—Ç—Ä–æ–∫–∞ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool auto_refresh;
  uint64_t refresh_interval_ms;
  bool on_change;
} mview_opts_t;

typedef struct {
  const char *name;
  value_t (*fn)(const row_t *, size_t);
} agg_fn_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `view_resolution_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
* `mview_refresh_total{mode}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π MV –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é/—Å–æ–±—ã—Ç–∏—é
* `aggregate_hits_total{name}` ‚Äî —á–∏—Å–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* `mview_invalidations_total` ‚Äî —á–∏—Å–ª–æ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö MV

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ/–ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
* –í–∞–ª–∏–¥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∑–∞–º–µ–Ω–µ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `1.10 ‚Äî Table Engine`
* `5.2 ‚Äî Aggregation Engine`
* `6.2 ‚Äî Auth`
* `7.3 ‚Äî Logging / Refresh Monitor`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_view_create_and_select`
* `test_materialized_view_refresh_by_timer`
* `test_adaptive_aggregate_substitution`
* `test_view_dependency_resolution`
* `test_mview_on_change_invalidation_trigger`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **13.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ROLLUP, CUBE, OLAP —Ñ—É–Ω–∫—Ü–∏–π –∏ precomputed –∫—É–±–æ–≤** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 13.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ROLLUP, CUBE, OLAP —Ñ—É–Ω–∫—Ü–∏–π –∏ precomputed –∫—É–±–æ–≤

**–ü–∞–∫–µ—Ç:** `13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `rollup_cube_olap_precomputed_cubes`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö OLAP-–∞–≥—Ä–µ–≥–∞—Ü–∏–π** ‚Äî `ROLLUP`, `CUBE`, `GROUPING SETS`, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö **–∫—É–±–æ–≤ –∞–≥—Ä–µ–≥–∞—Ü–∏–π**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏, —É—Å–∫–æ—Ä—è—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ —Å—á—ë—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö precomputed-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Å—Ç—Ä–æ–∏—Ç—å –∏ –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å OLAP-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ SQL.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                          | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ------------------------------------------------- | --------------------------------------- | ---------- |
| `olap_cube_define`      | `bool olap_cube_define(const cube_def_t *def);`   | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∫—É–±.       | `true`     |
| `olap_cube_refresh`     | `bool olap_cube_refresh(const char *cube_name);`  | –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫—É–±–µ.              | `true`     |
| `olap_group_rollup`     | `result_t *olap_group_rollup(const char *query);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç ROLLUP –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏.       | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `olap_group_cube`       | `result_t *olap_group_cube(const char *query);`   | –í—ã–ø–æ–ª–Ω—è–µ—Ç CUBE-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É.             | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `olap_cube_match_query` | `bool olap_cube_match_query(const char *sql);`    | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø—Ä–∏–º–µ–Ω–∏–º –ª–∏ precomputed –∫—É–±. | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char base_table[64];
  char dimensions[8][64];
  char measures[8][64];
  uint64_t refresh_interval_ms;
} cube_def_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `olap_cubes_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—É–±–æ–≤
* `olap_cube_hits_total{name}` ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π precomputed –∫—É–±–∞
* `rollup_queries_total` ‚Äî —á–∏—Å–ª–æ rollup-–∑–∞–ø—Ä–æ—Å–æ–≤
* `cube_refresh_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º –∏ –¥–∞–Ω–Ω—ã—Ö
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ define/refresh/use –∫—É–±–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `13.1 ‚Äî Materialized Views / Aggregates`
* `3.12 ‚Äî SQL Planner`
* `5.2 ‚Äî Aggregation Engine`
* `6.2 ‚Äî Auth System`
* `7.1 ‚Äî Metrics Collector`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_rollup_grouping_with_nulls`
* `test_cube_grouping_combinations`
* `test_define_and_refresh_precomputed_cube`
* `test_olap_query_using_cached_cube`
* `test_cube_fallback_on_data_mismatch`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **13.3 ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: rank, percentiles, lag/lead** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 13.3 ‚Äî –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏: rank, percentiles, lag/lead

**–ü–∞–∫–µ—Ç:** `13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `analytic_functions_rank_percentile_lag_lead`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º SQL:2011+, –≤–∫–ª—é—á–∞—è `RANK`, `DENSE_RANK`, `PERCENTILE_CONT`, `PERCENTILE_DISC`, `NTILE`, `LAG`, `LEAD`, `FIRST_VALUE`, `LAST_VALUE`. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ –æ–∫–Ω–∞—Ö —Å –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —Ä–∞–º–∫–∞–º–∏ (PARTITION BY, ORDER BY), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—É—é –∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------------- | ---------------------------------------------------------------------------------- | ----------------------------------- | ---------- |
| `analytic_fn_register`        | `bool analytic_fn_register(const analytic_def_t *def);`                            | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é. | `true`     |
| `analytic_fn_execute`         | `column_t *analytic_fn_execute(const analytic_def_t *def, const column_t *input);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞–¥ –∫–æ–ª–æ–Ω–∫–æ–π.     | –ö–æ–ª–æ–Ω–∫–∞    |
| `analytic_frame_init`         | `bool analytic_frame_init(window_frame_t *frame);`                                 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–∫–æ–Ω–Ω—É—é —Ä–∞–º–∫—É.       | `true`     |
| `analytic_rank_compute`       | `column_t *analytic_rank_compute(const column_t *order);`                          | –í—ã—á–∏—Å–ª—è–µ—Ç RANK.                     | –ö–æ–ª–æ–Ω–∫–∞    |
| `analytic_percentile_compute` | `column_t *analytic_percentile_compute(const column_t *values, double p);`         | –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å.               | –ö–æ–ª–æ–Ω–∫–∞    |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[32];      // "rank", "lead", etc.
  bool requires_order;
  bool requires_partition;
  column_t *(*fn)(const column_t *, const column_t *, const window_frame_t *);
} analytic_def_t;

typedef struct {
  int start_offset;
  int end_offset;
  bool is_rows;
} window_frame_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `analytic_functions_invoked_total{name}` ‚Äî –≤—ã–∑–æ–≤—ã –ø–æ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏
* `analytic_execution_latency_ns{name}` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* `analytic_window_frame_errors_total` ‚Äî –æ—à–∏–±–∫–∏ —Ä–∞–º–∫–∏ –æ–∫–Ω–∞
* `analytic_vectorization_ratio` ‚Äî —Å—Ç–µ–ø–µ–Ω—å –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –æ–∫–æ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫ –∏ –≥—Ä–∞–Ω–∏—Ü
* –ó–∞–ø—Ä–µ—Ç side-effect —Ñ—É–Ω–∫—Ü–∏–π –≤–Ω—É—Ç—Ä–∏ –æ–∫–æ–Ω
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ UDF/DSL

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `5.2 ‚Äî Aggregation Engine`
* `13.1 ‚Äî Views / Aggregates`
* `3.10 ‚Äî Expression Engine`
* `7.1 ‚Äî Profiler`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_rank_over_partition_order`
* `test_percentile_disc_edge_cases`
* `test_lag_lead_across_partitions`
* `test_window_frame_rows_and_range`
* `test_first_last_value_null_handling`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **13.4 ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, ML API** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 13.4 ‚Äî –°—Ü–µ–Ω–∞—Ä–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è, ML API

**–ü–∞–∫–µ—Ç:** `13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `clustering_correlation_forecasting_ml_api`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö **–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π –∏ —Ñ—É–Ω–∫—Ü–∏–π**, –≤–∫–ª—é—á–∞—è **–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, K-Means)**, **–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑**, **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã (ARIMA, ETS)**, –∞ —Ç–∞–∫–∂–µ API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å **ML-–º–æ–¥–µ–ª—è–º–∏ –≤ ONNX, TensorFlow, PyTorch**. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–æ–¥–µ–ª–∏ –Ω–∞–¥ —Ç–∞–±–ª–∏—Ü–∞–º–∏, –ø—Ä–∏–º–µ–Ω—è—Ç—å –æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏, –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –æ–±—É—á–∞—é—â–∏–µ –≤—ã–±–æ—Ä–∫–∏ –∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                          | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | -------------------------------------------------------------------------------------------- | --------------------------------- | ---------- |
| `ml_model_register`            | `bool ml_model_register(const ml_model_t *model);`                                           | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç ML-–º–æ–¥–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ. | `true`     |
| `ml_model_predict`             | `column_t *ml_model_predict(const char *model, const column_t *input);`                      | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ.           | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `analytics_cluster_kmeans`     | `json_t *analytics_cluster_kmeans(const column_t *data, int k);`                             | –ó–∞–ø—É—Å–∫–∞–µ—Ç K-Means –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é.  | JSON       |
| `analytics_correlation_matrix` | `json_t *analytics_correlation_matrix(const table_t *table);`                                | –í—ã—á–∏—Å–ª—è–µ—Ç –º–∞—Ç—Ä–∏—Ü—É –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π.     | JSON       |
| `analytics_forecast_series`    | `column_t *analytics_forecast_series(const column_t *series, const forecast_config_t *cfg);` | –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥.       | –ö–æ–ª–æ–Ω–∫–∞    |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  const char *name;
  const char *format; // "onnx", "tensorflow", etc.
  void *payload;
  size_t size;
} ml_model_t;

typedef struct {
  int horizon;
  char model[16]; // "arima", "ets", "holt"
  double alpha;
} forecast_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ml_predictions_total{name}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
* `clustering_runtime_ns` ‚Äî –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* `forecast_accuracy_avg{name}` ‚Äî —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–∞
* `ml_model_errors_total{type}` ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π (sandboxed)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π (–ø–æ–¥–ø–∏—Å–∏, —Å—Ö–µ–º–∞)
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `13.3 ‚Äî Analytic Functions`
* `8.12 ‚Äî Sandbox Runtime`
* `6.6 ‚Äî Access Control`
* `7.1 ‚Äî Profiler`
* `3.12 ‚Äî SQL Engine`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_kmeans_clustering_small_dataset`
* `test_forecast_arima_fixed_horizon`
* `test_correlation_matrix_with_nulls`
* `test_onnx_model_prediction_batch`
* `test_ml_model_register_and_invoke`

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –±–ª–æ–∫—É —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞ ‚Äî **13.5 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –æ–∫–æ–Ω–Ω—ã–µ UDF/DSL** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 13.5 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ –æ–∫–æ–Ω–Ω—ã–µ UDF/DSL

**–ü–∞–∫–µ—Ç:** `13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `forecasting_udf_dsl_window_scenarios`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **—Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è** –Ω–∞ SQL-–ø–æ–¥–æ–±–Ω–æ–º **DSL-—è–∑—ã–∫–µ**, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–≤–∞—Ç—å **–æ–∫–æ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (UDF)**, –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —É—Å–ª–æ–≤–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–∫–æ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç—ã –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—è multistep-forecast, detect+predict, threshold-based alerts.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | ------------------------------------------------------------------------------ | -------------------------------------- | ---------- |
| `forecast_scenario_register` | `bool forecast_scenario_register(const forecast_scenario_t *sc);`              | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.      | `true`     |
| `forecast_scenario_execute`  | `result_t *forecast_scenario_execute(const char *name, const table_t *input);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π. | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `window_udf_register`        | `bool window_udf_register(const udf_decl_t *decl);`                            | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–∫–æ–Ω–Ω—É—é UDF.              | `true`     |
| `dsl_compile_forecast`       | `forecast_plan_t *dsl_compile_forecast(const char *script);`                   | –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç DSL-—Å—Ü–µ–Ω–∞—Ä–∏–π.              | –ü–ª–∞–Ω       |
| `forecast_eval_plan`         | `result_t *forecast_eval_plan(forecast_plan_t *plan, const table_t *input);`   | –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –ø–ª–∞–Ω—É.            | –†–µ–∑—É–ª—å—Ç–∞—Ç  |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  const char *dsl_script;
  int horizon;
  char trigger[128];
} forecast_scenario_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `forecast_scenarios_total` ‚Äî —á–∏—Å–ª–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
* `forecast_dsl_compile_failures` ‚Äî –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ DSL
* `forecast_eval_runtime_ns` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ–≥–Ω–æ–∑–∞
* `window_udf_invocations_total` ‚Äî –≤—ã–∑–æ–≤–æ–≤ –æ–∫–æ–Ω–Ω—ã—Ö UDF

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è DSL –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –≤–Ω–µ —Ç–µ–∫—É—â–µ–≥–æ –æ–∫–Ω–∞
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —á–∏—Å–ª—É –∏—Ç–µ—Ä–∞—Ü–∏–π/–≥–ª—É–±–∏–Ω–µ –æ–∫–Ω–∞
* –ê—É–¥–∏—Ç —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ forecast hook-–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `13.4 ‚Äî ML API`
* `13.3 ‚Äî Analytic Functions`
* `9.1 ‚Äî UDF API`
* `3.10 ‚Äî DSL Engine`
* `6.6 ‚Äî Access Control`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_forecast_scenario_compile_and_run`
* `test_window_udf_custom_moving_avg`
* `test_dsl_forecast_trigger_on_threshold`
* `test_forecast_multistep_with_lag_lead`
* `test_forecast_access_control_scope`

---

‚úÖ –ü–∞–∫–µ—Ç **13. BI –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **14.1 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 14.1 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è

**–ü–∞–∫–µ—Ç:** `14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ`
**Block ID:** `distributed_query_planner_and_coordination`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤**, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–±–∏–≤–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —á–∞—Å—Ç–∏, –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –æ–±–º–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ñ–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**, **pushdown —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø—Ä–æ–µ–∫—Ü–∏–π**, **–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é –¥–∂–æ–π–Ω–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π**, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–∫–∞–∑–æ–≤ —É–∑–ª–æ–≤ –∏ –ø–ª–∞–Ω–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------ | ---------- |
| `query_plan_distribute`      | `dquery_plan_t *query_plan_distribute(const query_ast_t *ast);`                     | –°—Ç—Ä–æ–∏—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω.                | DQ-–ø–ª–∞–Ω    |
| `query_plan_schedule`        | `bool query_plan_schedule(const dquery_plan_t *plan);`                              | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞ —É–∑–ª–∞—Ö.             | `true`     |
| `query_node_result_receive`  | `bool query_node_result_receive(const char *node_id, const result_chunk_t *chunk);` | –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø–æ–¥—É–∑–ª–∞.                | `true`     |
| `query_plan_recover`         | `bool query_plan_recover(const dquery_plan_t *plan);`                               | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–æ—Å–ª–µ —Å–±–æ—è. | `true`     |
| `query_coordination_barrier` | `bool query_coordination_barrier(const char *query_id);`                            | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —à–∞–≥–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.            | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char query_id[64];
  node_ref_t fragments[32];
  size_t num_fragments;
  bool fault_tolerant;
} dquery_plan_t;

typedef struct {
  const char *node_id;
  const void *data;
  size_t len;
} result_chunk_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `distributed_query_plans_total` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤
* `query_fragment_failures_total` ‚Äî —Å–±–æ–µ–≤ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤
* `query_coordination_barriers_total` ‚Äî –±–∞—Ä—å–µ—Ä–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
* `query_plan_recovery_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ shard-–ø–æ–ª–∏—Ç–∏–∫ –∏ –¥–∞–Ω–Ω—ã—Ö
* –ê—É–¥–∏—Ç –º–µ–∂—É–∑–ª–æ–≤–æ–≥–æ –æ–±–º–µ–Ω–∞ –∏ –ø–ª–∞–Ω–æ–≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.11 ‚Äî SQL Planner`
* `5.5 ‚Äî Execution Engine`
* `14.2 ‚Äî Sharding Engine`
* `6.2 ‚Äî Auth / ACL`
* `7.1 ‚Äî Profiler / Trace`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_query_plan_distributed_with_join`
* `test_query_coordination_with_timeout`
* `test_query_recovery_on_partial_failure`
* `test_barrier_synchronization_under_load`
* `test_query_fragment_ordered_merge`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **14.2 ‚Äî –®–∞—Ä–¥–∏–Ω–≥, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, auto-rebalance, data locality** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 14.2 ‚Äî –®–∞—Ä–¥–∏–Ω–≥, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, auto-rebalance, data locality

**–ü–∞–∫–µ—Ç:** `14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ`
**Block ID:** `sharding_partitioning_rebalance_locality`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã **–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è** –∑–∞ —Å—á—ë—Ç **—à–∞—Ä–¥–∏–Ω–≥–∞**, **–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**, **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è** –∏ **data locality-awareness**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–ª—é—á–µ–≤–æ–π –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–π —à–∞—Ä–¥–∏–Ω–≥, –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏, –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏, —É—á—ë—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏, –∞ —Ç–∞–∫–∂–µ —Ö–æ–ª–æ–¥–Ω—ã–µ –∏ –≥–æ—Ä—è—á–∏–µ —Å–µ–≥–º–µ–Ω—Ç—ã –¥–∞–Ω–Ω—ã—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------------- | ------------------------------------------------------------------------ | ----------------------------------- | ---------- |
| `shard_assign_table`       | `bool shard_assign_table(const char *table, const shard_config_t *cfg);` | –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ö–µ–º—É —à–∞—Ä–¥–∏–Ω–≥–∞.           | `true`     |
| `shard_rebalance_start`    | `bool shard_rebalance_start(void);`                                      | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä—É auto-rebalance. | `true`     |
| `partition_create`         | `bool partition_create(const char *table, const char *expr);`            | –°–æ–∑–¥–∞—ë—Ç –ø–∞—Ä—Ç–∏—Ü–∏—é –ø–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—é.      | `true`     |
| `shard_node_locality_hint` | `const char *shard_node_locality_hint(const char *shard_id);`            | –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —É–∑–µ–ª.   | Node ID    |
| `shard_migrate_data`       | `bool shard_migrate_data(const char *shard_id, const char *dst_node);`   | –ú–∏–≥—Ä–∏—Ä—É–µ—Ç shard –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char method[16]; // "hash", "range"
  char key[64];
  int replication_factor;
  bool hot_data_hint;
} shard_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `shard_distribution_skew{table}` ‚Äî –¥–∏—Å–±–∞–ª–∞–Ω—Å –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
* `rebalance_operations_total` ‚Äî —á–∏—Å–ª–æ —Ä–µ–±–∞–ª–∞–Ω—Å–æ–≤
* `partition_scan_latency_ns` ‚Äî –≤—Ä–µ–º—è –≤—ã–±–æ—Ä–∫–∏ –∏–∑ –ø–∞—Ä—Ç–∏—Ü–∏–∏
* `shard_migration_duration_ms` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ ACL –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ shard/partition-–ø–æ–ª–∏—Ç–∏–∫
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.10 ‚Äî Storage Engine`
* `14.1 ‚Äî Query Planner`
* `6.2 ‚Äî Auth / ACL`
* `7.3 ‚Äî Logging / Tracing`
* `2.1 ‚Äî Snapshot Isolation`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_shard_assignment_by_hash`
* `test_partition_creation_and_query`
* `test_rebalance_under_node_addition`
* `test_data_locality_affinity_planner`
* `test_shard_migration_consistency_check`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **14.3 ‚Äî –ú–Ω–æ–≥–æ–Ω–æ–¥–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è: active-active, Raft, failover** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 14.3 ‚Äî –ú–Ω–æ–≥–æ–Ω–æ–¥–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è: active-active, Raft, failover

**–ü–∞–∫–µ—Ç:** `14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ`
**Block ID:** `multi_node_replication_raft_failover`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–º–Ω–æ–≥–æ–Ω–æ–¥–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**, –≤–∫–ª—é—á–∞—è —Ä–µ–∂–∏–º—ã **active-active**, **active-passive**, **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover**, –∞ —Ç–∞–∫–∂–µ –∫–æ–Ω—Å–µ–Ω—Å—É—Å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º **Raft** (–∏–ª–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ Paxos). –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–∑–ª–∞–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –∫–≤–æ—Ä—É–º—ã –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ —É–∑–ª–æ–≤ (leader/follower/candidate).

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | --------------------------------------------------------------------------- | --------------------------------------- | ---------- |
| `replication_start`            | `bool replication_start(const repl_config_t *cfg);`                         | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.     | `true`     |
| `replication_receive_log`      | `bool replication_receive_log(const char *from, const wal_entry_t *entry);` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç—É–ø–∞—é—â–∏–π –ª–æ–≥.           | `true`     |
| `raft_elect_leader`            | `bool raft_elect_leader(void);`                                             | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–±–æ—Ä–æ–≤.              | `true`     |
| `replication_failover_trigger` | `bool replication_failover_trigger(const char *node_id);`                   | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –º–∞—Å—Ç–µ—Ä.       | `true`     |
| `replication_status_query`     | `json_t *replication_status_query(void);`                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é –∏ —Å—Ç–∞—Ç—É—Å—ã. | JSON       |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char cluster_id[64];
  char node_id[64];
  int quorum_size;
  bool use_raft;
  bool enable_async_replication;
} repl_config_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `replication_events_total{type}` ‚Äî —Å–æ–±—ã—Ç–∏—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ —Ç–∏–ø—É
* `raft_elections_total` ‚Äî —á–∏—Å–ª–æ –≤—ã–±–æ—Ä–æ–≤ –ª–∏–¥–µ—Ä–∞
* `replication_lag_bytes{node}` ‚Äî –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –ø–æ –±–∞–π—Ç–∞–º
* `failover_triggers_total` ‚Äî —á–∏—Å–ª–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (TLS/mTLS)
* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –º–µ–∂–Ω–æ–¥–æ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (token/signature)
* ACL –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏, —Ä–µ–ø–ª–∏–∫–∞–º–∏, —É–∑–ª–∞–º–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.2 ‚Äî WAL / Logs`
* `6.2 ‚Äî Auth System`
* `4.1 ‚Äî Network Layer`
* `14.1 ‚Äî Distributed Planner`
* `7.4 ‚Äî AlertManager / Watchdog`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_raft_leader_election_with_quorum`
* `test_active_active_conflict_resolution`
* `test_failover_trigger_and_status`
* `test_replication_log_receive_and_apply`
* `test_replication_lag_monitoring_metrics`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **14.4 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∫–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏—è –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 14.4 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∫–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏—è –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ü–∞–∫–µ—Ç:** `14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ`
**Block ID:** `distributed_catalog_and_global_transactions`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∫–∞—Ç–∞–ª–æ–≥–∏–∑–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (—Ç–∞–±–ª–∏—Ü, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, –∏–Ω–¥–µ–∫—Å–æ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç.–¥.) –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ **–≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –ø–æ 2PC –∏–ª–∏ Paxos/RAFT, –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É online-ALTER –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | ------------------------------------------------------------------ | ------------------------------------------- | ---------- |
| `catalog_distributed_register` | `bool catalog_distributed_register(const catalog_entry_t *entry);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ.  | `true`     |
| `txn_global_begin`             | `gxtn_t *txn_global_begin(void);`                                  | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.       | –ö–æ–Ω—Ç–µ–∫—Å—Ç   |
| `txn_global_commit`            | `bool txn_global_commit(gxtn_t *txn);`                             | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–º–∏—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.     | `true`     |
| `txn_global_abort`             | `void txn_global_abort(gxtn_t *txn);`                              | –û—Ç–º–µ–Ω—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö.          | `void`     |
| `catalog_lookup_global`        | `catalog_entry_t *catalog_lookup_global(const char *name);`        | –í—ã–ø–æ–ª–Ω—è–µ—Ç lookup –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ. | –û–±—ä–µ–∫—Ç     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char type[16];  // "table", "view", "index", etc.
  char owner[64];
  timestamp_t created_at;
} catalog_entry_t;

typedef struct {
  char gtid[64];  // Global transaction ID
  bool active;
  timestamp_t start_time;
} gxtn_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `global_transactions_total{status}` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
* `distributed_catalog_lookups_total` ‚Äî –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É
* `catalog_conflict_detected_total` ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
* `gxtn_latency_commit_ns` ‚Äî –≤—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ DDL –∏ DML
* –ê—É–¥–∏—Ç –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å—Ö–µ–º –ø—Ä–∏ race condition

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC + Snapshot Isolation`
* `1.11 ‚Äî Catalog Engine`
* `6.2 ‚Äî Auth / ACL`
* `14.3 ‚Äî Replication / Coordination`
* `7.4 ‚Äî Tracing / Metrics`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_global_transaction_commit_across_nodes`
* `test_distributed_catalog_object_creation`
* `test_gxtn_conflict_and_abort`
* `test_catalog_lookup_remote_node`
* `test_global_ddl_with_catalog_sync`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **14.5 ‚Äî Query shipping, remote exec, federated joins** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 14.5 ‚Äî Query shipping, remote exec, federated joins

**–ü–∞–∫–µ—Ç:** `14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ`
**Block ID:** `query_shipping_remote_exec_federated_joins`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **query shipping** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —É–∑–ª–∞—Ö –±–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ **federated joins** –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–æ–¥–∞—Ö. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö**, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é —Å–µ—Ç–µ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º, –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------- | -------------------------------------------------------------------------- | ------------------------------------------------ | ---------- |
| `remote_exec_dispatch`    | `bool remote_exec_dispatch(const exec_unit_t *unit, const char *node_id);` | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–¥–∏–Ω–∏—Ü—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —É–∑–µ–ª. | `true`     |
| `remote_exec_collect`     | `result_chunk_t *remote_exec_collect(const char *query_id);`               | –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–∞.        | Chunk      |
| `federated_join_plan`     | `fjoin_plan_t *federated_join_plan(const join_ast_t *ast);`                | –°—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ join-–∞.              | –ü–ª–∞–Ω       |
| `federated_join_execute`  | `result_t *federated_join_execute(const fjoin_plan_t *plan);`              | –í—ã–ø–æ–ª–Ω—è–µ—Ç federated join.                        | –†–µ–∑—É–ª—å—Ç–∞—Ç  |
| `query_shipping_optimize` | `bool query_shipping_optimize(query_plan_t *plan);`                        | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –ø–ª–∞–Ω –ø–æ–¥ shipping-–º–æ–¥–µ–ª—å.            | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char node_id[64];
  char query_id[64];
  const char *sql_fragment;
} exec_unit_t;

typedef struct {
  char left_node[64];
  char right_node[64];
  char join_type[16];
  char condition[128];
} fjoin_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `remote_exec_units_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–∞–Ω–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü
* `federated_joins_total{type}` ‚Äî —á–∏—Å–ª–æ join-–æ–≤ –ø–æ —Ç–∏–ø–∞–º
* `remote_exec_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞
* `query_shipping_optimizations_applied` ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–ª–∞–Ω–æ–≤ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —É–∑–ª—É –∏ shard-—É
* –ó–∞—â–∏—Ç–∞ –æ—Ç reentrancy –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –∫–∞–Ω–∞–ª–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `14.1 ‚Äî Distributed Query Planner`
* `14.2 ‚Äî Sharding Engine`
* `3.11 ‚Äî Join Planner`
* `4.1 ‚Äî Inter-node Transport`
* `6.2 ‚Äî Auth / ACL`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_remote_exec_single_node_fragment`
* `test_federated_join_across_shards`
* `test_query_shipping_with_local_pushdown`
* `test_remote_result_consistency`
* `test_shipping_optimization_decision`

---

‚úÖ –ü–∞–∫–µ—Ç **14. –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **15. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **15.1 ‚Äî SYSTEM VERSIONED —Ç–∞–±–ª–∏—Ü—ã, AS OF –∏ temporal-–∑–∞–ø—Ä–æ—Å—ã**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 15.1 ‚Äî SYSTEM VERSIONED —Ç–∞–±–ª–∏—Ü—ã, AS OF –∏ temporal-–∑–∞–ø—Ä–æ—Å—ã

**–ü–∞–∫–µ—Ç:** `15. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º`
**Block ID:** `system_versioned_tables_asof_temporal`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **—Å–∏—Å—Ç–µ–º–Ω–æ-–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü** (`SYSTEM VERSIONED`), –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö —Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —É—á—ë—Ç–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Å–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `AS OF SYSTEM TIME`, –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤–µ—Ä—Å–∏–π –∏ TTL. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º overhead –∏ –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                     | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç       |
| ------------------------- | -------------------------------------------------------------------------------- | -------------------------------------------- | ---------------- |
| `versioned_table_create`  | `bool versioned_table_create(const char *table, const versioning_opts_t *opts);` | –°–æ–∑–¥–∞—ë—Ç SYSTEM VERSIONED —Ç–∞–±–ª–∏—Ü—É.            | `true`           |
| `query_as_of`             | `result_t *query_as_of(const char *sql, timestamp_t ts);`                        | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å `AS OF` –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è. | –†–µ–∑—É–ª—å—Ç–∞—Ç        |
| `version_chain_get`       | `version_chain_t *version_chain_get(const char *table, uint64_t rowid);`         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É –≤–µ—Ä—Å–∏–π —Å—Ç—Ä–æ–∫–∏.            | Chain            |
| `version_gc_run`          | `int version_gc_run(const char *table);`                                         | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –≤–µ—Ä—Å–∏–∏ (TTL).             | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö |
| `version_snapshot_export` | `json_t *version_snapshot_export(const char *table, timestamp_t ts);`            | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç snapshot –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏.     | JSON             |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool enable_ttl;
  uint64_t ttl_seconds;
  bool auto_compact;
} versioning_opts_t;

typedef struct {
  timestamp_t valid_from;
  timestamp_t valid_to;
  json_t *data;
} version_chain_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `versioned_rows_total{table}` ‚Äî —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ —Å –≤–µ—Ä—Å–∏—è–º–∏
* `version_gc_runs_total` ‚Äî —á–∏—Å–ª–æ –∑–∞–ø—É—Å–∫–æ–≤ GC
* `as_of_queries_total` ‚Äî —á–∏—Å–ª–æ AS OF-–∑–∞–ø—Ä–æ—Å–æ–≤
* `snapshot_export_latency_ms` ‚Äî –≤—Ä–µ–º—è —ç–∫—Å–ø–æ—Ä—Ç–∞ snapshot

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ä–µ–∑–∞–º (time-bound ACL)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –≤–µ—Ä—Å–∏–π
* –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è `AS OF`

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC Compressed Chains`
* `1.10 ‚Äî Storage Engine`
* `6.2 ‚Äî Auth / Policy`
* `7.3 ‚Äî Logging / Snapshot Monitor`
* `5.3 ‚Äî Insert Engine`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_create_versioned_table_and_insert`
* `test_as_of_query_correct_snapshot`
* `test_ttl_cleanup_old_versions`
* `test_version_chain_consistency`
* `test_export_snapshot_to_json_ts`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **15.2 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–æ–≤, snapshot restore, clone table** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 15.2 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–æ–≤, snapshot restore, clone table

**–ü–∞–∫–µ—Ç:** `15. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º`
**Block ID:** `rollback_snapshot_restore_clone`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î** –Ω–∞ –æ—Å–Ω–æ–≤–µ **copy-on-write snapshot-–æ–≤**, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π**, **—Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–æ–Ω–æ–≤ —Ç–∞–±–ª–∏—Ü**, —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç snapshot-–æ–≤ –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ä–µ–¥—ã. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç–∫–∞—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ç–æ—á–∫–µ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –±—ã—Å—Ç—Ä—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —Å—Ä–µ–¥—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–Ω–∏–º–∫–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | -------------------------------------------------------------------------- | -------------------------------------- | ---------- |
| `snapshot_create`           | `bool snapshot_create(const char *name);`                                  | –°–æ–∑–¥–∞—ë—Ç named snapshot.                | `true`     |
| `snapshot_restore`          | `bool snapshot_restore(const char *name);`                                 | –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ snapshot. | `true`     |
| `rollback_last_transaction` | `bool rollback_last_transaction(session_t *s);`                            | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.       | `true`     |
| `table_clone_from_snapshot` | `bool table_clone_from_snapshot(const char *table, const char *snapshot);` | –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∏–∑ snapshot.         | `true`     |
| `snapshot_export_binary`    | `bool snapshot_export_binary(const char *name, const char *path);`         | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç snapshot –≤ —Ñ–∞–π–ª.          | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  timestamp_t created_at;
  char origin_node[64];
  size_t size_bytes;
} snapshot_meta_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `snapshots_created_total` ‚Äî —Å–æ–∑–¥–∞–Ω–æ snapshot-–æ–≤
* `snapshots_restored_total` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π
* `rollback_operations_total` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –æ—Ç–∫–∞—Ç–æ–≤
* `snapshot_clone_latency_ms` ‚Äî –≤—Ä–µ–º—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ rollback/snapshot/clone
* –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—Ç–∫–∞—Ç–∞ –≤ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
* –ü–æ–¥–ø–∏—Å—å snapshot-–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `2.1 ‚Äî MVCC / Chain Versions`
* `5.1 ‚Äî Transaction Engine`
* `1.10 ‚Äî Table Engine`
* `7.1 ‚Äî Profiler / Alert`
* `6.2 ‚Äî ACL System`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_snapshot_create_and_restore`
* `test_transaction_rollback_on_error`
* `test_clone_table_from_snapshot_state`
* `test_snapshot_export_integrity`
* `test_restore_conflict_with_live_data`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **15.3 ‚Äî –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º, online-ALTER, live reload, rollback —Å—Ö–µ–º—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 15.3 ‚Äî –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º, online-ALTER, live reload, rollback —Å—Ö–µ–º—ã

**–ü–∞–∫–µ—Ç:** `15. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º`
**Block ID:** `schema_evolution_online_alter_reload_rollback`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **online-—ç–≤–æ–ª—é—Ü–∏—é —Å—Ö–µ–º—ã —Ç–∞–±–ª–∏—Ü** –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –≤–∫–ª—é—á–∞—è –∫–æ–º–∞–Ω–¥—ã `ALTER TABLE` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫), –ø–æ–¥–¥–µ—Ä–∂–∫—É **live reload** –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ **–æ—Ç–∫–∞—Ç—ã —Å—Ö–µ–º—ã**, —Ä–µ–≤–∏–∑–∏–∏ DDL, –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ö–µ–º—É –∏ WAL, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                             | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------------- | ---------------------------------------------------- | -------------------------------------- | ---------- |
| `schema_alter_table`          | `bool schema_alter_table(const char *ddl);`          | –í—ã–ø–æ–ª–Ω—è–µ—Ç ALTER TABLE –æ–Ω–ª–∞–π–Ω.          | `true`     |
| `schema_reload_metadata`      | `bool schema_reload_metadata(const char *table);`    | –ü–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—Ü—ã –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. | `true`     |
| `schema_rollback_last`        | `bool schema_rollback_last(const char *table);`      | –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ DDL-–∏–∑–º–µ–Ω–µ–Ω–∏–µ.    | `true`     |
| `schema_revision_list`        | `json_t *schema_revision_list(const char *table);`   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.          | JSON       |
| `schema_verify_compatibility` | `bool schema_verify_compatibility(const char *ddl);` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π.     | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char table[64];
  char ddl_text[256];
  timestamp_t applied_at;
  char user[64];
} ddl_revision_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `schema_alter_operations_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã
* `schema_reload_latency_ms` ‚Äî –≤—Ä–µ–º—è live reload
* `schema_rollback_events_total` ‚Äî —á–∏—Å–ª–æ –æ—Ç–∫–∞—Ç–æ–≤
* `ddl_compatibility_failures_total` ‚Äî –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö ALTER

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º
* –ê—É–¥–∏—Ç –≤—Å–µ—Ö DDL —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –ª–æ–≥–æ–º
* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤–æ –≤—Ä–µ–º—è active query

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.11 ‚Äî Catalog Engine`
* `2.1 ‚Äî MVCC`
* `5.1 ‚Äî Transaction Engine`
* `6.2 ‚Äî Auth / DDL Permissions`
* `7.3 ‚Äî Logging / Schema Watcher`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_online_alter_add_column_with_default`
* `test_schema_reload_after_ddl`
* `test_schema_rollback_and_visibility`
* `test_incompatible_ddl_rejected`
* `test_schema_version_history_listing`

---

‚úÖ –ü–∞–∫–µ—Ç **15. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å, –æ—Ç–∫–∞—Ç—ã –∏ —ç–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **16.1 ‚Äî CPU, memory, IOPS –∫–≤–æ—Ç—ã –∏ resource limits per session**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 16.1 ‚Äî CPU, memory, IOPS –∫–≤–æ—Ç—ã –∏ resource limits per session

**–ü–∞–∫–µ—Ç:** `16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è`
**Block ID:** `resource_limits_cpu_memory_iops_session`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∏ –∫–≤–æ—Ç –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã**: **CPU**, **–ø–∞–º—è—Ç—å**, **–¥–∏—Å–∫–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (IOPS)** –∏ **–≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî –Ω–∞ —É—Ä–æ–≤–Ω–µ **—Å–µ—Å—Å–∏–∏**, **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, **—Ä–æ–ª–∏** –∏–ª–∏ **–∑–∞–ø—Ä–æ—Å–∞**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∏–∑–æ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é –ø—Ä–∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è—Ö, –≤–∫–ª—é—á–∞–µ—Ç –ª–∏–º–∏—Ç—ã –Ω–∞ p95/–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –º—è–≥–∫–∏–µ –∏ –∂—ë—Å—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã, —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –≤ —Ä–∞–Ω—Ç–∞–π–º–µ.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | ------------------------------------------------------------------------------- | ------------------------------------- | ---------- |
| `resource_limits_set`        | `bool resource_limits_set(const char *scope, const resource_limits_t *limits);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–æ–ª–∏/—Å–µ—Å—Å–∏–∏. | `true`     |
| `resource_check_and_enforce` | `bool resource_check_and_enforce(session_t *s);`                                | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ª–∏–º–∏—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.  | `true`     |
| `resource_profile_report`    | `json_t *resource_profile_report(session_t *s);`                                | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.     | JSON       |
| `resource_limits_reset`      | `void resource_limits_reset(const char *scope);`                                | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç—ã.                    | `void`     |
| `resource_violation_log`     | `void resource_violation_log(const session_t *s, const char *resource);`        | –õ–æ–≥–∏—Ä—É–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞.            | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  uint64_t cpu_ms_limit;
  uint64_t mem_bytes_limit;
  uint64_t iops_limit;
  uint64_t query_timeout_ms;
  bool enforce_strict;
} resource_limits_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `resource_limits_applied_total{scope}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤
* `resource_violations_total{resource}` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è CPU/IO/mem
* `resource_usage_avg_per_session` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ
* `resource_enforcement_latency_ns` ‚Äî –≤—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å –ª–∏–º–∏—Ç—ã
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–π –∏ –∞–ª–µ—Ä—Ç—ã
* –ó–∞—â–∏—Ç–∞ –æ—Ç runaway queries –∏ DoS

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.2 ‚Äî Auth / Roles`
* `7.1 ‚Äî Profiler / Resource Monitor`
* `5.1 ‚Äî Session Manager`
* `8.4 ‚Äî Query Execution Engine`
* `2.1 ‚Äî MVCC Context`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_set_and_enforce_cpu_limit_session`
* `test_iops_limit_with_parallel_scan`
* `test_memory_exceed_abort_query`
* `test_soft_vs_strict_enforcement`
* `test_resource_report_accuracy_under_load`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **16.2 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 16.2 ‚Äî –ò–∑–æ–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–∞–∫–µ—Ç:** `16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è`
**Block ID:** `query_isolation_concurrency_adaptive_scheduling`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã **–∏–∑–æ–ª—è—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö —Å–µ—Å—Å–∏–π**, –≤–∫–ª—é—á–∞—è **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**, **–∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**, **–¥–µ—Ç–µ–∫—Ü–∏—é –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º** –∏ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é –≤–ª–∏—è–Ω–∏—è —Ç—è–∂—ë–ª—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏, –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–ª–æ—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ SLA –∏ —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------------- | -------------------------------------------------------------------- | ------------------------------------ | ---------- |
| `query_scheduler_init`       | `bool query_scheduler_init(void);`                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—Ä–æ—Å–æ–≤. | `true`     |
| `query_schedule_request`     | `bool query_schedule_request(query_t *q);`                           | –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–ª–æ—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.      | `true`     |
| `query_schedule_release`     | `void query_schedule_release(query_t *q);`                           | –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –∑–∞–Ω—è—Ç—ã–π —Å–ª–æ—Ç.            | `void`     |
| `query_isolation_policy_set` | `bool query_isolation_policy_set(const isolation_policy_t *policy);` | –ó–∞–¥–∞—ë—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–∑–æ–ª—è—Ü–∏–∏.           | `true`     |
| `query_throttle_check`       | `bool query_throttle_check(const query_t *q);`                       | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏.    | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  int priority;  // 0=low, 10=high
  bool allow_preemption;
  uint64_t max_runtime_ms;
} isolation_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `query_slot_wait_time_ns` ‚Äî –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–ª–æ—Ç–∞
* `query_preemptions_total` ‚Äî —á–∏—Å–ª–æ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–π
* `concurrent_queries_running_total` ‚Äî —Ç–µ–∫—É—â–µ–µ —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
* `adaptive_scheduling_decisions_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∏ —Ä–æ–ª—è–º
* –ó–∞—â–∏—Ç–∞ –æ—Ç starvation –ø—Ä–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –∑–∞–ø—Ä–æ—Å–∞–º per user/session

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.1 ‚Äî Session Engine`
* `16.1 ‚Äî Resource Limits`
* `7.1 ‚Äî Profiler / Load Monitor`
* `3.12 ‚Äî SQL Executor`
* `6.2 ‚Äî Auth / Access Control`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_priority_query_preempts_low`
* `test_query_throttle_on_overload`
* `test_slot_release_on_cancel`
* `test_isolation_policy_application`
* `test_adaptive_scheduling_with_spikes`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **16.3 ‚Äî NUMA-awareness, CPU-affinity, memory binding** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 16.3 ‚Äî NUMA-awareness, CPU-affinity, memory binding

**–ü–∞–∫–µ—Ç:** `16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è`
**Block ID:** `numa_awareness_cpu_affinity_memory_binding`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–∞–ø–ø–∞—Ä–∞—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤** —Å —É—á—ë—Ç–æ–º **NUMA-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**, **–ø—Ä–∏–≤—è–∑–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ –∫ —è–¥—Ä–∞–º (CPU-affinity)** –∏ **–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏**. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–æ—Å—Å-–Ω–æ–¥–æ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏, –ø–æ–≤—ã—à–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–Ω–∏–∂–∞—Ç—å –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é, —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–æ–ª–∏—Ç–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                             | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------ | -------------------------------------------------------------- | ------------------------------------ | ---------- |
| `numa_topology_discover` | `bool numa_topology_discover(void);`                           | –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç NUMA-–Ω–æ–¥–æ–≤—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é. | `true`     |
| `thread_set_affinity`    | `bool thread_set_affinity(pthread_t tid, int cpu);`            | –ù–∞–∑–Ω–∞—á–∞–µ—Ç –ø–æ—Ç–æ–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —è–¥—Ä–æ.    | `true`     |
| `memory_bind_numa_node`  | `bool memory_bind_numa_node(void *ptr, size_t len, int node);` | –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç –ø–∞–º—è—Ç—å –∫ NUMA-–Ω–æ–¥–µ.      | `true`     |
| `numa_policy_apply`      | `bool numa_policy_apply(const numa_policy_t *policy);`         | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.      | `true`     |
| `query_numa_advice`      | `int query_numa_advice(query_t *q);`                           | –í—ã–¥–∞—ë—Ç NUMA-—Å–æ–≤–µ—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.       | –ù–æ–º–µ—Ä —É–∑–ª–∞ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  bool prefer_local_node;
  bool bind_on_alloc;
  int fixed_node;
} numa_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `numa_local_allocations_total` ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π
* `numa_cross_node_penalty_ns` ‚Äî —Å—Ä–µ–¥–Ω—è—è –º–µ–∂–Ω–æ–¥–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
* `thread_affinity_applied_total` ‚Äî —á–∏—Å–ª–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–∏–≤—è–∑–æ–∫
* `memory_binding_failures_total` ‚Äî –æ—à–∏–±–æ–∫ –ø—Ä–∏ –±–∏–Ω–¥–∏–Ω–≥–µ

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —è–¥—Ä–∞—Ö
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–∞ —á—É–∂–∏—Ö NUMA-—É–∑–ª–æ–≤ –±–µ–∑ –ø—Ä–∞–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `7.1 ‚Äî System Profiler`
* `16.1 ‚Äî Resource Limits`
* `16.2 ‚Äî Scheduler`
* `8.2 ‚Äî Execution Threads`
* `11.3 ‚Äî OS Integration Layer`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_discovery_of_numa_topology`
* `test_affinity_assignment_static`
* `test_memory_binding_cross_node`
* `test_apply_custom_numa_policy`
* `test_numa_advice_for_parallel_query`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **16.4 ‚Äî Query sandboxing, isolation levels and query jail** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 16.4 ‚Äî Query sandboxing, isolation levels and query jail

**–ü–∞–∫–µ—Ç:** `16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è`
**Block ID:** `query_sandboxing_isolation_levels_jail`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º **–∏–∑–æ–ª—è—Ü–∏–∏ –∏ "–ø–µ—Å–æ—á–Ω–∏—Ü" (sandboxing)** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **—É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**, **–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Å—Ä–µ–¥—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è**, **–∑–∞–ø—Ä–µ—Ç–∞ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** –∏ **–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö jail-–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤** –¥–ª—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç enforcement —Å—Ç—Ä–æ–≥–∏—Ö –ø—Ä–∞–≤–∏–ª, –∑–∞—â–∏—Ç—É –æ—Ç runaway-–∑–∞–ø—Ä–æ—Å–æ–≤, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ UDF/DSL –≤ —Å–∞–Ω–¥–±–æ–∫—Å–∞—Ö —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ------------------------------ | ---------------------------------------------------------------------- | ------------------------------------- | ---------- |
| `query_sandbox_enter`          | `sandbox_t *query_sandbox_enter(const sandbox_policy_t *policy);`      | –í–∫–ª—é—á–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–µ—Å–æ—á–Ω–∏—Ü—É.     | –ö–æ–Ω—Ç–µ–∫—Å—Ç   |
| `query_sandbox_exit`           | `void query_sandbox_exit(sandbox_t *ctx);`                             | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ.     | `void`     |
| `query_set_isolation_level`    | `bool query_set_isolation_level(session_t *s, isolation_level_t lvl);` | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏.       | `true`     |
| `query_jail_attach`            | `bool query_jail_attach(const query_t *q);`                            | –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ jail-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ. | `true`     |
| `query_isolation_policy_check` | `bool query_isolation_policy_check(const query_t *q);`                 | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏–∫–µ.      | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  ISOLATION_READ_COMMITTED,
  ISOLATION_REPEATABLE_READ,
  ISOLATION_SERIALIZABLE,
  ISOLATION_SNAPSHOT
} isolation_level_t;

typedef struct {
  bool restrict_syscalls;
  bool limit_memory;
  bool block_io;
  isolation_level_t default_level;
} sandbox_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `sandbox_invocations_total` ‚Äî —á–∏—Å–ª–æ sandbox-—Å–µ—Å—Å–∏–π
* `jail_violations_total` ‚Äî –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏
* `query_isolation_level_used_total` ‚Äî —á–∞—Å—Ç–æ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π
* `sandbox_execution_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –≤ –∏–∑–æ–ª—è—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ SQL/DSL/UDF
* –°—Ç—Ä–æ–≥–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å syscall-–æ–≤ (seccomp)
* Jail-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–ª–∏ query scope

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `6.6 ‚Äî ACL –∏ Policy Engine`
* `5.1 ‚Äî Transaction Manager`
* `9.1 ‚Äî DSL/UDF Engine`
* `8.12 ‚Äî Sandbox Runtime`
* `7.4 ‚Äî Security Audit`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_sandbox_block_unsafe_function`
* `test_isolation_level_snapshot_read`
* `test_jail_mode_restricts_io`
* `test_udf_inside_sandbox_no_syscall`
* `test_violation_triggers_audit_log`

---

‚úÖ –ü–∞–∫–µ—Ç **16. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –∏ –∏–∑–æ–ª—è—Ü–∏—è** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **17. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **17.1 ‚Äî SQL-–∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, cron, watch**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 17.1 ‚Äî SQL-–∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, cron, watch

**–ü–∞–∫–µ—Ç:** `17. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π`
**Block ID:** `scheduled_sql_tasks_cron_watch`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ SQL-–∑–∞–¥–∞—á**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∑–∞–ø—É—Å–∫–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –∏–º–ø–æ—Ä—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç—ã –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ **–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é**, –ø–æ —Å–æ–±—ã—Ç–∏—è–º, –ø–æ `CRON`-–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º –∏–ª–∏ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π (`watch`). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–ª–µ—Ä—Ç–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------------- | ----------------------------------- | ---------- |
| `task_schedule_create`  | `bool task_schedule_create(const scheduled_task_t *task);`  | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ. | `true`     |
| `task_schedule_cancel`  | `bool task_schedule_cancel(const char *task_id);`           | –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É.                    | `true`     |
| `task_schedule_trigger` | `bool task_schedule_trigger(const char *task_id);`          | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É.     | `true`     |
| `task_schedule_list`    | `json_t *task_schedule_list(void);`                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á.       | JSON       |
| `task_schedule_watch`   | `bool task_schedule_watch(const watch_trigger_t *trigger);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –ø–æ —É—Å–ª–æ–≤–∏—é.     | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[64];
  char cron_expr[64];
  char sql[512];
  bool enabled;
  timestamp_t next_run;
} scheduled_task_t;

typedef struct {
  char condition[128];
  char task_id[64];
} watch_trigger_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tasks_scheduled_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
* `task_executions_total{status}` ‚Äî –∑–∞–ø—É—Å–∫–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å
* `task_watch_triggers_total` ‚Äî —á–∏—Å–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ watch
* `task_cron_parse_failures_total` ‚Äî –æ—à–∏–±–∫–∏ CRON-–ø–∞—Ä—Å–µ—Ä–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* ACL –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
* –ê—É–¥–∏—Ç –∫–∞–∂–¥–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç runaway-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞–≤—Ç–æ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `6.2 ‚Äî Auth / ACL`
* `7.4 ‚Äî AlertManager`
* `9.1 ‚Äî DSL/UDF`
* `8.9 ‚Äî System Clock / Timer`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_cron_schedule_every_minute`
* `test_manual_task_trigger`
* `test_watch_condition_triggered_by_metric`
* `test_task_disable_and_reschedule`
* `test_task_failure_notification_alert`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **17.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async SQL, –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 17.1 ‚Äî SQL-–∑–∞–¥–∞—á–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, cron, watch

**–ü–∞–∫–µ—Ç:** `17. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π`
**Block ID:** `scheduled_sql_tasks_cron_watch`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ SQL-–∑–∞–¥–∞—á**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∑–∞–ø—É—Å–∫–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã, –ø—Ä–æ—Ü–µ–¥—É—Ä—ã, –∏–º–ø–æ—Ä—Ç—ã, —ç–∫—Å–ø–æ—Ä—Ç—ã –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ **–ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é**, –ø–æ —Å–æ–±—ã—Ç–∏—è–º, –ø–æ `CRON`-–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º –∏–ª–∏ –ø—Ä–∏ –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–∏ —É—Å–ª–æ–≤–∏–π (`watch`). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫, –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–æ–π –∞–ª–µ—Ä—Ç–æ–≤.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------------- | ----------------------------------- | ---------- |
| `task_schedule_create`  | `bool task_schedule_create(const scheduled_task_t *task);`  | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ. | `true`     |
| `task_schedule_cancel`  | `bool task_schedule_cancel(const char *task_id);`           | –û—Ç–º–µ–Ω—è–µ—Ç –∑–∞–¥–∞—á—É.                    | `true`     |
| `task_schedule_trigger` | `bool task_schedule_trigger(const char *task_id);`          | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É.     | `true`     |
| `task_schedule_list`    | `json_t *task_schedule_list(void);`                         | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á.       | JSON       |
| `task_schedule_watch`   | `bool task_schedule_watch(const watch_trigger_t *trigger);` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –ø–æ —É—Å–ª–æ–≤–∏—é.     | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[64];
  char cron_expr[64];
  char sql[512];
  bool enabled;
  timestamp_t next_run;
} scheduled_task_t;

typedef struct {
  char condition[128];
  char task_id[64];
} watch_trigger_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `tasks_scheduled_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
* `task_executions_total{status}` ‚Äî –∑–∞–ø—É—Å–∫–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å
* `task_watch_triggers_total` ‚Äî —á–∏—Å–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ watch
* `task_cron_parse_failures_total` ‚Äî –æ—à–∏–±–∫–∏ CRON-–ø–∞—Ä—Å–µ—Ä–∞

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* ACL –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
* –ê—É–¥–∏—Ç –∫–∞–∂–¥–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç runaway-–∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∞–≤—Ç–æ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `6.2 ‚Äî Auth / ACL`
* `7.4 ‚Äî AlertManager`
* `9.1 ‚Äî DSL/UDF`
* `8.9 ‚Äî System Clock / Timer`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_cron_schedule_every_minute`
* `test_manual_task_trigger`
* `test_watch_condition_triggered_by_metric`
* `test_task_disable_and_reschedule`
* `test_task_failure_notification_alert`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **17.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ async SQL, –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 17.3 ‚Äî –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, DAG-–∑–∞–¥–∞—á–∏, retry, priority queue

**–ü–∞–∫–µ—Ç:** `17. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π`
**Block ID:** `dag_task_scheduler_retries_priority_queue`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≥—Ä–∞—Ñ–æ–≤—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (DAG)** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤, –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ –∫–∞–∫ —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ –≥—Ä–∞—Ñ–∞–º–∏. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–¥–∞—á–∏ –≤ –≤–∏–¥–µ **–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—Ü–∏–∫–ª–∏—á–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞**, –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–±–æ–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏, —É—á–∏—Ç—ã–≤–∞—Ç—å retry-–ø–æ–ª–∏—Ç–∏–∫—É –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                              | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ------------------------------------------------------------------------------------ | ------------------------------------- | ---------- |
| `dag_task_create`           | `bool dag_task_create(const dag_task_t *task);`                                      | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç DAG-–∑–∞–¥–∞—á—É.              | `true`     |
| `dag_task_execute`          | `bool dag_task_execute(const char *dag_id);`                                         | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ DAG-–≥—Ä–∞—Ñ–∞.       | `true`     |
| `dag_task_add_dependency`   | `bool dag_task_add_dependency(const char *from, const char *to);`                    | –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏. | `true`     |
| `dag_task_set_retry_policy` | `bool dag_task_set_retry_policy(const char *task_id, const retry_policy_t *policy);` | –ù–∞–∑–Ω–∞—á–∞–µ—Ç retry-–ø–æ–ª–∏—Ç–∏–∫—É.             | `true`     |
| `dag_task_set_priority`     | `bool dag_task_set_priority(const char *task_id, int priority);`                     | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á–∏.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char id[64];
  char command[512];
  int priority;
  int max_retries;
  int retry_delay_sec;
} dag_task_t;

typedef struct {
  int max_attempts;
  int delay_sec;
  bool exponential_backoff;
} retry_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `dag_tasks_total` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ DAG-–∑–∞–¥–∞—á
* `dag_dependency_depth_max` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* `dag_retries_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
* `dag_priority_queue_depth` ‚Äî —Ç–µ–∫—É—â–∞—è –¥–ª–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ DAG-–æ–ø–µ—Ä–∞—Ü–∏—è–º –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ü–∏–∫–ª—ã –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –≥–ª—É–±–∏–Ω—É DAG –∏ max-retries

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `17.1 ‚Äî Task Scheduler`
* `17.2 ‚Äî Async Execution`
* `6.2 ‚Äî Auth / ACL`
* `9.1 ‚Äî UDF/DSL runtime`
* `7.3 ‚Äî Monitoring / Graph Viewer`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_create_dag_task_with_dependencies`
* `test_execute_dag_with_parallel_branches`
* `test_retry_policy_with_backoff`
* `test_priority_queue_ordering`
* `test_detect_cycle_in_dag_registration`

---

‚úÖ –ü–∞–∫–µ—Ç **17. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ —Å–æ–±—ã—Ç–∏–π** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **18. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –∏ TimeSeries –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **18.1 ‚Äî TimeSeries —Ç–∏–ø—ã, gap-filling, downsampling, retention**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 18.1 ‚Äî TimeSeries —Ç–∏–ø—ã, gap-filling, downsampling, retention

**–ü–∞–∫–µ—Ç:** `18. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –∏ TimeSeries –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `timeseries_types_gapfill_downsampling_retention`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ (TimeSeries)** –≤ –≤–∏–¥–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö, –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **gap-filling**, **downsampling**, **retention-–ø–æ–ª–∏—Ç–∏–∫—É**, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ IoT, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ, –ª–æ–≥–∞—Ö, –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ real-time –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è in-memory –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç             |
| ---------------------- | --------------------------------------------------------------------------------------- | ------------------------------------------ | ---------------------- |
| `ts_create_series`     | `bool ts_create_series(const char *name, const ts_options_t *opts);`                    | –°–æ–∑–¥–∞—ë—Ç TimeSeries-—Ç–∞–±–ª–∏—Ü—É.                | `true`                 |
| `ts_insert_point`      | `bool ts_insert_point(const char *series, timestamp_t ts, double value);`               | –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ—á–∫—É –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä—è–¥.          | `true`                 |
| `ts_gapfill_linear`    | `ts_series_t *ts_gapfill_linear(const ts_series_t *series);`                            | –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π.          | Series                 |
| `ts_downsample`        | `ts_series_t *ts_downsample(const ts_series_t *series, interval_t step, agg_fn_t agg);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä—É—é—â—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é –ø–æ —à–∞–≥–∞–º. | Series                 |
| `ts_retention_enforce` | `int ts_retention_enforce(const char *series);`                                         | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è.               | –ö–æ–ª-–≤–æ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  interval_t resolution;
  uint64_t retention_days;
  bool enable_compression;
} ts_options_t;

typedef struct {
  timestamp_t ts;
  double value;
} ts_point_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ts_points_inserted_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
* `ts_gapfill_operations_total` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π gapfill
* `ts_downsample_latency_ns` ‚Äî –≤—Ä–µ–º—è downsampling
* `ts_retention_removed_points_total` ‚Äî —É–¥–∞–ª–µ–Ω–æ —Ç–æ—á–µ–∫ –ø–æ retention

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ insert –∏ query
* –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä—è–¥–∞–º–∏
* TTL-–∑–∞—á–∏—Å—Ç–∫–∞ –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.10 ‚Äî Column Store Engine`
* `3.12 ‚Äî SQL Executor`
* `5.2 ‚Äî Aggregation Engine`
* `7.1 ‚Äî Time Profiler / Series Monitor`
* `6.2 ‚Äî Access Control`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_create_and_insert_timeseries_data`
* `test_gapfill_on_sparse_series`
* `test_downsample_with_avg_and_step`
* `test_retention_enforcement_policy`
* `test_query_timeseries_range_filtering`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **18.2 ‚Äî –û–∫–æ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 18.2 ‚Äî –û–∫–æ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö

**–ü–∞–∫–µ—Ç:** `18. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –∏ TimeSeries –∞–Ω–∞–ª–∏—Ç–∏–∫–∞`
**Block ID:** `timeseries_window_aggregates_anomaly_detection`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–æ–∫–æ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã** –∏ **–¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π** –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ —Å–∫–æ–ª—å–∑—è—â–∏–º –æ–∫–Ω–∞–º (`window`, `hop`, `tumble`), –∞ —Ç–∞–∫–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π (Z-score, MAD, seasonal, spike detection). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∞–ª–µ—Ä—Ç–æ–≤, –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------- | --------------------------------------------------------------------------------------------------- | -------------------------------------- | ---------- |
| `ts_window_aggregate` | `ts_series_t *ts_window_aggregate(const ts_series_t *input, const window_def_t *win, agg_fn_t fn);` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–∫–æ–Ω–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é.           | Series     |
| `ts_detect_anomalies` | `anomaly_report_t *ts_detect_anomalies(const ts_series_t *input, const anomaly_opts_t *opts);`      | –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏.                  | –û—Ç—á—ë—Ç      |
| `ts_moving_avg`       | `ts_series_t *ts_moving_avg(const ts_series_t *input, int window_size);`                            | –°–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ.                    | Series     |
| `ts_zscore_detect`    | `ts_series_t *ts_zscore_detect(const ts_series_t *input, double threshold);`                        | –í—ã–¥–µ–ª—è–µ—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ Z-–æ—Ü–µ–Ω–∫–µ. | Series     |
| `ts_window_define`    | `window_def_t *ts_window_define(interval_t size, interval_t hop, bool aligned);`                    | –°–æ–∑–¥–∞—ë—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–∫–Ω–∞.              | WindowDef  |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  interval_t size;
  interval_t hop;
  bool aligned;
} window_def_t;

typedef struct {
  double z_threshold;
  bool use_mad;
  bool seasonal_adjust;
} anomaly_opts_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ts_window_aggregates_total` ‚Äî —á–∏—Å–ª–æ –æ–∫–æ–Ω–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ü–∏–π
* `ts_anomalies_detected_total` ‚Äî –Ω–∞–π–¥–µ–Ω–æ –∞–Ω–æ–º–∞–ª–∏–π
* `ts_zscore_threshold_hits` ‚Äî –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ø–æ—Ä–æ–≥–∞
* `ts_anomaly_detection_latency_ns` ‚Äî –≤—Ä–µ–º—è –¥–µ—Ç–µ–∫—Ü–∏–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞
* –ê—É–¥–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ –≤—ã–∑–æ–≤ anomaly-—Ñ—É–Ω–∫—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `18.1 ‚Äî TimeSeries Engine`
* `5.2 ‚Äî Aggregation Engine`
* `13.3 ‚Äî Analytical Functions`
* `7.1 ‚Äî Metrics / Profiler`
* `9.1 ‚Äî DSL / UDF (alert triggers)`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_window_sum_with_tumble_interval`
* `test_moving_avg_with_sparse_series`
* `test_anomaly_zscore_and_mad_detection`
* `test_anomaly_threshold_trigger_alert`
* `test_combined_aggregate_and_anomaly_pipeline`

---

‚úÖ –ü–∞–∫–µ—Ç **18. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –∏ TimeSeries –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø–∞–∫–µ—Ç—É ‚Äî **19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **19.1 ‚Äî CSV, JSON, XML, Parquet, Excel ingestion**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 19.1 ‚Äî CSV, JSON, XML, Parquet, Excel ingestion

**–ü–∞–∫–µ—Ç:** `19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö`
**Block ID:** `data_ingestion_csv_json_parquet_excel`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–∏–º–ø–æ—Ä—Ç–∞ (ingestion)** –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ ‚Äî **CSV**, **JSON**, **XML**, **Parquet**, **Excel** ‚Äî –≤ —Ç–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ç–∏–ø–æ–≤, –ø—Ä–æ–ø—É—Å–∫ –æ—à–∏–±–æ—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫, —á–∞—Å—Ç–∏—á–Ω—ã–π –∏–º–ø–æ—Ä—Ç, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É, –ø—Ä–æ–≤–µ—Ä–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä—è–º—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤ column-store. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å S3, –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∏ –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------- | ---------------------------------------------------------------------------------------------- | ----------------------------------- | ---------- |
| `data_ingest_file`    | `bool data_ingest_file(const char *path, const ingest_options_t *opts);`                       | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –≤ —Ç–∞–±–ª–∏—Ü—É.         | `true`     |
| `data_detect_schema`  | `table_schema_t *data_detect_schema(const char *path);`                                        | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ö–µ–º—É –ø–æ –≤—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º. | –°—Ö–µ–º–∞      |
| `data_ingest_from_s3` | `bool data_ingest_from_s3(const char *bucket, const char *key, const ingest_options_t *opts);` | –ò–º–ø–æ—Ä—Ç –∏–∑ S3.                       | `true`     |
| `data_ingest_preview` | `json_t *data_ingest_preview(const char *path, int lines);`                                    | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–≤—å—é –¥–∞–Ω–Ω—ã—Ö.           | JSON       |
| `data_validate_row`   | `bool data_validate_row(const table_schema_t *schema, const row_t *row);`                      | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä–æ–∫—É –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π.    | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char format[16];     // "csv", "json", "parquet", etc.
  char table[64];
  bool has_header;
  bool strict_types;
  char delimiter;
} ingest_options_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `data_rows_ingested_total{format}` ‚Äî –æ–±—â–µ–µ —á–∏—Å–ª–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
* `data_ingest_errors_total{reason}` ‚Äî –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
* `data_ingest_duration_ms` ‚Äî –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
* `data_format_usage_total` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ ingestion-–æ–ø–µ—Ä–∞—Ü–∏–∏
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø—É—Ç–∏, –∏—Å—Ç–æ—á–Ω–∏–∫—É, —Ñ–æ—Ä–º–∞—Ç—É
* –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–º–ø–æ—Ä—Ç–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.10 ‚Äî Column Store`
* `6.2 ‚Äî Auth / ACL`
* `8.9 ‚Äî File IO Engine`
* `5.3 ‚Äî Insert Engine`
* `7.3 ‚Äî Logging / Metrics`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_csv_ingest_with_header_and_types`
* `test_json_ingest_partial_with_schema_detection`
* `test_parquet_columnar_loading_speed`
* `test_excel_import_multiple_sheets`
* `test_ingest_error_handling_and_report`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **19.2 ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö: CSV, JSON, Parquet, streaming** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 19.2 ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö: CSV, JSON, Parquet, streaming

**–ü–∞–∫–µ—Ç:** `19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö`
**Block ID:** `data_export_csv_json_parquet_streaming`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** –∏–∑ —Ç–∞–±–ª–∏—Ü, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç—ã **CSV**, **JSON**, **Parquet**, –∞ —Ç–∞–∫–∂–µ –≤ —Ä–µ–∂–∏–º–µ **streaming** ‚Äî —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ Kafka, Pulsar, WebSocket –∏–ª–∏ HTTP endpoint. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, —Å–∂–∞—Ç–∏–µ, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –≤—ã–≥—Ä—É–∑–æ–∫, –ø–æ—Ç–æ–∫–æ–≤—É—é —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –æ–±—Ä–∞—Ç–∏–º—É—é —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —ç–∫—Å–ø–æ—Ä—Ç–∞.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ---------------------- | --------------------------------------------------------------------------- | ---------------------------------- | ---------- |
| `data_export_file`     | `bool data_export_file(const char *query, const export_options_t *opts);`   | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª.     | `true`     |
| `data_export_stream`   | `bool data_export_stream(const char *query, const stream_options_t *opts);` | –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.  | `true`     |
| `data_export_preview`  | `json_t *data_export_preview(const char *query, int limit);`                | –ü—Ä–µ–≤—å—é —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.      | JSON       |
| `data_export_progress` | `export_progress_t *data_export_progress(const char *job_id);`              | –°—Ç–∞—Ç—É—Å –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–¥–∞—á–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞. | –ü—Ä–æ–≥—Ä–µ—Å—Å   |
| `data_export_cancel`   | `bool data_export_cancel(const char *job_id);`                              | –û—Ç–º–µ–Ω—è–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç.                  | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char format[16];  // "csv", "json", "parquet"
  char path[256];
  bool compress;
  int shard_count;
} export_options_t;

typedef struct {
  char protocol[16]; // "kafka", "http", etc.
  char target[256];
  int batch_size;
} stream_options_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `export_jobs_total{format}` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç–æ–≤ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º
* `export_bytes_written_total` ‚Äî –≤—Å–µ–≥–æ –≤—ã–≥—Ä—É–∂–µ–Ω–æ –¥–∞–Ω–Ω—ã—Ö
* `export_stream_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
* `export_active_jobs_total` ‚Äî –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* ACL –Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω–µ—à–Ω–∏–º stream-—Ä–µ—Å—É—Ä—Å–∞–º
* –ê—É–¥–∏—Ç –∫–∞–∂–¥–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –∏ –ª–æ–≥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî SQL Executor`
* `6.2 ‚Äî ACL System`
* `8.9 ‚Äî File IO / Stream IO`
* `7.3 ‚Äî Export Monitor`
* `17.1 ‚Äî Scheduler` (–¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–æ–≤)

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_export_csv_basic_query`
* `test_export_json_nested_fields`
* `test_export_parquet_compressed`
* `test_streaming_kafka_export_delivery`
* `test_export_cancel_and_resume`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **19.3 ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ/—ç–∫—Å–ø–æ—Ä—Ç–µ** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 19.3 ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ/—ç–∫—Å–ø–æ—Ä—Ç–µ

**–ü–∞–∫–µ—Ç:** `19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö`
**Block ID:** `data_transform_normalize_on_ingest_export`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**, **–æ—á–∏—Å—Ç–∫—É** –∏ **–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö** –≤–æ –≤—Ä–µ–º—è **–∏–º–ø–æ—Ä—Ç–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞**. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è, –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é —Ñ–æ—Ä–º–∞—Ç–æ–≤ (–¥–∞—Ç, —á–∏—Å–µ–ª, –∫–æ–¥–∏—Ä–æ–≤–æ–∫), –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤, –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é –∑–∞–ø–∏—Å–µ–π –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ, ETL, –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ —Å—Ö–µ–º–∞–º.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                        | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | ------------------------------------------------------------------------- | ------------------------------- | ---------- |
| `data_transform_apply`      | `bool data_transform_apply(row_t *row, const transform_rules_t *rules);`  | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∫ —Å—Ç—Ä–æ–∫–µ.     | `true`     |
| `data_normalize_column`     | `bool data_normalize_column(cell_t *cell, const normalize_opts_t *opts);` | –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–ª–æ–Ω–∫–µ. | `true`     |
| `data_flatten_json`         | `bool data_flatten_json(cell_t *cell, json_path_t *paths);`               | –î–µ–∫–æ–º–ø–æ–∑–∏—Ä—É–µ—Ç JSON –≤ –ø–æ–ª—è.      | `true`     |
| `data_type_cast`            | `bool data_type_cast(cell_t *cell, column_type_t target);`                | –ü—Ä–∏–≤–æ–¥–∏—Ç —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö.           | `true`     |
| `data_enrich_with_metadata` | `bool data_enrich_with_metadata(row_t *row, const meta_context_t *ctx);`  | –î–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char source_column[64];
  char target_column[64];
  char expression[128]; // DSL expr
} transform_rule_t;

typedef struct {
  bool trim;
  bool lowercase;
  bool utf8_check;
  bool date_format_check;
} normalize_opts_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `transform_rules_applied_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª
* `normalize_failures_total{type}` ‚Äî –æ—à–∏–±–æ–∫ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
* `json_flatten_fields_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö JSON-–ø–æ–ª–µ–π
* `cast_failures_total` ‚Äî –æ—à–∏–±–æ–∫ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º –Ω–∞ enrich

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.11 ‚Äî Table Schema`
* `5.3 ‚Äî Insert Engine`
* `6.2 ‚Äî Access Control`
* `9.1 ‚Äî DSL / Expression Engine`
* `19.1 ‚Äî Ingestion`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_column_mapping_with_expression`
* `test_utf8_and_trim_normalization`
* `test_json_flatten_nested_object`
* `test_cast_string_to_timestamp`
* `test_enrich_row_with_import_context`

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É ‚Äî **19.4 ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 19.4 ‚Äî –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã

**–ü–∞–∫–µ—Ç:** `19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö`
**Block ID:** `format_conversion_serialization_converters`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏**, –≤–∫–ª—é—á–∞—è **—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é** –∏ **–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é** –≤ —Ñ–æ—Ä–º–∞—Ç—ã **JSON**, **CSV**, **Parquet**, **MsgPack**, **Avro**, **YAML**, **XML**, **Arrow** –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –°–£–ë–î. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ API, —ç–∫—Å–ø–æ—Ä—Ç–µ, CDC, —Å—Ç—Ä–∏–º–∏–Ω–≥–µ, –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Ö.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | ----------------------------------------------------------------------------------------------------- | -------------------------------------- | ---------- |
| `format_serialize`      | `bool format_serialize(const row_t *row, const format_opts_t *opts, buffer_t *out);`                  | –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. | `true`     |
| `format_deserialize`    | `bool format_deserialize(const buffer_t *data, const format_opts_t *opts, row_t *out);`               | –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –≤ —Å—Ç—Ä–æ–∫—É.                | `true`     |
| `format_convert`        | `bool format_convert(const buffer_t *input, format_type_t src, format_type_t dst, buffer_t *output);` | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏.           | `true`     |
| `format_schema_extract` | `table_schema_t *format_schema_extract(const buffer_t *data, format_type_t fmt);`                     | –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ö–µ–º—É –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞.            | –°—Ö–µ–º–∞      |
| `format_validate`       | `bool format_validate(const buffer_t *data, format_type_t fmt);`                                      | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞.        | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  FORMAT_CSV,
  FORMAT_JSON,
  FORMAT_PARQUET,
  FORMAT_MSGPACK,
  FORMAT_XML,
  FORMAT_AVRO,
  FORMAT_ARROW,
  FORMAT_YAML,
  FORMAT_INTERNAL
} format_type_t;

typedef struct {
  format_type_t type;
  bool pretty;
  bool compress;
} format_opts_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `format_serializations_total{type}` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–π
* `format_conversion_latency_ms` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
* `format_validation_failures_total` ‚Äî –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
* `format_schema_extract_success_total` ‚Äî —É—Å–ø–µ—à–Ω—ã—Ö –∏–∑–≤–ª–µ—á–µ–Ω–∏–π —Å—Ö–µ–º

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º –≤—Ö–æ–¥–Ω—ã—Ö/–≤—ã—Ö–æ–¥–Ω—ã—Ö –±—É—Ñ–µ—Ä–æ–≤
* –ó–∞—â–∏—Ç–∞ –æ—Ç format-bomb –∏ schema-injection

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.11 ‚Äî Table Schema`
* `19.1 ‚Äî Ingestion`
* `19.2 ‚Äî Export Engine`
* `9.1 ‚Äî UDF / DSL Engine`
* `7.3 ‚Äî Logging / Error Trace`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_json_serialize_and_parse`
* `test_convert_parquet_to_csv`
* `test_validate_invalid_avro_payload`
* `test_arrow_roundtrip_conversion`
* `test_schema_extract_from_msgpack`

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –±–ª–æ–∫—É –ø–∞–∫–µ—Ç–∞ ‚Äî **19.5 ‚Äî –û–±–æ–≥–∞—â–µ–Ω–∏–µ, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–∞—Å—á—ë—Ç–Ω—ã–µ –ø–æ–ª—è –≤ real-time**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 19.5 ‚Äî –û–±–æ–≥–∞—â–µ–Ω–∏–µ, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Ä–∞—Å—á—ë—Ç–Ω—ã–µ –ø–æ–ª—è –≤ real-time

**–ü–∞–∫–µ—Ç:** `19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö`
**Block ID:** `realtime_enrichment_filtering_computed_fields`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **–æ–±–æ–≥–∞—â–µ–Ω–∏—è (enrichment)** –¥–∞–Ω–Ω—ã—Ö, **—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º**, –∞ —Ç–∞–∫–∂–µ **–≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö (computed) –ø–æ–ª–µ–π** –≤ —Ä–µ–∂–∏–º–µ **—Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏** –≤–æ –≤—Ä–µ–º—è –≤—Å—Ç–∞–≤–∫–∏, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, ingestion, —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –∏–ª–∏ CDC. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤, —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫, –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª–∏–π, –æ–±–æ–≥–∞—â–µ–Ω–∏—è –ø–æ lookup-—Ç–∞–±–ª–∏—Ü–∞–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º DSL/UDF.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                                 | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | -------------------------------------------------------------------------------------- | ---------------------------------------- | ---------- |
| `realtime_enrich_apply`     | `bool realtime_enrich_apply(row_t *row, const enrich_policy_t *policy);`               | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –æ–±–æ–≥–∞—â–µ–Ω–∏—è.           | `true`     |
| `realtime_filter_match`     | `bool realtime_filter_match(const row_t *row, const filter_expr_t *expr);`             | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ñ–∏–ª—å—Ç—Ä—É. | `true`     |
| `realtime_compute_fields`   | `bool realtime_compute_fields(row_t *row, const compute_expr_t *exprs, size_t count);` | –í—ã—á–∏—Å–ª—è–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –ø–æ–ª—è.              | `true`     |
| `realtime_lookup_join`      | `bool realtime_lookup_join(row_t *row, const lookup_table_t *lt);`                     | –í—ã–ø–æ–ª–Ω—è–µ—Ç lookup-–æ–±–æ–≥–∞—â–µ–Ω–∏–µ.             | `true`     |
| `realtime_stream_transform` | `bool realtime_stream_transform(stream_event_t *evt);`                                 | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –ø–æ—Ç–æ–∫–∞ inline.       | `true`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char name[64];
  char expr[256];
} compute_expr_t;

typedef struct {
  char condition[256];
} filter_expr_t;

typedef struct {
  char table[64];
  char key_column[64];
  char value_column[64];
} lookup_table_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `realtime_enrichments_total` ‚Äî —á–∏—Å–ª–æ –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã—Ö enrich-–æ–ø–µ—Ä–∞—Ü–∏–π
* `realtime_filter_drops_total` ‚Äî –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Å—Ç—Ä–æ–∫
* `realtime_computed_fields_total` ‚Äî –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
* `realtime_stream_latency_ns` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å UDF/DSL –≤—ã—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ lookup-—Ç–∞–±–ª–∏—Ü–∞–º
* –ê—É–¥–∏—Ç –≤—Å–µ—Ö enrich-–æ–ø–µ—Ä–∞—Ü–∏–π –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π inline

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `5.3 ‚Äî Insert Engine`
* `9.1 ‚Äî UDF / DSL Execution`
* `1.11 ‚Äî Table Schema`
* `19.1 ‚Äî Ingestion`
* `7.1 ‚Äî Metrics & Tracing`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_computed_field_expression_with_date_math`
* `test_filter_row_based_on_threshold`
* `test_lookup_enrich_from_reference_table`
* `test_stream_transform_inline_field_append`
* `test_udf_enrichment_sandboxed_execution`

---

‚úÖ –ü–∞–∫–µ—Ç **19. –§–æ—Ä–º–∞—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö** –∑–∞–≤–µ—Ä—à—ë–Ω.

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É (—Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É) –ø–∞–∫–µ—Ç—É ‚Äî **20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ**, –Ω–∞—á–∏–Ω–∞—è —Å –±–ª–æ–∫–∞ **20.1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞: Parser ‚Üí Planner ‚Üí Optimizer ‚Üí Executor ‚Üí Storage**. –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 20.1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —è–¥—Ä–∞: Parser ‚Üí Planner ‚Üí Optimizer ‚Üí Executor ‚Üí Storage

**–ü–∞–∫–µ—Ç:** `20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ`
**Block ID:** `core_architecture_parser_planner_optimizer_executor`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–ø–∏—Å—ã–≤–∞–µ—Ç **–æ—Å–Ω–æ–≤–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω —è–¥—Ä–∞ –°–£–ë–î**, –≤–∫–ª—é—á–∞—é—â–∏–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —ç—Ç–∞–ø—ã:

1. **Parser** ‚Äî –ª–µ–∫—Å–∏–∫–æ-—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–±–æ—Ä SQL –∏ UDF.
2. **Planner** ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ø–ª–∞–Ω–∞.
3. **Optimizer** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏.
4. **Executor** ‚Äî –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.
5. **Storage** ‚Äî –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º (row/column store, index).

–ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º–∏, —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ-–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§—É–Ω–∫—Ü–∏—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç                        |
| --------- | -------------------- | ------------------------------------------------------ | --------------------------------- |
| Parser    | `sql_parse`          | `ast_t *sql_parse(const char *sql);`                   | –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ |
| Planner   | `plan_build_logical` | `logical_plan_t *plan_build_logical(ast_t *ast);`      | –õ–æ–≥–∏—á–µ—Å–∫–∏–π –ø–ª–∞–Ω                   |
| Optimizer | `plan_optimize`      | `optimized_plan_t *plan_optimize(logical_plan_t *lp);` | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω             |
| Executor  | `plan_execute`       | `result_t *plan_execute(optimized_plan_t *plan);`      | –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞                 |
| Storage   | `storage_access`     | `block_t *storage_access(const access_spec_t *spec);`  | –ë–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö                      |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char *sql;
  bool is_udf;
} ast_t;

typedef struct {
  ast_t *ast;
  table_ref_t *tables;
  predicate_t *filters;
} logical_plan_t;

typedef struct {
  logical_plan_t *base;
  join_strategy_t join_type;
  index_usage_t indexes;
} optimized_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `parser_parse_errors_total`
* `optimizer_rewrites_applied_total`
* `planner_logical_nodes_total`
* `executor_runtime_ns`
* `storage_block_fetch_latency_ns`

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü—Ä–æ–≤–µ—Ä–∫–∞ AST –∏ –ø–ª–∞–Ω–∞ –Ω–∞ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–ª–∞–Ω–æ–≤ —Å —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏ (SQLi, DoS)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è UDF –∏ sandbox-—Ä–µ–∂–∏–º–æ–≤

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.3 ‚Äî Logical Planner`
* `3.4 ‚Äî Cost-Based Optimizer`
* `3.12 ‚Äî Executor`
* `1.10 ‚Äî Column/Row Storage`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_parser_valid_syntax_and_ast`
* `test_logical_plan_with_joins`
* `test_optimizer_rewrites_pushdown`
* `test_executor_result_consistency`
* `test_storage_fetch_from_columnstore`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **20.2 ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: AST, IR, execution plan, symbol table** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 20.2 ‚Äî –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: AST, IR, execution plan, symbol table

**–ü–∞–∫–µ—Ç:** `20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ`
**Block ID:** `internal_structures_ast_ir_plan_symbols`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª—é—á–µ–≤—ã–µ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è** –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤ —è–¥—Ä–µ –°–£–ë–î, –≤–∫–ª—é—á–∞—è:

* **AST** ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ;
* **IR** ‚Äî –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤;
* **Execution Plan** ‚Äî –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è;
* **Symbol Table** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏, —Ç–∏–ø–∞–º–∏, –∞–ª–∏–∞—Å–∞–º–∏ –∏ –æ–±–ª–∞—Å—Ç—å—é –≤–∏–¥–∏–º–æ—Å—Ç–∏.

–≠—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è—Ö, –∞–Ω–∞–ª–∏–∑–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                           | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| -------------------- | ------------------------------------------------------------ | ---------------------------------- | ---------- |
| `ast_build`          | `ast_t *ast_build(const char *sql);`                         | –°—Ç—Ä–æ–∏—Ç AST –∏–∑ SQL.                 | AST        |
| `ir_generate`        | `ir_t *ir_generate(ast_t *ast);`                             | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç IR –ø–æ AST.              | IR         |
| `plan_compile`       | `exec_plan_t *plan_compile(ir_t *ir);`                       | –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç IR –≤ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –ø–ª–∞–Ω. | –ü–ª–∞–Ω       |
| `symbol_table_build` | `symtab_t *symbol_table_build(ast_t *ast);`                  | –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å–∏–º–≤–æ–ª–æ–≤.        | –°–∏–º–≤–æ–ª—ã    |
| `symbol_resolve`     | `symbol_t *symbol_resolve(symtab_t *tab, const char *name);` | –ò—â–µ—Ç —Å–∏–º–≤–æ–ª –ø–æ –∏–º–µ–Ω–∏.              | –°–∏–º–≤–æ–ª     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  char *name;
  data_type_t type;
  int scope_level;
  bool is_alias;
} symbol_t;

typedef struct {
  ast_node_t *root;
  int node_count;
} ast_t;

typedef struct {
  opcode_t *opcodes;
  int op_count;
} ir_t;

typedef struct {
  plan_node_t *nodes;
  int stages;
} exec_plan_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `ast_node_depth_max`
* `ir_opcodes_total`
* `exec_plan_stages_total`
* `symbol_resolutions_total`
* `symbol_resolution_failures_total`

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (scope isolation)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç alias shadowing
* –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ IR

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.1 ‚Äî SQL Parser`
* `3.2 ‚Äî IR Generator`
* `3.5 ‚Äî Execution Plan Compiler`
* `9.1 ‚Äî UDF Expression Engine`
* `6.2 ‚Äî Auth / Scope Policy`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_ast_construction_select_nested`
* `test_ir_generation_with_subquery`
* `test_exec_plan_stage_structure`
* `test_symbol_alias_resolution`
* `test_symbol_scope_shadow_blocking`

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –±–ª–æ–∫–∞ **20.3 ‚Äî –Ø–¥—Ä–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è: vectorized executor, pipelines, threads** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 20.3 ‚Äî –Ø–¥—Ä–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è: vectorized executor, pipelines, threads

**–ü–∞–∫–µ—Ç:** `20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ`
**Block ID:** `core_executor_vectorized_pipelines_threads`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **–≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ **–ø–æ—Ç–æ—á–Ω–æ–º (pipeline) –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏**, **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö** –∏ **–≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –±–∞—Ç—á–∞—Ö –¥–∞–Ω–Ω—ã—Ö**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ OLTP/OLAP —Ä–µ–∂–∏–º–µ —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CPU-–∫—ç—à–∞ –∏ SIMD.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                            | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| --------------------------- | --------------------------------------------------------- | ----------------------------------- | ---------- |
| `executor_init`             | `bool executor_init(void);`                               | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —è–¥—Ä–æ. | `true`     |
| `executor_run_pipeline`     | `bool executor_run_pipeline(exec_plan_t *plan);`          | –ó–∞–ø—É—Å–∫–∞–µ—Ç pipeline-–ø–ª–∞–Ω.            | `true`     |
| `executor_fetch_batch`      | `batch_t *executor_fetch_batch(pipeline_stage_t *stage);` | –ü–æ–ª—É—á–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –±–∞—Ç—á.            | –ë–∞—Ç—á       |
| `executor_schedule_threads` | `bool executor_schedule_threads(exec_plan_t *plan);`      | –†–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.        | `true`     |
| `executor_finalize`         | `void executor_finalize(void);`                           | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.               | `void`     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct {
  void **columns;
  size_t row_count;
  size_t capacity;
} batch_t;

typedef struct {
  int stage_id;
  operator_type_t op;
  batch_t *input;
  batch_t *output;
} pipeline_stage_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `executor_batches_processed_total`
* `executor_pipeline_latency_ns`
* `executor_thread_utilization_percent`
* `executor_cache_hit_ratio`
* `executor_vector_width_avg`

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ò–∑–æ–ª—è—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–π
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –±—É—Ñ–µ—Ä–∞
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞ SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `3.12 ‚Äî Execution Plan`
* `5.1 ‚Äî Session Engine`
* `7.1 ‚Äî Perf Profiler`
* `16.3 ‚Äî CPU / NUMA Binding`
* `8.2 ‚Äî Thread Runtime`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_executor_vectorized_filter_scan`
* `test_parallel_pipeline_execution_order`
* `test_executor_batch_boundary_conditions`
* `test_executor_thread_affinity_behavior`
* `test_executor_finalize_memory_release`

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –±–ª–æ–∫—É **20.4 ‚Äî –Ø–¥—Ä–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: row-store, column-store, JSON-store –∏ –∏–Ω–¥–µ–∫—Å—ã** ‚Äî –Ω–∞–ø–∏—à–∏ **"–¥–∞"**.

–í–æ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å:

---

## üß© –ë–ª–æ–∫ 20.4 ‚Äî –Ø–¥—Ä–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞: row-store, column-store, JSON-store –∏ –∏–Ω–¥–µ–∫—Å—ã

**–ü–∞–∫–µ—Ç:** `20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ`
**Block ID:** `core_storage_row_column_json_indexes`

---

### üìù –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–ª–æ–∫–∞

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç **—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, –≤–∫–ª—é—á–∞—é—â–µ–µ:

* **row-store** (—Å—Ç—Ä–æ–∫–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è OLTP);
* **column-store** (–∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏);
* **JSON-store** (–≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞);
* **–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é**: `B+ tree`, `hash`, `bitmap`, `inverted`, `adaptive`.
  –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è NUMA-aware –∞–ª–ª–æ–∫–∞—Ü–∏—è, –≥–æ—Ä—è—á–∏–µ/—Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–∂–∞—Ç–∏–µ, TTL, eviction –∏ tiered storage.

---

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                      | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç |
| ----------------------- | --------------------------------------------------------------------------------- | ----------------------------- | ---------- |
| `storage_row_insert`    | `bool storage_row_insert(table_t *table, const row_t *row);`                      | –í—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ row-store. | `true`     |
| `storage_column_insert` | `bool storage_column_insert(table_t *table, const column_t *cols, size_t count);` | –í—Å—Ç–∞–≤–∫–∞ –≤ column-store.       | `true`     |
| `storage_json_upsert`   | `bool storage_json_upsert(table_t *table, const json_t *doc);`                    | –î–æ–±–∞–≤–ª—è–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç JSON. | `true`     |
| `storage_index_build`   | `bool storage_index_build(table_t *table, index_type_t type);`                    | –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –ø–æ —Ç–∏–ø—É.       | `true`     |
| `storage_tier_evict`    | `int storage_tier_evict(table_t *table, tier_policy_t *policy);`                  | –í—ã–ø–æ–ª–Ω—è–µ—Ç —ç–≤–∏–∫—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.     | –ö–æ–ª-–≤–æ     |

---

### üìö –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef enum {
  INDEX_BTREE,
  INDEX_HASH,
  INDEX_BITMAP,
  INDEX_INVERTED,
  INDEX_ADAPTIVE
} index_type_t;

typedef struct {
  size_t hot_threshold;
  size_t cold_retention;
  bool compress;
} tier_policy_t;
```

---

### üìà –ú–µ—Ç—Ä–∏–∫–∏ –∏ Observability

* `storage_inserts_total{store}` ‚Äî –≤—Å—Ç–∞–≤–∫–∏ –ø–æ —Ç–∏–ø—É —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
* `storage_index_build_total{type}` ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –∏–Ω–¥–µ–∫—Å–æ–≤
* `storage_json_docs_total` ‚Äî —á–∏—Å–ª–æ JSON-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
* `storage_evicted_pages_total` ‚Äî —ç–≤–∏–∫—Ü–∏–∏ –ø–æ tier

---

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü/–∫–æ–ª–æ–Ω–æ–∫/–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
* –ò–∑–æ–ª—è—Ü–∏—è JSON-–ø–æ–ª–µ–π –ø–æ row-level security
* –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö DML/DDL –æ–ø–µ—Ä–∞—Ü–∏–π

---

### ‚öôÔ∏è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* `1.10 ‚Äî Storage Engine`
* `1.13 ‚Äî TTL / Tiering`
* `1.6 ‚Äî Compression Engine`
* `5.3 ‚Äî Insert Engine`
* `6.1 ‚Äî Security / RBAC`

---

### üß™ –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

* `test_insert_row_and_retrieve`
* `test_column_store_vectorized_write`
* `test_json_upsert_and_query_path`
* `test_index_btree_lookup_range`
* `test_eviction_policy_under_load`

---

‚úÖ –ü–∞–∫–µ—Ç **20. –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —è–¥—Ä–æ** –∑–∞–≤–µ—Ä—à—ë–Ω.
‚úÖ –í—Å–µ **374 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –±–ª–æ–∫–∞** –æ–ø–∏—Å–∞–Ω—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ `block_functions`.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å `block_functions.json` –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å Markdown-–∞—Ä—Ö–∏–≤ –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤.
