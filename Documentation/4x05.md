# ðŸ§± Ð‘Ð»Ð¾Ðº 4.5 â€” REST Webhooks Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ñ‹ (async eventing)

---

## ðŸ†” Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð±Ð»Ð¾ÐºÐ°

* **ÐŸÐ°ÐºÐµÑ‚:** 4 â€” Ð˜Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹ Ð¸ Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸
* **Ð‘Ð»Ð¾Ðº:** 4.5 â€” REST Webhooks Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ðµ Ð²Ñ‹Ð·Ð¾Ð²Ñ‹ (async eventing)

---

## ðŸŽ¯ ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ

Ð‘Ð»Ð¾Ðº Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ REST-ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ñ‹Ñ… webhook-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð² Ð¸ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð², Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð¾Ð¿Ð¾Ð²ÐµÑ‰ÐµÐ½Ð¸Ñ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼ Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÑ… Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¡Ð£Ð‘Ð”. Ð­Ñ‚Ð¾ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ñ loosely-coupled Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¹, Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ½Ñ‹Ñ… Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€, Ð°ÑƒÐ´Ð¸Ñ‚Ð°, Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸ Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð½Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ðµ ERP/BI-ÑÐ¸ÑÑ‚ÐµÐ¼.

## âš™ï¸ Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

| ÐŸÐ¾Ð´ÑÐ¸ÑÑ‚ÐµÐ¼Ð°         | Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ / Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸                               |
| ------------------ | ------------------------------------------------------ |
| Webhook Dispatcher | ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ñ‡ÐµÑ€ÐµÐ· HTTP POST/PUT/PATCH |
| Callback Registry  | Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‡Ð¸ÐºÐ¾Ð² Ð¸ Ð¸Ñ… Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸Ðº        |
| Event Queue        | ÐÐ°Ð´Ñ‘Ð¶Ð½Ð°Ñ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ñ retry/backoff              |
| Payload Templates  | ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¾Ð² Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (JSONPath, Jinja-like) |
| Delivery Policy    | Timeouts, retries, backoff, dead-letter queue, QoS     |

## ðŸ’¾ Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

```c
typedef struct webhook_callback_t {
    char *url;
    char *event_type;
    char *template_body;
    int retry_count;
    int timeout_ms;
} webhook_callback_t;

typedef struct webhook_event_t {
    char *event_type;
    json_value_t *payload;
    uint64_t created_at_ns;
} webhook_event_t;
```

## ðŸ”„ Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐ²ÑÐ·Ð¸

```plantuml
[Webhook Dispatcher] --> [Event Dispatcher]
[Webhook Dispatcher] --> [HTTP Client Layer]
[Callback Registry] --> [Catalog Engine]
[Event Dispatcher] --> [Storage Engine]
```

## ðŸ§  ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸

* ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° HTTP/1.1, TLS, gzip-ÑÐ¶Ð°Ñ‚Ð¸Ðµ
* JIT-ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (Ð½Ð° Ð»ÐµÑ‚Ñƒ)
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° `application/json`, `application/xml`, `text/plain`
* Ð¥Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð² Ð² in-memory + WAL + snapshot
* Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ SQL-Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€Ð°Ð¼Ð¸, DML-ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼Ð¸, CDC

## ðŸ“‚ Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ ÐºÐ¾Ð´Ð°

* `src/hooks/webhook_dispatcher.c`
* `include/hooks/webhook_dispatcher.h`
* `src/hooks/webhook_registry.c`
* `include/hooks/webhook_registry.h`
* `src/net/http_client.c`

## ðŸ”§ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð½Ð° C

| Ð˜Ð¼Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸             | ÐŸÑ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿                                               | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ                               |
| ----------------------- | ------------------------------------------------------ | -------------------------------------- |
| `webhook_register`      | `int webhook_register(const webhook_callback_t *cfg);` | Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ webhook-Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‡Ð¸ÐºÐ°         |
| `webhook_emit`          | `int webhook_emit(const webhook_event_t *evt);`        | Ð­Ð¼Ð¸ÑÑÐ¸Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ð·Ð¾Ð²Ð°   |
| `webhook_dispatch_loop` | `void webhook_dispatch_loop(void);`                    | ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ |

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

* ÐœÐ¾Ð´ÑƒÐ»ÑŒÐ½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹: `tests/hooks/webhook_test.c`
* Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ: HTTP ÑÐµÑ€Ð²ÐµÑ€Ñ‹-Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ¸ Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹ retry, order
* Fuzzing: URL, payload ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹, Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸
* ÐÐ°Ð³Ñ€ÑƒÐ·Ð¾Ñ‡Ð½Ñ‹Ðµ: 100K+ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹, 10K+ endpoints, 500+ TPS

## ðŸ“Š ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

* Ð¡Ñ€ÐµÐ´Ð½ÐµÐµ Ð²Ñ€ÐµÐ¼Ñ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ: \~12 Ð¼Ñ (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾), \~50 Ð¼Ñ (Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚)
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° 20K Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‡Ð¸ÐºÐ¾Ð² Ñ failover
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° 2 Ð¼Ð»Ð½ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹/Ð´ÐµÐ½ÑŒ

## âœ… Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ SAP HANA+

| ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹                 | ÐžÑ†ÐµÐ½ÐºÐ° | ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹                                            |
| ------------------------ | ------ | ------------------------------------------------------ |
| REST Webhooks            | 100    | ÐŸÐ¾Ð»Ð½Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ñ‹ Ð¸ QoS               |
| Event delivery semantics | 90     | Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹ retries, DLQ, Ð½Ð¾ Ð½ÐµÑ‚ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ð¹ EXACTLY-ONCE |

## ðŸ“Ž ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ð´Ð°

```c
webhook_callback_t cb = {
    .url = "https://erp.example.com/hooks/invoice",
    .event_type = "invoice_created",
    .template_body = "{\"invoice_id\": {{id}}, \"amount\": {{total}}}",
    .retry_count = 5,
    .timeout_ms = 1000
};
webhook_register(&cb);
```

## ðŸ§© Ð‘ÑƒÐ´ÑƒÑ‰Ð¸Ðµ Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° webhook-Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº (chain hooks)
* ÐŸÐ¾Ð´Ð¿Ð¸ÑÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (HMAC, JWT)
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ (EXACTLY-ONCE)

## ðŸ§° Ð¡Ð²ÑÐ·ÑŒ Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸

* Ð ÐµÐ°ÐºÑ†Ð¸Ñ Ð½Ð° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ: Ð½Ð¾Ð²Ñ‹Ðµ Ð·Ð°ÐºÐ°Ð·Ñ‹, Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ, ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹
* Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¼Ð¸ BPM/ERP ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸
* ÐÑƒÐ´Ð¸Ñ‚ Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹

## ðŸ” Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

* TLS/mTLS Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ðµ
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° scoped tokens Ð¸ client identity
* ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ endpoint Ð¿Ð¾ ACL/whitelist

## ðŸ§¾ Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð¾ÑˆÐ¸Ð±ÐºÐ¸, Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ

* `ERR_WEBHOOK_TIMEOUT`
* `WARN_WEBHOOK_RETRY_EXCEEDED`
* `INFO_WEBHOOK_DISPATCHED`

## ðŸ•“ Ð’ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

* v1.0 â€” Ð±Ð°Ð·Ð¾Ð²Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ HTTP webhook
* v1.1 â€” ÑˆÐ°Ð±Ð»Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐ»Ð°, QoS, failover
* v1.2 â€” Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ CDC, Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ

## ðŸ“ˆ UML-Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð°

```plantuml
@startuml
package "Webhook Engine" {
  class WebhookDispatcher {
    +emit()
    +dispatch()
  }
  class CallbackRegistry {
    +register()
    +unregister()
  }
  WebhookDispatcher --> CallbackRegistry
  WebhookDispatcher --> HttpClient
  CallbackRegistry --> CatalogEngine
}
@enduml
```
