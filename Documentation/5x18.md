–ë–ª–æ–∫ 5.18 ‚Äî Structured Logging –∏ –∞—É–¥–∏—Ç

---

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.18 ‚Äî Structured Logging –∏ –∞—É–¥–∏—Ç**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏—Å—Ç–µ–º—É –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ –°–£–ë–î. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤, –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∫–æ–º–ø–ª–∞–µ–Ω—Å–∞ (GDPR, ISO 27001, SOC 2 –∏ –¥—Ä.).

–û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–∂–∏–º–æ–≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (stderr, syslog, –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç), –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞—É–¥–∏—Ç–∞ –≤—Å–µ—Ö DML/DDL-–∫–æ–º–∞–Ω–¥, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–µ, –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∂—É—Ä–Ω–∞–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π (chainable immutable logs).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| ----------------------------- | ------------------------------------------------------------- |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –§–æ—Ä–º–∞—Ç JSON / binary / syslog; –ª–æ–∫–∞—Ü–∏–∏: —Ñ–∞–π–ª, stdout, syslog  |
| –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π                | DML / DDL / —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏; –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å—Ö–µ–º, –ø–æ–ª–∏—Ç–∏–∫ |
| –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å               | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ chainable hash-based audit logs                     |
| –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è            | TRACE, DEBUG, INFO, WARN, ERROR, FATAL                        |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è                  | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è –∏ –∫–∞–Ω–∞–ª–∞ –ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è   |

---

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct log_entry_t {
  uint64_t timestamp_ns;
  log_level_t level;
  char source[32];
  char operation[64];
  char message[256];
  uint64_t tx_id;
  uint64_t session_id;
} log_entry_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
Logger --> AuditManager
Logger --> SyslogInterface
Logger --> BinaryLogger
AuditManager --> TxManager
AuditManager --> UserManager
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤ (lock-free)
* –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ –∏ syslog-–∫–∞–Ω–∞–ª—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ trace ID –¥–ª—è —Å–∫–≤–æ–∑–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ª–æ–≥–æ–≤
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π audit policy engine
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ / —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/log/log.c`
* `src/log/logger_internal.c`
* `src/audit/audit.c`
* `include/log/log.h`
* `include/audit/audit.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ---------------- | --------------------------------------------------------------- | ---------------------------------- |
| `log_event`      | `void log_event(const char *op, uint64_t time_ns, size_t size)` | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥   |
| `audit_write`    | `void audit_write(tx_t *tx, const char *event)`                 | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∞—É–¥–∏—Ç–∞          |
| `log_set_level`  | `void log_set_level(log_level_t lvl)`                           | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  |
| `log_flush`      | `void log_flush(void)`                                          | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –ª–æ–≥–æ–≤ –≤ –∫–∞–Ω–∞–ª |
| `log_event_json` | `void log_event_json(const char *op, const char *json)`         | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON-–ª–æ–≥         |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/log/test_log.c`, `tests/audit/test_audit.c`
* Fuzz: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å trace ID
* Integration: –ø—Ä–æ–≤–µ—Ä–∫–∞ syslog-–∞—É–¥–∏—Ç–∞ –≤ multi-session —Å—Ä–µ–¥–µ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                    | –ú–µ—Ç—Ä–∏–∫–∞              |
| --------------------------- | -------------------- |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏      | \~60 –Ω—Å / —Å–æ–±—ã—Ç–∏–µ    |
| –í—ã–≥—Ä—É–∑–∫–∞ 10 —Ç—ã—Å. –ª–æ–≥–æ–≤ JSON | < 2.1 –º—Å             |
| –ê—É–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π            | –¥–æ 500k –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                 |
| ----------------------------- | ------ | ------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ audit logging       | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç DML/DDL           |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | 100    | JSON, syslog –∏ binary —Ñ–æ—Ä–º–∞—Ç—ã               |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å            | 100    | < 100 –Ω—Å –Ω–∞ –ª–æ–≥ ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
log_event("TX_COMMIT", get_time_ns(), sizeof(tx_t));
audit_write(current_tx, "User committed transaction.");
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry –¥–ª—è log collector'–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ S3/Cloud Storage
* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞—É–¥–∏—Ç-–ø–æ–ª–∏—Ç–∏–∫ –¥–æ row-level –∞—É–¥–∏—Ç–∞

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "Logger" as LOG
entity "AuditManager" as AUDIT
entity "SyslogInterface" as SYSLOG
entity "BinaryLogger" as BIN
entity "TxManager" as TX
entity "UserManager" as USR

LOG --> AUDIT
LOG --> SYSLOG
LOG --> BIN
AUDIT --> TX
AUDIT --> USR
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ö–æ–º–ø–ª–∞–µ–Ω—Å (GDPR, SOC2)
* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
* –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
* –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π (audit trail)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –Ω–∞ –ª–µ—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
* RBAC –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –∏ –∞—É–¥–∏—Ç—É
* Immutable-–∂—É—Ä–Ω–∞–ª—ã —Å —Ü–µ–ø–æ—á–∫–æ–π —Ö—ç—à–µ–π (proof of record)

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî syslog –∏ stderr –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
* v1.1 ‚Äî JSON structured logs + trace ID
* v1.2 ‚Äî audit log —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
* v1.3 ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                             | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ------------------ | ----------------------------------- | ---------------------------------- |
| `E_LOG_WRITE_FAIL` | –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥             | –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∫–∞–Ω–∞–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  |
| `W_LOG_OVERFLOW`   | –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω          | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–±—ã—Ç–∏–π –ª–æ–≥–æ–≤ |
| `E_AUDIT_UNAUTH`   | –ü–æ–ø—ã—Ç–∫–∞ –∞—É–¥–∏—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –∞—É–¥–∏—Ç–∞       |

