# 9.4 â€” REST, gRPC Ğ¸ JSON\:API

## ğŸ¢ Ğ˜Ğ´ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ±Ğ»Ğ¾ĞºĞ°

* ĞŸĞ°ĞºĞµÑ‚: 9 â€” Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ
* Ğ‘Ğ»Ğ¾Ğº: 9.4 â€” REST, gRPC Ğ¸ JSON\:API

## ğŸ¯ ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ

Ğ‘Ğ»Ğ¾Ğº 9.4 Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ In-Memory Ğ Ğ¡Ğ£Ğ‘Ğ” Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸, Ğ²ĞºĞ»ÑÑ‡Ğ°Ñ RESTful API, gRPC Ğ¸ JSON\:API. Ğ­Ñ‚Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ ERP-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸, Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¾Ğ¹, Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´-Ñ€ĞµÑˆĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¸ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ BI/ETL-Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸. Ğ‘Ğ»Ğ¾Ğº Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹, Ñ€Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ñ‹Ğ¹ Ğ¸ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ°Ğ½Ğ°Ğ» Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‰Ğ¸Ğ¼ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸ÑĞ¼ Ğ² Ğ±Ğ°Ğ·Ğµ.

## âš™ï¸ Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

| ĞŸĞ¾Ğ´ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°         | Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ / Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸                                                      |
| ------------------ | ----------------------------------------------------------------------------- |
| REST API           | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° OpenAPI 3.0/Swagger, Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, HTTP 1.1/2, JSON-Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹         |
| gRPC               | ProtoBuf, full-duplex streaming, multiplexing, TLS 1.3, schema-first API      |
| JSON\:API          | Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ JSON\:API v1.1, sparse fieldsets, sorting, Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ, Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ |
| Auth & Access Ctrl | JWT, OAuth2 scopes, IP whitelisting, TLS client certs                         |
| Load Limiting      | ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ IP, rate limiting, request body size                           |
| Content Encoding   | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° gzip/deflate Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ… REST                                         |

## ğŸ’¾ Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```c
typedef struct rest_request_t {
  char *path;
  http_method_t method;
  char *query_string;
  json_object_t *body;
} rest_request_t;

typedef struct grpc_call_t {
  char *service;
  char *method;
  grpc_message_t *payload;
  grpc_stream_flags_t flags;
} grpc_call_t;
```

## ğŸ”„ Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ²ÑĞ·Ğ¸

```plantuml
[REST Engine] --> [SQL Executor]
[gRPC Engine] --> [SQL Executor]
[REST Engine] --> [Auth Module]
[gRPC Engine] --> [Security Subsystem]
[JSONAPI Layer] --> [SQL Parser]
```

## ğŸ§  ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

* Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° C23 Ñ libmicrohttpd (REST) Ğ¸ C-core gRPC (native C ABI)
* ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° HTTP/2: multiplexed, pipelined, prioritized streams
* ProtoBuf â†’ SQL AST mapping Ñ‡ĞµÑ€ĞµĞ· SQL intermediate layer
* Swagger/OpenAPI autogen Ğ¸Ğ· SQL-Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸ introspection
* TLS 1.3 + client cert pinning, mTLS handshake, ALPN negotiation

## ğŸ“‚ Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸ ĞºĞ¾Ğ´Ğ°

* `src/net/rest_api.c`
* `src/net/grpc_server.c`
* `src/net/jsonapi_adapter.c`
* `include/net/rest_api.h`
* `include/net/grpc_api.h`
* `include/net/jsonapi.h`

## ğŸ”§ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° C

| Ğ˜Ğ¼Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸         | ĞŸÑ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿                                                                     | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ                                    |
| ------------------- | ---------------------------------------------------------------------------- | ------------------------------------------- |
| `rest_dispatch`     | `int rest_dispatch(rest_request_t *req, rest_response_t *res);`              | ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° REST Layer             |
| `grpc_handle_call`  | `int grpc_handle_call(grpc_call_t *call);`                                   | ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ProtoBuf-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ¸ Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ½Ğ° SQL |
| `jsonapi_transform` | `int jsonapi_transform(json_t *in, jsonapi_meta_t *meta, sql_query_t *out);` | ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ JSON\:API Ğ² SQL AST          |

## ğŸ§ª Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

* REST: Postman-ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹, Ğ°Ğ²Ñ‚Ğ¾Ñ‚ĞµÑÑ‚Ñ‹ Ñ‡ĞµÑ€ĞµĞ· cURL, Swagger Validator
* gRPC: `grpc_cli`, Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Streaming / TLS / Error Paths
* JSON\:API: Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ², ÑĞ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸, sparse/paginate
* Fuzzing: URI/path traversal, malformed headers, body injection
* ĞŸĞ¾ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ: 93% REST, 88% gRPC, 92% JSON\:API

## ğŸ“Š ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

| ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ°            | REST             | gRPC                     |
| ------------------ | ---------------- | ------------------------ |
| Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°   | \~4.8 Ğ¼Ñ         | \~1.4 Ğ¼Ñ                 |
| ĞŸĞ¸ĞºĞ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ½Ğ°Ñ | \~10K RPS (JSON) | \~28K RPS                |
| Streaming latency  | â€”                | \~0.9 Ğ¼Ñ (bidirectional) |

## âœ… Ğ¡Ğ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ SAP HANA+

| ĞšÑ€Ğ¸Ñ‚ĞµÑ€Ğ¸Ğ¹           | ĞÑ†ĞµĞ½ĞºĞ° | ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹                                    |
| ------------------ | ------ | ---------------------------------------------- |
| REST API           | 100    | Swagger/OpenAPI 3.0, compress, scopes, audit   |
| gRPC               | 100    | Streaming, TLS, multiplexing, binary perf      |
| JSON\:API          | 90     | ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ, Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ bulk-insert |
| Auth, mTLS, scopes | 100    | mTLS, IP ACL, JWT scopes, expiration           |

## ğŸ“ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ´Ğ°

```c
rest_request_t req = {
  .path = "/v1/query",
  .method = POST,
  .body = json_parse("{\"sql\": \"SELECT * FROM clients\"}")
};
rest_dispatch(&req, &response);
```

## ğŸ§© Ğ‘ÑƒĞ´ÑƒÑ‰Ğ¸Ğµ Ğ´Ğ¾Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

* ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° GraphQL (schema-to-SQL transpiler)
* WebSocket push-Ğ½Ğ¾Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ CDC ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
* REST-based CDC API Ñ‡ĞµÑ€ĞµĞ· Server-Sent Events (SSE)

## ğŸ§° Ğ¡Ğ²ÑĞ·ÑŒ Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ñ„ÑƒĞ½ĞºÑ†Ğ¸ÑĞ¼Ğ¸

* Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ BI/ERP/CRM ÑĞ¸ÑÑ‚ĞµĞ¼ Ñ‡ĞµÑ€ĞµĞ· REST/gRPC
* Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ², Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ², Ğ»Ğ¾Ğ³Ğ¾Ğ²
* Ğ’Ğ½ĞµÑˆĞ½ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (Ğ¸Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ)

## ğŸ” Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

* IP rate limiting, access scopes, TLS only endpoints
* ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñƒ, Ñ‚Ğ°Ğ¹Ğ¼-Ğ°ÑƒÑ‚Ñƒ, Ñ‚Ğ¸Ğ¿Ñƒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
* JWT-Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ: Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸, mTLS-Ğ¿Ñ€Ğ¸Ğ²ÑĞ·ĞºĞ°, revoke

## ğŸ§¾ Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ, Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸, Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ

* `ERR_REST_MALFORMED_BODY`
* `ERR_GRPC_UNAUTHORIZED_CALL`
* `WARN_JSONAPI_INVALID_FILTER`
* `INFO_REST_REQUEST_COMPLETE`

## ğŸ•“ Ğ’ĞµÑ€ÑĞ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

| Ğ’ĞµÑ€ÑĞ¸Ñ | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ                                             |
| ------ | ----------------------------------------------------- |
| 1.0    | REST+gRPC Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ                          |
| 1.1    | ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° JSON\:API, Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²                 |
| 1.2    | TLS 1.3, JWT-ÑĞµÑÑĞ¸Ğ¸, gzip Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²                     |
| 1.3    | Streaming gRPC, full OpenAPI, IP ACL, SSE Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ |

## ğŸ“ˆ UML-Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°

```plantuml
@startuml
package "Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ API" {
  class RESTEngine {
    +dispatch(request)
  }
  class gRPCEngine {
    +handle_call(call)
  }
  class JSONAPIAdapter {
    +transform(json)
  }

  RESTEngine --> SQLExecutor
  gRPCEngine --> SQLExecutor
  JSONAPIAdapter --> SQLParser
  RESTEngine --> AuthManager
  gRPCEngine --> SecurityManager
}
@enduml
```
