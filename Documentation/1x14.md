# üß± –ë–ª–æ–∫ 1.14 ‚Äî –ê–≤—Ç–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (Auto Rebalancing)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.14 ‚Äî –ê–≤—Ç–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –°–£–ë–î, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ —Ü–µ–ª—è—Ö –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤. –ö–ª—é—á–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–º–µ–µ—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ 500+ —Ñ–∏–ª–∏–∞–ª–æ–≤ —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π —Å–≤—ã—à–µ 2 —Ç—Ä–ª–Ω –∑–∞–ø–∏—Å–µ–π –≤ –≥–æ–¥, –∏ –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ OLTP/OLAP –∑–∞–ø—Ä–æ—Å–∞—Ö.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                    |
| ---------------------------------- | ----------------------------------------------------------- |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏                | –ú–µ—Ç—Ä–∏–∫–∏ IOPS, latency, volume per node                      |
| –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ   | Hash-based, range-based, time-based                         |
| –ê–≤—Ç–æ-–º–∏–≥—Ä–∞—Ü–∏—è —à–∞—Ä–¥–æ–≤               | –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ CPU, RAM, NVMe, network                     |
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è             | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MVCC-—Å–Ω–∞–ø—à–æ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö     |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏         | –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ SLA/Latency/Throughput/CPU                       |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å replica-—Ñ–µ–π–ª–æ–≤–µ—Ä–æ–º | –ü–µ—Ä–µ–Ω–æ—Å leader / follower —Ä–æ–ª–µ–π —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct shard_info_t {
    uint32_t shard_id;
    node_id_t current_node;
    uint64_t record_count;
    double avg_latency;
    uint64_t last_migration_time;
} shard_info_t;

typedef struct rebalance_plan_t {
    shard_info_t *source;
    shard_info_t *target;
    uint64_t data_bytes;
    bool live_migration;
} rebalance_plan_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
auto_rebalancer --> cluster_manager
auto_rebalancer --> metrics_collector
auto_rebalancer --> planner
auto_rebalancer --> shard_controller
auto_rebalancer --> mvcc
auto_rebalancer --> wal
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π low-latency –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **multi-tenant**
* –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ NUMA-aware —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **MVCC snapshot** –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ live-migration (–±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤)
* –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Å atomic rebalancing trigger

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/distributed/auto_rebalance.c`
* `include/distributed/auto_rebalance.h`
* `src/sharding/shard_manager.c`
* `src/cluster/cluster_topology.c`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –§—É–Ω–∫—Ü–∏—è                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| ------------------------- | -------------------------------------------------------- | -------------------------------- |
| `rebalance_init`          | `bool rebalance_init(void)`                              | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞   |
| `rebalance_monitor_load`  | `void rebalance_monitor_load(metric_t *cluster_metrics)` | –°–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏    |
| `rebalance_plan_generate` | `rebalance_plan_t *rebalance_plan_generate(void)`        | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö |
| `rebalance_execute`       | `bool rebalance_execute(rebalance_plan_t *plan)`         | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ live-migration        |
| `rebalance_notify_nodes`  | `void rebalance_notify_nodes(rebalance_plan_t *plan)`    | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –Ω–æ–¥       |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* **Unit**: –ª–æ–≥–∏–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–≥—Ä—É–∑–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏—è
* **Integration**: –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å `cluster_manager`, `planner`
* **Fuzz**: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∏ —Ç–æ–ø–æ–ª–æ–≥–∏–π
* **Soak**: –∏–º–∏—Ç–∞—Ü–∏—è 72-—á–∞—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π
* **Mutation**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∏ rollback

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                | –ó–Ω–∞—á–µ–Ω–∏–µ               |
| ---------------------- | ---------------------- |
| –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞  | < 3 –º—Å                 |
| –ü–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —à–∞—Ä–¥–æ–≤ | –¥–æ 10 –ì–ë/—Å –ø—Ä–∏ 4 —É–∑–ª–∞—Ö |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ latency     | < 1.5%                 |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å         | –¥–æ 32 –ø–æ—Ç–æ–∫–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                    | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| --------------------------- | ------ | ----------------------------------------- |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫                    |
| Live-migration              | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ MVCC + WAL              |
| Consistency –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏    | 100    | Snapshot-based                            |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —à–∞—Ä–¥–æ–≤ | 100    | Time-based, Hash-based, Range-based       |
| Multi-node —Ç–æ–ø–æ–ª–æ–≥–∏—è        | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ >32 —É–∑–ª–æ–≤ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Ä–æ–ª–µ–π |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
rebalance_plan_t *plan = rebalance_plan_generate();
if (plan) {
    rebalance_execute(plan);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* ML-–º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ –¥–ª—è proactive —Ä–µ–±–∞–ª–∞–Ω—Å–∞
* Predictive hot-spot detection
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å task scheduler –¥–ª—è background –∑–∞–¥–∞—á

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å—Ç—Ä–æ–≥–æ –ø–æ snapshot –∏ WAL
* –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏—Ä—É—é—Ç—Å—è
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É–∑–ª–µ-–ø–æ–ª—É—á–∞—Ç–µ–ª–µ

---

## üõ∞Ô∏è –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ì–∞—Ä–∞–Ω—Ç–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 500+ —Ñ–∏–ª–∏–∞–ª–æ–≤
* –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ hot-spots –∏ bottle-neck –ø—Ä–∏ OLTP/OLAP
* –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ / –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

## üóÇÔ∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* –í–µ—Ä—Å–∏—è: `v1.0`
* –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `26.07.2025`
* –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: `distributed_team@domain`

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class shard_info_t {
  +uint32_t shard_id
  +node_id_t current_node
  +uint64_t record_count
  +double avg_latency
  +uint64_t last_migration_time
}

class rebalance_plan_t {
  +shard_info_t *source
  +shard_info_t *target
  +uint64_t data_bytes
  +bool live_migration
}

rebalance_plan_t --> shard_info_t : source / target
@enduml
```

