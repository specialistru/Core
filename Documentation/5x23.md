# 5.23 ‚Äî SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.23 ‚Äî SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ SQL: –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–∞–º, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –ø–æ –≥—Ä—É–ø–ø–∞–º –¥–∞–Ω–Ω—ã—Ö, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å real-time –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä—è–º–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º ML-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| --------------------------- | ------------------------------------------------------------- |
| SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è | `FORECAST()`, `PREDICT_LINEAR()`, `HOLT_WINTERS()`            |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è               | `CLUSTER_KMEANS()`, `CLUSTER_DBSCAN()`                        |
| –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏                  | `CORR()`, `COVAR_POP()`, `COVAR_SAMP()`                       |
| –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã          | `TIME_BUCKET()`, `GAP_FILL()`, `MOVING_AVG()`                 |
| –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞          | `LAG()`, `LEAD()`, `FIRST_VALUE()`, `LAST_VALUE()`, `DELTA()` |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct forecast_model_t {
  char model_name[MAX_NAME];
  enum { LINEAR, HOLT_WINTERS, ARIMA } method;
  float alpha, beta, gamma;
  uint64_t train_ts_start;
  uint64_t train_ts_end;
  double *coefficients;
} forecast_model_t;

typedef struct cluster_result_t {
  int cluster_id;
  float distance;
} cluster_result_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
SQLExecutor --> ForecastEngine
SQLExecutor --> CorrelationEngine
SQLExecutor --> ClusterEngine
ForecastEngine --> TimeSeriesStore
ClusterEngine --> ColumnStore
CorrelationEngine --> RowStore
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: C23 —Å SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ
* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ (auto-tuning)
* NUMA-aware –¥–æ—Å—Ç—É–ø –∫ Column Store

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/sql_forecast.c`
* `src/sql/sql_cluster.c`
* `src/sql/sql_corr.c`
* `include/sql/forecast.h`
* `include/sql/cluster.h`
* `include/sql/correlation.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| --------------------- | ------------------------------------------------------------------------ | ------------------------------------------ |
| `forecast_eval`       | `result_t forecast_eval(const row_t *rows, const forecast_model_t *m)`   | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è            |
| `cluster_kmeans`      | `cluster_result_t *cluster_kmeans(row_t *rows, int k)`                   | –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–º k-—Å—Ä–µ–¥–Ω–∏—Ö |
| `compute_correlation` | `double compute_correlation(const double *x, const double *y, size_t n)` | –†–∞—Å—á—ë—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ü–∏—Ä—Å–æ–Ω–∞     |
| `ts_gap_fill`         | `result_t ts_gap_fill(row_t *series)`                                    | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö    |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/sql/test_forecast.c`, `test_corr.c`, `test_cluster.c`
* Soak: –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –æ–∫–æ–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
* Fuzz: –≤–≤–æ–¥ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
* Coverage: 97.2% —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –ø–æ–∫—Ä—ã—Ç–æ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                          | –ú–µ—Ç—Ä–∏–∫–∞                   |
| --------------------------------- | ------------------------- |
| –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ `FORECAST()`           | < 0.9 –º—Å –Ω–∞ 1000 —Ç–æ—á–µ–∫    |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è `CLUSTER_KMEANS()`  | 2.3 –º—Å –Ω–∞ 10 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤    |
| –†–∞—Å—á—ë—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ `CORR()`        | < 0.5 –º—Å –Ω–∞ 1000 –ø–∞—Ä      |
| –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ `GAP_FILL()` | \~1.2 –º—Å –Ω–∞ 500 –ø—Ä–æ–ø—É—Å–∫–æ–≤ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| ----------------------------- | ------ | --------------------------------------- |
| SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ           | 100    | –ï—Å—Ç—å `FORECAST`, `HOLT_WINTERS`         |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π          | 100    | `CORR()`, `COVAR_*()`                   |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è SQL             | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ `CLUSTER_KMEANS()`           |
| –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ gap-fill | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `GAP_FILL()`, `TIME_BUCKET()` |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
SELECT symbol, FORECAST(price, 'HOLT_WINTERS', 7)
FROM stock_prices
WHERE symbol = 'AAPL'
GROUP BY symbol
ORDER BY timestamp DESC;
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ARIMA –∏ Prophet –º–æ–¥–µ–ª–µ–π
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ (ACF)
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* –£—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenCL/GPU

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
component "ForecastEngine" as F
component "CorrelationEngine" as C
component "ClusterEngine" as K
database "TimeSeriesStore" as TS
database "ColumnStore" as CS
database "RowStore" as RS

SQL --> F
SQL --> C
SQL --> K
F --> TS
K --> CS
C --> RS
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
* –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
* –û—Ü–µ–Ω–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –ø—Ä–æ–¥–∞–∂–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏
* –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ telemetry/IoT

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª—è–º –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ —Ä–æ–ª—è–º
* –ê—É–¥–∏—Ç –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –∏ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
* v1.1 ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∏ gap-fill
* v1.2 ‚Äî auto-tuning –º–æ–¥–µ–ª–µ–π
* v1.3 ‚Äî NUMA-aware –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                      | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | ---------------------------- | ------------------------------------ |
| `E_FORECAST_MODEL` | –ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏          |
| `W_CLUSTER_EMPTY`  | –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ã | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏–ª–∏ –ø—É—Å—Ç—ã |
| `E_CORR_DIV0`      | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å              | –ù–µ—Ç –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –≤ –æ–¥–Ω–æ–º –∏–∑ –≤–µ–∫—Ç–æ—Ä–æ–≤    |


