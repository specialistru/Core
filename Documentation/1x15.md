# üß± –ë–ª–æ–∫ 1.15 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (Distributed Planner)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.15 ‚Äî –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á –≤ —É—Å–ª–æ–≤–∏—è—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞. –û–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Ç–æ–ø–æ–ª–æ–≥–∏—é –¥–∞–Ω–Ω—ã—Ö (—à–∞—Ä–¥—ã, –ø–∞—Ä—Ç–∏—Ü–∏–∏, —Ä–µ–ø–ª–∏–∫–∏) –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å —É—á—ë—Ç–æ–º –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏, –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏. –ö–ª—é—á–µ–≤–∞—è —Ä–æ–ª—å ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –∏ –±—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                             |
| --------------------------------- | ---------------------------------------------------- |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã     | –ü–ª–∞–Ω –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –ø–æ–¥–≥—Ä–∞—Ñ—ã —Å —É—á—ë—Ç–æ–º —à–∞—Ä–¥–æ–≤ –∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ |
| –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤           | Join, Filter, Sort, Aggregate –∏ –∏—Ö –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —É–∑–ª–∞–º  |
| –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ     | –í —Å–ª—É—á–∞–µ –æ—à–∏–±–æ–∫, –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∏–ª–∏ hot-spot             |
| –£—á–µ—Ç –º–µ—Ç—Ä–∏–∫                       | –£—á–∏—Ç—ã–≤–∞–µ—Ç latency, cardinality, —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, IOPS  |
| –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤          | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ final-aggregation, UNION, LIMIT            |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ-—Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π | –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —à–∞—Ä–¥–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏   |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct plan_fragment_t {
    uint64_t fragment_id;
    node_id_t target_node;
    char *sql_subplan;
    uint32_t estimated_cost;
} plan_fragment_t;

typedef struct distributed_plan_t {
    uint64_t query_id;
    plan_fragment_t *fragments;
    uint32_t fragment_count;
    uint64_t total_cost;
} distributed_plan_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
distributed_planner --> sql_parser
distributed_planner --> cost_estimator
distributed_planner --> auto_rebalancer
distributed_planner --> cluster_topology
distributed_planner --> transaction_manager
distributed_planner --> executor
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23** —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ C++ –æ–±—ë—Ä—Ç–∫–∞–º–∏ –¥–ª—è –ø–ª–∞–Ω-–≥—Ä–∞—Ñ–∞
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AST -> logical plan -> distributed physical plan
* NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö —É–∑–ª–æ–≤
* Runtime feedback loop —Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º subplan –ø—Ä–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ pull-based (coordinator), —Ç–∞–∫ –∏ push-based (leaf-driven) –º–æ–¥–µ–ª–µ–π

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/planner/distributed_planner.c`
* `include/planner/distributed_planner.h`
* `src/planner/plan_fragment.c`
* `src/executor/distributed_executor.c`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –§—É–Ω–∫—Ü–∏—è                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| ------------------------- | ------------------------------------------------------------------------------------ | --------------------------------- |
| `planner_generate_plan`   | `distributed_plan_t *planner_generate_plan(ast_node_t *root, db_session_t *session)` | –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω     |
| `planner_split_fragments` | `plan_fragment_t *planner_split_fragments(...)`                                      | –†–∞–∑–±–∏–≤–∞–µ—Ç –ø–ª–∞–Ω –ø–æ —à–∞—Ä–¥–∞–º          |
| `planner_estimate_cost`   | `uint32_t planner_estimate_cost(plan_fragment_t *fragment)`                          | –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥-–ø–ª–∞–Ω–∞        |
| `planner_dispatch`        | `bool planner_dispatch(distributed_plan_t *plan)`                                    | –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥-–ø–ª–∞–Ω–æ–≤ –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ |
| `planner_feedback_adjust` | `void planner_feedback_adjust(query_id_t qid, latency_t actual)`                     | –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–ª–∞–Ω–∞ –≤ runtime     |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* **Unit**: cost estimate, fragment split
* **Integration**: SQL ‚Üí distributed plan ‚Üí execution
* **Stress**: 10K+ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
* **Mutation**: –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è —Å–µ—Ç–∏, —Å–±–æ–π —É–∑–ª–æ–≤
* **Coverage**: >94% –≤ planner/ –ø–æ–¥–¥–µ—Ä–µ–≤–µ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                       | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
| ----------------------------- | ---------------------------- |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞ | 1.8 –º—Å                       |
| –ü–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞ –ø–æ feedback loop   | <500 –º–∫—Å                     |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏    | –¥–æ 128 —É–∑–ª–æ–≤                 |
| –†–∞–∑–º–µ—Ä –ø–ª–∞–Ω–∞ –≤ –ø–∞–º—è—Ç–∏         | <1 –ú–ë –Ω–∞ —Å–ª–æ–∂–Ω—ã–π OLAP –∑–∞–ø—Ä–æ—Å |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                         | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| -------------------------------- | ------ | -------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏           | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞                 |
| Runtime –∞–¥–∞–ø—Ç–∞—Ü–∏—è                | 100    | Feedback + replanning                        |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π           | 100    | –° —É—á—ë—Ç–æ–º NUMA –∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏                    |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ | 100    | –°–≤—è–∑–∞–Ω —Å planner, rebalance, txn, cost, exec |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
distributed_plan_t *plan = planner_generate_plan(ast_root, session);
if (plan && planner_dispatch(plan)) {
    log_event("distributed_plan_dispatched", time_ns(), plan->fragment_count);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* ML-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ common subplans
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–Ω–∞ (EXPLAIN GRAPH)

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –§—Ä–∞–≥–º–µ–Ω—Ç—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è HMAC –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
* –ó–∞—â–∏—Ç–∞ –æ—Ç route injection –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RBAC-–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ

---

## üõ∞Ô∏è –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω–∞ 500+ —Ñ–∏–ª–∏–∞–ª–∞—Ö
* –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ ‚Äî –±–µ–∑ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π SLA latency

---

## üóÇÔ∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* –í–µ—Ä—Å–∏—è: `v1.0`
* –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `26.07.2025`
* –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: `planner_team@domain`

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class plan_fragment_t {
  +uint64_t fragment_id
  +node_id_t target_node
  +char* sql_subplan
  +uint32_t estimated_cost
}

class distributed_plan_t {
  +uint64_t query_id
  +plan_fragment_t* fragments
  +uint32_t fragment_count
  +uint64_t total_cost
}

distributed_plan_t --> plan_fragment_t : fragments
@enduml
```
