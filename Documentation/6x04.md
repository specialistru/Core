# 6.4 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (TLS / mTLS / JWT / TDE)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.4 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (TLS / mTLS / JWT / TDE)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∑–∞—â–∏—Ç—É –∫–∞–Ω–∞–ª–∞ –∏ —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –≤–∫–ª—é—á–∞—è TLS 1.3, –≤–∑–∞–∏–º–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (mTLS), —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ (JWT) –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ (TDE). –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–∞–∫ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º RPC/SQL-—Ç—Ä–∞—Ñ–∏–∫–µ, —Ç–∞–∫ –∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                    |
| --------------------------------- | ----------------------------------------------------------- |
| TLS / mTLS                        | TLS 1.3 —Å ECDHE, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏      |
| JWT                               | –ü–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–æ–≤ (RS256), –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è         |
| Transparent Data Encryption (TDE) | AES-256-GCM, –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ KMS, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ page-level         |
| API Access Layer                  | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ REST/gRPC/SQL, –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤          |
| Key Rotation                      | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –∫–ª—é—á–µ–π, zero-downtime –∫–ª—é—á–µ–≤–æ–π rollover |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
// –ö–ª—é—á–∏ TLS
typedef struct tls_cert_t {
  char subject[256];
  uint8_t *cert_data;
  size_t cert_len;
} tls_cert_t;

// –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
typedef struct tde_key_metadata_t {
  uuid_t key_id;
  time_t created_at;
  bool active;
} tde_key_metadata_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
[Net API Layer] --> [TLS Handler]
[SQL Gateway] --> [JWT Validator]
[Storage Engine] --> [TDE Encryptor]
[Admin UI] --> [TLS Handler]
[TDE Encryptor] --> [KMS Interface]
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* OpenSSL –∏ BoringSSL —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö HSM –∏ –≤–Ω–µ—à–Ω–µ–≥–æ KMS (AWS, Vault)
* Sandbox –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–ª—é—á–∞–º–∏
* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏ –¥–æ–≤–µ—Ä–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä–æ–≤

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/tls_handler.c`
* `src/security/tde.c`
* `src/security/jwt.c`
* `src/net/net_secure.c`
* `include/security/tls.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| ---------------- | ----------------------------------------------------------- | -------------------------------- |
| `tls_init`       | `int tls_init(const char *cert_path, const char *key_path)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TLS –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ |
| `jwt_validate`   | `bool jwt_validate(const char *token, const char *pubkey)`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT-—Ç–æ–∫–µ–Ω–∞              |
| `tde_encrypt`    | `int tde_encrypt(page_t *pg, tde_key_t *key)`               | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö       |
| `tde_rotate_key` | `int tde_rotate_key(uuid_t new_key_id)`                     | –ê—Ç–æ–º–∞—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞          |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_tls.c`, `test_tde.c`, `test_jwt.c`
* Integration: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI/REST/gRPC —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
* Fuzz: –ø—Ä–æ–≤–µ—Ä–∫–∞ PEM/DER –≤—Ö–æ–¥–æ–≤ –∏ JWT-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
* Coverage: > 94%

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                  | –ú–µ—Ç—Ä–∏–∫–∞          |
| ------------------------- | ---------------- |
| TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ (avg)     | \~2.1 –º—Å         |
| JWT-–ø—Ä–æ–≤–µ—Ä–∫–∞              | < 0.4 –º—Å         |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (TDE) | \~1.7 –º—Å –Ω–∞ 8 KB |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                       | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| ------------------------------ | ------ | ---------------------------------------- |
| TLS/mTLS                       | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ TLS  |
| JWT —Å —Ä–æ–ª—è–º–∏ –∏ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RS256 –∏ RBAC –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| Transparent Data Encryption    | 100    | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü, key rollover, audit  |
| KMS/HSM                        | 90     | –ï—Å—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ     |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
// –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –ø–µ—Ä–µ–¥ SQL-–∑–∞–ø—Ä–æ—Å–æ–º
if (!jwt_validate(token, public_key)) {
    return ERR_AUTH_FAILED;
}
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS 1.3 PSK
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π KMS —Å GUI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ discovery —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "Net API Layer" as API
entity "SQL Gateway" as SQL
entity "TLS Handler" as TLS
entity "JWT Validator" as JWT
entity "TDE Encryptor" as TDE
entity "KMS Interface" as KMS

API --> TLS
SQL --> JWT
TDE --> KMS
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
* –ó–∞—â–∏—Ç–∞ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–µ–∫ –¥–æ–≤–µ—Ä–∏—è TLS
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ –¥–∞—Ç–µ/—Å—É–±—ä–µ–∫—Ç—É
* –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏ –∂—É—Ä–Ω–∞–ª –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî TLS –∏ JWT
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TDE
* v1.2 ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º KMS

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                   | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ----------------- | ------------------------- | ------------------------------------ |
| `E_TLS_HANDSHAKE` | –û—à–∏–±–∫–∞ TLS                | –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ |
| `E_JWT_INVALID`   | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω            | –¢–æ–∫–µ–Ω –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É     |
| `W_KEY_ROTATE`    | –ò—Å—Ç—ë–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ | –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞             |


