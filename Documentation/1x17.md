# üß± –ë–ª–æ–∫ 1.17 ‚Äî –ò–Ω–¥–µ–∫—Å—ã –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è (Indexing Engine)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.17 ‚Äî –ò–Ω–¥–µ–∫—Å—ã –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: OLTP, OLAP, JSON, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–Ω–¥–µ–∫—Å–æ–≤ (B+-–¥–µ—Ä–µ–≤—å—è, —Ö–µ—à, –±–∏—Ç–æ–≤—ã–µ, –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ), –∞ —Ç–∞–∫–∂–µ –º–µ—Ö–∞–Ω–∏–∑–º –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, —Ñ–æ—Ä–º–∏—Ä—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –≥–ª—É–±–æ–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞              | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                                |
| ----------------------- | --------------------------------------------------------------------------------------- |
| B+-–∏–Ω–¥–µ–∫—Å—ã              | –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∏–ø –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –∏ –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–º–∏ —Å–∫–∞–Ω–∞–º–∏ |
| –•–µ—à-–∏–Ω–¥–µ–∫—Å—ã             | –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ point-lookup –ø–æ –∫–ª—é—á—É                                                      |
| Bitmap-–∏–Ω–¥–µ–∫—Å—ã          | –î–ª—è –±—É–ª–µ–≤—ã—Ö –∏ low-cardinality —Å—Ç–æ–ª–±—Ü–æ–≤                                                  |
| –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã | –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–∫—Å—Ç–∞–º, JSON, —Å–ø–∏—Å–∫–∞–º                                                    |
| –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è   | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, —Å —ç–≤–∏–∫—Ü–∏–µ–π –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö                      |
| TTL-–∏–Ω–¥–µ–∫—Å—ã             | –î–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –¥–∞–Ω–Ω—ã—Ö                                                    |
| –ò–Ω–¥–µ–∫—Å—ã –ø–æ JSON –ø—É—Ç—è–º   | –ü–æ–∑–≤–æ–ª—è—é—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä                            |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef enum {
    INDEX_BTREE,
    INDEX_HASH,
    INDEX_BITMAP,
    INDEX_INVERTED,
    INDEX_ADAPTIVE
} index_type_t;

typedef struct index_entry_t {
    uint64_t key_hash;
    rowid_t row_id;
} index_entry_t;

typedef struct index_t {
    index_type_t type;
    char column_name[MAX_NAME];
    void *impl;
} index_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
indexing_engine --> column_store
indexing_engine --> row_store
indexing_engine --> optimizer
indexing_engine --> planner
indexing_engine --> mvcc_engine
indexing_engine --> wal
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**, B+-tree —Å lock-free split/merge
* NUMA-aware –∞–ª–ª–æ–∫–∞—Ü–∏—è —É–∑–ª–æ–≤ –∏ bitmap-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bloom-—Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω–¥–µ–∫—Å–∞–º
* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –ø–æ –º–µ—Ä–µ –≤—Å—Ç–∞–≤–æ–∫/—É–¥–∞–ª–µ–Ω–∏–π
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–Ω–ª–∞–π–Ω —Å–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/index/index_engine.c`
* `include/index/index_engine.h`
* `src/index/btree.c`, `hash.c`, `bitmap.c`, `adaptive.c`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –§—É–Ω–∫—Ü–∏—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| -------------------- | --------------------------------------------------------------------------- | ------------------------------------------ |
| `index_create`       | `index_t *index_create(index_type_t type, const char *column)`              | –°–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞              |
| `index_insert`       | `void index_insert(index_t *index, rowid_t row, const void *value)`         | –í—Å—Ç–∞–≤–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∏–Ω–¥–µ–∫—Å                  |
| `index_search`       | `rowid_t *index_search(index_t *index, const void *key, size_t *out_count)` | –ü–æ–∏—Å–∫ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –∫–ª—é—á–∞                    |
| `index_evict_unused` | `void index_evict_unused(index_t *index, uint64_t ts_limit)`                | –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä |
| `index_drop`         | `void index_drop(index_t *index)`                                           | –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞                           |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* **Unit**: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–æ–∏—Å–∫–∞ —Å full scan
* **Fuzz**: –ø–æ–∏—Å–∫ –ø–æ —Å–ª—É—á–∞–π–Ω—ã–º –∫–ª—é—á–∞–º –∏ eviction
* **Stress**: –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
* **Coverage**: 94% –ø–æ `src/index/`

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                        | –ó–Ω–∞—á–µ–Ω–∏–µ                            |
| ------------------------------ | ----------------------------------- |
| Lookup latency (hash)          | < 200 –Ω—Å                            |
| Range scan (btree)             | \~1.1 –º–ª–Ω —Å—Ç—Ä–æ–∫/—Å–µ–∫/—è–¥—Ä–æ            |
| Bitmap scan (10K rows)         | < 30 –º–∫—Å                            |
| –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ | < 5 –º—Å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –∫–æ–ª–æ–Ω–∫–µ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                        | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                           |
| ------------------------------- | ------ | ------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ B+ –∏ hash             | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã                           |
| –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, bitmap –∏–Ω–¥–µ–∫—Å—ã | 100    | –ï—Å—Ç—å                                  |
| –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è           | 100    | –í—Å—Ç—Ä–æ–µ–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏        |
| TTL / JSON –∏–Ω–¥–µ–∫—Å—ã              | 100    | –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ query planner           |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º      | 100    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
index_t *ix = index_create(INDEX_BTREE, "amount");
index_insert(ix, 1024, &value);
rowid_t *matches = index_search(ix, &query_val, &count);
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ó–∞—â–∏—Ç–∞ –æ—Ç race condition —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RW-locks
* Fail-safe recovery —á–µ—Ä–µ–∑ WAL –∑–∞–ø–∏—Å–µ–π –∏–Ω–¥–µ–∫—Å–∞
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ cardinality –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤

---

## üõ∞Ô∏è –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
* –ü–æ–∏—Å–∫ –ø–æ JSON —Å–æ–±—ã—Ç–∏—è–º –∏ –ª–æ–≥–∞–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å –±—ã—Å—Ç—Ä—ã–º —Ñ–∏–ª—å—Ç—Ä–æ–º

---

## üóÇÔ∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* –í–µ—Ä—Å–∏—è: `v1.0`
* –û–±–Ω–æ–≤–ª–µ–Ω–æ: `26.07.2025`
* –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: `index_team@domain`

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class index_t {
  +index_type_t type
  +char column_name[]
  +void *impl
}

class index_entry_t {
  +uint64_t key_hash
  +rowid_t row_id
}

index_t --> index_entry_t
@enduml
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* Index skipping –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
* –î–µ–ª—å—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è snapshot
* –ì–∏–±—Ä–∏–¥–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: bitmap + btree
