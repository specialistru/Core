# üß± –ë–ª–æ–∫ 1.3 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ (network\_init)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.3 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ (network\_init)–µ

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞ –°–£–ë–î, –≤–∫–ª—é—á–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ–∫–µ—Ç–æ–≤, –ø—Ä–∏–≤—è–∑–∫—É –∫ IP-–∞–¥—Ä–µ—Å–∞–º –∏ –ø–æ—Ä—Ç–∞–º, —É—Å—Ç–∞–Ω–æ–≤–∫—É —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –Ø–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ gRPC/WebSocket/REST-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                         |
| ----------------- | ---------------------------------------------------------------- |
| TCP/UDP-—Å–µ—Ä–≤–µ—Ä    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ IPv4/IPv6, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `thrd_create`         |
| –ü–æ—Ä—Ç—ã             | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑ config: API, replication, metrics                   |
| –°–æ–∫–µ—Ç—ã            | `socket_create()`, `socket_bind()`, `socket_listen()`            |
| CLI/REST/gRPC     | –û–±—â–∞—è –ø—Ä–æ—Å–ª–æ–π–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–∫–µ—Ç–æ–≤                                |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SSL/TLS | –ß–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π (–≤ –±—É–¥—É—â–µ–º, —á–µ—Ä–µ–∑ OpenSSL –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É) |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```c
typedef struct {
    char bind_ip[64];
    uint16_t api_port;
    uint16_t repl_port;
    uint16_t metrics_port;
    bool reuse_addr;
    bool tcp_nodelay;
} net_config_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[1.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è] --> [1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.1 REST API]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.2 gRPC –°–µ—Ä–≤–µ—Ä]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.3 –í–µ–±-—Å–æ–∫–µ—Ç—ã]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [4.1 –ö–ª–∞—Å—Ç–µ—Ä–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è POSIX-—Å–æ–∫–µ—Ç—ã (Linux) –∏ Windows API —á–µ—Ä–µ–∑ –æ–±—ë—Ä—Ç–∫–∏
* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `SO_REUSEADDR`, `TCP_NODELAY` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö: `bind`, `listen`, `accept`
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ thread affinity –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/network.c`
* `include/network.h`
* `src/socket.c`
* `include/socket.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| -------------- | ------------------------------------------------------------ | ------------------------------------ |
| network\_init  | `bool network_init(const net_config_t *cfg);`                | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–ª—É—à–∞—é—â–∏—Ö —Å–æ–∫–µ—Ç–æ–≤ |
| socket\_create | `int socket_create();`                                       | –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ —Å–æ–∫–µ—Ç–∞          |
| socket\_bind   | `bool socket_bind(int sock, const char *ip, uint16_t port);` | –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–∫–µ—Ç–∞ –∫ IP/–ø–æ—Ä—Ç—É           |
| socket\_listen | `bool socket_listen(int sock);`                              | –ü–µ—Ä–µ–≤–æ–¥ —Å–æ–∫–µ—Ç–∞ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* `tests/test_network.c`: Unit + Integration
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏ —Å–æ–∫–µ—Ç–æ–≤
* –ü–æ–∫—Ä—ã—Ç–∏–µ: —Å–æ–∑–¥–∞–Ω–∏–µ, bind, listen, –æ—à–∏–±–∫–∏ –ø–æ—Ä—Ç–æ–≤

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ < 2 –º—Å
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ > 20K –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (epoll/kqueue)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ thread pinning –∏ NUMA-aware —Å–æ–∫–µ—Ç–æ–≤ –≤ –±—É–¥—É—â–µ–º

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                 |
| ---------------------------- | ------ | --------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤         | 100    | TCP, WebSocket, REST, gRPC  |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | 100    | epoll, thread pool          |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å                 | 80     | –í –ø–ª–∞–Ω–∞—Ö TLS/mTLS           |
| –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å              | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ C23 `thrd_create` |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!network_init(&global_config.net)) {
    log_error("network", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–∏");
    return false;
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* TLS/mTLS —á–µ—Ä–µ–∑ OpenSSL –∏–ª–∏ wolfSSL
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ QUIC/HTTP3
* NUMA-aware —Å–æ–∫–µ—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
* Adaptive backlog + SO\_PRIORITY

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
package "1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏" {
  [socket_create()] --> [socket_bind()]
  [socket_bind()] --> [socket_listen()]
  [socket_listen()] --> [network_init()]
}
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (–≤–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã)
* –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏
* –°—Ç—Ä–∏–º–∏–Ω–≥ –∏ CDC –Ω–∞—Ä—É–∂—É

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* `v0.9`: –ø–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `network_init`
* `v1.1`: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IPv6, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫
* `v1.2`: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ reusable address + thread-pinning roadmap

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ IP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ config
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ—Ä—Ç–æ–≤/ACL
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                           | –£—Å–ª–æ–≤–∏–µ                                |
| ------- | ----------------------------------- | -------------------------------------- |
| INFO    | `[NET] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ –Ω–∞ %s:%d` | –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º bind                      |
| ERROR   | `[NET] –û—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞: %s`           | –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö socket\_create/bind/listen |
| DEBUG   | `[NET] –°–æ–∫–µ—Ç %d —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç %d`    | –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ                 |

