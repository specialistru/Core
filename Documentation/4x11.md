# üìò 4.11 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ DSL –∏ API-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* –ü–∞–∫–µ—Ç 4 ‚Äî –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
* –ë–ª–æ–∫ 4.11 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ DSL –∏ API-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–Ω–µ—à–Ω–∏—Ö –¥–æ–º–µ–Ω–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (DSL) –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö API-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –ø–æ–∑–≤–æ–ª—è—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –°–£–ë–î —Å –±–∏–∑–Ω–µ—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏, low-code/no-code —Å—Ä–µ–¥–∞–º–∏, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é –ª–æ–≥–∏–∫—É —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã. –≠—Ç–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã, –ø–æ–∑–≤–æ–ª—è—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤–Ω–µ–¥—Ä—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ API.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞       | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                |
| ---------------- | ----------------------------------------------------------------------- |
| –í–Ω–µ—à–Ω–∏–µ DSL      | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —à–ª—é–∑—ã –¥–ª—è low-code DSL (JSONScript, BPMN, DomainXML)         |
| –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ API  | –ü–ª–∞–≥–∏–Ω—ã –≤ –≤–∏–¥–µ C/WASM-–º–æ–¥—É–ª–µ–π, –¥–æ—Å—Ç—É–ø –∫ API —è–¥—Ä–∞                        |
| Runtime Binding  | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ DSL –∏ API-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã                      |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ERP | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –∑–∞–¥–∞—á, –±–∏–∑–Ω–µ—Å-—Å–ª–æ–≤–∞—Ä–∏, –≤—ã–∑–æ–≤ ETL/DSL —Ñ—É–Ω–∫—Ü–∏–π |
| –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ scope/role/tenant + sandbox –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ                   |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct api_extension_t {
    char *name;
    void (*handler_fn)(api_context_t *ctx);
    char *dsl_type;
    bool is_runtime;
} api_extension_t;

typedef struct dsl_binding_t {
    char *dsl_name;
    char *entrypoint;
    json_t *definition;
} dsl_binding_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[DSL Binding] --> [API Gateway]
[API Gateway] --> [Core Execution]
[API Extension] --> [Security Sandbox]
[ERP Templates] --> [ETL Engine]
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DSL —Å AST-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞–º–∏ –∏/–∏–ª–∏ bytecode
* –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ WASM-–º–æ–¥—É–ª–µ–π —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ API
* Dynamic reloading –º–æ–¥—É–ª–µ–π –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —è–¥—Ä–∞
* –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã DSL ‚Üí SQL/DSL ‚Üí internal DSL
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É DSL/API

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/dsl/dsl_bind.c`
* `include/dsl/dsl_bind.h`
* `src/ext/api_gateway.c`
* `include/ext/api_gateway.h`
* `src/ext/api_runtime.c`
* `include/ext/api_runtime.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                         | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| -------------------- | ------------------------------------------------ | ------------------------------------- |
| `dsl_bind_register`  | `int dsl_bind_register(dsl_binding_t *binding);` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è DSL-—Å—Ü–µ–Ω–∞—Ä–∏—è              |
| `api_ext_register`   | `int api_ext_register(api_extension_t *ext);`    | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ API-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è |
| `api_gateway_handle` | `void api_gateway_handle(api_context_t *ctx);`   | –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ API-–∑–∞–ø—Ä–æ—Å–∞       |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: DSL binding, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è API
* Integration: ERP —Å—Ü–µ–Ω–∞—Ä–∏–∏ —á–µ—Ä–µ–∑ DSL/API
* Stress: 10K API —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ DSL-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä—ã
* Fuzzing: –≤—Ö–æ–¥–Ω—ã–µ DSL-–¥–µ—Ä–µ–≤—å—è, runtime callbacks

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ DSL < 2 –º—Å –¥–ª—è AST
* –í—Ä–µ–º—è –Ω–∞ API callback (WASM): \~5 –º—Å
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 5K –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö DSL/REST –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ----------------- | ------ | ----------------------------------------- |
| –í–Ω–µ—à–Ω–∏–µ DSL       | 90     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BPMN, JSONScript, —à–∞–±–ª–æ–Ω–æ–≤ ERP  |
| –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å API | 95     | Runtime-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, sandbox, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| ERP-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è    | 88     | –®–∞–±–ª–æ–Ω—ã –∏ —Ä–µ–µ—Å—Ç—Ä —Å—É—â–Ω–æ—Å—Ç–µ–π –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç   |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
api_extension_t ext = {
  .name = "custom_approval",
  .handler_fn = &my_custom_handler,
  .dsl_type = "JSONScript",
  .is_runtime = true
};
api_ext_register(&ext);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö DSL: YANG, GraphDSL, FinDSL
* JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏—è WASM-—Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

## üß∞ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ low-code BPMN –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö workflow —á–µ—Ä–µ–∑ DSL
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö API —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ ERP/BI

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ò–∑–æ–ª—è—Ü–∏—è WASM API-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
* RBAC/ABAC –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ API
* –õ–∏–º–∏—Ç—ã CPU/memory/time –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤

## üßæ –°–æ–æ–±—â–µ–Ω–∏—è, –æ—à–∏–±–∫–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

* `ERR_DSL_ENTRY_MISSING`
* `ERR_API_HANDLER_FAILED`
* `WARN_DSL_OVERTIME_EXECUTION`

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî DSL registry + API —Ö–µ–Ω–¥–ª–µ—Ä—ã –Ω–∞ C
* v1.1 ‚Äî WASM DSL-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, runtime reload
* v1.2 ‚Äî ERP —à–∞–±–ª–æ–Ω—ã, sandbox runtime

## üìà UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "API/DSL Runtime" {
  class api_extension_t {
    +name
    +handler_fn
    +dsl_type
    +is_runtime
  }
  class dsl_binding_t {
    +dsl_name
    +entrypoint
    +definition
  }
  api_extension_t --> api_gateway
  dsl_binding_t --> dsl_engine
}
@enduml
```
