# üì¶ –ü–∞–∫–µ—Ç 0 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç

| ‚Ññ –±–ª–æ–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞                                                                           |
| ------- | ---------------------------------------------------------------------------------------- |
| 0.1     | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)                                                     |

# üß± –ë–ª–æ–∫ 0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 0 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç
* **–ë–ª–æ–∫:** 0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ `0.1 main()` —è–≤–ª—è–µ—Ç—Å—è **—Ç–æ—á–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** —Ä–∞–±–æ—Ç—ã –≤—Å–µ–π In-Memory –†–°–£–ë–î. –û–Ω –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –±–ª–æ–∫, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| ------------------- | ------------------------------------------------------------- |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è        | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è                      |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ         | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è syslog / stderr / –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è         |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ           | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL, snapshot, recovery                         |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫         | –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è                 |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏          | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è REST/gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤                           |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è / –∫–≤–æ—Ä—É–º | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)                        |
| –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã   | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ SIGINT/SIGTERM, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

*–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: –±–ª–æ–∫ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.*

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "0 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" {
  [0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)]
}

[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [1.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [2.1 MVCC-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [3.1 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [4.1 REST API / CLI]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [7.1 –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**
* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤: `signal(SIGINT, handler)`
* NUMA-aware –∫–æ–Ω—Ç—Ä–æ–ª—å –≤ startup –ª–æ–≥–∏–∫–µ
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `thrd_t` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (metrics, GC)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–æ–≤ –∑–∞–ø—É—Å–∫–∞ (single-user / multi-user)

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```text
src/main.c
include/main.h
include/config.h
include/log.h
```

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                               | –û–ø–∏—Å–∞–Ω–∏–µ                                              |
| ------------------ | -------------------------------------- | ----------------------------------------------------- |
| `main`             | `int main(int argc, char **argv)`      | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∏ –ø–µ—Ç–ª—é —Å–æ–±—ã—Ç–∏–π |
| `log_startup_info` | `static void log_startup_info(void)`   | –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, PID, –ø–∞–º—è—Ç–∏       |
| `handle_signal`    | `static void handle_signal(int signo)` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SIGINT/SIGTERM                           |
| `db_initialize`    | `bool db_initialize(void)`             | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã                              |
| `db_shutdown`      | `void db_shutdown(void)`               | –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É                            |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                         | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω             |
| --------- | ------------------------------------------- | -------------------------- |
| Unit      | –ü—Ä–æ–≤–µ—Ä–∫–∞ `handle_signal`, `db_initialize`   | `tests/test_main.c`        |
| Soak      | –î–æ–ª–≥–∏–π –∑–∞–ø—É—Å–∫ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π | `tests/soak/init_stress.c` |
| Fuzz      | –ü–µ—Ä–µ–¥–∞—á–∞ –º—É—Å–æ—Ä–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö main           | `fuzz/fuzz_main_args.c`    |
| Coverage  | –ó–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ gcov / lcov                    | `coverage/index.html`      |

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ó–Ω–∞—á–µ–Ω–∏–µ  |
| -------------------------- | --------- |
| –í—Ä–µ–º—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | 52‚Äì88 –º—Å  |
| –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è CPU –ø—Ä–∏ idle    | < 1% —è–¥—Ä–∞ |
| –ü–æ—Ç–æ–∫–æ–≤ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á      | 5‚Äì8       |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                  | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ------------------------- | ------ | ----------------------------------------- |
| –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π startup     | 100    | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Ç–æ–∫–∏ –∏ NUMA-aware –ª–æ–≥–∏–∫–∞   |
| –ß–∏—Å—Ç–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ         | 100    | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ |
| –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ | 100    | –ß–µ—Ä–µ–∑ —Ö—É–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é                 |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C

```c
signal(SIGINT, handle_signal);
if (!db_initialize()) {
    log_error("main", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ –ë–î.");
    return EXIT_FAILURE;
}
log_info("main", "–°–£–ë–î —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞");
thrd_join(metrics_thread, NULL);
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –î–æ–±–∞–≤–∏—Ç—å async-–æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ `signalfd`
* –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–µ—Ç–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (bootup staging)
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å hot-reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª `SIGHUP`

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```
@startuml
start
:main();
:config_load();
:log_init();
:db_initialize();
if (error) then (yes)
  :log_error();
  stop
else (no)
  :run_services();
  :wait_for_shutdown();
endif
:db_shutdown();
stop
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –°–£–ë–î
* –Ø–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–æ–π –∞–Ω–∞–ª–∏–∑–∞ —Å–±–æ–µ–≤ (–º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏)
* –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ SLA-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: latency, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è                           |
| ------ | ---------- | ----------------------------------- |
| 1.0    | 2025-07-25 | –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è               |
| 1.1    | 2025-07-26 | –î–æ–±–∞–≤–ª–µ–Ω–∞ NUMA-aware –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è  |
| 1.2    | 2025-07-27 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è signal handler –∏ cleanup |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (pid-lock)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –∫—Ä–∞—à–µ–π —Å –∞–≤–∞—Ä–∏–π–Ω—ã–º log dump

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                  | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è              |
| ------- | ------------------------------------------ | ------------------------------ |
| INFO    | `[main] –°–£–ë–î —Å—Ç–∞—Ä—Ç—É–µ—Ç...`                  | –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è               |
| INFO    | `[main] Build: %s %s`                      | –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏                   |
| INFO    | `[main] PID: %lu`                          | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞         |
| INFO    | `[main] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: %s`                  | –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É                 |
| ERROR   | `[main] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ –ë–î.`     | `db_initialize()` –≤–µ—Ä–Ω—É–ª false |
| DEBUG   | `[main] Signal %d received, shutting down` | –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ SIGINT/SIGTERM   |
