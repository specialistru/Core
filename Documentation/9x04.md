# ðŸ§± Ð‘Ð»Ð¾Ðº 9.4 â€” Ð’Ð½ÐµÑˆÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹: REST, gRPC Ð¸ JSON\:API

---

## ðŸ†” Ð˜Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð±Ð»Ð¾ÐºÐ°

* **ÐŸÐ°ÐºÐµÑ‚:** 9 â€” Ð Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ð¾ÑÑ‚ÑŒ
* **Ð‘Ð»Ð¾Ðº:** 9.4 â€” Ð’Ð½ÐµÑˆÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹: REST, gRPC Ð¸ JSON\:API

---

## ðŸŽ¯ ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ

Ð”Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð»Ð¾Ðº Ñ€ÐµÐ°Ð»Ð¸Ð·ÑƒÐµÑ‚ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¹ API-Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº In-Memory Ð Ð¡Ð£Ð‘Ð” Ñ‡ÐµÑ€ÐµÐ· Ñ‚Ñ€Ð¸ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð°:

* **REST API** â€” Ð´Ð»Ñ ÑˆÐ¸Ñ€Ð¾ÐºÐ¸Ñ… HTTP-ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð², UI, BI-Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð², ERP-ÑÐ¸ÑÑ‚ÐµÐ¼;
* **gRPC** â€” Ð´Ð»Ñ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹, Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð¸ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ñ‹Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼;
* **JSON\:API** â€” Ð´Ð»Ñ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð¾Ð±ÑŠÐµÐºÑ‚Ð½Ñ‹Ð¼ Ñ€ÐµÑÑƒÑ€ÑÐ°Ð¼.

Ð¦ÐµÐ»ÑŒ â€” Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹, Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ñ‹Ð¹, ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ API-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ…ÐµÐ¼Ð°Ð¼Ð¸, Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÐ¼Ð¸, Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸ Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ….

---

## âš™ï¸ Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

| ÐŸÐ¾Ð´ÑÐ¸ÑÑ‚ÐµÐ¼Ð°         | Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ / Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸                                                       |
| ------------------ | ------------------------------------------------------------------------------ |
| REST API           | OpenAPI 3.0, JSON-Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹, Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ, gzip, Ð°Ð²Ñ‚Ð¾-Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ, Swagger UI   |
| gRPC               | ProtoBuf, HTTP/2, full-duplex streaming, multiplexing, schema-first API        |
| JSON\:API          | Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ JSON\:API v1.1, Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° sparse fieldsets, Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ð¸, Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ |
| Auth & Access Ctrl | JWT, OAuth2, IP ACL, client TLS certs, scopes                                  |
| Load Limiting      | ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð½Ð° IP, Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°, rate limiting, timeouts                     |
| Routing Engine     | ÐœÐµÑ‚Ð¾Ð´+Ð¿ÑƒÑ‚ÑŒ+ÑÑ…ÐµÐ¼Ð°, path-Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ, HTTP verbs, Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°            |
| Compression Layer  | ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Gzip/Deflate Ð¿Ð¾ Accept-Encoding                                      |

---

## ðŸ’¾ Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

```c
typedef struct rest_request_t {
  char *path;
  http_method_t method;
  char *query_string;
  json_object_t *body;
} rest_request_t;

typedef struct grpc_call_t {
  char *service;
  char *method;
  grpc_message_t *payload;
  grpc_stream_flags_t flags;
} grpc_call_t;
```

REST Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ ÑÐµÑ€Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÑŽ JSON Ñ‡ÐµÑ€ÐµÐ· `json_object_t`.
gRPC Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ ProtoBuf-ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¸ Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ð¼Ð¸ Ð¿Ð¾Ñ‚Ð¾ÐºÐ°Ð¼Ð¸.

---

## ðŸ”„ Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸ ÑÐ²ÑÐ·Ð¸

```plantuml
[REST Engine] --> [SQL Executor]
[gRPC Engine] --> [SQL Executor]
[JSONAPI Layer] --> [SQL Parser]
[REST Engine] --> [Auth Module]
[gRPC Engine] --> [Security Subsystem]
[REST Engine] --> [Schema Registry]
[gRPC Engine] --> [Audit Logger]
```

---

## ðŸ§  ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸

* Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð½Ð° **C23**, REST â€” Ð½Ð° `libmicrohttpd`, gRPC â€” Ð½Ð° `grpc-c-core`
* HTTP/2: multiplexed streams, ALPN negotiation
* ÐÐ²Ñ‚Ð¾-Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ OpenAPI Ð¸Ð· SQL-Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹ (Swagger UI / YAML)
* ProtoBuf â†’ SQL AST Ñ‡ÐµÑ€ÐµÐ· intermediate-layer Ñ‚Ñ€Ð°Ð½ÑÐ»ÑÑ†Ð¸ÑŽ
* Full-duplex streaming Ð² gRPC (Ð¿Ð»Ð°Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð¸ Ð´Ð»Ñ CDC)
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° gzip, deflate, chunked encoding
* TLS 1.3, client certificate pinning, mTLS auth

---

## ðŸ“‚ Ð¡Ð²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ ÐºÐ¾Ð´Ð°

* `src/net/rest_api.c`
* `src/net/grpc_server.c`
* `src/net/jsonapi_adapter.c`
* `include/net/rest_api.h`
* `include/net/grpc_api.h`
* `include/net/jsonapi.h`

---

## ðŸ”§ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð½Ð° C

| Ð˜Ð¼Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸         | ÐŸÑ€Ð¾Ñ‚Ð¾Ñ‚Ð¸Ð¿                                                                     | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ                                   |
| ------------------- | ---------------------------------------------------------------------------- | ------------------------------------------ |
| `rest_dispatch`     | `int rest_dispatch(rest_request_t *req, rest_response_t *res);`              | ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° REST-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð², Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ     |
| `grpc_handle_call`  | `int grpc_handle_call(grpc_call_t *call);`                                   | ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° gRPC-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð², Ð²Ñ‹Ð·Ð¾Ð² executor    |
| `jsonapi_transform` | `int jsonapi_transform(json_t *in, jsonapi_meta_t *meta, sql_query_t *out);` | ÐŸÑ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ JSON\:API-Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð² SQL AST |

---

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

* REST: Ð°Ð²Ñ‚Ð¾Ñ‚ÐµÑÑ‚Ñ‹ Ñ‡ÐµÑ€ÐµÐ· `cURL`, Postman, Swagger Validator
* gRPC: `grpc_cli`, TLS, Streaming, error-path coverage
* JSON\:API: sparse fields, Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹, ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°, Ð¿Ð°Ð³Ð¸Ð½Ð°Ñ†Ð¸Ñ
* Fuzzing: malformed URI, body injection, header abuse
* ÐÐ°Ð³Ñ€ÑƒÐ·Ð¾Ñ‡Ð½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:

  * `wrk2` (REST)
  * `ghz` (gRPC)
* ÐŸÐ¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ: REST â€” 93%, gRPC â€” 88%, JSON\:API â€” 92%

---

## ðŸ“Š ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

| ÐœÐµÑ‚Ñ€Ð¸ÐºÐ°                 | REST (JSON) | gRPC (ProtoBuf)          |
| ----------------------- | ----------- | ------------------------ |
| Ð¡Ñ€ÐµÐ´Ð½ÑÑ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ°        | \~4.8 Ð¼Ñ    | \~1.4 Ð¼Ñ                 |
| ÐŸÐ¸ÐºÐ¾Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ½Ð°Ñ      | \~10K RPS   | \~28K RPS                |
| Streaming latency (avg) | â€”           | \~0.9 Ð¼Ñ (bidirectional) |

---

## âœ… Ð¡Ð¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ SAP HANA+

| ÐšÑ€Ð¸Ñ‚ÐµÑ€Ð¸Ð¹  | ÐžÑ†ÐµÐ½ÐºÐ° | ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¹                                      |
| --------- | ------ | ------------------------------------------------ |
| REST API  | 100    | OpenAPI, JWT, gzip, scopes, Swagger UI           |
| gRPC      | 100    | Streaming, multiplexing, schema-first, TLS 1.3   |
| JSON\:API | 90     | ÐÐµÑ‚ bulk-insert, Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾ Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ |
| Security  | 100    | TLS-only, JWT, OAuth2 scopes, IP-based ACL       |

---

## ðŸ“Ž ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ð´Ð°

```c
rest_request_t req = {
  .path = "/v1/query",
  .method = POST,
  .body = json_parse("{\"sql\": \"SELECT * FROM clients\"}")
};
rest_dispatch(&req, &response);
```

---

## ðŸ§© Ð‘ÑƒÐ´ÑƒÑ‰Ð¸Ðµ Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸

* GraphQL (schema â†’ SQL transpiler)
* WebSocket CDC (CDC streaming Ð² UI)
* Server-Sent Events (SSE) Ð´Ð»Ñ REST CDC
* ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° bulk-Ð¸Ð½ÑÐµÑ€Ñ‚Ð¾Ð² Ð² JSON\:API

---

## ðŸ§° Ð¡Ð²ÑÐ·ÑŒ Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸

* Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¼Ð¸ ERP/CRM/BI ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· REST/gRPC
* Web UI Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼, Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑÐ¼ Ð¸ Ð»Ð¾Ð³Ð°Ð¼
* ETL-Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð²Ð½ÐµÑˆÐ½Ð¸Ð¼Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ñ‡ÐµÑ€ÐµÐ· HTTP Ð¸ ProtoBuf
* Ð Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ð¾ÑÑ‚ÑŒ â€” Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… REST endpoint'Ð¾Ð²

---

## ðŸ” Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

* TLS 1.3, mTLS, HTTPS-only Ñ€ÐµÐ¶Ð¸Ð¼
* JWT-Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒÑŽ, scopes, TTL, revoke
* IP ACL, rate limiting, body size limits, timeout control
* ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð², Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¾Ð², content-types

---

## ðŸ§¾ Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð¾ÑˆÐ¸Ð±ÐºÐ¸, Ð¿Ñ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ

* `ERR_REST_MALFORMED_BODY`
* `ERR_HTTP_400_BAD_REQUEST`
* `ERR_GRPC_UNAUTHORIZED_CALL`
* `WARN_JSONAPI_INVALID_FILTER`
* `INFO_REST_REQUEST_COMPLETE`

---

## ðŸ•“ Ð’ÐµÑ€ÑÐ¸Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹

| Ð’ÐµÑ€ÑÐ¸Ñ | Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ                            |
| ------ | ------------------------------------ |
| 1.0    | Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ REST/gRPC         |
| 1.1    | OpenAPI auto-gen, JWT, TLS           |
| 1.2    | JSON\:API v1.1, gzip, sparse fields  |
| 1.3    | gRPC streaming, IP ACL, SSE Ð² Ð¿Ð»Ð°Ð½Ð°Ñ… |

---

## ðŸ“ UML-Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ð°

```plantuml
@startuml
package "Ð’Ð½ÐµÑˆÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹ API" {
  class RESTEngine {
    +dispatch(request)
  }
  class gRPCEngine {
    +handle_call(call)
  }
  class JSONAPIAdapter {
    +transform(json)
  }

  RESTEngine --> SQLExecutor
  gRPCEngine --> SQLExecutor
  JSONAPIAdapter --> SQLParser
  RESTEngine --> AuthManager
  gRPCEngine --> SecurityManager
  RESTEngine --> SchemaRegistry
}
@enduml
```
