# üß± –ë–ª–æ–∫ 7.4 ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 7 ‚Äî Observability –∏ DevOps
* **–ë–ª–æ–∫:** 7.4 ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É —Å–æ–±—ã—Ç–∏–π –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –°–£–ë–î. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, –ø–∞–º—è—Ç–∏ –∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞. –ö–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                     |
| -------------------- | ------------------------------------------------------------ |
| Structured Logging   | JSON, syslog, –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Fluentd, Loki |
| Event Tracing        | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ event\_id, time\_ns, latency, context\_id          |
| Error Classification | –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: error, warning, info, trace, debug            |
| Log Filtering        | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–æ–¥—É–ª—è–º, —É—Ä–æ–≤–Ω—è–º, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º         |
| Log Sink             | –í—ã–≤–æ–¥ –≤ stderr, —Ñ–∞–π–ª, —É–¥–∞–ª—ë–Ω–Ω—ã–π syslog, Kafka                |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct log_event_t {
  uint64_t timestamp_ns;
  uint32_t thread_id;
  uint16_t level;        // ERROR, WARN, INFO, DEBUG
  char module[16];
  char message[256];
  uint64_t context_id;
} log_event_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
QueryExecutor --> Logger
StorageEngine --> Logger
TransactionManager --> Logger
Profiler --> Logger
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* –§–æ—Ä–º–∞—Ç—ã: JSON, binary, syslog-compatible
* –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å —Å ring buffer
* –ü—Ä–µ—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π overhead

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/log/log.c`
* `include/log/log.h`
* `src/metrics/query_tracer.c`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                        |
| --------------- | ------------------------------------------------------------------ | ----------------------------------------------- |
| `log_event`     | `void log_event(const char *mod, int level, const char *fmt, ...)` | –ó–∞–ø–∏—Å—å –ª–æ–≥-—Å–æ–±—ã—Ç–∏—è —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º |
| `log_set_level` | `void log_set_level(const char *mod, int level)`                   | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –º–æ–¥—É–ª—è         |
| `log_flush`     | `void log_flush(void)`                                             | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –±—É—Ñ–µ—Ä–∞ –ª–æ–≥–æ–≤              |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/log/test_log.c`
* –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã: –º–∞—Å—Å–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π (10M+/—Å–µ–∫)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, SQL-–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                  | –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å      |
| ------------------------- | --------------- |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ binary sink | < 200 –Ω—Å/–≤—ã–∑–æ–≤  |
| JSON –ª–æ–≥ (stderr)         | < 1.5 –º–∫—Å/–≤—ã–∑–æ–≤ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ 10M —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫ | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è  |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                       | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                         |
| ------------------------------ | ------ | ----------------------------------- |
| Structured Logging             | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫–æ–º   | 100    | –°–æ–±—ã—Ç–∏—è —Ç—Ä–∞—Å—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ timeline    |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | 100    | < 200 –Ω—Å/–≤—ã–∑–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º –ø—É—Ç–∏  |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
log_event("executor", LOG_INFO, "Start query id=%lu", query_id);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –§–æ—Ä–º–∞—Ç OpenTelemetry Logging
* –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
* –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ UI

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
actor "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" as Admin
package "–ú–æ–¥—É–ª–∏ –°–£–ë–î" {
  [Executor] --> [Logger]
  [Storage] --> [Logger]
  [TX Manager] --> [Logger]
  [Profiler] --> [Logger]
}
[Logger] --> [Log Sink]
Admin --> [Log Sink]
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –≤ SLA-—Ä–µ–∂–∏–º–µ
* –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∏ –∞—É–¥–∏—Ç–æ—Ä—Å–∫–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DevOps-–ø—Ä–∞–∫—Ç–∏–∫ –∏ CI/CD

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ó–∞—â–∏—Ç–∞ –ª–æ–≥–æ–≤ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è (append-only)
* –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º –ø–æ —Ä–æ–ª—è–º
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–æ–≤

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ stderr/syslog
* v1.1 ‚Äî –ë–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤
* v1.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ trace timeline
* v1.3 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø       | –£—Å–ª–æ–≤–∏–µ                            | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| --------------- | ---------------------------------- | ------------------------------ |
| `E_LOG_SINK`    | –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥-—Ñ–∞–π–ª       | –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—É—Ç—å –∏–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ |
| `W_LOG_SKIPPED` | –ü—Ä–æ–ø—É—Å–∫ –ª–æ–≥–æ–≤ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞    |
| `I_LOG_ROTATE`  | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥-—Ñ–∞–π–ª–∞ (rotation)  | –†–µ–≥—É–ª—è—Ä–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ             |
