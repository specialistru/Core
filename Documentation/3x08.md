# üß± –ë–ª–æ–∫ 3.8 ‚Äî JSON –∏ semi-structured —Ñ—É–Ω–∫—Ü–∏–∏ SQL

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 3 ‚Äî SQL –∏ –Ø–∑—ã–∫–∏
* **–ë–ª–æ–∫:** 3.8 ‚Äî JSON –∏ semi-structured —Ñ—É–Ω–∫—Ü–∏–∏ SQL

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–∞—Ç–∏–≤–Ω—ã—Ö JSON-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π, —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Å ANSI SQL:2016+, –∞ —Ç–∞–∫–∂–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å semi-structured –¥–∞–Ω–Ω—ã–º–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –≥–∏–±—Ä–∏–¥–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≥–¥–µ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –µ–¥–∏–Ω–æ–º SQL-–ø–æ—Ç–æ–∫–µ. –ú–æ–¥—É–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∞—Ä—Å–∏—Ç—å, –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∏ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ JSON-–æ–±—ä–µ–∫—Ç—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞      | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                          |
| --------------- | ----------------------------------------------------------------- |
| JSON path       | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSONPath (\$.a.b, $\[\*]) —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏                   |
| JSON —Ñ—É–Ω–∫—Ü–∏–∏    | JSON\_VALUE, JSON\_QUERY, JSON\_EXISTS, JSON\_OBJECT, JSON\_ARRAY |
| –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è     | JSON\_SET, JSON\_INSERT, JSON\_REMOVE                             |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è JSON | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è inverted indexes, –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä              |
| –ê–≥—Ä–µ–≥–∞—Ü–∏—è JSON  | JSON\_AGG, JSON\_OBJECTAGG, merge/reduce —Å–µ–º–∞–Ω—Ç–∏–∫–∞                |
| –†–∞—Å—à–∏—Ä–µ–Ω–∏—è      | JSON\_TABLE, json\_each(), json\_typeof(), JSON\_SCHEMA\_VALIDATE |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct json_node_t {
    enum { JSON_NULL, JSON_BOOL, JSON_NUM, JSON_STR, JSON_OBJ, JSON_ARR } type;
    union {
        double num;
        bool boolean;
        char *string;
        struct kv_pair_t *object;
        struct json_node_t **array;
    };
    size_t size;
} json_node_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[SQL Parser] --> [JSON Planner]
[JSON Planner] --> [JSON Runtime]
[JSON Runtime] --> [Storage Engine]
[JSON Indexer] --> [Inverted Index Engine]
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* Lazy-–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä—Å–µ—Ä–∞
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ö–µ–º JSON Schema draft-07 –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ –Ω–∏–º
* SIMD-—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ JSON
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JSON-–≤—ã—Ä–∞–∂–µ–Ω–∏–π –≤ WHERE, JOIN, SELECT
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å column-store —á–µ—Ä–µ–∑ JSON Dictionary Encoding

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/json/json_runtime.c`
* `include/sql/json/json_runtime.h`
* `src/index/inverted_json.c`
* `include/index/inverted_json.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                           |
| ------------------ | ----------------------------------------------------------------------------------- | -------------------------------------------------- |
| `json_eval_path`   | `int json_eval_path(const json_node_t *root, const char *path, json_node_t **out);` | –û—Ü–µ–Ω–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è JSONPath –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ |
| `json_agg`         | `int json_agg(json_node_t **items, size_t count, json_node_t **out);`               | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ JSON-–º–∞—Å—Å–∏–≤           |
| `json_index_build` | `int json_index_build(table_t *table, column_t *col);`                              | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –¥–ª—è JSON-–∫–æ–ª–æ–Ω–Ω—ã      |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/sql/json_test.c`
* Fuzzing: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö JSON-–¥–µ—Ä–µ–≤—å–µ–≤
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –∑–∞–ø—Ä–æ—Å—ã SELECT/UPDATE —Å JSON-—Ñ—É–Ω–∫—Ü–∏—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏
* –ü–æ–∫—Ä—ã—Ç–∏–µ: >91% –¥–ª—è JSON-–ø–∞—Ä—Å–µ—Ä–∞ –∏ API

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* JSON –∞–≥—Ä–µ–≥–∞—Ü–∏—è: –¥–æ 2 –º–ª–Ω –æ–±—ä–µ–∫—Ç–æ–≤/—Å–µ–∫
* –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è JSON: \~120K —Å—Ç—Ä–æ–∫/—Å–µ–∫ —Å –∞–≤—Ç–æ—Ä–∞–∑–±–æ—Ä–æ–º –∫–ª—é—á–µ–π
* –ü–æ–∏—Å–∫ –ø–æ JSON: latency < 200Œºs –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ inverted index

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π               | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                              |
| ---------------------- | ------ | -------------------------------------------------------- |
| JSON-—Ñ—É–Ω–∫—Ü–∏–∏ SQL       | 95     | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞–∑–æ–≤—ã—Ö + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π                    |
| JSON –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è        | 90     | –û–±—Ä–∞—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, auto-discovery, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º   |
| Semi-structured –∞–Ω–∞–ª–∏–∑ | 85     | JSON\_TABLE, json\_each –¥–æ—Å—Ç—É–ø–Ω—ã, –Ω–æ –±–µ–∑ support for XML |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
json_node_t *out = NULL;
json_eval_path(doc, "$.user.address.city", &out);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* JSON Patch/MergePatch support (RFC 7386)
* XPath-to-JSONPath transpiler
* –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ JSON-—Ñ—É–Ω–∫—Ü–∏–π –≤ materialized views

## üß∞ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤, –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è JSON –¥–ª—è API/BI
* –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø–æ–ª—É—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞—Ç—Ä–∏–±—É—Ç–∞–º

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö JSON-–æ–±—ä–µ–∫—Ç–æ–≤ (max depth)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–¥–µ–ª–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ JSON-–ø–æ–ª—è

## üßæ –°–æ–æ–±—â–µ–Ω–∏—è, –æ—à–∏–±–∫–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

* `ERR_JSON_PARSE`
* `ERR_JSON_PATH_INVALID`
* `WARN_JSON_NULL_INDEXED`

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî JSON\_VALUE/QUERY, JSONPath, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
* v1.1 ‚Äî JSON\_SCHEMA\_VALIDATE, JSON\_TABLE
* v1.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö JSON-–≤—ã—Ä–∞–∂–µ–Ω–∏–π

## üìà UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "JSON SQL Support" {
  class JsonRuntime {
    +eval_path()
    +agg()
  }
  class JsonIndexer {
    +build_index()
  }
  JsonRuntime --> SqlExecutor
  JsonIndexer --> InvertedIndexEngine
}
@enduml
```

---

–°–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫: **3.9 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏—è SQL: FILTER, MATCH\_RECOGNIZE, MERGE** ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ **–¥–∞**.

