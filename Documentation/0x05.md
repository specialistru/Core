# üîÄ –ë–ª–æ–∫ 0.5 ‚Äî OLTP + Real-Time Analytics

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                            |
| --------- | ----------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 0 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç |
| üî¢ –ë–ª–æ–∫   | 0.5 ‚Äî OLTP + Real-Time Analytics    |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–¶–µ–ª—å –±–ª–æ–∫–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–≥–∏–±—Ä–∏–¥–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É HTAP**, —Å–ø–æ—Å–æ–±–Ω—É—é –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞–∫ –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (**OLTP**), —Ç–∞–∫ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (**OLAP**) –≤ **–µ–¥–∏–Ω–æ–º in-memory –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏**.

–í—Å—ë —ç—Ç–æ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ETL, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–π –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è OLAP-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** –ø—Ä—è–º–æ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö transactional-–¥–∞–Ω–Ω—ã—Ö.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                |
| ------------- | ----------------------------------------------------------------------- |
| Executor      | –í–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä: SCAN ‚Üí JOIN ‚Üí AGGREGATE ‚Üí PROJECT           |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫   | Adaptive –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: OLTP-—Ä–µ–∂–∏–º ‚Üí OLAP-—Ä–µ–∂–∏–º –ø–æ —à–∞–±–ª–æ–Ω—É –∑–∞–ø—Ä–æ—Å–∞       |
| –ê–≥—Ä–µ–≥–∞—Ü–∏—è     | Streaming aggregation + windowing functions (rank, percentiles, etc.)   |
| –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏ –æ–±—ã—á–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π                     |
| OLAP-—Ñ—É–Ω–∫—Ü–∏–∏  | ROLLUP, CUBE, time-binning, gap-fill, downsampling                      |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥    | –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è OLTP/OLAP –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–ª–∞–Ω–æ–≤, –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                        |
| ----------------------------- | --------------------------------------------------------------- | --------------------------------- |
| `executor_run_sql()`          | `result_iter_t *executor_run_sql(session_t *, const char *sql)` | –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ SQL          |
| `aggregate_streaming_exec()`  | `bool aggregate_streaming_exec(plan_t *, result_t *)`           | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ |
| `window_function_apply()`     | `void window_function_apply(plan_t *, result_t *)`              | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–∫–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π        |
| `materialized_view_refresh()` | `bool materialized_view_refresh(view_t *)`                      | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ materialized view      |
| `planner_detect_htap_mode()`  | `bool planner_detect_htap_mode(ast_t *)`                        | –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è           |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                          | –ò—Å—Ç–æ—á–Ω–∏–∫                | –¶–µ–ª—å                       |
| -------------------------------- | ----------------------- | -------------------------- |
| `oltp_query_latency_ns`          | OLTP SELECT/UPDATE      | < 1–º—Å                      |
| `olap_query_latency_ms`          | Aggregation, JOIN       | < 50–º—Å (–¥–ª—è TPC-H scale 1) |
| `plan_cache_hit_ratio`           | –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | > 90%                      |
| `streaming_agg_rows_per_sec`     | Streaming aggregate     | > 1 –º–ª–Ω —Å—Ç—Ä–æ–∫/—Å–µ–∫          |
| `materialized_view_refresh_time` | MV refresh              | < 100 –º—Å                   |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/executor.c
src/pipeline_exec.c
src/group.c
src/window.c
src/materialized_view.c
src/planner.c
include/executor.h
include/group.h
include/window.h
include/view.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ï–¥–∏–Ω—ã–π SQL-–¥–≤–∏–∂–æ–∫ –¥–ª—è OLTP –∏ OLAP —Å auto-switch –ø–æ —à–∞–±–ª–æ–Ω—É
* –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (zero-copy row access)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –Ω–∞ –ª–µ—Ç—É (–≤ column-store)
* –†–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π join –∏ group-by
* Runtime re-optimization –Ω–∞ –æ—Å–Ω–æ–≤–µ collected statistics

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞   | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                      | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                    |
| ----------- | -------------------------------------------------------- | --------------------------------- |
| Integration | SELECT/UPDATE/INSERT/AGGREGATE/ROLLUP –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ | `tests/test_htap_combined.c`      |
| Benchmarks  | TPC-H/TPC-C –º–æ–¥–µ–ª–∏                                       | `bench/tpch_q1.c`, `bench/tpcc.c` |
| Soak        | 24—á –ø–æ—Ç–æ–∫ mix-–∑–∞–ø—Ä–æ—Å–æ–≤                                   | `tests/soak/htap_mix.c`           |
| Fuzz        | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ OLAP-–∑–∞–ø—Ä–æ—Å—ã                                | `fuzz/fuzz_groupby.c`             |

---

## üìê –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è OLTP/OLAP

```plantuml
@startuml
start
:parse_query();
:detect_query_type();
if (type == OLTP) then (yes)
  :executor_run_sql();
elseif (type == OLAP) then (yes)
  :planner_detect_htap_mode();
  :build_agg_pipeline();
  :streaming_aggregation();
endif
stop
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                         | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| -------------------------------- | ------ | ---------------------------------------- |
| –ï–¥–∏–Ω—ã–π –¥–≤–∏–∂–æ–∫ OLTP/OLAP          | 100    | –ë–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ETL                    |
| Streaming aggregation            | 95     | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ pipeline execution     |
| Adaptive –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫             | 90     | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø–æ —Ç–∏–ø—É –∑–∞–ø—Ä–æ—Å–∞      |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–∫–æ–Ω–Ω—ã—Ö –∏ OLAP —Ñ—É–Ω–∫—Ü–∏–π | 95     | ROLLUP, CUBE, RANK, PERCENTILE, GAP-FILL |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
const char *sql = "SELECT region, COUNT(*) FROM sales GROUP BY region";
result_iter_t *res = executor_run_sql(session, sql);
while (result_iter_next(res)) {
    printf("region: %s, count: %d\n", res->region, res->count);
}
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä—è–º–æ –Ω–∞ live-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö ERP/CRM
* –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç TCO (–±–µ–∑ ETL / OLAP-–∫–æ–ø–∏–π)
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä–∞–º–∏ (Tableau, PowerBI)
