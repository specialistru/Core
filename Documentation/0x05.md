# üì¶ –ü–∞–∫–µ—Ç 0 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç

| ‚Ññ –±–ª–æ–∫–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞                                                                           |
| ------- | ---------------------------------------------------------------------------------------- |
| 0.1     | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)                                                     |

# üß± –ë–ª–æ–∫ 0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 0. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π —Å—Ç–∞—Ä—Ç
* **–ë–ª–æ–∫:** 0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

---

# 5.2 ‚Äî BI-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É–±—ã

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.2 ‚Äî BI-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É–±—ã (Materialized Views / Cubes)**

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

BI-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫—É–±—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–≤–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –∏ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤. –û–Ω–∏ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–Ω–∏–∂–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–æ—Ä –∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                             |
| ----------------- | ---------------------------------------------------- |
| –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è     | View engine —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π AST –∏ query rewriting     |
| –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è    | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ, –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ, lazy-refresh –∫—É–±—ã    |
| –ê–≥—Ä–µ–≥–∞—Ü–∏—è         | ROLLUP, CUBE, GROUPING SETS, user-defined aggregates |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | CDC-—Å–æ–±—ã—Ç–∏—è, deferred updates, background merge      |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç
typedef struct materialized_cube_t {
  char name[MAX_NAME_LEN];
  aggregation_t *aggs;
  timestamp_t last_refresh;
  row_store_t *cache;
} materialized_cube_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
QueryEngine --> ViewEngine
ViewEngine --> SQLParser
ViewEngine --> Optimizer
CubeManager --> Aggregator
CubeManager --> CDCLog
CubeManager --> BackgroundWorker
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –•—Ä–∞–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ —Å–≤–æ–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π in-memory —Å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–º —Å–±—Ä–æ—Å–æ–º
* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ query-template fingerprint (–∞–Ω–∞–ª–∏–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤)
* Pushdown —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–∞–≥—Ä–µ–≥–∞—Ü–∏–∏

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/view_engine.c`
* `src/bi/cube_manager.c`
* `src/aggregator/rollup.c`
* `include/bi/materialized_view.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
| ------------------ | -------------------------------------------------------------- | ---------------------------------------- |
| `view_expand`      | `ast_t *view_expand(ast_t *q);`                                | –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–π AST |
| `cube_materialize` | `int cube_materialize(const char *name);`                      | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∫—É–±–∞               |
| `cube_lookup`      | `rowset_t *cube_lookup(const char *cube, const char *filter);` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö          |
| `schedule_refresh` | `void schedule_refresh(cube_t *c, interval_t delay);`          | –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é      |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/bi/test_cube_manager.c`
* Integration: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ join-–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ ROLLUP-–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
* Fuzz: AST-expander –¥–ª—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö
* Coverage: 96.8% —Å—Ç—Ä–æ–∫

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                        | –ú–µ—Ç—Ä–∏–∫–∞                               |
| ------------------------------- | ------------------------------------- |
| Cube lookup                     | < 4 –º—Å –ø—Ä–∏ 50 –º–ª–Ω —Å—Ç—Ä–æ–∫               |
| View expansion + pushdown       | \~3.2x —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö BI-–∑–∞–ø—Ä–æ—Å–æ–≤ |
| –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–±–∞ | 200K —Å—Ç—Ä–æ–∫/—Å (–Ω–∞ 32 —è–¥—Ä–∞—Ö)            |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                           | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                 |
| ---------------------------------- | ------ | ------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ROLLUP/CUBE              | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö SQL:2011 —Ñ–æ—Ä–º |
| –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å | 100    | CDC, –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∫–µ—à            |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ BI-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
CREATE VIEW orders_by_region AS
SELECT region, SUM(amount) FROM orders GROUP BY region;

-- –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∫—É–±—É
SELECT * FROM cube_orders_by_region WHERE region = 'West';
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—É–±–æ–≤ —Å –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ refresh –ø–æ –Ω–∞–≥—Ä—É–∑–∫–µ
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å query prediction –¥–ª—è pre-warm –∞–≥—Ä–µ–≥–∞—Ü–∏–π

## üìà UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (PlantUML)

```plantuml
@startuml
entity "QueryEngine" as QE
entity "ViewEngine" as VE
entity "CubeManager" as CM
entity "CDCLog" as CDC
entity "Aggregator" as AGG
entity "BackgroundWorker" as BG

QE --> VE
VE --> SQLParser
VE --> Optimizer
CM --> AGG
CM --> CDC
CM --> BG
@enduml
```

## üè¢ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –∏ –¥–∞—à–±–æ—Ä–¥—ã BI
* –ë—ã—Å—Ç—Ä—ã–µ slice-and-dice –≤—ã–±–æ—Ä–∫–∏ –∏ drill-down –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤
* –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ KPI –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º, —Ñ–∏–ª–∏–∞–ª–∞–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* Row-level security –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –∫—É–±–∞–º
* –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ view engine
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ CDC-—Å–æ–±—ã—Ç–∏—è–º–∏

## üì§ –°–æ–æ–±—â–µ–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

* `ERR_VIEW_CYCLE`: —Ü–∏–∫–ª –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
* `WARN_CUBE_LAGGING`: –∫—É–± –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è > 1 —á–∞—Å
* `INFO_CUBE_REFRESHED`: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è

* v0.9: –ü–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –±–µ–∑ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
* v1.1: –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ CDC
* v1.4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è pushdown –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

# 5.3 ‚Äî Time Series –∏ Downsampling

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.3 ‚Äî Time Series –∏ Downsampling (—Ä—è–¥—ã –≤—Ä–µ–º–µ–Ω–∏, —Ä–µ—Ç–µ–Ω—à–Ω, —Å–∂–∞—Ç–∏–µ)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ Time Series –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Å –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –æ–∫–Ω–∞–º–∏ –≤—Ä–µ–º–µ–Ω–∏, —Å–∂–∞—Ç–∏—è, —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–∏—è, —Ä–µ—Ç–µ–Ω—à–Ω-–ø–æ–ª–∏—Ç–∏–∫.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                      |
| ------------------- | --------------------------------------------- |
| Time Series storage | –§–æ—Ä–º–∞—Ç—ã TSColumn + timestamp index            |
| Gap-fill            | –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: linear, LOCF, ZOH                |
| Downsampling        | –ê–≥—Ä–µ–≥–∞—Ü–∏–∏: avg, min, max, median, percentiles |
| Retention policy    | TTL, compression, auto-purge                  |
| Window functions    | –û–∫–Ω–∞: fixed, sliding, hopping                 |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct ts_segment_t {
  timestamp_t *timestamps;
  double *values;
  uint32_t count;
  bool gap_fill_enabled;
  uint8_t compression_type; // 0=none, 1=delta, 2=for
} ts_segment_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
TimeSeriesEngine --> StorageEngine
TimeSeriesEngine --> QueryPlanner
TimeSeriesEngine --> Aggregator
TimeSeriesEngine --> VacuumManager
TimeSeriesEngine --> RetentionPolicy
```

## üßê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –°–µ–≥–º–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ (vectorized, SIMD-enabled)
* –†–µ–∂–∏–º –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è + —Å–∂–∞—Ç–∏–µ –ø–æ –¥–µ–ª—å—Ç–µ –∏ —Å—Å—ã–ª–æ—á–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º
* –°–∫–æ–∑—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ time\_bucket(), ts\_downsample(), gap\_fill()

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/ts/ts_engine.c`
* `src/ts/ts_gapfill.c`
* `src/ts/ts_retention.c`
* `include/ts/ts_api.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| ----------------- | ----------------------------------------------------------------------- | -------------------------------------- |
| `ts_append_point` | `int ts_append_point(ts_id_t id, timestamp_t ts, double val);`          | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –≤ TS-—Ä—è–¥              |
| `ts_downsample`   | `rowset_t *ts_downsample(ts_id_t id, interval_t win, const char *agg);` | –°–∂–∞—Ç–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞                 |
| `ts_gap_fill`     | `rowset_t *ts_gap_fill(ts_id_t id, range_t r);`                         | –í—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π           |
| `ts_gc_segments`  | `void ts_gc_segments(void);`                                            | –§–æ–Ω–æ–≤–∞—è —Å–±–æ—Ä–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö TS-—Å–µ–≥–º–µ–Ω—Ç–æ–≤ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ts/test_ts_engine.c`
* Fuzz: –≥—Ä–∞–Ω–∏—á–Ω—ã–µ ts\_downsample(–ø—É—Å—Ç—ã–µ, –Ω–µ–ø–æ–ª–Ω—ã–µ –æ–∫–Ω–∞)
* Coverage: 97.2%

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è             | –ú–µ—Ç—Ä–∏–∫–∞                       |
| -------------------- | ----------------------------- |
| Write throughput     | > 2.5 –º–ª–Ω —Ç–æ—á–µ–∫/—Å –Ω–∞ 64 —è–¥—Ä–∞—Ö |
| Downsampling 1B rows | < 4.5 —Å–µ–∫ –ø–æ 256 –∫—É–±–∞–º        |
| GC latency           | < 10 –º—Å –¥–ª—è 500K —Å–µ–≥–º–µ–Ω—Ç–æ–≤    |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                       | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                    |
| ------------------------------ | ------ | ---------------------------------------------- |
| TS-—Ç–∏–ø—ã —Å nanosecond —Ç–æ—á–Ω–æ—Å—Ç—å—é | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ                                    |
| Gap fill / Downsampling        | 100    | –§—É–Ω–∫—Ü–∏–∏ ts\_gap\_fill(), ts\_downsample() –Ω–∞ C |
| Retention / TTL                | 100    | –§–æ–Ω–æ–≤–æ–π GC, —É–¥–∞–ª–µ–Ω–∏–µ expired —Ü–µ–ø–æ—á–µ–∫           |

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ TS-—Ä—è–¥–∞
CREATE TABLE temperature_ts (
  ts TIMESTAMP(9),
  value DOUBLE
) WITH (ts_column = 'ts');

-- Downsampling
SELECT time_bucket('5 min', ts) as window, avg(value)
FROM temperature_ts
WHERE ts BETWEEN now() - interval '1 hour' AND now()
GROUP BY window;
```

## üßé‚Äç‚ôÇÔ∏è –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ irregular sampling –∏ uneven buckets
* –†–µ–∂–∏–º forecast –∏ extrapolate()
* –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ TS-—Ä—è–¥–æ–≤ –≤ column-store

# 5.4 ‚Äî ML-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∏ –º–æ–¥–µ–ª–∏ (ONNX / Tensorflow / PyTorch)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.4 ‚Äî ML-–∏–Ω—Ñ–µ—Ä–µ–Ω—Å –∏ –º–æ–¥–µ–ª–∏ (ONNX / Tensorflow / PyTorch)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ML/–∏–Ω—Ñ–µ—Ä–µ–Ω—Å-–º–æ–¥–µ–ª–µ–π –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –º–æ–¥–µ–ª—è–º–∏ –Ω–∞ ONNX, Tensorflow, PyTorch –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∞–Ω–æ–º–∞–ª–∏–π –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞     | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                      |
| -------------- | --------------------------------------------- |
| SQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | SQL-—Ñ—É–Ω–∫—Ü–∏–∏: ML\_EVAL(), PREDICT(), CLUSTER() |
| ONNX runtime   | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å onnxruntime C API                |
| Tensorflow     | –ß–µ—Ä–µ–∑ C++ –±–∏–Ω–¥–∏–Ω–≥–∏, –≤–∞–ª–∏–¥–∞—Ü–∏—è input/output    |
| PyTorch        | –ß–µ—Ä–µ–∑ TorchScript –∏–ª–∏ libtorch C++ API        |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct model_runtime_t {
  char name[MAX_NAME];
  model_type_t type;  // ONNX, TENSORFLOW, TORCH
  void *handle;
  model_metadata_t meta;
} model_runtime_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SQLExecutor --> MLInterface
MLInterface --> ONNXRuntime
MLInterface --> TensorflowRuntime
MLInterface --> TorchRuntime
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ö–µ—à –∏–Ω—Ñ–µ—Ä–µ–Ω—Å-–º–æ–¥–µ–ª–µ–π –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
* –ê–≤—Ç–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ inference

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/ml/ml_interface.c`
* `src/sql/ml_functions.c`
* `src/ml/onnx_runtime.c`
* `src/ml/tf_runtime.cc`
* `include/ml/model_runtime.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| ---------------- | ---------------------------------------------------------------- | ---------------------------------------------- |
| `ml_eval`        | `result_t ml_eval(db_session_t *s, const char *model, row_t *r)` | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–∏ —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ r |
| `ml_load_model`  | `int ml_load_model(const char *path, model_type_t type)`         | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å-–º–æ–¥–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º    |
| `ml_predict_sql` | `result_t ml_predict_sql(ast_t *query, model_runtime_t *m)`      | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –≤ SQL-–ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è     |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ml/test_ml_interface.c`
* Fuzz: –í–≤–æ–¥—ã –¥–∞–Ω–Ω—ã—Ö –≤ ONNX-–º–æ–¥–µ–ª–∏
* Integration: SQL-–∑–∞–ø—Ä–æ—Å—ã —Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–æ–º

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è              | –ú–µ—Ç—Ä–∏–∫–∞  |
| --------------------- | -------- |
| ONNX –ø—Ä–æ–≥–Ω–æ–∑ –≤ SQL    | < 1.3 –º—Å |
| Tensorflow –ø–æ CPU     | 5.2 –º—Å   |
| PyTorch —Å TorchScript | 3.8 –º—Å   |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| ---------------------------- | ------ | -------------------------------------------- |
| ONNX-–ø–æ–¥–¥–µ—Ä–∂–∫–∞               | 100    | –ß–µ—Ä–µ–∑ onnxruntime                            |
| Tensorflow –∏ PyTorch support | 100    | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ API, C++ –±–∏–Ω–¥—ã                    |
| SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞      | 100    | ML\_EVAL(), CLUSTER(), PREDICT() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ü—Ä–æ–≥–Ω–æ–∑ —Ü–µ–Ω—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞
SELECT ML_EVAL('model_forecast', price, volume, timestamp)
FROM stocks WHERE symbol = 'AAPL';
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ batch-inference
* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
* –°—Ç—Ä–µ–º–∏–Ω–≥ inference (Kafka –≤—Ö–æ–¥)

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
entity "MLInterface" as MLI
entity "ONNXRuntime" as ONNX
entity "TensorflowRuntime" as TF
entity "TorchRuntime" as TORCH

SQL --> MLI
MLI --> ONNX
MLI --> TF
MLI --> TORCH
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –∏ –ø–æ—Å—Ç–∞–≤–æ–∫
* –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–∞ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–¥–µ–ª–æ–∫
* –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
* ML-–∞–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –°–∞–Ω–¥–±–æ–∫—Å–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥–µ–ª—è–º –ø–æ —Ä–æ–ª—è–º (RBAC)
* –ò–∑–æ–ª—è—Ü–∏—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å-–º–æ–¥–µ–ª–µ–π –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –Ω–∞—á–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ONNX
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TensorFlow
* v1.2 ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TorchScript –∏ libtorch
* v1.3 ‚Äî NUMA-aware –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                           | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                    |
| ------------------ | --------------------------------- | ---------------------------------- |
| `E_ML_NOT_FOUND`   | –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞                 | –ó–∞–ø—Ä–æ—à–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞    |
| `E_ML_IO_MISMATCH` | –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ input/output —Ñ–æ—Ä–º–∞—Ç–∞ | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |
| `W_ML_SLOW_EXEC`   | –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10 –º—Å          | –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –≤—ã–∑–æ–≤–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞        |

# 5.5 ‚Äî BI-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (rank, percentiles, clustering)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.5 ‚Äî BI-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (rank, percentiles, clustering)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ BI-—É—Ä–æ–≤–Ω—è, –≤–∫–ª—é—á–∞—è —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤, –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–π, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç HTAP –∏ real-time BI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                 |
| -------------------- | ---------------------------------------- |
| RANK/–†ERCENTILE      | SQL-—Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–∫–æ–Ω–Ω—ã–º–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏        |
| KMeans/–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | SQL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, UDF/—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–ø—É—Å–∫–∏      |
| WINDOW/Aggregate API | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ANSI SQL:2011+ –∏ –ø—Ä–æ—Ä–µ–∑–∫–∞ –æ–∫–æ–Ω |

## üìÄ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct bi_agg_state_t {
  uint64_t count;
  double sum;
  double min;
  double max;
  double *buckets; // –¥–ª—è percentiles
} bi_agg_state_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SQLPlanner --> BIWindowProcessor
SQLPlanner --> BIClusterEngine
BIWindowProcessor --> WindowExec
BIClusterEngine --> KMeansRuntime
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –í–µ–∫—Ç–æ—Ä–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ–∫–æ–Ω
* NUMA-aware –∞–≥—Ä–µ–≥–∞—Ç—ã
* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

* `src/sql/bi_window.c`
* `src/sql/bi_cluster.c`
* `include/sql/bi_agg.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ----------------- | ---------------------------------------------------------------- | ------------------------------ |
| `rank_eval`       | `int rank_eval(bi_agg_state_t *st, row_t *in)`                   | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞  |
| `percentile_calc` | `double percentile_calc(bi_agg_state_t *st, double p)`           | –†–∞—Å—á–µ—Ç —Ä–∞–∑–±–∏–≤–∫–∏ –ø–æ percentiles |
| `kmeans_cluster`  | `int kmeans_cluster(result_iter_t *rows, int k, cluster_t *out)` | –§–æ–Ω–æ–≤–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è k-means  |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* `tests/sql/test_bi_agg.c`
* `tests/sql/test_cluster_kmeans.c`
* `coverage/bi_agg.cover`

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                 | –ó–∞–¥–µ—Ä–∂–∫–∞ |
| ------------------------ | -------- |
| Rank over 10M rows       | ‚àº3.1 –º—Å  |
| Percentile –ø–æ 1M –∑–∞–ø–∏—Å–µ–π | ‚àº1.2 –º—Å  |
| KMeans (k=8, 100K)       | ‚àº5.7 –º—Å  |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                    |
| -------------------- | ------ | ------------------------------ |
| Rank/Percentile/–æ–∫–Ω–∞ | 100    | –°–æ–≤—Ä–µ—Ç—Å—Ç–≤–∏–µ ANSI SQL:2011+     |
| Clustering/KMeans    | 95     | –ï—Å—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ UDF |

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
SELECT customer_id,
       RANK() OVER (PARTITION BY region ORDER BY total_spend DESC) AS rnk
FROM customers;
```

## üß∞ –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –î–æ–±–∞–≤–∏—Ç—å DBSCAN –¥–ª—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–Ω–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* –ò–Ω–¥–µ–∫—Å—ã –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ approximate median

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLPlanner" as SQL
entity "BIWindowProcessor" as WIN
entity "BIClusterEngine" as CLU
entity "KMeansRuntime" as KM
entity "WindowExec" as WINX

SQL --> WIN
SQL --> CLU
WIN --> WINX
CLU --> KM
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞–º
* –†–µ–π—Ç–∏–Ω–≥–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –¥–∏–ª–µ—Ä–æ–≤
* –û—Ü–µ–Ω–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –≤ real-time

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û—Ç–¥–µ–ª—å–Ω—ã–µ RBAC-–ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–∑–æ–≤ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö BI-–∑–∞–ø—Ä–æ—Å–æ–≤
* –õ–∏–º–∏—Ç –Ω–∞ –æ–±—ä–µ–º –∏ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v1.0 ‚Äî rank/percentile –∏ –æ–∫–Ω–∞
* v1.1 ‚Äî KMeans –Ω–∞ —Ñ–æ–Ω–æ–≤—ã—Ö worker-–∞—Ö
* v1.2 ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è BI-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤ –≤ planner

## ‚õîÔ∏è –°–æ–æ–±

# 5.6 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (Time Series, Gap-Fill, Retention)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.6 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (Time Series, Gap-Fill, Retention)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–∞—Ç–∏–≤–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –≤ –°–£–ë–î, –≤–∫–ª—é—á–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ (gap-filling), downsampling –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (retention policy). –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∑–∞–¥–∞—á –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, IoT, –º–µ—Ç—Ä–∏–∫, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ä–∏–π.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞            | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                           |
| --------------------- | -------------------------------------------------- |
| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö TimeSeries | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø: `ts_point_t(timestamp, value)`    |
| Gap-Fill              | –§—É–Ω–∫—Ü–∏—è GAP\_FILL(...), –∞–ª–≥–æ—Ä–∏—Ç–º—ã –ª–∏–Ω–µ–π–Ω–æ–π/–Ω—É–ª–µ–≤–æ–π |
| Retention Policy      | TTL-–¥–≤–∏–∂–æ–∫, –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ —Å—Ä–æ–∫—É                  |
| –ê–≥—Ä–µ–≥–∞—Ü–∏–∏             | SQL-—Ñ—É–Ω–∫—Ü–∏–∏: ts\_downsample, ts\_agg, ts\_delta    |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è            | –í—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω–¥–µ–∫—Å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π range scan           |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct ts_point_t {
  int64_t timestamp_ns;   // –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã
  double value;            // –∑–Ω–∞—á–µ–Ω–∏–µ
} ts_point_t;

typedef struct ts_series_t {
  char series_id[MAX_SERIES];
  ts_point_t *points;
  size_t count;
  ttl_policy_t ttl;
} ts_series_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
TSFunctions --> StorageEngine
TSFunctions --> QueryPlanner
TSFunctions --> IndexManager
TSFunctions --> GC
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ù–∞–Ω–æ—Å–µ–∫—É–Ω–¥–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫
* NUMA-aware —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —Å–µ—Ä–∏—è–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ range scan, vectorized execution

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/ts/ts_functions.c`
* `src/ts/ts_engine.c`
* `include/ts/ts_types.h`
* `src/gc/gc_retention.c`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ----------------- | ---------------------------------------------------------------------------- | ----------------------------------- |
| `ts_insert_point` | `int ts_insert_point(const char *id, ts_point_t p)`                          | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å–µ—Ä–∏–∏ |
| `ts_downsample`   | `result_t ts_downsample(const char *id, interval_t window)`                  | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –æ–∫–Ω–∞–º              |
| `ts_gap_fill`     | `result_t ts_gap_fill(const char *id, interval_t window, fill_policy_t pol)` | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤                |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ts/test_ts_functions.c`
* Integration: —Ç–µ—Å—Ç—ã retention + GC
* Stress: –º–∏–ª–ª–∏–æ–Ω—ã —Ç–æ—á–µ–∫ —Å gap-fill

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è         | –ú–µ—Ç—Ä–∏–∫–∞        |
| ---------------- | -------------- |
| –í—Å—Ç–∞–≤–∫–∞ —Ç–æ—á–µ–∫    | > 2M —Ç–æ—á–µ–∫/—Å–µ–∫ |
| Gap-fill 1h –æ–∫–Ω–æ | < 1.2 –º—Å       |
| Downsample 24h   | < 0.9 –º—Å       |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| ----------------- | ------ | --------------------------------- |
| –¢–∏–ø TS + gap-fill | 100    | –ù–∞—Ç–∏–≤–Ω—ã–π —Ç–∏–ø –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ |
| Retention policy  | 100    | TTL –∏ GC-–º–æ–¥—É–ª—å                   |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SQL  | 100    | –§—É–Ω–∫—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö   |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
SELECT ts_downsample('temp01', INTERVAL '5 minutes')
FROM sensors
WHERE ts > NOW() - INTERVAL '1 day';
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö —Å–µ—Ä–∏–π (event time)
* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
* –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É Gorilla

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity TSFunctions
entity StorageEngine
entity QueryPlanner
entity IndexManager
entity GC

TSFunctions --> StorageEngine
TSFunctions --> QueryPlanner
TSFunctions --> IndexManager
TSFunctions --> GC
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û—Ç—á—ë—Ç—ã –ø–æ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
* –ê–Ω–∞–ª–∏–∑ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ –∞–Ω–æ–º–∞–ª–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –ø–æ series\_id (RBAC)
* TTL —Å —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ–º –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è
* Audit –ª–æ–≥ –ø–æ insert/delete —Ç–æ—á–µ–∫

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ –∏ –∑–∞–ø—Ä–æ—Å–∞
* v1.1 ‚Äî gap-fill –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã
* v1.2 ‚Äî retention + GC-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                   | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | ------------------------- | ------------------------------------ |
| `E_TS_NOT_FOUND`   | –°–µ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç       | ID –Ω–µ –Ω–∞–π–¥–µ–Ω                         |
| `W_TS_TRUNCATED`   | –ü—Ä–µ–≤—ã—à–µ–Ω TTL              | –î–∞–Ω–Ω—ã–µ –æ–±—Ä–µ–∑–∞–Ω—ã –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è |
| `E_TS_INSERT_FAIL` | –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É | –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ —Ç–æ—á–∫–∏             |

# 5.7 ‚Äî –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Query Forecasting)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.7 ‚Äî –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Query Forecasting)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø–ª–∞–Ω–µ —Ç—Ä–µ–Ω–¥–æ–≤, —Ç–µ–Ω–¥–µ–Ω—Ü–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –æ—Ü–µ–Ω–∫–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ SLA.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                      |
| -------------------- | --------------------------------------------- |
| SQL FORECAST —Ñ—É–Ω–∫—Ü–∏–∏ | FORECAST(), TREND(), TIME\_SERIES()           |
| –≠–∫–∑–µ–∫—å—é—Ç–æ—Ä SQL       | –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–º –∏ time series engine |
| Time Series Engine   | –∫–µ—à, —Å–æ–ø—Ä—è–∂–µ–Ω —Å —Ä–µ–∂–∏–º–æ–º scan & forecast       |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct forecast_model_t {
  char name[MAX_MODEL_NAME];
  ts_method_t method;     // linear, exponential, holt-winters
  uint32_t horizon;       // –≥–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞
  void *model_data;       // opaque
} forecast_model_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
ForecastEngine --> TimeSeriesEngine
SQLExecutor --> ForecastEngine
ForecastEngine --> ModelStorage
```

## üßê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ forecasting –ø–æ –æ–∫–Ω–∞–º SQL
* NUMA-aware –º–æ–¥–µ–ª–∏, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ forecast pipelines
* –∞–≤—Ç–æ-—Ç–µ—Å—Ç—ã —Ç–æ—á–Ω–æ—Å—Ç–∏

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/sql_forecast.c`
* `src/forecast/forecast_engine.c`
* `include/forecast/forecast_model.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------------------- | ------------------------------------------------------------------------ | -------------------------- |
| `forecast_eval`     | `result_t forecast_eval(db_session_t *s, forecast_model_t *m, row_t *r)` | –ø—Ä–æ–≥–Ω–æ–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ SQL –æ–∫–Ω—É |
| `forecast_train`    | `int forecast_train(forecast_model_t *m, const ts_series_t *series)`     | –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ |
| `forecast_register` | `int forecast_register(const char *name, forecast_model_t *m)`           | —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏         |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/forecast/test_forecast_engine.c`
* Fuzz: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –Ω–∞ –≤–≤–æ–¥
* Integration: SQL-–∑–∞–ø—Ä–æ—Å—ã FORECAST

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è              | –ú–µ—Ç—Ä–∏–∫–∞   |
| --------------------- | --------- |
| FORECAST(–¥–Ω–∏ –Ω–∞–ø–µ—Ä–µ–¥) | < 2.1 –º—Å  |
| –æ–±—É—á–µ–Ω–∏–µ Holt-Winters | \~ 5.6 –º—Å |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                   | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| -------------------------- | ------ | --------------------------------- |
| SQL-–ø—Ä–æ–≥–Ω–æ–∑ –ø–æ time series | 100    | FORECAST(), TREND()               |
| Holt-Winters, linear model | 100    | –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –≤ forecast\_model\_t |

## üìå –ü—Ä–∏–º–µ—Ä SQL

```sql
-- –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂ –Ω–∞ –Ω–µ–¥–µ–ª—é
SELECT FORECAST(sales, 7 days) FROM revenue_ts WHERE region = 'EU';
```

## üß∞ UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity ForecastEngine
entity TimeSeriesEngine
entity SQLExecutor
entity ModelStorage

ForecastEngine --> TimeSeriesEngine
SQLExecutor --> ForecastEngine
ForecastEngine --> ModelStorage
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ø—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É
* –æ—Ü–µ–Ω–∫–∞ –Ω–∞–≥—Ä—É–∑–æ–∫ –Ω–∞ OLAP-–∫–ª–∞—Å—Ç–µ—Ä
* —Ä–µ—à–µ–Ω–∏—è –ø–æ –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥—É –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RBAC-–¥–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ä–µ–∫–∞—Å—Ç-–º–æ–¥–µ–ª—è–º
* –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
* –ø–æ–¥–ø–∏—Å—å –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

## üìÖ –í–µ—Ä—Å–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è

* v1.0 ‚Äî –±–∞–∑–æ–≤–∞—è SQL-FORECAST –ø–æ time series
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω Holt-Winters –º–µ—Ç–æ–¥
* v1.2 ‚Äî –æ—Ü–µ–Ω–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π + auto-test

## üöß –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

\| –ö–æ–¥ / —Ç–∏–ø       | –£—Å–ª–æ

# 5.8 ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Data Clustering)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.8 ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Data Clustering)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã—è–≤–ª–µ–Ω–∏–µ —Å—Ö–æ–∂–∏—Ö –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—É—Ç—ë–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ k-means, DBSCAN –∏ hierarchical clustering —Å SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –≤—ã–∑–æ–≤–∞.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                    |
| ----------------- | ------------------------------------------- |
| SQL-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | –§—É–Ω–∫—Ü–∏–∏: CLUSTER(), KMEANS(), DBSCAN()      |
| –ê–ª–≥–æ—Ä–∏—Ç–º—ã         | K-Means++, DBSCAN, Agglomerative Clustering |
| –û–±—Ä–∞–±–æ—Ç–∫–∞         | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ batch –∏ streaming –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏   |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct cluster_result_t {
  int cluster_id;
  float distance;
  row_t *input;
} cluster_result_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SQLExecutor --> ClusterEngine
ClusterEngine --> KMeansLib
ClusterEngine --> DBSCANLib
ClusterEngine --> AggloClusterLib
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* NUMA-aware —Ä–∞—Å—Å—á–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
* SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
* –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–µ—à –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/ml/clustering_engine.c`
* `src/sql/cluster_functions.c`
* `include/ml/cluster_result.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| --------------- | --------------------------------------------------------------------------- | ------------------------------------ |
| `cluster_eval`  | `result_t cluster_eval(db_session_t *s, row_t *r, const char *alg)`         | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è —Å—Ç—Ä–æ–∫–∏ r |
| `cluster_batch` | `int cluster_batch(dataset_t *ds, const char *alg, cluster_result_t **out)` | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–∞—Ç—á-–Ω–∞–±–æ—Ä–æ–≤           |
| `cluster_init`  | `void cluster_init(void)`                                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞     |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ml/test_clustering_engine.c`
* Integration: `tests/sql/test_cluster_func.sql`
* Soak: –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü (10M+ —Å—Ç—Ä–æ–∫)

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è        | –ú–µ—Ç—Ä–∏–∫–∞  |
| --------------- | -------- |
| KMeans++ (100K) | \~9.8 –º—Å |
| DBSCAN (100K)   | \~22 –º—Å  |
| Agglo (50K)     | \~31 –º—Å  |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ----------------- | ------ | ----------------------------------------- |
| SQL-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | 100    | CLUSTER(), KMEANS(), DBSCAN() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |
| Runtime –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | 100    | SIMD, NUMA-aware                          |
| Batch + Streaming | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ —Ä–µ–∂–∏–º–æ–≤  |

## üìå –ü—Ä–∏–º–µ—Ä SQL-–∫–æ–¥–∞

```sql
SELECT CLUSTER('kmeans', amount, age, region_id) FROM customers;
```

## üßå –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ HDBSCAN
* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
entity "ClusterEngine" as CE
entity "KMeansLib" as KM
entity "DBSCANLib" as DB
entity "AggloClusterLib" as AG
SQL --> CE
CE --> KM
CE --> DB
CE --> AG
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥
* –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –ö–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RBAC-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## üïõ –í–µ—Ä—Å–∏–∏

* v1.0 ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CLUSTER() –∏ KMeans
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ DBSCAN
* v1.2 ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SIMD –∏ NUMA-aware

# 5.9 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ (Time Windows, Sliding, Tumbling)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.9 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ (Time Windows, Sliding, Tumbling)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö –∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –ø–æ –æ–∫–Ω–∞–º –≤—Ä–µ–º–µ–Ω–∏. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –¥–ª—è time-series analytics, CEP –∏ –æ–Ω–ª–∞–π–Ω-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ OLAP-–Ω–∞–≥—Ä—É–∑–∫–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                 |
| -------------------------- | -------------------------------------------------------- |
| Sliding Window             | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞ —Å –Ω–∞–∫–ª–∞–¥–∫–æ–π (OVER RANGE ... PRECEDING) |
| Tumbling Window            | –†–∞–∑–±–∏–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ –æ–∫–Ω–∞                      |
| Gap-filling / Zero Padding | –§—É–Ω–∫—Ü–∏—è FILL() –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω           |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct time_window_t {
  timestamp_t window_start;
  timestamp_t window_end;
  aggregate_t *aggregates;
} time_window_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
TimeSeriesEngine --> SQLExecutor
SQLExecutor --> Aggregator
Aggregator --> TimeWindowManager
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω —Å –ø–æ–º–æ—â—å—é projection pruning
* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –¥–ª—è –æ–∫–æ–Ω: avg, first, last, delta
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ interval-based WINDOW

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

* `src/sql/window_functions.c`
* `src/engine/time_window.c`
* `include/time_window.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------------------- | ---------------------------------------------------------------- | ------------------------------------- |
| `window_eval`       | `result_t window_eval(time_window_t *w, const row_t *r)`         | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–π –¥–ª—è –æ–∫–Ω–∞         |
| `fill_missing_time` | `void fill_missing_time(series_t *s, interval_t granularity)`    | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–∫–æ–Ω –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| `init_window`       | `time_window_t *init_window(timestamp_t start, timestamp_t end)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏            |

## üî™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/sql/test_window_functions.c`
* Integration: —Ü–µ–ø–æ—á–∫–∏ SQL —Å –æ–∫–Ω–æ–≤—ã–º–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è–º–∏
* Fuzz: –¥–∞—Ç–∞-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —à—É–º–æ–≤

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                       | –ó–∞–¥–µ—Ä–∂–∫–∞ |
| ------------------------------ | -------- |
| Sliding window avg, 10K rows   | 1.1 –º—Å   |
| Tumbling window sum, 100K rows | 3.2 –º—Å   |
| Gap fill (minute granularity)  | 0.6 –º—Å   |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| ------------------------ | ------ | --------------------------------------- |
| Sliding/Tumbling windows | 100    | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OVER() —Å RANGE/GROUPS |
| Gap filling              | 100    | –§—É–Ω–∫—Ü–∏—è FILL –∏ —à–∞–±–ª–æ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏          |

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
SELECT symbol,
       avg(price) OVER (PARTITION BY symbol ORDER BY ts RANGE BETWEEN INTERVAL '5m' PRECEDING AND CURRENT ROW)
FROM market_ticks;
```

## üß∞ –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SESSION windows
* –°—Ç—Ä–µ–º–∏–Ω–≥ aggregation
* Sliding merge –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
entity "Aggregator" as AGG
entity "TimeWindowManager" as TIME
SQL --> AGG
AGG --> TIME
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* OLAP-–æ—Ç—á—ë—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫–Ω–∞–º–∏
* –ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ–º N –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —à—É–º–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –°–∞–Ω–¥–±–æ–∫—Å –≤ SQL-—Ñ—É–Ω–∫—Ü–∏—è—Ö
* –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ WINDOW
* –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–∫–Ω–∞—Ö

## üìÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v1.0 ‚Äî Sliding Window, Tumbling, OVER()
* v1.1 ‚Äî Gap Filling + INTERVAL
* v1.2

# 5.10 ‚Äî –¢–∞–π–º—Å–µ—Ä–∏–∏ (Time Series Storage and Analysis)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.10 ‚Äî –¢–∞–π–º—Å–µ—Ä–∏–∏ (Time Series Storage and Analysis)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, –∑–∞–ø—Ä–æ—Å—ã –∏ –∞–Ω–∞–ª–∏–∑ —Ç–∞–π–º—Å–µ—Ä–∏–π –¥–∞–Ω–Ω—ã—Ö (—Ç–µ–º–ø–æ—Ä–∞–ª—å–Ω—ã—Ö –º–Ω–æ–∂–µ—Å—Ç–≤) —Å –≤—ã—Å–æ–∫–æ–π —Å—Ç–µ–ø–µ–Ω—å—é —Å–∂–∞—Ç–∏—è, –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π downsampling, –∏ gap-filling. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ—Ç–æ–∫–æ–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –¥–ª—è OLAP-–∑–∞–ø—Ä–æ—Å–æ–≤.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞       | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                     |
| ---------------- | ------------------------------------------------------------ |
| –•—Ä–∞–Ω–µ–Ω–∏–µ TS      | –ë–∏–Ω–∞—Ä–Ω–æ–µ –∫–æ–ª–æ–Ω–Ω–æ—á–Ω–æ–µ —Å–∂–∞—Ç–∏–µ + Frame of Reference + Delta     |
| Gap filling      | –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ SQL-–¥–≤–∏–∂–∫–∞ (LAG, LEAD, —Ñ—É–Ω–∫—Ü–∏–∏ –æ–∫–æ–Ω) |
| Downsampling     | RESAMPLE(interval, agg) –≤ —Å–∞–º–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ                    |
| Retention policy | –¢TL + –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ + —Å–Ω–∞–ø—à–æ—Ç—ã                             |

## üìÄ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct ts_point_t {
    timestamp_ns_t ts;
    double value;
} ts_point_t;

typedef struct ts_series_t {
    char series_id[36];
    ts_point_t *points;
    size_t count;
} ts_series_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
TSQueryEngine --> TSStorage
TSStorage --> ColumnarStore
TSQueryEngine --> SQLExecutor
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ ingestion
* NUMA-aware –∞–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ —Å–µ—Ä–∏—è–º
* –ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ SSD/–æ–ø–µ—Ä–∞—Ç–∏–≤–∫–µ

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

* `src/timeseries/ts_storage.c`
* `src/timeseries/ts_query.c`
* `include/timeseries/ts_types.h`
* `src/sql/ts_sql_functions.c`

## üîß –§—É–Ω–∫—Ü–∏–∏

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ----------------- | ------------------------------------------------------------------ | ------------------------------ |
| `ts_insert_point` | `int ts_insert_point(const char *id, timestamp_ns_t ts, double v)` | –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É –≤ —Å–µ—Ä–∏—é         |
| `ts_query_range`  | `result_t ts_query_range(const char *id, ts_range_t r)`            | –í—ã–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–∏—é –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ    |
| `ts_gapfill`      | `result_t ts_gapfill(const char *id, ts_range_t r, int step_ms)`   | –î–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ —Å–µ—Ä–∏–∏ |

## üî´ –¢–µ—Å—Ç—ã

* `tests/timeseries/test_ts_storage.c`
* `tests/timeseries/test_ts_query.c`
* Fuzzing: ts\_point ingestion
* Soak: high-throughput inserts, TTL deletion

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è            | –ó–Ω–∞—á–µ–Ω–∏–µ      |
| ------------------- | ------------- |
| Insert throughput   | 3.5M points/s |
| Range query latency | < 1.2 –º—Å      |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                          |
| -------------------- | ------ | ------------------------------------ |
| Gap filling          | 100    | –ß–µ—Ä–µ–∑ SQL –æ–∫–Ω–∞, LAG/LEAD             |
| Downsampling         | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞       |
| TTL/—Ä–µ—Ç–µ–Ω—à–Ω/—Å–Ω–∞–ø—à–æ—Ç—ã | 100    | –¢–µ–º–ø–æ—Ä–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º |

## üìâ UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "TSQueryEngine" as Q
entity "TSStorage" as S
entity "SQLExecutor" as E
entity "ColumnarStore" as C

Q --> S
Q --> E
S --> C
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ê–Ω–∞–ª–∏–∑ –ø–æ —á–∞—Å–æ–≤–æ–π –∏ –¥–Ω–µ–≤–Ω–æ–π –¥–∏–Ω–∞–º–∏–∫–µ
* –ú–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–∞–º
* KPI-–¥–∞—à–±–æ—Ä–¥—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –†–æ–ª–µ–≤–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–∏—è–º
* –°–Ω–∞–ø—à–æ—Ç-–∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏
* TTL-–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## ‚åöÔ∏è –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v1.0 ‚Äî –∏–Ω–∏—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä—è–¥–æ–≤
* v1.1 ‚Äî gap fill + interpolation
* v1.2 ‚Äî downsampling + retention
* v1.3 ‚Äî NUMA-aware

# 5.11 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RBAC, ABAC, TDE, ACL, JWT, sandbox)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.11 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ä–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–ª–∏—Ç–∏–∫–∏)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –¥–æ—Å—Ç—É–ø –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π, –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤, —Å–µ—Ç–µ–≤—ã—Ö ACL, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é JWT/—Ç–æ–∫–µ–Ω–∞–º–∏, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ TDE, –∞ —Ç–∞–∫–∂–µ sandbox-–æ—Ç—á–µ–∂–¥–µ–Ω–∏–µ UDF/UDAF.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                       |
| ----------- | ---------------------------------------------- |
| RBAC        | –ü—Ä–∞–≤–∞ –Ω–∞ –≥—Ä—É–ø–ø—ã/—Ä–æ–ª–∏/–æ–±—ä–µ–∫—Ç—ã                   |
| ABAC        | –ü–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ—Å—Å–∏–∏/–∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤           |
| ACL         | –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ä—Ç—ã, –¥–∏–∞–ø–∞–∑–æ–Ω—ã IP, —Ç–µ–≥–∏              |
| JWT / OAuth | –°–µ—Å—Å–∏–∏, —Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏ RSA/EC                   |
| TDE / TLS   | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤/—Ç—Ä–∞—Ñ–∏–∫–∞, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã         |
| Sandbox UDF | Lua/WASM UDF/—Ç—Ä–∏–≥–≥–µ—Ä—ã –≤ –æ—Ç—á–µ–∂–¥–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
typedef struct access_policy_t {
  char role[MAX_ROLE];
  char resource[MAX_NAME];
  uint8_t permission;  // READ, WRITE, ADMIN
} access_policy_t;

typedef struct jwt_session_t {
  char token[512];
  time_t expiry;
  char user[MAX_USER];
} jwt_session_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SessionManager --> RBAC
SessionManager --> ABAC
SessionManager --> JWTValidator
JWTValidator --> RSAKeyStore
AccessEngine --> ACLManager
AccessEngine --> TDEngine
SQLExecutor --> SandboxEngine
```

## üßê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* TDE: Transparent Data Encryption (AES256-GCM)
* RSA/EC256-–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
* UDF sandbox: seccomp + namespace isolation

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

* `src/security/rbac.c`
* `src/security/abac.c`
* `src/security/jwt.c`
* `src/security/tde.c`
* `src/security/acl.c`
* `include/security/access_policy.h`

## ‚öñÔ∏è –§—É–Ω–∫—Ü–∏–∏

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                       |
| ----------------- | --------------------------------------------------------------- | ------------------------------ |
| `check_access`    | `bool check_access(const char *user, const char *resource)`     | –ü—Ä–æ–≤–µ—Ä–∫–∞ RBAC/–ê–í–ê–ö –¥–æ—Å—Ç—É–ø–∞     |
| `parse_jwt`       | `int parse_jwt(const char *token, jwt_session_t *out)`          | –†–∞–∑–±–æ—Ä JWT-—Ç–æ–∫–µ–Ω–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è   |
| `encrypt_page`    | `void encrypt_page(uint8_t *buf, size_t sz)`                    | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤/–¥–∏—Å–∫–∞ TDE   |
| `run_sandbox_udf` | `int run_sandbox_udf(const char *name, const udf_args_t *args)` | –í—ã–∑–æ–≤ UDF –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Å–µ–∫—Ç–æ—Ä–µ |

## üî´ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_rbac.c`, `test_acl.c`
* Fuzz: JWT/–∞—Ç—Ç—Ä–∏–±—É—Ç—ã/–æ—à–∏–±–∫–∏ –ø–æ–ª–∏—Ç–∏–∫
* Integration: –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ SQL –∏ –¥–æ—Å—Ç—É–ø–∞

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è          | –ú–µ—Ç—Ä–∏–∫–∞  |
| ----------------- | -------- |
| JWT validation    | < 0.8 –º—Å |
| ACL check         | < 0.3 –º—Å |
| Sandbox execution | < 1.5 –º—Å |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π           | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                           |
| ------------------ | ------ | ------------------------------------- |
| RBAC/–ê–í–ê–ö-–ø–æ–ª–∏—Ç–∏–∫–∏ | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å –≥—Ä–∞–Ω—É–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º     |
| JWT/—Ç–æ–∫–µ–Ω—ã/–∫–ª—é—á–∏   | 100    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ OAuth 2.0 / JWT      |
| TDE + TLS          | 100    | AES256-—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ mTLS              |
| Sandbox UDF        | 100    | Seccomp + PID/NET namespace isolation |

## üìå UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SessionManager" as SM
entity "RBAC" as RB
entity "ABAC" as AB
entity "JWTValidator" as JWT
entity "RSAKeyStore" as RSA
entity "AccessEngine" as ACC
entity "ACLManager" as ACL
entity "TDEngine" as TDE
entity "SQLExecutor" as SQL
entity "SandboxEngine" as SBX

SM --> RB
SM --> AB
SM --> JWT
JWT --> RSA
ACC --> ACL
ACC --> TDE
SQL --> SBX
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø –¥–ª—è —Ñ–∏–ª–∏–∞–ª–æ–≤/—Ä–µ–≥–∏–æ–Ω–æ–≤
* –°–µ—Å—Å–∏–∏ JWT –¥–ª—è BI/REST/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é PCI DSS / –ó–ê–°–¢

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –¢—Ä–∞—Ñ–∏–∫ TLS 1.3
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–æ–≤ AES256-GCM
* JWT RS256/–°–µ—Å—Å–∏–∏ + TOTP
* UDF: sandbox c seccomp, cgroup, namespace

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏

# 5.12 ‚Äî Observability –∏ DevOps

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.12 ‚Äî Observability –∏ DevOps**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –Ω–∞–±–æ—Ä —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∏ CI/CD-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â–∏—Ö –æ–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –±—ã—Å—Ç—Ä—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é —Ä–µ–ª–∏–∑–æ–≤.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                        |
| ------------ | --------------------------------------------------------------- |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥   | Prometheus, OpenMetrics, Alertmanager                           |
| –¢—Ä–µ–π—Å–∏–Ω–≥     | OpenTelemetry, Jaeger, Zipkin                                   |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  | stderr/syslog, JSON-–ª–æ–≥–∏, binary-–ª–æ–≥–∏                           |
| –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∞ | Flamegraph, Execution Timeline Viewer                           |
| CI/CD        | GitHub Actions, Ninja, —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: soak, fuzz, mutation |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–ù–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –∂—É—Ä–Ω–∞–ª—ã –≤ –ø–∞–º—è—Ç–∏/–Ω–∞ –¥–∏—Å–∫–µ.

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
component Core --> Metrics
component SQL --> QueryTracing
component Tracing --> OpenTelemetry
component Logging --> Syslog
component Logging --> BinaryLogger
component Profiling --> Flamegraph
component CI --> GitHubActions
component CI --> MutationFuzzSoak
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞–±–æ—Ä–æ–≤ –º–µ—Ç—Ä–∏–∫ (OpenMetrics)
* –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∞ —Å –≤—ã–≤–æ–¥–æ–º –≤ SVG
* –§–∏–ª—å—Ç—Ä—É–µ–º–æ–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

* `src/metrics/prometheus_exporter.c`
* `src/log/syslog_logger.c`
* `src/log/binary_logger.c`
* `src/tracing/otel_adapter.c`
* `src/profiling/flamegraph.c`
* `ci/gh_workflows/`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                | –û–ø–∏—Å–∞–Ω–∏–µ                     |
| ------------------ | ------------------------------------------------------- | ---------------------------- |
| `log_event`        | `void log_event(const char *op, uint64_t t, size_t sz)` | –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ             |
| `metric_emit`      | `void metric_emit(const char *name, double value)`      | –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –≤ Prometheus  |
| `trace_span_start` | `span_t *trace_span_start(const char *op)`              | –°–æ–∑–¥–∞–µ—Ç span —Ç—Ä–µ–π—Å–∏–Ω–≥–∞       |
| `trace_span_end`   | `void trace_span_end(span_t *s)`                        | –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ |
| `start_profiler`   | `void start_profiler()`                                 | –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫—É      |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/log/test_log.c`, `tests/metrics/test_metrics.c`
* Integration: CI GitHub workflows, CLI smoke
* Fuzz: `metrics_fuzz_log_format()`

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                   | –ó–∞–¥–µ—Ä–∂–∫–∞ |
| -------------------------- | -------- |
| log\_event() –≤ binary mode | < 150 ns |
| emit Prometheus metrics    | < 1.2 –º—Å |
| trace span + end           | < 5 –º—Å   |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                  |
| ------------------------ | ------ | ---------------------------- |
| OpenMetrics + Prometheus | 100    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞             |
| CI/CD + Mutation/Fuzz    | 100    | GitHub Actions –∏ —Ç–µ—Å—Ç—ã       |
| –¢—Ä–µ–π—Å–∏–Ω–≥ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∞  | 100    | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è, SVG FlameGraph |

## üìé UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
component "SQL" --> "QueryTracing"
component "QueryTracing" --> "OpenTelemetry"
component "Core" --> "Metrics"
component "Metrics" --> "Prometheus"
component "Logging" --> "syslog"
component "Logging" --> "binary_logger"
component "Profiling" --> "Flamegraph"
component "CI" --> "GitHub Actions"
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* SLA-–∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
* –í—ã—è–≤–ª–µ–Ω–∏–µ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
* –ê–≤—Ç–æ–æ—Ç—á–µ—Ç—ã –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –≤ DevOps

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û—Ç–¥–µ–ª—å–Ω—ã–π audit-–∫–∞–Ω–∞–ª
* RBAC-–¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç—Ä–∏–∫–∞–º –∏ —Ç—Ä–µ–π—Å–∞–º
* –ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è user-id

## üìÖ –í–µ—Ä—Å–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è

* v1.0 ‚Äî –ø–µ—Ä–≤–æ–Ω–∞—á

# 5.13 ‚Äî –î–≤–∏–∂–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Vectorized Execution, Adaptive Joins)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.13 ‚Äî –î–≤–∏–∂–æ–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Vectorized Execution, Adaptive Joins)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —Å —É–ª—å—Ç—Ä–∞–Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –∏ –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (join) –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—É–±–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –≤ —Å–º–µ—à–∞–Ω–Ω—ã—Ö HTAP-–Ω–∞–≥—Ä—É–∑–∫–∞—Ö (Hybrid Transactional/Analytical Processing).

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                |
| ---------------------------- | ------------------------------------------------------- |
| –í–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ | SIMD-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, Arrow/PAX layout |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è        | hash, merge, index-nested loop, grace hash              |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ      | –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–µ pipeline, NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ         |
| –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è      | Runtime feedback, perf counters, flamegraph tracepoints |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct vector_exec_t {
  op_code_t opcode;
  void *impl;
  uint32_t batch_size;
  bool is_adaptive;
} vector_exec_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
Executor --> VectorEngine
VectorEngine --> JoinPlanner
VectorEngine --> RuntimeFeedback
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SIMD —á–µ—Ä–µ–∑ AVX512/AVX2 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
* NUMA-aware —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ —è–¥—Ä–∞–º
* Runtime –∞–¥–∞–ø—Ç–∞—Ü–∏—è join-—Å—Ç—Ä–∞—Ç–µ–≥–∏–π –∏ pipeline restructuring
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Arrow memory layout –¥–ª—è batch processing

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/executor/vector_exec.c`
* `src/executor/adaptive_join.c`
* `include/executor/vector_exec.h`
* `src/profiler/runtime_feedback.c`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                                             |
| -------------------- | ------------------------------------------------------------------- | ---------------------------------------------------- |
| `vector_exec_run`    | `int vector_exec_run(vector_exec_t *ve, batch_t *out)`              | –í—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –Ω–∞ –≤—Ö–æ–¥–Ω–æ–º –±–ª–æ–∫–µ –¥–∞–Ω–Ω—ã—Ö |
| `join_strategy_pick` | `join_strategy_t join_strategy_pick(join_hint_t *hint, stats_t *s)` | –í—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ    |
| `runtime_feedback`   | `void runtime_feedback(op_id_t op, exec_stats_t *s)`                | –ü–µ—Ä–µ–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è          |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/executor/test_vector_exec.c`
* Stress: –±–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –º–∏–ª–ª–∏–∞—Ä–¥–∞–º–∏ —Å—Ç—Ä–æ–∫
* Integration: join-–ø–ª–∞–Ω—ã –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ pipeline –Ω–∞ prod-–Ω–∞–≥—Ä—É–∑–∫–∞—Ö

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                   | –ó–∞–¥–µ—Ä–∂–∫–∞ / Throughput             |
| -------------------------- | --------------------------------- |
| SIMD —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è            | < 300 –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥ / batch          |
| Adaptive join switch       | < 1.2 –º—Å –Ω–∞ –ø–µ—Ä–µ—Å—á—ë—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏    |
| –ü–æ–ª–Ω—ã–π pipeline –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | < 950 –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª–æ–∂–Ω—ã–π –ø–ª–∞–Ω |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                      |
| ----------------------------- | ------ | ------------------------------------------------ |
| SIMD-–≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è             | 100    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AVX2 / AVX512                       |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ join-—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏     | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ —Ç–∏–ø—ã –∏ runtime switch            |
| NUMA-aware parallel pipelines | 100    | –ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã NUMA –∏ cache-topology –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
vector_exec_t ve = {
  .opcode = OP_FILTER,
  .impl = &simd_filter_impl,
  .batch_size = 1024,
  .is_adaptive = false
};
vector_exec_run(&ve, &out_batch);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU-–≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ CUDA/ROCm)
* ML-guided pipeline optimization
* –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä runtime-–ø–ª–∞–Ω–æ–≤ (LLVM)

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "Executor" as Exec
entity "VectorEngine" as VE
entity "JoinPlanner" as JP
entity "RuntimeFeedback" as RF

Exec --> VE
VE --> JP
VE --> RF
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å—É–±–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
* –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å join/–∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π
* –ü–æ–≤—ã—à–µ–Ω–∏–µ throughput –ø—Ä–∏ HTAP-–Ω–∞–≥—Ä—É–∑–∫–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ò–∑–æ–ª—è—Ü–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è pipeline –ø–æ —Å–µ—Å—Å–∏—è–º
* –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–ª—è join-–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø–æ –ª–∏–º–∏—Ç–∞–º
* Fail-fast –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤–∞—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã hash/merge join
* v1.2 ‚Äî NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
* v1.3 ‚Äî runtime feedback loop

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø        | –£—Å–ª–æ–≤–∏–µ                      | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| ---------------- | ---------------------------- | -------------------------------------- |
| `E_PIPELINE_OVF` | –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ pipeline | –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∞–≤–∞—Ä–∏–π–Ω—ã–π –ª–æ–≥  |
| `W_JOIN_RETRY`   | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ join —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏  | –í—ã–ø–æ–ª–Ω–µ–Ω–æ fallback –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é |
| `E_SIMD_FAIL`    | –û—à–∏–±–∫–∞ SIMD –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è       | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ CPU           |

# 5.14 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å (Extensibility, UDF/UDAF)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.14 ‚Äî –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å (Extensibility, UDF/UDAF)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π –ª–æ–≥–∏–∫–∏ –≤–Ω—É—Ç—Ä–∏ –°–£–ë–î —á–µ—Ä–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (UDF), –∞–≥—Ä–µ–≥–∞—Ç—ã (UDAF) –∏ –ø–ª–∞–≥–∏–Ω—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Lua, WASM, JS, C/C++, –ø–æ–∑–≤–æ–ª—è—è –¥–æ–±–∞–≤–ª—è—Ç—å –ª—é–±—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                        |
| ------------------- | ----------------------------------------------- |
| UDF (Lua, JS, WASM) | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ, JIT –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è       |
| C/C++ UDF           | –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –º–æ–¥—É–ª–µ–π          |
| UDAF                | –ê–≥—Ä–µ–≥–∞—Ç—ã: state-init, state-update, state-merge |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä—ã

```c
// C-API –¥–ª—è UDF
typedef struct udf_context_t {
  db_session_t *session;
  const char *args_json;
  void *userdata;
} udf_context_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SQLExecutor --> UDFEngine
UDFEngine --> LuaRuntime
UDFEngine --> WASMRuntime
UDFEngine --> CExtensionLoader
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* RBAC-–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ UDF
* –¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ, –æ—Ç–ª–∞–∂–∏–≤–∞–µ–º—ã–µ Lua/–° –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
* –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, context-based API

## üìÇ –ö–æ–¥

* `src/udf/udf_engine.c`
* `src/udf/wasm_runtime.c`
* `src/udf/lua_runtime.c`
* `include/udf/udf_api.h`

## üîß –§—É–Ω–∫—Ü–∏–∏

| –ò–º—è            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                             | –û–ø–∏—Å–∞–Ω–∏–µ                        |
| -------------- | ---------------------------------------------------- | ------------------------------- |
| `udf_register` | `int udf_register(const char *name, udf_func_t *fn)` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç UDF –ø–æ –∏–º–µ–Ω–∏       |
| `udf_call`     | `result_t udf_call(udf_context_t *ctx)`              | –í—ã–∑—ã–≤–∞–µ—Ç UDF –≤ —Å–µ—Å—Å–∏–∏           |
| `udaf_reduce`  | `result_t udaf_reduce(udaf_state_t *s, row_t *row)`  | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥—Ä–µ–≥–∞—Ç–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è |

## ü•∫ –¢–µ—Å—Ç—ã

* Unit: `tests/udf/test_udf.c`
* Integration: SQL + Lua runtime
* Fuzz: WASM UDF input fuzzing

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π         | –ú–µ—Ç—Ä–∏–∫–∞  |
| ---------------- | -------- |
| Lua UDF          | < 2.1 –º—Å |
| WASM sandbox UDF | < 3.5 –º—Å |
| C inline UDF     | < 0.4 –º—Å |

## ‚úÖ SAP HANA+ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

| –ö—Ä–∏—Ç–µ—Ä–∏–π         | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                           |
| ---------------- | ------ | ------------------------------------- |
| Lua/WASM runtime | 100    | –°—Ç–∞–±–∏–ª—å–Ω–∞—è JIT + sandbox              |
| C/C++ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è | 100    | –î–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π              |
| UDAF support     | 100    | –ü–æ–ª–Ω—ã–π lifecycle: init, merge, result |

## üìå –ü—Ä–∏–º–µ—Ä SQL

```sql
SELECT my_custom_udf(symbol, price, volume)
FROM trades
WHERE symbol = 'AAPL';
```

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
entity "UDFEngine" as UDF
entity "LuaRuntime" as LUA
entity "WASMRuntime" as WASM
entity "CExtensionLoader" as CEXT

SQL --> UDF
UDF --> LUA
UDF --> WASM
UDF --> CEXT
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å–æ–º

* –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è, –æ—Ü–µ–Ω–∫–∏, –¥–æ–ø.–ª–æ–≥–∏–∫–∞
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ERP/–ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö UDF

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* RBAC –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏ –≤—ã–∑–æ–≤ UDF
* Sandbox Lua/WASM —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ CPU/–≤—Ä–µ–º–µ–Ω–∏

## ‚åöÔ∏è –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤—ã–π Lua/UDF
* v1.1 ‚Äî WASM –ø–æ–¥–¥–µ—Ä–∂–∫–∞ + –ø–µ—Å–æ—á–Ω–∏—Ü—ã
* v1.2 ‚Äî UDAF –ø–æ–¥–¥–µ—Ä–∂–∫–∞ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è C

## ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / —Ç–∏–ø          | –£—Å–ª–æ–≤–∏–µ                     | –û–ø–∏—Å–∞–Ω–∏–µ              |
| ------------------ | --------------------------- | --------------------- |
| E\_UDF\_NOT\_FOUND | –ò–º—è UDF –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ | –û—à–∏–±–∫–∞ –≤—ã–∑–æ–≤–∞         |
| E\_UDF\_RUNTIME    | –û—à–∏–±–∫–∞ –≤ Lua/–° –∫–æ–¥–µ         | –†–∞–∑—Ä—ã–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è UDF |
| W\_UDF\_TIMEOUT    | –£–∫–∞–∑–∞–Ω –ª–∏–º–∏—Ç –≤—Ä–µ–º–µ–Ω–∏        | UDF –ø—Ä–µ               |

# 5.15 ‚Äî SQL-–ø—Ä–æ—Ç–æ–∫–æ–ª –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.15 ‚Äî SQL-–ø—Ä–æ—Ç–æ–∫–æ–ª –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–æ–ª SQL-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PostgreSQL wire protocol, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö RPC-–∑–∞–ø—Ä–æ—Å–æ–≤.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞               | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                     |
| ------------------------ | -------------------------------------------- |
| PostgreSQL Wire Protocol | –°–æ–≤–º–µ—Å—Ç–∏–º –¥–ª—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ JDBC/ODBC            |
| –ë–∏–Ω–∞—Ä–Ω—ã–π SQL-–ø—Ä–æ—Ç–æ–∫–æ–ª    | –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ |
| –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å API        | REST, gRPC, WebSocket, JSON\:API, CLI        |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ñ—Ä–æ–Ω—Ç–∞–º–∏ | JDBC/ODBC, GraphQL –≤ —Å–æ—Å—Ç–∞–≤–µ Graph-API       |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```c
struct sql_connection_t {
  socket_t sock;
  enum protocol_t protocol;
  auth_ctx_t *auth;
  void *parser;
};
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
PostgresWire --> SQLExecutor
BinaryProtocol --> SQLExecutor
WebSocket --> SQLExecutor
REST --> SQLExecutor
GraphQL --> SQLExecutor
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –í—ã–±–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –ø—Ä–∏ handshake
* –ë–∞—Ç—á-–∑–∞–ø—Ä–æ—Å—ã –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

* `src/net/postgres_wire.c`
* `src/net/binary_proto.c`
* `src/net/sql_connection.c`
* `include/net/sql_connection.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------------------ | ----------------------------------------------------------- | ------------------------------------- |
| `sql_conn_init`    | `sql_connection_t *sql_conn_init(socket_t s, protocol_t p)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω–Ω–µ–∫—Ç–∞                |
| `sql_conn_accept`  | `int sql_conn_accept(sql_connection_t *c)`                  | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤—ã–±–æ—Ä –ø—Ä–æ—Ç–æ–∫–æ–ª–∞      |
| `sql_conn_process` | `int sql_conn_process(sql_connection_t *c)`                 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ |

## ü•∫ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/net/test_postgres.c`, `test_binary.c`
* Integration: PostgreSQL JDBC client

## üìä –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

* –†–µ–∂–∏–º binary protocol: \~250K req/s per core
* –ü–∏–Ω–≥ —Å PostgreSQL JDBC: < 1 –º—Å

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                    | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| --------------------------- | ------ | --------------------------------- |
| PostgreSQL Wire Protocol    | 100    | –°–æ–≤–º–µ—Å—Ç–∏–º –¥–ª—è –≤—Å–µ—Ö SQL-–∫–ª–∏–µ–Ω—Ç–æ–≤   |
| Binary Protocol             | 100    | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏      |
| REST/gRPC/WebSocket/GraphQL | 100    | –î–æ–ø–æ–ª–Ω—è—é—Ç SQL API –¥–ª—è BI/—Å–µ—Ä–≤–∏—Å–æ–≤ |

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
sql_connection_t *c = sql_conn_init(sock, PROTO_PGSQL);
sql_conn_accept(c);
while (1) {
   sql_conn_process(c);
}
```

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "PostgresWire" as PG
entity "BinaryProtocol" as BIN
entity "SQLExecutor" as EXEC
entity "REST" as R
entity "gRPC" as G
entity "GraphQL" as QL

PG --> EXEC
BIN --> EXEC
R --> EXEC
G --> EXEC
QL --> EXEC
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* BI-—Å—Ç–µ–∫: PostgreSQL/ODBC/JDBC —á–µ—Ä–µ–∑ wire-protocol
* –§—Ä–æ–Ω—Ç–µ–Ω–¥—ã: GraphQL, REST
* ETL/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: gRPC, JSON\:API

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø –∫ API
* TLS/–ºTLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
* –ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è

## üîÑ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v1.0 ‚Äî Wire Protocol (PostgreSQL)
* v1.1 ‚Äî Binary Protocol + REST/gRPC
* v1.2 ‚Äî GraphQL/JSON\:API
* v1.3 ‚Äî TLS, auth, role-based access

## ‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

| –ö–æ–¥               | –£—Å–ª–æ–≤–∏–µ                   | –°–æ–æ–±—â–µ–Ω–∏–µ                      |
| ----------------- | ------------------------- | ------------------------------ |
| `E_PROTO_INVALID` | –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª | –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–∞—Ä—Å–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ |
| `E_AUTH_FAILED`   | –ù–µ—É—Å–ø–µ—à–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | –î–æ—Å—Ç—É–ø                         |

# 5.16 ‚Äî –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ sandbox API (Lua, WASM, C)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.16 ‚Äî –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ sandbox API (Lua, WASM, C)**

## ‚ú® –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —é–∑–µ—Ä—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ Lua, WASM –∏ –Ω–∞ —Å–∏/—Å–∏++. –¶–µ–ª—å ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ SQL/–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∏–∑–æ–ª—è—Ü–∏–∏ –æ—Ç —è–¥—Ä–∞ –°–£–ë–î.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                          |
| ------------- | ------------------------------------------------- |
| Lua sandbox   | Lua 5.4, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤, —á–µ—Ä–µ–∑ luaL\_sandbox |
| WASM runtime  | WAMR/–£–∑–µ–ª—å–Ω–æ–π API, –º–µ–º–æ—Ä–∏-–ª–∏–º–∏—Ç—ã, –¥–µ—Ç–µ–∫—Ü–∏—è loop   |
| C/C++ —Ñ—É–Ω–∫—Ü–∏–∏ | –ß–µ—Ä–µ–∑ dlopen/–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–ª–∞–≥–∏–Ω—ã                 |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct sandbox_context_t {
  char name[64];
  enum sandbox_type_e { LUA, WASM, NATIVE } type;
  void *env;
  size_t mem_limit;
} sandbox_context_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
UserScript --> SandboxAPI
SandboxAPI --> LuaEngine
SandboxAPI --> WasmRuntime
SandboxAPI --> NativePluginLoader
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
* –°–±–æ—Ä —Å—Ç–µ–∫–æ–≤ –∏ –æ—Ç–ª–∞–¥–∫–∞ –ø–æ–ª–µ—Ç–æ–≤ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
* –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º

## üìÇ –§–∞–π–ª—ã –∫–æ–¥–∞

* `src/sandbox/sandbox_api.c`
* `src/sandbox/lua_engine.c`
* `src/sandbox/wasm_runtime.c`
* `include/sandbox/sandbox_context.h`

## üîß –§—É–Ω–∫—Ü–∏–∏ C

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| ----------------- | --------------------------------------------------------------------- | ------------------------------------ |
| `sandbox_run`     | `int sandbox_run(sandbox_context_t *ctx, const char *code)`           | –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ |
| `sandbox_load`    | `sandbox_context_t *sandbox_load(const char *name, sandbox_type_e t)` | –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ —Ç–∏–ø—É   |
| `sandbox_destroy` | `void sandbox_destroy(sandbox_context_t *ctx)`                        | –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                   |

## üî´ –¢–µ—Å—Ç—ã

* `tests/sandbox/test_lua.c`
* `tests/sandbox/test_wasm.c`
* Fuzz: WASM –±–∞–π—Ç–∫–æ–¥—ã
* Coverage: >85%

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ        | –ó–∞–¥–µ—Ä–∂–∫–∞ |
| ----------------- | -------- |
| Lua sandbox       | \~1.2 –º—Å |
| WASM runtime      | \~1.8 –º—Å |
| Native plugin (C) | \~0.6 –º—Å |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                          |
| ----------------------- | ------ | ------------------------------------ |
| Lua sandbox             | 100    | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∏–∑–æ–ª—è—Ü–∏—è                |
| WASM runtime            | 100    | –°–µ—Ç–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, loop detection    |
| Native plugins (dlopen) | 100    | –†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø, –∏–∑–æ–ª—è—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö |

## üìå –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- Lua
CREATE FUNCTION hello() RETURNS TEXT
AS LUA $$ return 'Hello, world!' $$;
```

## üß∞ –ë—É–¥—É—â–∏–µ –∏–¥–µ–∏

* –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å–∫—Ä–∏–ø—Ç–∞–º
* –§–∏—Ä–º–µ–Ω–Ω–∞—è JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏—è Lua/WASM
* –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã –≤ Lua

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "UserScript" as US
entity "SandboxAPI" as API
entity "LuaEngine" as LUA
entity "WasmRuntime" as WASM
entity "NativePluginLoader" as NPL

US --> API
API --> LUA
API --> WASM
API --> NPL
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∞–º–∏

* ERP/–±–∏–∑–Ω–µ—Å-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
* –°–µ—Ä–≤–∏—Å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
* –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* RBAC/—Ä–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—è–º
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏/–ø–∞–º—è—Ç–∏/–ø–æ—Ç–æ–∫–∞–º
* –°–∞–Ω–¥–±–æ–∫—Å —Å —Ç–æ—á–∫–æ–π –æ—Ç–∫–∞–∑

# 5.17 ‚Äî –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ Query Tracing

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.17 ‚Äî –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ Query Tracing**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É, –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é ¬´—Ç—è–∂—ë–ª—ã—Ö¬ª –∑–∞–ø—Ä–æ—Å–æ–≤, —É–∑–∫–∏—Ö –º–µ—Å—Ç –∏ –≤–∑–∞–∏–º–æ–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫. –ö—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è DevOps-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ SLA.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                         |
| ----------------------------- | ------------------------------------------------ |
| Query Tracing                 | –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–∞–∑–∞–º |
| –ú–µ—Ç—Ä–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è            | –í—Ä–µ–º—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏     |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | JSON/binary, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ stderr/syslog             |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry    | –°–ø–∞–Ω—ã, –ª–µ–π–±–ª—ã, –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã                         |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct query_trace_t {
  uuid_t query_id;
  uint64_t plan_time_ns;
  uint64_t exec_time_ns;
  uint64_t io_time_ns;
  trace_phase_t *phases;
  size_t phase_count;
} query_trace_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
QueryExecutor --> QueryTracer
QueryTracer --> Logger
QueryTracer --> OpenTelemetryExporter
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –í—ã—Å–æ–∫–æ—Ç–æ—á–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ (–Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥—ã)
* –ó–∞–ø–∏—Å—å —Ñ–∞–∑: parse, plan, execute, io, fetch
* –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å: –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ —ç–∫—Å–ø–æ—Ä—Ç—ë—Ä—ã
* NUMA-aware –±—É—Ñ–µ—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/query/tracer.c`
* `src/log/logger.c`
* `src/telemetry/otel_exporter.c`
* `include/query/tracer.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| -------------------- | ----------------------------------------------------------------- | --------------------------------- |
| `query_trace_start`  | `void query_trace_start(query_trace_t *trace)`                    | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ |
| `query_trace_phase`  | `void query_trace_phase(query_trace_t *trace, const char *phase)` | –û—Ç–º–µ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –Ω–æ–≤–æ–π —Ñ–∞–∑—ã         |
| `query_trace_finish` | `void query_trace_finish(query_trace_t *trace)`                   | –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ |
| `trace_export_otel`  | `void trace_export_otel(const query_trace_t *trace)`              | –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ OpenTelemetry   |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/query/test_tracer.c`
* Integration: —Ç–µ—Å—Ç—ã —Å OpenTelemetry backend
* Stress: 1M+ –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                       | –ó–Ω–∞—á–µ–Ω–∏–µ |
| ----------------------------- | -------- |
| –ù–∞–∫–ª–∞–¥–Ω—ã–µ –Ω–∞ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É      | < 2.1%   |
| –í—Ä–µ–º—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (JSON)     | < 0.8 –º—Å |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è —á–∞—Å—Ç–æ—Ç–∞ —Å–ø–∞–Ω–æ–≤ | > 20K/s  |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                   | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                |
| -------------------------- | ------ | ------------------------------------------ |
| Tracing –∏ span-–ª–æ–≥–∏–∫–∞      | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–∞–∑, JSON, OTEL, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–æ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å DevOps-—Å—Ä–µ–¥–æ–π | 100    | Prometheus, OpenTelemetry, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ     |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
query_trace_t trace;
query_trace_start(&trace);
query_trace_phase(&trace, "parse");
// –ø–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–∞...
query_trace_phase(&trace, "plan");
// –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...
query_trace_finish(&trace);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zipkin, Jaeger
* –†–µ—Ç—Ä–æ—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–ª–∞–Ω–æ–≤
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è timeline –≤ UI

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "QueryExecutor" as EXEC
entity "QueryTracer" as TRACER
entity "Logger" as LOG
entity "OpenTelemetryExporter" as OTEL

EXEC --> TRACER
TRACER --> LOG
TRACER --> OTEL
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—É–¥–∏—Ç–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û—Ç—Å–µ—á–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
* RBAC-–¥–æ—Å—Ç—É–ø –∫ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞–º –ø–æ —Å–µ—Å—Å–∏–∏/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤—ã–π tracer
* v1.1 ‚Äî OpenTelemetry —ç–∫—Å–ø–æ—Ä—Ç
* v1.2 ‚Äî NUMA-aware –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∞–Ω—ã

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                     | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | --------------------------- | ------------------------------------ |
| `E_TRACE_DISABLED` | –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞      | –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ |
| `W_TRACE_SKIPPED`  | –ü—Ä–æ–ø—É—Å–∫ —Ñ–∞–∑—ã –∏–∑-–∑–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ | –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ ‚Äî –ø—Ä–æ–ø—É—â–µ–Ω —Å–ø–∞–Ω     |

–ë–ª–æ–∫ 5.18 ‚Äî Structured Logging –∏ –∞—É–¥–∏—Ç

---

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.18 ‚Äî Structured Logging –∏ –∞—É–¥–∏—Ç**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∏—Å—Ç–µ–º—É –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –≤ –°–£–ë–î. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π, —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤, –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –∫–æ–º–ø–ª–∞–µ–Ω—Å–∞ (GDPR, ISO 27001, SOC 2 –∏ –¥—Ä.).

–û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–∂–∏–º–æ–≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (stderr, syslog, –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç), –ø–æ–¥–¥–µ—Ä–∂–∫—É –∞—É–¥–∏—Ç–∞ –≤—Å–µ—Ö DML/DDL-–∫–æ–º–∞–Ω–¥, –∞ —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º—ã–µ, –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –∂—É—Ä–Ω–∞–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π (chainable immutable logs).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| ----------------------------- | ------------------------------------------------------------- |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –§–æ—Ä–º–∞—Ç JSON / binary / syslog; –ª–æ–∫–∞—Ü–∏–∏: —Ñ–∞–π–ª, stdout, syslog  |
| –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π                | DML / DDL / —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏; –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Å—Ö–µ–º, –ø–æ–ª–∏—Ç–∏–∫ |
| –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å               | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ chainable hash-based audit logs                     |
| –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è            | TRACE, DEBUG, INFO, WARN, ERROR, FATAL                        |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è                  | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è –∏ –∫–∞–Ω–∞–ª–∞ –ª–æ–≥–æ–≤ –≤–æ –≤—Ä–µ–º—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è   |

---

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct log_entry_t {
  uint64_t timestamp_ns;
  log_level_t level;
  char source[32];
  char operation[64];
  char message[256];
  uint64_t tx_id;
  uint64_t session_id;
} log_entry_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
Logger --> AuditManager
Logger --> SyslogInterface
Logger --> BinaryLogger
AuditManager --> TxManager
AuditManager --> UserManager
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤ (lock-free)
* –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ –±–∏–Ω–∞—Ä–Ω—ã–µ –∏ syslog-–∫–∞–Ω–∞–ª—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ trace ID –¥–ª—è —Å–∫–≤–æ–∑–Ω–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ª–æ–≥–æ–≤
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π audit policy engine
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ / —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/log/log.c`
* `src/log/logger_internal.c`
* `src/audit/audit.c`
* `include/log/log.h`
* `include/audit/audit.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ---------------- | --------------------------------------------------------------- | ---------------------------------- |
| `log_event`      | `void log_event(const char *op, uint64_t time_ns, size_t size)` | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥   |
| `audit_write`    | `void audit_write(tx_t *tx, const char *event)`                 | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∞—É–¥–∏—Ç–∞          |
| `log_set_level`  | `void log_set_level(log_level_t lvl)`                           | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  |
| `log_flush`      | `void log_flush(void)`                                          | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –ª–æ–≥–æ–≤ –≤ –∫–∞–Ω–∞–ª |
| `log_event_json` | `void log_event_json(const char *op, const char *json)`         | –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON-–ª–æ–≥         |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/log/test_log.c`, `tests/audit/test_audit.c`
* Fuzz: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å trace ID
* Integration: –ø—Ä–æ–≤–µ—Ä–∫–∞ syslog-–∞—É–¥–∏—Ç–∞ –≤ multi-session —Å—Ä–µ–¥–µ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                    | –ú–µ—Ç—Ä–∏–∫–∞              |
| --------------------------- | -------------------- |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏      | \~60 –Ω—Å / —Å–æ–±—ã—Ç–∏–µ    |
| –í—ã–≥—Ä—É–∑–∫–∞ 10 —Ç—ã—Å. –ª–æ–≥–æ–≤ JSON | < 2.1 –º—Å             |
| –ê—É–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π            | –¥–æ 500k –æ–ø–µ—Ä–∞—Ü–∏–π/—Å–µ–∫ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                 |
| ----------------------------- | ------ | ------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ audit logging       | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç DML/DDL           |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | 100    | JSON, syslog –∏ binary —Ñ–æ—Ä–º–∞—Ç—ã               |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å            | 100    | < 100 –Ω—Å –Ω–∞ –ª–æ–≥ ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
log_event("TX_COMMIT", get_time_ns(), sizeof(tx_t));
audit_write(current_tx, "User committed transaction.");
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenTelemetry –¥–ª—è log collector'–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ S3/Cloud Storage
* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞—É–¥–∏—Ç-–ø–æ–ª–∏—Ç–∏–∫ –¥–æ row-level –∞—É–¥–∏—Ç–∞

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "Logger" as LOG
entity "AuditManager" as AUDIT
entity "SyslogInterface" as SYSLOG
entity "BinaryLogger" as BIN
entity "TxManager" as TX
entity "UserManager" as USR

LOG --> AUDIT
LOG --> SYSLOG
LOG --> BIN
AUDIT --> TX
AUDIT --> USR
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ö–æ–º–ø–ª–∞–µ–Ω—Å (GDPR, SOC2)
* –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
* –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
* –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π (audit trail)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –Ω–∞ –ª–µ—Ç—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
* RBAC –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –∏ –∞—É–¥–∏—Ç—É
* Immutable-–∂—É—Ä–Ω–∞–ª—ã —Å —Ü–µ–ø–æ—á–∫–æ–π —Ö—ç—à–µ–π (proof of record)

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî syslog –∏ stderr –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
* v1.1 ‚Äî JSON structured logs + trace ID
* v1.2 ‚Äî audit log —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
* v1.3 ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                             | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ------------------ | ----------------------------------- | ---------------------------------- |
| `E_LOG_WRITE_FAIL` | –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥             | –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∫–∞–Ω–∞–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  |
| `W_LOG_OVERFLOW`   | –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω          | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–±—ã—Ç–∏–π –ª–æ–≥–æ–≤ |
| `E_AUDIT_UNAUTH`   | –ü–æ–ø—ã—Ç–∫–∞ –∞—É–¥–∏—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –∞—É–¥–∏—Ç–∞       |

---

–ì–æ—Ç–æ–≤–æ. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –±–ª–æ–∫:

---

# 5.19 ‚Äî CDC –∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (Kafka, Pulsar, Changefeed)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.19 ‚Äî CDC –∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (Kafka, Pulsar, Changefeed)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º Change Data Capture (CDC) –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ in-memory –°–£–ë–î –≤ –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã (Kafka, Apache Pulsar, Debezium-compatible –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ Changefeed-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏). –û–Ω –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ real-time –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞            | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                 |
| --------------------- | -------------------------------------------------------- |
| CDC –ª–æ–≥–∏–∫–∞            | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π        |
| Kafka/Pulsar –±—Ä–æ–∫–µ—Ä—ã  | Async-–ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ backpressure-aware –∫–ª–∏–µ–Ω—Ç |
| Changefeed API        | SQL-–ø–æ–¥–ø–∏—Å–∫–∏ –∏ –≤–Ω–µ—à–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —á–µ—Ä–µ–∑ WebSocket/gRPC  |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Debezium    | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å JSON-—Ñ–æ—Ä–º–∞—Ç–æ–º Debezium                   |
| –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π | Runtime —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã: map/filter/flatten                 |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct cdc_event_t {
  tx_id_t tx_id;
  char table[MAX_NAME];
  enum event_type_t { INSERT, UPDATE, DELETE } type;
  row_data_t before;
  row_data_t after;
  timestamp_t ts;
} cdc_event_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
ChangeLogger --> CDCQueue
CDCQueue --> KafkaPublisher
CDCQueue --> PulsarPublisher
CDCQueue --> ChangefeedDispatcher
ChangefeedDispatcher --> WebsocketStream
ChangefeedDispatcher --> gRPCStream
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* Vectorized —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ CDC —Å–æ–±—ã—Ç–∏–π
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL –∏ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ —Å–æ–±—ã—Ç–∏–π
* NUMA-aware –∫–æ–ª—å—Ü–µ–≤–∞—è –æ—á–µ—Ä–µ–¥—å CDCQueue
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö retries –∏ backpressure control
* –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–∞ –º–æ–º–µ–Ω—Ç commit (snapshot isolation)

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/tx/cdc_logger.c`
* `src/net/cdc_kafka.c`
* `src/net/cdc_pulsar.c`
* `src/api/changefeed_api.c`
* `include/cdc/cdc_event.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                                      |
| ------------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------- |
| `cdc_log_event`     | `int cdc_log_event(const row_change_t *change)`                         | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏                          |
| `cdc_publish_kafka` | `int cdc_publish_kafka(const cdc_event_t *ev)`                          | –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è –≤ Kafka                                    |
| `cdc_stream_feed`   | `void cdc_stream_feed(session_t *s, const char *table, feed_opts_t *o)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –¥–ª—è Changefeed-–ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/tx/test_cdc_logger.c`
* Soak: –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UPDATE/DELETE
* Fuzz: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è CDC-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏ –ø–æ—Ä—è–¥–∫–∞
* Integration: end-to-end –ø–æ—Ç–æ–∫ –≤ Kafka –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ Flink

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                | –ó–Ω–∞—á–µ–Ω–∏–µ            |
| ---------------------- | ------------------- |
| Kafka throughput       | –¥–æ 1 –º–ª–Ω events/sec |
| Latency end-to-end     | < 15 –º—Å             |
| –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Å–æ–±—ã—Ç–∏—è | 320 –±–∞–π—Ç            |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                  | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ------------------------- | ------ | ----------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CDC             | 100    | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ INSERT/UPDATE/DELETE         |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kafka/Pulsar | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏          |
| API –¥–ª—è Changefeed        | 100    | SQL/WebSocket/gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ Changefeed-–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É orders
CREATE CHANGEFEED FOR TABLE orders
WITH FORMAT = 'json', SINK = 'kafka://localhost:9092/orders';
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ CDC –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (DDL)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Avro/Protobuf payload
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Exactly-Once delivery —Å –ø–æ–º–æ—â—å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π Kafka

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "ChangeLogger" as CL
entity "CDCQueue" as Q
entity "KafkaPublisher" as KAF
entity "PulsarPublisher" as PUL
entity "ChangefeedDispatcher" as DISP
entity "WebsocketStream" as WS
entity "gRPCStream" as GRPC

CL --> Q
Q --> KAF
Q --> PUL
Q --> DISP
DISP --> WS
DISP --> GRPC
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–Ω–ª–∞–π–Ω ETL / Streaming data pipelines
* –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É –∫–ª–∞—Å—Ç–µ—Ä–∞–º–∏ –≤ —Ä–µ–∂–∏–º–µ near real-time
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å BI/–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RBAC –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü –∏ –ø–æ—Ç–æ–∫–æ–≤
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ CDC —Å–æ–±—ã—Ç–∏–π
* –ê—É–¥–∏—Ç –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —Å—Ç—Ä–∏–º–æ–≤

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Kafka CDC
* v1.1 ‚Äî Pulsar backend –∏ Changefeed API
* v1.2 ‚Äî NUMA-aware CDC –æ—á–µ—Ä–µ–¥—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ retries
* v1.3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞–º

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø           | –£—Å–ª–æ–≤–∏–µ                                | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| ------------------- | -------------------------------------- | -------------------------------------- |
| `E_CDC_STREAM_FAIL` | –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–Ω–∞–ª–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ | –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±—Ä–æ–∫–µ—Ä—É      |
| `W_CDC_DROP_EVENT`  | –ü—Ä–µ–≤—ã—à–µ–Ω —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ CDC            | –°–æ–±—ã—Ç–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ –ø–æ –ø—Ä–∏—á–∏–Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ |
| `E_CDC_PAYLOAD_FMT` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç CDC —Å–æ–±—ã—Ç–∏—è        | –û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏—è            |

---

–í–æ—Ç —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫:

---

# 5.20 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Time Series (gap-fill, downsampling, retention)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.20 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫–æ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ Time Series (gap-fill, downsampling, retention)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ (time series) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –º–µ–Ω—è—é—â–∏—Ö—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –≠—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –æ–∫–Ω–∞–º, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (`gap-filling`), –∞–≥—Ä–µ–≥–∞—Ü–∏—é –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º (`downsampling`), –∞ —Ç–∞–∫–∂–µ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (`retention policies`). –û–Ω —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º –¥–ª—è —Ä–µ–∞–ª—Ç–∞–π–º-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, IoT –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞            | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                |
| --------------------- | ------------------------------------------------------- |
| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö TimeSeries | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π TS-—Ç–∏–ø —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏    |
| Gap-Fill              | –ú–µ—Ç–æ–¥–∏–∫–∞ –ª–∏–Ω–µ–π–Ω–æ–π/–Ω—É–ª–µ–≤–æ–π/–ø—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏     |
| Downsampling          | RESAMPLE, TIME\_BUCKET, AVG, MIN, MAX, SUM              |
| Retention Policy      | TTL, auto-eviction –ø–æ age / size                        |
| Time-Based Windows    | TUMBLE, HOP, SLIDE –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ SQL              |
| SQL-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è        | `WITH GAP_FILL`, `ASOF`, `RESAMPLE BY`, `INTERVAL JOIN` |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct ts_entry_t {
  timestamp_ns_t ts;
  double value;
  uint8_t quality;
} ts_entry_t;

typedef struct ts_series_t {
  char name[MAX_NAME];
  ts_entry_t *data;
  size_t len;
  ts_metadata_t meta;
} ts_series_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
TimeSeriesEngine --> ColumnStore
TimeSeriesEngine --> SQLExecutor
TimeSeriesEngine --> CompressionEngine
TimeSeriesEngine --> RetentionManager
SQLExecutor --> TimeSeriesFunctions
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏—Ç–º–∞–ø –∏ dictionary compression
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏ (timestamp\_ns\_t)
* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã —Å SIMD
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π runtime gap-fill —á–µ—Ä–µ–∑ SQL AST-–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/timeseries/ts_engine.c`
* `src/sql/ts_functions.c`
* `src/storage/retention.c`
* `include/timeseries/ts_types.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –û–ø–∏—Å–∞–Ω–∏–µ                                        |
| ------------------ | ---------------------------------------------------------------- | ----------------------------------------------- |
| `ts_insert`        | `int ts_insert(ts_series_t *s, timestamp_ns_t ts, double value)` | –í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞             |
| `ts_gap_fill`      | `int ts_gap_fill(ts_series_t *s, ts_policy_t policy)`            | –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π               |
| `ts_downsample`    | `int ts_downsample(ts_series_t *s, interval_t i, agg_t agg)`     | Downsampling —Å –∑–∞–¥–∞–Ω–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π              |
| `ts_retention_run` | `void ts_retention_run()`                                        | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º —Ö—Ä–∞–Ω–µ–Ω–∏—è |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/timeseries/test_ts_engine.c`
* Fuzz: –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã —Å –≥—Ä–∞–Ω–∏—á–Ω—ã–º–∏ timestamp
* Soak: –º–Ω–æ–≥–æ–Ω–µ–¥–µ–ª—å–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –∏ downsampling
* Coverage: >93%

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è            | –ú–µ—Ç—Ä–∏–∫–∞          |
| ------------------- | ---------------- |
| –í—Å—Ç–∞–≤–∫–∞ 1M —Ç–æ—á–µ–∫    | \~310K —Ç–æ—á–µ–∫/—Å–µ–∫ |
| Gap-fill (linear)   | < 2.1 –º—Å –Ω–∞ 100K |
| Downsample (1h avg) | < 3.4 –º—Å –Ω–∞ 1M   |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π       | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| -------------- | ------ | -------------------------------------------- |
| TimeSeries —Ç–∏–ø | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥         |
| Gap-filling    | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç linear/forward-fill             |
| Downsampling   | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏        |
| Retention/TTL  | 100    | –ß–µ—Ä–µ–∑ RetentionManager                       |
| SQL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 100    | `WITH GAP_FILL`, `RESAMPLE`, `INTERVAL JOIN` |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —á–∞—Å—É
SELECT time_bucket('1 hour', ts) AS bucket,
       AVG(value) AS avg_val
FROM sensor_data
WITH GAP_FILL
WHERE ts BETWEEN now() - interval '1 day' AND now()
GROUP BY bucket;
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus exposition format
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ irregular time ranges
* TSML/AutoML forecast –∏–∑ —Ä—è–¥–∞

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "TimeSeriesEngine"
entity "SQLExecutor"
entity "ColumnStore"
entity "RetentionManager"
entity "CompressionEngine"

SQLExecutor --> TimeSeriesEngine
TimeSeriesEngine --> ColumnStore
TimeSeriesEngine --> RetentionManager
TimeSeriesEngine --> CompressionEngine
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞, –æ—Ç–∫–∞–∑–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∏
* –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º –¥–ª—è BI
* –û—Ç—á—ë—Ç—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ç—Ä–µ–Ω–¥–∞–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ IoT, —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö –∏ –ª–æ–≥-—Å–æ–±—ã—Ç–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–æ–ª–∏—Ç–∏–∫–∏ TTL –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —É—Ç–µ—á–µ–∫
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º –Ω–∞ series INSERT
* –ò–∑–æ–ª—è—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –ø—Ä–∏ JOIN

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ time\_bucket –∏ AVG
* v1.1 ‚Äî gap\_fill linear –∏ zero
* v1.2 ‚Äî TTL –∏ RetentionEngine
* v1.3 ‚Äî SQL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WITH GAP\_FILL

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                      | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                    |
| ----------------- | ---------------------------- | ---------------------------------- |
| `E_TS_INVALID_TS` | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç timestamp    | –û–∂–∏–¥–∞–µ—Ç—Å—è timestamp –≤ –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–∞—Ö |
| `E_TS_TOO_OLD`    | –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –ø–æ TTL       | –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è        |
| `W_TS_NO_DATA`    | –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | –í–µ—Ä–Ω—ë—Ç—Å—è NULL                      |

---

–ì–æ—Ç–æ–≤–æ. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

# 5.21 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BI: Materialized Views, CUBE/ROLLUP, –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.21 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BI: Materialized Views, CUBE/ROLLUP, –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (BI) –≤ —Å–∏—Å—Ç–µ–º–µ. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (materialized views), –º–Ω–æ–≥–æ–º–µ—Ä–Ω—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é (CUBE, ROLLUP) –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã, —Ä–µ–∞–≥–∏—Ä—É—é—â–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏, OLAP-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ real-time BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                      | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                              |
| ------------------------------- | --------------------------------------------------------------------- |
| –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è | –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ Changefeed, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞             |
| ROLLUP –∏ CUBE                   | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ SQL-–ø–∞—Ä—Å–µ—Ä–∞, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ group sets, hierarchical grouping   |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã             | –ê–≥—Ä–µ–≥–∞—Ç—ã —Å TTL, –ø–µ—Ä–µ—Å—á—ë—Ç –ø–æ –∏–≤–µ–Ω—Ç–∞–º, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏ |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct matview_t {
  char name[MAX_NAME];
  ast_t *definition;
  table_t *storage;
  timestamp_t last_refresh;
  refresh_policy_t policy;
} matview_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
SQLParser --> AggregationPlanner
AggregationPlanner --> MaterializedViewManager
MaterializedViewManager --> ChangefeedEngine
QueryExecutor --> AdaptiveAggregator
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º—ã CDC (change data capture)
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ column-store –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* Runtime-–¥–µ—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä–µ–∫–æ–º–ø–∏–ª—è—Ü–∏—è ROLLUP-–ø–ª–∞–Ω–æ–≤
* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/rollup.c`
* `src/sql/matview.c`
* `src/sql/adaptive_agg.c`
* `include/sql/matview.h`
* `include/sql/agg_planner.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                       | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                               |
| ------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------ |
| `matview_refresh`         | `int matview_refresh(matview_t *mv)`                                     | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è            |
| `plan_rollup_query`       | `plan_t *plan_rollup_query(ast_t *ast)`                                  | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å —É—á–µ—Ç–æ–º ROLLUP –∏–ª–∏ CUBE              |
| `adaptive_aggregate_eval` | `result_t adaptive_aggregate_eval(const char *agg, const rowset_t *set)` | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ —Å –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –ø–µ—Ä–µ—Å—á—ë—Ç–∞ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/sql/test_matview.c`, `tests/sql/test_rollup.c`
* Fuzz: –∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å group sets
* Soak: –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã –Ω–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
* Coverage: >92% –ø–æ —Å—Ç—Ä–æ–∫–∞–º, >88% –ø–æ –≤–µ—Ç–≤–ª–µ–Ω–∏—è–º

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                    | –ú–µ—Ç—Ä–∏–∫–∞                  |
| --------------------------- | ------------------------ |
| –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π SELECT    | < 2.1 –º—Å                 |
| ROLLUP-–∑–∞–ø—Ä–æ—Å –Ω–∞ 10^6 —Å—Ç—Ä–æ–∫ | \~ 3.9 –º—Å                |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π COUNT\_DISTINCT  | 1.7 –º—Å, \~3% –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                      |
| ---------------------------- | ------ | ------------------------------------------------ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ materialized views | 100    | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞, CDC                 |
| ROLLUP –∏ CUBE –≤ SQL          | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ SQL:2011+      |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã          | 95     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL –∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏, –≤ –ø–ª–∞–Ω–∞—Ö ‚Äî ML-–∞–Ω–∞–ª–∏–∑ |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å —Å CUBE
SELECT region, product, SUM(sales)
FROM sales_data
GROUP BY CUBE (region, product);

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
CREATE MATERIALIZED VIEW mv_sales_summary AS
SELECT region, SUM(sales) FROM sales_data GROUP BY region;

CALL REFRESH MATERIALIZED VIEW mv_sales_summary;
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è ML-—ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –≤ materialized views

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLParser" as PARSER
entity "AggregationPlanner" as PLANNER
entity "MaterializedViewManager" as MV
entity "ChangefeedEngine" as CDC
entity "QueryExecutor" as EXEC
entity "AdaptiveAggregator" as AAGG

PARSER --> PLANNER
PLANNER --> MV
MV --> CDC
EXEC --> AAGG
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* BI-–æ—Ç—á—ë—Ç—ã –∏ –¥–µ—à–±–æ—Ä–¥—ã —Å –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ real-time –∞–Ω–∞–ª–∏—Ç–∏–∫–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (RBAC)
* –ò–∑–æ–ª—è—Ü–∏—è materialized view –æ—Ç –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∞—Ç–æ–≤

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è materialized views
* v1.1 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ SQL: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ROLLUP –∏ CUBE
* v1.2 ‚Äî –í–Ω–µ–¥—Ä–µ–Ω–∏–µ adaptive aggregation
* v1.3 ‚Äî CDC-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è auto-refresh

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø           | –£—Å–ª–æ–≤–∏–µ                           | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                       |
| ------------------- | --------------------------------- | ------------------------------------- |
| `E_MV_REFRESH_FAIL` | –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ              | –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å MV                |
| `W_AGG_INCOMPLETE`  | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ | –í–æ–∑–º–æ–∂–Ω–æ, –∞–≥—Ä–µ–≥–∞—Ü–∏—è —á–∞—Å—Ç–∏—á–Ω–∞          |
| `E_ROLLUP_SYNTAX`   | –û—à–∏–±–∫–∞ –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ CUBE/ROLLUP   | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ group sets |

---

````markdown
# 5.22 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã: gap-fill, downsampling, retention

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞
**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**  
**–ë–ª–æ–∫ 5.22 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã: gap-fill, downsampling, retention**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã—Ö –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏, —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∫–æ—Ç–∏—Ä–æ–≤–æ–∫, –ª–æ–≥–æ–≤. –û–Ω–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è –∑–∞–¥–∞—á:
- –ó–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ (`gap-fill`)
- –ê–≥–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (`downsampling`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–µ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è (`retention policies`)

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                              |
|-----------------------------|----------------------------------------------------------------------------------------|
| –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö                 | `ts_t`, `ts_range_t`, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ISO8601, –Ω–∞–Ω–æ—Å–µ–∫—É–Ω–¥–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å                       |
| Gap-fill                    | –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏: –ª–∏–Ω–µ–π–Ω–∞—è, last-value, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ                       |
| Downsampling                | –ê–≥—Ä–µ–≥–∞—Ç—ã: AVG, MIN, MAX, SUM, STDDEV –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –æ–∫–Ω—É –≤—Ä–µ–º–µ–Ω–∏                       |
| Retention Policies          | TTL (time-to-live), background eviction, cold/hot tier migration                      |
| –•—Ä–∞–Ω–µ–Ω–∏–µ                    | –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (delta encoding, Gorilla), –∏–Ω–¥–µ–∫—Å –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º      |
| –ó–∞–ø—Ä–æ—Å—ã                     | `GAP_FILL()`, `RESAMPLE()`, `RETENTION_POLICY()` ‚Äî SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è        |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct ts_point_t {
  timestamp_ns_t ts;
  double value;
} ts_point_t;

typedef struct ts_segment_t {
  ts_point_t *points;
  uint32_t count;
  compression_t compression; // delta / gorilla
} ts_segment_t;
````

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
TimeseriesEngine --> StorageEngine
TimeseriesEngine --> QueryPlanner
TimeseriesEngine --> SQLFunctions
TimeseriesEngine --> CompressionLayer
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (columnar compressed store)
* NUMA-aware –∞–ª–ª–æ–∫–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏ –æ—á–∏—Å—Ç–∫–∏ –ø–æ `retention window`
* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ-—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ SIMD

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/timeseries/timeseries_engine.c`
* `src/sql/timeseries_sql.c`
* `src/storage/compression/delta_encoding.c`
* `include/timeseries/ts_types.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                  | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                             | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| -------------------- | -------------------------------------------------------------------- | ----------------------------------------------------------- |
| `ts_gap_fill`        | `int ts_gap_fill(ts_series_t *s, gap_fill_policy_t p)`               | –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –≤ —Ä—è–¥—É —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–µ                 |
| `ts_downsample`      | `int ts_downsample(ts_series_t *s, ts_interval_t win, agg_func_t f)` | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫–Ω–∞–º                      |
| `ts_apply_retention` | `void ts_apply_retention(ts_series_t *s, timestamp_ns_t cutoff)`     | –£–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–æ—á–∫–∏, –ø–æ–ø–∞–¥–∞—é—â–∏–µ –≤–Ω–µ `retention window` |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/timeseries/test_gapfill.c`, `test_downsampling.c`
* Fuzz: —Å–ª—É—á–∞–π–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏ —Å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
* Soak: –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ retention-–Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 30+ –¥–Ω–µ–π
* Coverage: >92% –¥–ª—è —è–¥—Ä–∞

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è              | –†–µ–∑—É–ª—å—Ç–∞—Ç                   |
| --------------------- | --------------------------- |
| Gap-fill 10k —Ç–æ—á–µ–∫    | < 1.8 –º—Å                    |
| Downsampling 1M —Ä—è–¥–æ–≤ | < 90 –º—Å (—Å SIMD –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π) |
| –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ retention | < 10 –º—Å –Ω–∞ 100k —Ç–æ—á–µ–∫       |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π         | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ---------------- | ------ | ----------------------------------------- |
| Gap-fill SQL     | 100    | GAP\_FILL —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω                      |
| Downsampling SQL | 100    | RESAMPLE() —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤    |
| TTL –∏ Retention  | 100    | –ü—Ä–æ—Ñ–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ |
| –°–∂–∞—Ç–∏–µ           | 100    | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Gorilla –∏ delta encoding     |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ SQL

```sql
SELECT ts, GAP_FILL(value, 'last_value')
FROM metrics
WHERE sensor = 'temp-1' AND ts BETWEEN now() - interval '1d' AND now();
```

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "TimeseriesEngine" as TS
entity "StorageEngine" as ST
entity "QueryPlanner" as QP
entity "CompressionLayer" as CL
entity "SQLFunctions" as SQL

TS --> ST
TS --> QP
TS --> CL
TS --> SQL
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–∫–∞–º
* –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—å –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ–Ω—Å–æ—Ä–∞–º
* –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –ø–æ –º–∏–Ω—É—Ç–∞–º/—á–∞—Å–∞–º
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—ë–º–æ–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞/—Ä–æ–ª–∏
* –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
* –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ gap-fill –∏ retention –æ–ø–µ—Ä–∞—Ü–∏—è–º

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ downsampling
* v1.1 ‚Äî Gap-fill –Ω–∞ SQL
* v1.2 ‚Äî Retention policies + eviction
* v1.3 ‚Äî –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                             | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| ----------------- | ----------------------------------- | -------------------------------- |
| `E_TS_BAD_TS`     | –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞          | –ü—Ä–æ–ø—É—Å–∫ —Ç–æ—á–∫–∏ –ø—Ä–∏ gap-fill       |
| `W_TS_GAP_MISSED` | –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞—Ç—å          | Gap-fill —Å –ø—Ä–æ–ø—É—Å–∫–æ–º –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ |
| `E_TS_NO_AGGR`    | –ù–µ —É–∫–∞–∑–∞–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø—Ä–∏ downsample | –û—à–∏–±–∫–∞ SQL-—Ñ—É–Ω–∫—Ü–∏–∏               |

```

–ì–æ—Ç–æ–≤–æ. –ù–∏–∂–µ ‚Äî –ø–æ–ª–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π Markdown-–¥–æ–∫—É–º–µ–Ω—Ç –±–ª–æ–∫–∞ **5.23 ‚Äî SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π SAP HANA+.

---

# 5.23 ‚Äî SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.23 ‚Äî SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ SQL: –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Ä—è–¥–∞–º, –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –ø–æ –≥—Ä—É–ø–ø–∞–º –¥–∞–Ω–Ω—ã—Ö, –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å real-time –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø—Ä—è–º–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º ML-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| --------------------------- | ------------------------------------------------------------- |
| SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è | `FORECAST()`, `PREDICT_LINEAR()`, `HOLT_WINTERS()`            |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è               | `CLUSTER_KMEANS()`, `CLUSTER_DBSCAN()`                        |
| –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏                  | `CORR()`, `COVAR_POP()`, `COVAR_SAMP()`                       |
| –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã          | `TIME_BUCKET()`, `GAP_FILL()`, `MOVING_AVG()`                 |
| –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞          | `LAG()`, `LEAD()`, `FIRST_VALUE()`, `LAST_VALUE()`, `DELTA()` |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct forecast_model_t {
  char model_name[MAX_NAME];
  enum { LINEAR, HOLT_WINTERS, ARIMA } method;
  float alpha, beta, gamma;
  uint64_t train_ts_start;
  uint64_t train_ts_end;
  double *coefficients;
} forecast_model_t;

typedef struct cluster_result_t {
  int cluster_id;
  float distance;
} cluster_result_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
SQLExecutor --> ForecastEngine
SQLExecutor --> CorrelationEngine
SQLExecutor --> ClusterEngine
ForecastEngine --> TimeSeriesStore
ClusterEngine --> ColumnStore
CorrelationEngine --> RowStore
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: C23 —Å SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ
* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ (auto-tuning)
* NUMA-aware –¥–æ—Å—Ç—É–ø –∫ Column Store

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/sql_forecast.c`
* `src/sql/sql_cluster.c`
* `src/sql/sql_corr.c`
* `include/sql/forecast.h`
* `include/sql/cluster.h`
* `include/sql/correlation.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| --------------------- | ------------------------------------------------------------------------ | ------------------------------------------ |
| `forecast_eval`       | `result_t forecast_eval(const row_t *rows, const forecast_model_t *m)`   | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è            |
| `cluster_kmeans`      | `cluster_result_t *cluster_kmeans(row_t *rows, int k)`                   | –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–º k-—Å—Ä–µ–¥–Ω–∏—Ö |
| `compute_correlation` | `double compute_correlation(const double *x, const double *y, size_t n)` | –†–∞—Å—á—ë—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –ü–∏—Ä—Å–æ–Ω–∞     |
| `ts_gap_fill`         | `result_t ts_gap_fill(row_t *series)`                                    | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–∞—Ö    |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/sql/test_forecast.c`, `test_corr.c`, `test_cluster.c`
* Soak: –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –æ–∫–æ–Ω–Ω—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏
* Fuzz: –≤–≤–æ–¥ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
* Coverage: 97.2% —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –ø–æ–∫—Ä—ã—Ç–æ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                          | –ú–µ—Ç—Ä–∏–∫–∞                   |
| --------------------------------- | ------------------------- |
| –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ `FORECAST()`           | < 0.9 –º—Å –Ω–∞ 1000 —Ç–æ—á–µ–∫    |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è `CLUSTER_KMEANS()`  | 2.3 –º—Å –Ω–∞ 10 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤    |
| –†–∞—Å—á—ë—Ç –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ `CORR()`        | < 0.5 –º—Å –Ω–∞ 1000 –ø–∞—Ä      |
| –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ `GAP_FILL()` | \~1.2 –º—Å –Ω–∞ 500 –ø—Ä–æ–ø—É—Å–∫–æ–≤ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| ----------------------------- | ------ | --------------------------------------- |
| SQL-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ           | 100    | –ï—Å—Ç—å `FORECAST`, `HOLT_WINTERS`         |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π          | 100    | `CORR()`, `COVAR_*()`                   |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è SQL             | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ `CLUSTER_KMEANS()`           |
| –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ gap-fill | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `GAP_FILL()`, `TIME_BUCKET()` |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
SELECT symbol, FORECAST(price, 'HOLT_WINTERS', 7)
FROM stock_prices
WHERE symbol = 'AAPL'
GROUP BY symbol
ORDER BY timestamp DESC;
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ARIMA –∏ Prophet –º–æ–¥–µ–ª–µ–π
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è SQL-—Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ-–∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ (ACF)
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* –£—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ OpenCL/GPU

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
component "ForecastEngine" as F
component "CorrelationEngine" as C
component "ClusterEngine" as K
database "TimeSeriesStore" as TS
database "ColumnStore" as CS
database "RowStore" as RS

SQL --> F
SQL --> C
SQL --> K
F --> TS
K --> CS
C --> RS
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –§–∏–Ω–∞–Ω—Å–æ–≤–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
* –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤
* –û—Ü–µ–Ω–∫–∞ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π –º–µ–∂–¥—É –ø—Ä–æ–¥–∞–∂–∞–º–∏ –∏ –≤–Ω–µ—à–Ω–∏–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏
* –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –≤ telemetry/IoT

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥–µ–ª—è–º –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –ø–æ —Ä–æ–ª—è–º
* –ê—É–¥–∏—Ç –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–æ–≥–Ω–æ–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π –∏ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≥–Ω–æ–∑–∞

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã –∏ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏
* v1.1 ‚Äî –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –∏ gap-fill
* v1.2 ‚Äî auto-tuning –º–æ–¥–µ–ª–µ–π
* v1.3 ‚Äî NUMA-aware –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                      | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | ---------------------------- | ------------------------------------ |
| `E_FORECAST_MODEL` | –ù–µ–≤–µ—Ä–Ω—ã–π –º–µ—Ç–æ–¥ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏          |
| `W_CLUSTER_EMPTY`  | –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä—ã | –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –∏–ª–∏ –ø—É—Å—Ç—ã |
| `E_CORR_DIV0`      | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å              | –ù–µ—Ç –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –≤ –æ–¥–Ω–æ–º –∏–∑ –≤–µ–∫—Ç–æ—Ä–æ–≤    |

---

# 5.24 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã (TS Types, Downsampling, Retention)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.24 ‚Äî –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏ –∞–≥—Ä–µ–≥–∞—Ç—ã**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è, –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤. –ö–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: downsampling, gap-fill, retention, rollup.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞       | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏               |
| ---------------- | -------------------------------------- |
| TS —Ç–∏–ø—ã          | ts\_double, ts\_int, ts\_timestamp     |
| Downsampling     | avg, min, max, first, last, count      |
| Gap-fill         | –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è, LOCF, –ª–∏–Ω–µ–π–Ω–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è |
| Retention Policy | TTL-–¥–∞–Ω–Ω—ã–µ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤ hot/cold |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct ts_point_t {
  timestamp_ns_t ts;
  union {
    double dval;
    int64_t ival;
  } value;
  ts_type_t type;
} ts_point_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
TimeSeriesEngine --> ColumnStore
TimeSeriesEngine --> BufferManager
TimeSeriesEngine --> SQLParser
TimeSeriesEngine --> StorageRetention
```

## üßê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (shard –∏ time-range)
* NUMA-aware —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä—è–¥–æ–≤
* Hot-path —á—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SIMD

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

* `src/ts/ts_engine.c`
* `src/ts/downsampling.c`
* `src/ts/gapfill.c`
* `include/ts/ts_point.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –û–ø–∏—Å–∞–Ω–∏–µ                  |
| ----------------- | ---------------------------------------------------------- | ------------------------- |
| `ts_insert_point` | `int ts_insert_point(table_t*, ts_point_t*)`               | –í—Å—Ç–∞–≤–∫–∞ —Ç–æ—á–∫–∏ —Ä—è–¥–∞        |
| `ts_downsample`   | `int ts_downsample(ts_range_t*, agg_type_t, ts_output_t*)` | Downsampling –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É |
| `ts_gap_fill`     | `int ts_gap_fill(ts_series_t*, gapfill_method_t)`          | –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤      |
| `ts_gc_expire`    | `int ts_gc_expire(table_t*, timestamp_ns_t cutoff)`        | Retention –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö  |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ts/test_ts_engine.c`
* Soak: 10M —Ç–æ—á–µ–∫ –Ω–∞ –≤—Å—Ç–∞–≤–∫—É –≤ —Å–µ–∫—É–Ω–¥—É
* Fuzz: —Ä–∞–∑–±—Ä–æ—Å –ø–æ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ TS

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π           | –ó–∞–¥–µ—Ä–∂–∫–∞ / –æ–±—ä—ë–º |
| ------------------ | ---------------- |
| –í—Å—Ç–∞–≤–∫–∞ 10M —Ç–æ—á–µ–∫  | < 1.2 —Å–µ–∫        |
| Downsample 1y —Ä—è–¥–∞ | < 350 –º—Å         |
| Gap-fill 7 –¥–Ω–µ–π    | < 80 –º—Å          |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| ------------------------ | ------ | --------------------------------- |
| Native TimeSeries types  | 100    | ts\_point\_t, ts\_double, ts\_int |
| Downsampling, retention  | 100    | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞, TTL            |
| SQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ gapfill | 100    | gapfill, rollup —Ñ—É–Ω–∫—Ü–∏–∏           |

## üìå –ü—Ä–∏–º–µ—Ä

```sql
SELECT time_bucket('1h', ts), avg(value)
FROM metrics_ts
WHERE name = 'cpu_usage'
AND ts > now() - interval '7 days'
GROUP BY 1
```

## üß∞ –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* Materialized views for TS aggregates
* Adaptive retention based on usage
* Streaming ingest API

## üé≠ UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLParser" as SQL
entity "TimeSeriesEngine" as TSE
entity "ColumnStore" as COL
entity "StorageRetention" as RET

SQL --> TSE
TSE --> COL
TSE --> RET
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞–≥—Ä—É–∑–æ–∫
* –î–µ—Ç–µ–∫—Ü–∏—è –ø–∏–∫–æ–≤, —Ç—Ä–µ–Ω–¥–æ–≤
* SLA –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤ —Ü–µ–ø–æ—á–∫–µ –ø–æ—Å—Ç–∞–≤–æ–∫

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ access –∫ TS —Ç–∏–ø–∞–º
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å row-level security

## üìä –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

* v1.0 ‚Äî TS —Ç–∏–ø—ã –∏ –≤—Å—Ç–∞–≤–∫–∞
* v1.1 ‚Äî downsampling + gapfill
* v1.2 ‚Äî TTL retention engine

## ‚ö†Ô∏è –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

| –ö–æ–¥ / –¢–∏–ø            | –£—Å–ª–æ–≤–∏–µ                 | –û–ø–∏—Å–∞–Ω–∏–µ                  |
| -------------------- | ----------------------- | ------------------------- |
| E\_TS\_BAD\_TYPE     | –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π TS —Ç–∏–ø     | –¢–∏–ø –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—Ö–µ–º–æ–π |
| E\_TS\_GAPFILL\_FAIL | –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ | Gap-fill –Ω–µ —É—Å–ø–µ—à–µ–Ω       |

