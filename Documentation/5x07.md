# 5.7 ‚Äî –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Query Forecasting)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.7 ‚Äî –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (Query Forecasting)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ø–ª–∞–Ω–µ —Ç—Ä–µ–Ω–¥–æ–≤, —Ç–µ–Ω–¥–µ–Ω—Ü–∏–π, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –±–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –æ—Ü–µ–Ω–∫–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∏ SLA.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                      |
| -------------------- | --------------------------------------------- |
| SQL FORECAST —Ñ—É–Ω–∫—Ü–∏–∏ | FORECAST(), TREND(), TIME\_SERIES()           |
| –≠–∫–∑–µ–∫—å—é—Ç–æ—Ä SQL       | –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–º –∏ time series engine |
| Time Series Engine   | –∫–µ—à, —Å–æ–ø—Ä—è–∂–µ–Ω —Å —Ä–µ–∂–∏–º–æ–º scan & forecast       |

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct forecast_model_t {
  char name[MAX_MODEL_NAME];
  ts_method_t method;     // linear, exponential, holt-winters
  uint32_t horizon;       // –≥–æ—Ä–∏–∑–æ–Ω—Ç –ø—Ä–æ–≥–Ω–æ–∑–∞
  void *model_data;       // opaque
} forecast_model_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
ForecastEngine --> TimeSeriesEngine
SQLExecutor --> ForecastEngine
ForecastEngine --> ModelStorage
```

## üßê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ forecasting –ø–æ –æ–∫–Ω–∞–º SQL
* NUMA-aware –º–æ–¥–µ–ª–∏, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ forecast pipelines
* –∞–≤—Ç–æ-—Ç–µ—Å—Ç—ã —Ç–æ—á–Ω–æ—Å—Ç–∏

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/sql/sql_forecast.c`
* `src/forecast/forecast_engine.c`
* `include/forecast/forecast_model.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ------------------- | ------------------------------------------------------------------------ | -------------------------- |
| `forecast_eval`     | `result_t forecast_eval(db_session_t *s, forecast_model_t *m, row_t *r)` | –ø—Ä–æ–≥–Ω–æ–∑ –¥–∞–Ω–Ω—ã—Ö –ø–æ SQL –æ–∫–Ω—É |
| `forecast_train`    | `int forecast_train(forecast_model_t *m, const ts_series_t *series)`     | –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏ |
| `forecast_register` | `int forecast_register(const char *name, forecast_model_t *m)`           | —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏         |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/forecast/test_forecast_engine.c`
* Fuzz: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –Ω–∞ –≤–≤–æ–¥
* Integration: SQL-–∑–∞–ø—Ä–æ—Å—ã FORECAST

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è              | –ú–µ—Ç—Ä–∏–∫–∞   |
| --------------------- | --------- |
| FORECAST(–¥–Ω–∏ –Ω–∞–ø–µ—Ä–µ–¥) | < 2.1 –º—Å  |
| –æ–±—É—á–µ–Ω–∏–µ Holt-Winters | \~ 5.6 –º—Å |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                   | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| -------------------------- | ------ | --------------------------------- |
| SQL-–ø—Ä–æ–≥–Ω–æ–∑ –ø–æ time series | 100    | FORECAST(), TREND()               |
| Holt-Winters, linear model | 100    | –≤—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ –≤ forecast\_model\_t |

## üìå –ü—Ä–∏–º–µ—Ä SQL

```sql
-- –ü—Ä–æ–≥–Ω–æ–∑ –ø—Ä–æ–¥–∞–∂ –Ω–∞ –Ω–µ–¥–µ–ª—é
SELECT FORECAST(sales, 7 days) FROM revenue_ts WHERE region = 'EU';
```

## üß∞ UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity ForecastEngine
entity TimeSeriesEngine
entity SQLExecutor
entity ModelStorage

ForecastEngine --> TimeSeriesEngine
SQLExecutor --> ForecastEngine
ForecastEngine --> ModelStorage
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ø—Ä–æ–≥–Ω–æ–∑ —Å–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—É
* –æ—Ü–µ–Ω–∫–∞ –Ω–∞–≥—Ä—É–∑–æ–∫ –Ω–∞ OLAP-–∫–ª–∞—Å—Ç–µ—Ä
* —Ä–µ—à–µ–Ω–∏—è –ø–æ –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥—É –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–µ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RBAC-–¥–æ—Å—Ç—É–ø –∫ —Ñ–æ—Ä–µ–∫–∞—Å—Ç-–º–æ–¥–µ–ª—è–º
* –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
* –ø–æ–¥–ø–∏—Å—å –º–æ–¥–µ–ª–µ–π –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

## üìÖ –í–µ—Ä—Å–∏–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è

* v1.0 ‚Äî –±–∞–∑–æ–≤–∞—è SQL-FORECAST –ø–æ time series
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω Holt-Winters –º–µ—Ç–æ–¥
* v1.2 ‚Äî –æ—Ü–µ–Ω–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π + auto-test

## üöß –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

\| –ö–æ–¥ / —Ç–∏–ø       | –£—Å–ª–æ


