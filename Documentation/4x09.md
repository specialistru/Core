# üìò 4.9 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Webhooks –∏ REST-notify

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* –ü–∞–∫–µ—Ç 4 ‚Äî –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
* –ë–ª–æ–∫ 4.9 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Webhooks –∏ REST-notify

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Å–æ–±—ã—Ç–∏–π –∏–∑ –°–£–ë–î –≤–æ –≤–Ω–µ—à–Ω–∏–µ HTTP-—Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ Webhooks –∏ REST-—Å–æ–±—ã—Ç–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä—ã, workflow-—Å—Ü–µ–Ω–∞—Ä–∏–∏, –∞–ª–µ—Ä—Ç—ã, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ø—Ä–æ—á–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∞–∫—Ü–∏–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                              |
| ------------------- | ----------------------------------------------------- |
| Webhooks            | HTTP POST/PUT/DELETE, –æ—Ç–ø—Ä–∞–≤–∫–∞ JSON-—Å–æ–±—ã—Ç–∏–π           |
| REST-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ —Å–æ–±—ã—Ç–∏—è           |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ retry     | –†–µ—Ç—Ä–∞–π —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, idempotency keys |
| –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è | DDL/DML-—Å–æ–±—ã—Ç–∏—è, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã, –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏     |
| Queue buffering     | –û—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏                  |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct webhook_event_t {
    char *event_type;      // "INSERT", "UPDATE", "DELETE", "ALERT"
    char *resource;        // "orders", "users"
    json_t *payload;
    char *target_url;
    timestamp_t timestamp;
} webhook_event_t;

typedef struct webhook_subscription_t {
    char *resource;
    char *event_filter;
    char *url;
    bool enabled;
} webhook_subscription_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[Webhook Dispatcher] --> [HTTP Client Engine]
[Webhook Dispatcher] --> [Transaction Engine]
[Webhook Dispatcher] --> [DDL Notifier]
[Webhook Dispatcher] --> [Security Policy Engine]
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –í—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π HTTP-–∫–ª–∏–µ–Ω—Ç —Å keep-alive
* HMAC-–ø–æ–¥–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏–π, –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —á–∞—Å—Ç–æ—Ç–µ (rate limit), max size, JSON schema validate
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
* –†—É—á–Ω–æ–π resend —Å–æ–±—ã—Ç–∏–π, REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/net/webhook_dispatcher.c`
* `include/net/webhook_dispatcher.h`
* `src/net/http_client.c`
* `src/hooks/ddl_notifier.c`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                              | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ----------------------- | --------------------------------------------------------------------- | ------------------------------------- |
| `webhook_subscribe`     | `int webhook_subscribe(webhook_subscription_t *sub);`                 | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Å–æ–±—ã—Ç–∏–µ      |
| `webhook_send_event`    | `int webhook_send_event(webhook_event_t *evt);`                       | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤–æ –≤–Ω–µ—à–Ω–∏–π webhook |
| `webhook_resend_failed` | `int webhook_resend_failed(const char *resource, uint64_t since_ts);` | –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π  |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ
* Integration: –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã-–ø—Ä–∏—ë–º–Ω–∏–∫–∏, REST API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
* Soak: 72—á –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DML –∏ –∞–ª–µ—Ä—Ç–æ–≤
* Fuzz: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ JSON-–ø–æ–¥–ø–∏—Å–∫–∏, inject latency/errors

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* 100K —Å–æ–±—ã—Ç–∏–π/–¥–µ–Ω—å —Å <10 –º—Å —Å—Ä–µ–¥–Ω–µ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1000+ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤, –æ—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π –≤ –ø–∞–º—è—Ç–∏
* –†–µ—Ç—Ä–∞–π < 3% –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π              | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                   |
| --------------------- | ------ | --------------------------------------------- |
| Webhook API           | 90     | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π            |
| –ü–æ–¥–ø–∏—Å–∫–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è | 85     | –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º –∏ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π          |
| –ù–∞–¥—ë–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞     | 95     | –û—á–µ—Ä–µ–¥–∏, –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏, –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
webhook_subscription_t sub = {
  .resource = "orders",
  .event_filter = "INSERT",
  .url = "https://api.example.com/webhook/orders",
  .enabled = true
};
webhook_subscribe(&sub);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ CloudEvents –∏ –ø–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ WebSub
* –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π GraphQL Streaming –ø–æ–≤–µ—Ä—Ö webhook
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ payload –∏ –ø–æ–ª–∏—Ç–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üß∞ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö, –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏
* –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è workflow –≤ BPM/ERP —Å–∏—Å—Ç–µ–º–∞—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ URL, HTTPS only, –ø–æ–¥–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π (HMAC)
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –∏ —Ä–æ–ª–∏
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –æ–±—ä—ë–º—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Å–æ–±—ã—Ç–∏–π

## üßæ –°–æ–æ–±—â–µ–Ω–∏—è, –æ—à–∏–±–∫–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

* `ERR_WEBHOOK_TIMEOUT`
* `ERR_WEBHOOK_NOT_SUBSCRIBED`
* `WARN_WEBHOOK_RETRY_EXCEEDED`

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî Webhook insert/update/delete
* v1.1 ‚Äî –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è, —Ä–µ—Ç—Ä–∞–π –∏ –æ—á–µ—Ä–µ–¥—å
* v1.2 ‚Äî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è DDL, REST UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

## üìà UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "Webhook Engine" {
  class WebhookEvent {
    +event_type
    +resource
    +payload
    +target_url
  }
  class WebhookSubscription {
    +resource
    +event_filter
    +url
    +enabled
  }
  WebhookEvent --> HTTPClient
  WebhookEvent --> SubscriptionStore
}
@enduml
```
