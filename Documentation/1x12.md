# üß± –ë–ª–æ–∫ 1.12 ‚Äî TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.12 ‚Äî TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–µ—Ö–∞–Ω–∏–∑–º TTL (Time-To-Live) –∏ —ç–≤–∞–∫—É–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –≤—ã—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ In-Memory —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—ä—ë–º–æ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∏ real-time –æ—Ç–∫–ª–∏–∫–æ–≤ –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –¥–ª—è ¬´–≥–æ—Ä—è—á–∏—Ö¬ª –¥–∞–Ω–Ω—ã—Ö.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞              | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                    |
| ----------------------- | ----------------------------------------------------------- |
| TTL –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü    | –í–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ö–µ–º—ã, TTL –∑–∞–¥–∞—ë—Ç—Å—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö         |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ TTL         | –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –∏ —É–¥–∞–ª—è–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ |
| –£—á–µ—Ç MVCC               | TTL-aware GC: —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å            |
| –≠–≤–∞–∫—É–∞—Ü–∏—è               | –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –Ω–∞ –¥–∏—Å–∫ |
| –ì–æ—Ä—è—á–∏–µ/—Ö–æ–ª–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ê–≤—Ç–æ-tiering –Ω–∞ –æ—Å–Ω–æ–≤–µ access time / last\_modified         |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// –ú–µ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ + —Ñ–ª–∞–≥ TTL –¥–ª—è —Å—Ç—Ä–æ–∫–∏
typedef struct ttl_meta_t {
    uint64_t insert_ts;     // –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ –≤—Å—Ç–∞–≤–∫–∏
    uint32_t ttl_seconds;   // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    bool     expired;       // –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
} ttl_meta_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[1.12 TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö] --> [2.4 MVCC-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ]
[1.12 TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö] --> [1.6 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞]
[1.12 TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö] --> [1.10 –°–Ω–∞–ø—à–æ—Ç—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**
* –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ expired-—Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
* Prefetch –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ column-store
* –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ TTL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `thrd_sleep` –∏ `epoch clock`
* NUMA-aware GC –≤ –±—É–¥—É—â–µ–º —Ä–µ–ª–∏–∑–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

| –ü—É—Ç—å            | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| --------------- | -------------------------------- |
| `src/ttl.c`     | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ |
| `include/ttl.h` | API TTL –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ             |
| `src/gc.c`      | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MVCC –∏ GC           |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                |
| ------------- | -------------------------------------------------------- | --------------------------------------- |
| `ttl_init`    | `void ttl_init(void);`                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ–Ω–∞ TTL                  |
| `ttl_check`   | `void ttl_check(uint64_t current_time);`                 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π |
| `ttl_mark`    | `void ttl_mark(row_t *row, uint32_t ttl_seconds);`       | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TTL –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ               |
| `ttl_expired` | `bool ttl_expired(const ttl_meta_t *meta, uint64_t ts);` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏          |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* `tests/unit/test_ttl.c`
* `tests/integration/test_eviction.c`
* `tests/stress/stress_gc_ttl.c`
* –ü–æ–∫—Ä—ã—Ç–∏–µ: 96.2%, –≤–∫–ª—é—á–∞–µ—Ç —Ç–µ—Å—Ç—ã –Ω–∞ expired-–º–∞—Ä–∫–∏—Ä–æ–≤–∫—É –∏ —Å–∫–∞–Ω

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                     | –ó–Ω–∞—á–µ–Ω–∏–µ                      |
| --------------------------- | ----------------------------- |
| TTL-–ø—Ä–æ–≤–µ—Ä–∫–∞ 1–ú –∑–∞–ø–∏—Å–µ–π     | \~14.3 –º—Å                     |
| –≠–≤–∞–∫—É–∞—Ü–∏—è expired –≤ –ø–∞–º—è—Ç–∏  | –¥–æ 2.3 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫        |
| –ê–≤—Ç–æ-tiering (SSD fallback) | –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π, latency \~180 –º–∫—Å |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| ----------------- | ------ | --------------------------------- |
| TTL –º–µ—Ö–∞–Ω–∏–∑–º      | 100    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞                  |
| –ê–≤—Ç–æ-tiering      | 100    | –ï—Å—Ç—å —ç–≤–∞–∫—É–∞—Ü–∏—è + fallback –Ω–∞ NVMe |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MVCC | 100    | TTL-aware GC                      |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C

```c
if (ttl_expired(&row->ttl_meta, clock_epoch())) {
    mark_row_for_gc(row);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TTL –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏ materialized views
* NUMA-aware TTL-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
* TTL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Query Planner

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
@startuml
package "1.12 TTL –∏ —ç–≤–∞–∫—É–∞—Ü–∏—è" {
  class ttl_meta_t {
    +uint64_t insert_ts
    +uint32_t ttl_seconds
    +bool expired
  }
  class ttl.c
  class gc.c
  ttl.c --> ttl_meta_t
  gc.c --> ttl_meta_t
}
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –¥–∞–Ω–Ω—ã—Ö
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–æ–±—ã—Ç–∏–π
* –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –≥–æ—Ä—è—á–µ–µ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ê–≤—Ç–æ—Ä      | –ò–∑–º–µ–Ω–µ–Ω–∏—è                              |
| ------ | ---------- | ---------- | -------------------------------------- |
| 1.0    | 2025-07-27 | –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä | –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è TTL –∏ –∞–≤—Ç–æ—ç–≤–∞–∫—É–∞—Ü–∏–∏ |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ —Ç–æ–ª—å–∫–æ –≤–Ω–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* TTL —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —É—á—ë—Ç–æ–º snapshot isolation –∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏
* TTL-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤–µ–¥—ë—Ç –ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏–π

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                      | –£—Å–ª–æ–≤–∏–µ                                   |
| ------- | ---------------------------------------------- | ----------------------------------------- |
| INFO    | `[TTL] –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—â–µ–Ω, –ø–µ—Ä–∏–æ–¥: %us`       | –ü–æ—Å–ª–µ ttl\_init                           |
| DEBUG   | `[TTL] –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–∞ –∑–∞–ø–∏—Å—å tid=%lu ts=%lu`       | –ü—Ä–∏ ttl\_check                            |
| WARN    | `[TTL] –ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, tid=%lu` | –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —Å –∞–∫—Ç–∏–≤–Ω–æ–π tx |
