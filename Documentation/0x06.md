üß± –ì–æ—Ç–æ–≤ —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫:

---

# 6.1 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RBAC, ABAC, RLS, CLS)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.1 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RBAC, ABAC, RLS, CLS)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–æ–ª–µ–π –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º (RBAC), –∞—Ç—Ä–∏–±—É—Ç–∞–º (ABAC), –∞ —Ç–∞–∫–∂–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤ (RLS/CLS), —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –º–Ω–æ–≥–æ–∞—Ä–µ–Ω–¥–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                             |
| --------------------------- | -------------------------------------------------------------------- |
| –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (RBAC)       | –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, multiple role assignment               |
| –ê—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å (ABAC)  | Access Policy Engine —Å eval-—Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ predicate expression        |
| RLS (Row-Level Security)    | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –Ω–∞ —Å—Ç–∞–¥–∏–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ |
| CLS (Column-Level Security) | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞, –∑–∞–ø—Ä–µ—Ç —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º            |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct access_policy_t {
  char role[MAX_ROLE];
  char object[MAX_OBJECT];
  access_mode_t mode;    // READ, WRITE, EXEC
  char condition[MAX_EXPR]; // –ü—Ä–µ–¥–∏–∫–∞—Ç –¥–ª—è ABAC / RLS
} access_policy_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
Authentication --> AccessPolicyEngine
AccessPolicyEngine --> RBAC
AccessPolicyEngine --> ABAC
AccessPolicyEngine --> RLSFilter
AccessPolicyEngine --> CLSFilter
SQLExecutor --> RLSFilter
SQLExecutor --> CLSFilter
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (session-level attributes)
* –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º DSL
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫
* –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è overhead'–∞ —á–µ—Ä–µ–∑ inlined-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/rbac.c`
* `src/security/abac.c`
* `src/security/rls.c`
* `src/security/cls.c`
* `include/security/access_policy.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ------------------- | ------------------------------------------------------------------------ | ----------------------------------- |
| `check_rbac_access` | `bool check_rbac_access(user_t *u, const char *obj, access_mode_t m)`    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π    |
| `eval_abac_policy`  | `bool eval_abac_policy(session_t *s, const access_policy_t *p)`          | –û—Ü–µ–Ω–∫–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞ ABAC-–ø–æ–ª–∏—Ç–∏–∫–∏      |
| `apply_rls_filter`  | `query_plan_t *apply_rls_filter(session_t *s, const query_plan_t *plan)` | –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ RLS –≤ SQL-–ø–ª–∞–Ω   |
| `apply_cls_mask`    | `void apply_cls_mask(row_t *r, const cls_policy_t *p)`                   | –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ CLS –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_rbac.c`, `test_abac.c`, `test_rls.c`
* Fuzz: eval –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤
* Integration: –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è       | –ó–∞–¥–µ—Ä–∂–∫–∞          |
| -------------- | ----------------- |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ RBAC  | < 0.2 –º—Å          |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è RLS | < 0.5 –º—Å / –∑–∞–ø—Ä–æ—Å |
| –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ CLS | < 0.3 –º—Å / —Å—Ç—Ä–æ–∫–∞ |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| ------------------------ | ------ | -------------------------------------------- |
| RBAC                     | 100    | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –≤–∫–ª—é—á–∞—è –∏–µ—Ä–∞—Ä—Ö–∏–∏          |
| ABAC                     | 100    | –ü–æ–ª–∏—Ç–∏–∫–∏ —Å eval DSL                          |
| Row-Level Security (RLS) | 100    | –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è              |
| Column-Level Security    | 100    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–ø—Ä–µ—Ç—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π RLS
CREATE TABLE patients (
  id INT,
  name TEXT,
  diagnosis TEXT
) WITH RLS;

-- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY rls_patient_access
  ON patients
  FOR SELECT
  USING (user_department = department);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–ª–∏—Ç–∏–∫ RBAC/ABAC
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (valid from / to)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ IAM-—Å–∏—Å—Ç–µ–º–∞–º–∏ (LDAP, OAuth)

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "6.1 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" {
  class Authentication
  class AccessPolicyEngine
  class RBAC
  class ABAC
  class RLSFilter
  class CLSFilter
  class SQLExecutor

  Authentication --> AccessPolicyEngine
  AccessPolicyEngine --> RBAC
  AccessPolicyEngine --> ABAC
  AccessPolicyEngine --> RLSFilter
  AccessPolicyEngine --> CLSFilter
  SQLExecutor --> RLSFilter
  SQLExecutor --> CLSFilter
}
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ó–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (GDPR, HIPAA)
* –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –≤ SaaS-—Å—Ä–µ–¥–∞—Ö
* –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RLS/CLS –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
* –ü–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä—è–º–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –¥–∞–Ω–Ω—ã–º
* –í—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî RBAC + CLS
* v1.1 ‚Äî ABAC + –≤—ã—Ä–∞–∂–µ–Ω–∏—è
* v1.2 ‚Äî –ü–æ–ª–Ω—ã–π RLS + –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Å—Å–∏–∏
* v1.3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                   | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | ------------------------- | ------------------------------------ |
| `E_POLICY_DENIED`  | –ù–∞—Ä—É—à–µ–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ | –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ RBAC/RLS/CLS      |
| `E_RLS_FILTER_ERR` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—Ä–µ–¥–∏–∫–∞—Ç     | –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ |
| `W_CLS_MASKING`    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö       | –°—Ç–æ–ª–±–µ—Ü –±—ã–ª —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω    |

---

üõ° –°–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫:

---

# 6.2 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–º/–¥–∏—Å–∫–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ (TLS, TDE, Forward Secrecy)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.2 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –Ω–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–º/–¥–∏—Å–∫–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ (TLS, TDE, Forward Secrecy)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –ø–æ —Å–µ—Ç–∏, —Ç–∞–∫ –∏ –ø—Ä–∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ø–∞–º—è—Ç–∏ –∏ –Ω–∞ NVMe-–¥–∏—Å–∫–∞—Ö. –û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç TLS/mTLS –¥–ª—è —Å–µ—Ç–µ–≤–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü (TDE ‚Äî Transparent Data Encryption), –∞ —Ç–∞–∫–∂–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã —Å –ø—Ä—è–º–æ–π —Å–µ–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å—é (Forward Secrecy), —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∏ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                     |
| ------------------ | ------------------------------------------------------------ |
| TLS / mTLS         | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS 1.3 —Å mTLS, —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã |
| TDE                | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü WAL –∏ Snapshot —Å –ø–µ—Ä-—Ç–∞–±–ª–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏   |
| Forward Secrecy    | ECDHE + ephemeral session keys                               |
| –ö–ª—é—á–µ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | –ó–∞—â–∏—Ç–∞ –∫–ª—é—á–µ–π –≤ –ø–∞–º—è—Ç–∏, KMIP —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å                   |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct encryption_context_t {
  uint8_t master_key[32];
  uint8_t table_key[32];
  uint8_t iv[16];
  cipher_alg_t alg;
} encryption_context_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
Client <--> TLS_Engine
TLS_Engine --> CertificateStore
StorageEngine --> TDE_Encryptor
WALWriter --> TDE_Encryptor
SnapshotManager --> TDE_Encryptor
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AES-256-GCM / ChaCha20-Poly1305
* –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ AES-NI / AVX2
* –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –∫–ª—é—á–µ–π –≤ –ø–∞–º—è—Ç–∏ (zero-on-free)
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã –∫–ª—é—á–µ–π –∏ key rotation

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/tls_engine.c`
* `src/security/tde_encryptor.c`
* `src/security/keyvault.c`
* `include/security/encryption_context.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                      | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ------------------ | ------------------------------------------------------------- | ----------------------------------- |
| `tls_init_server`  | `int tls_init_server(const char *cert, const char *key)`      | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TLS-—Å–µ—Ä–≤–µ—Ä–∞           |
| `tde_encrypt_page` | `void tde_encrypt_page(page_t *p, encryption_context_t *ctx)` | –®–∏—Ñ—Ä—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –∑–∞–ø–∏—Å–∏         |
| `tde_decrypt_page` | `bool tde_decrypt_page(page_t *p, encryption_context_t *ctx)` | –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏     |
| `key_rotate_table` | `int key_rotate_table(const char *table)`                     | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_tls.c`, `test_tde.c`
* Integration: TLS handshake, WAL encrypted replay
* Soak: –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ TLS-—Å–µ—Å—Å–∏–∏, –º–∞—Å—Å–æ–≤–∞—è —Å–º–µ–Ω–∞ –∫–ª—é—á–µ–π

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                | –ú–µ—Ç—Ä–∏–∫–∞         |
| ----------------------- | --------------- |
| TLS Handshake (ECDHE)   | < 5.1 –º—Å        |
| WAL Encryption per page | \~1.8 ¬µs        |
| Decryption throughput   | >1.1 GB/s (AES) |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π        | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                 |
| --------------- | ------ | --------------------------- |
| TLS / mTLS      | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è      |
| TDE             | 100    | –ü–æ —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–º—É —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—é   |
| Forward Secrecy | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ECDHE        |
| Key management  | 100    | –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –∏ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã WAL
page_t *p = ...;
encryption_context_t ctx = get_encryption_ctx("orders");
tde_encrypt_page(p, &ctx);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HSM (Hardware Security Module)
* –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è TDE
* KMIP-–ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö Vault-—Å–∏—Å—Ç–µ–º

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "6.2 –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ" {
  [Client] <--> [TLS_Engine]
  [TLS_Engine] --> [CertificateStore]
  [StorageEngine] --> [TDE_Encryptor]
  [WALWriter] --> [TDE_Encryptor]
  [SnapshotManager] --> [TDE_Encryptor]
}
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ó–∞—â–∏—Ç–∞ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–∞–º: ISO 27001, GDPR, FIPS-140
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å BI/ETL-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–∏
* –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã
* –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ–ø—É—Å–∫–∞ –∫ –∫–ª—é—á–∞–º: RBAC –∏ –∑–æ–Ω—ã –¥–æ–≤–µ—Ä–∏—è

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî TLS 1.2 / 1.3
* v1.1 ‚Äî TDE –¥–ª—è WAL + Snapshots
* v1.2 ‚Äî –≠—Ñ–µ–º–µ—Ä–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –∏ Forward Secrecy
* v1.3 ‚Äî AES-NI —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∏ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                        | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏              |
| ------------------ | ------------------------------ | ---------------------------- |
| `E_TLS_HANDSHAKE`  | –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è TLS-—Å–µ—Å—Å–∏–∏ | –ù–µ–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏–ª–∏ –∫–ª—é—á |
| `E_TDE_ENCRYPTION` | –û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã     | –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ IV |
| `W_KEY_ROTATION`   | –ò—Å—Ç–µ–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞      | –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π     |

---

````markdown
# 6.3 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞: RBAC / ABAC / –ü–æ–ª–∏—Ç–∏–∫–∏ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞
**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**  
**–ë–ª–æ–∫ 6.3 ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞: RBAC / ABAC / –ü–æ–ª–∏—Ç–∏–∫–∏ —É—Ä–æ–≤–Ω—è —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –º–æ–¥–µ–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –≤ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π In-Memory –°–£–ë–î. –í–∫–ª—é—á–∞–µ—Ç —Ä–æ–ª–∏ (RBAC), –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ (ABAC), —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤, —Ç–µ–º —Å–∞–º—ã–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –≥–∏–±–∫—É—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –º–æ–¥–µ–ª—å —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –≤ —É—Å–ª–æ–≤–∏—è—Ö –º—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω—ã—Ö —Å—Ä–µ–¥, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, GDPR, ISO 27001).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                                 |
|------------------------------|-------------------------------------------------------------------------------------------|
| Role-Based Access Control    | –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤, —Å–∫–æ—É–ø—ã (–≥–ª–æ–±–∞–ª—å–Ω—ã–π, —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–π, —Å—Ö–µ–º–Ω—ã–π)              |
| Attribute-Based Access Ctrl  | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ SQL/UDF –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞                    |
| Row-Level Security           | Predicate-—Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫–∏ (RLS), –∞–≤—Ç–æ–∏–Ω—ä–µ–∫—Ü–∏—è WHERE –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤     |
| Column-Level Security        | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ / —Å–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–ª–æ–Ω–æ–∫, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ SELECT, INSERT, UPDATE             |
| Policy Engine                | –†–∞—Å—à–∏—Ä—è–µ–º–∞—è DSL –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–∞—è –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–∏    |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```c
typedef struct access_policy_t {
    char name[MAX_NAME];
    access_scope_t scope; // GLOBAL, SCHEMA, TABLE
    policy_type_t type;   // RBAC, ABAC, RLS, CLS
    char expression[MAX_EXPR]; // SQL-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
} access_policy_t;
````

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
UserSession --> AccessControlEngine
AccessControlEngine --> RoleManager
AccessControlEngine --> PolicyEngine
PolicyEngine --> SQLParser
PolicyEngine --> UDFExecutor
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (pre-/post-authorization hooks)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç—É)
* NUMA-aware –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –≤–Ω–µ—à–Ω–∏–º–∏ IAM —á–µ—Ä–µ–∑ REST/gRPC
* –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ SQL (parse-time binding)

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/access_control.c`
* `src/security/policy_engine.c`
* `include/security/access_policy.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                          |
| ---------------------- | ---------------------------------------------------------------------- | --------------------------------- |
| `ac_check_permission`  | `bool ac_check_permission(db_session_t*, const char* object, op_t op)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—ä–µ–∫—Ç—É   |
| `ac_apply_rls_filters` | `bool ac_apply_rls_filters(query_t *q, const user_ctx_t *ctx)`         | –ò–Ω—ä–µ–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ |
| `policy_compile`       | `int policy_compile(const char* expr, policy_t* out)`                  | –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏     |
| `policy_eval`          | `bool policy_eval(policy_t*, row_t*, user_ctx_t*)`                     | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∏     |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit-—Ç–µ—Å—Ç—ã: `tests/security/test_access_control.c`
* Fuzz-—Ç–µ—Å—Ç—ã: –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫ (`policy_compile`)
* Soak-—Ç–µ—Å—Ç—ã: —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å 10K+ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏, –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç—ã
* Coverage: > 96%

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                       | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è |
| ------------------------------ | ------------- |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ RBAC                  | < 100 –Ω—Å      |
| –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ RLS –≤ –∑–∞–ø—Ä–æ—Å | < 1.2 –º–∫—Å     |
| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ABAC-–ø–æ–ª–∏—Ç–∏–∫–∏ —Å UDF | \~2.4 –º–∫—Å     |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π              | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                    |
| --------------------- | ------ | ---------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RBAC        | 100    | –ò–µ—Ä–∞—Ä—Ö–∏–∏, –ø—Ä–∏–≤—è–∑–∫–∞ —Ä–æ–ª–µ–π –∫ —Å—Ö–µ–º–∞–º –∏ —Å–µ—Å—Å–∏—è–º    |
| ABAC                  | 100    | –í—ã—Ä–∞–∂–µ–Ω–∏—è –≤ —Å—Ç–∏–ª–µ SQL/UDF, –ª–æ–≥–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫   |
| RLS/CLS               | 100    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, predicate-injection —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã  |
| –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫ | 100    | DSL-–ø–æ–¥–æ–±–Ω–∞—è –º–æ–¥–µ–ª—å, —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ IAM |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
CREATE POLICY salary_mask ON employees
FOR SELECT
USING (role() != 'HR') 
WITH COLUMN_MASK (salary = NULL);
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–∏—Ç–∏–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ row-level ownership-–ø–æ–ª–∏—Ç–∏–∫ (per user/tenant)
* –ü—Ä–µ–¥–∏–∫–∞—Ç—ã —Å ML/UDF –∞–Ω–∞–ª–∏–∑–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "UserSession"
entity "AccessControlEngine"
entity "RoleManager"
entity "PolicyEngine"
entity "SQLParser"
entity "UDFExecutor"

UserSession --> AccessControlEngine
AccessControlEngine --> RoleManager
AccessControlEngine --> PolicyEngine
PolicyEngine --> SQLParser
PolicyEngine --> UDFExecutor
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π, –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π –∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π
* –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∑–∞—Ä–ø–ª–∞—Ç—ã, —Ñ–∏–Ω–∞–Ω—Å—ã, –º–µ–¥–∏—Ü–∏–Ω–∞)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç–∏ (tenants) —Å —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫–≤–æ–∑–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (TDE) –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∏
* RBAC/ABAC –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª–∏—Ç–∏–∫ –≤ —Å—ç–Ω–¥–±–æ–∫—Å-–æ–∫—Ä—É–∂–µ–Ω–∏–∏

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî RBAC-–¥–≤–∏–∂–æ–∫
* v1.1 ‚Äî ABAC –≤—ã—Ä–∞–∂–µ–Ω–∏—è + UDF
* v1.2 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RLS/CLS
* v1.3 ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ IAM (OpenAPI)

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                     | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ----------------- | --------------------------- | ---------------------------------- |
| `E_AC_DENIED`     | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤           | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω        |
| `E_POLICY_SYNTAX` | –û—à–∏–±–∫–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ | –ù–µ–≤–∞–ª–∏–¥–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ               |
| `W_AC_NO_POLICY`  | –ù–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç      | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |

```

# 6.4 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (TLS / mTLS / JWT / TDE)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.4 ‚Äî –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (TLS / mTLS / JWT / TDE)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∑–∞—â–∏—Ç—É –∫–∞–Ω–∞–ª–∞ –∏ —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤, –≤–∫–ª—é—á–∞—è TLS 1.3, –≤–∑–∞–∏–º–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (mTLS), —Ç–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞ (JWT) –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ (TDE). –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–∞–∫ –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º RPC/SQL-—Ç—Ä–∞—Ñ–∏–∫–µ, —Ç–∞–∫ –∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                    |
| --------------------------------- | ----------------------------------------------------------- |
| TLS / mTLS                        | TLS 1.3 —Å ECDHE, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏      |
| JWT                               | –ü–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–æ–≤ (RS256), –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è         |
| Transparent Data Encryption (TDE) | AES-256-GCM, –∫–ª—é—á–∏ —á–µ—Ä–µ–∑ KMS, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ page-level         |
| API Access Layer                  | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ REST/gRPC/SQL, –ø–µ—Ä–µ—Ö–≤–∞—Ç—á–∏–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤          |
| Key Rotation                      | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–º–µ–Ω–∞ –∫–ª—é—á–µ–π, zero-downtime –∫–ª—é—á–µ–≤–æ–π rollover |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
// –ö–ª—é—á–∏ TLS
typedef struct tls_cert_t {
  char subject[256];
  uint8_t *cert_data;
  size_t cert_len;
} tls_cert_t;

// –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
typedef struct tde_key_metadata_t {
  uuid_t key_id;
  time_t created_at;
  bool active;
} tde_key_metadata_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
[Net API Layer] --> [TLS Handler]
[SQL Gateway] --> [JWT Validator]
[Storage Engine] --> [TDE Encryptor]
[Admin UI] --> [TLS Handler]
[TDE Encryptor] --> [KMS Interface]
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* OpenSSL –∏ BoringSSL —Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö HSM –∏ –≤–Ω–µ—à–Ω–µ–≥–æ KMS (AWS, Vault)
* Sandbox –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–ª—é—á–∞–º–∏
* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ü–µ–ø–æ—á–∫–∏ –¥–æ–≤–µ—Ä–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä–æ–≤

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/tls_handler.c`
* `src/security/tde.c`
* `src/security/jwt.c`
* `src/net/net_secure.c`
* `include/security/tls.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è              | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                         |
| ---------------- | ----------------------------------------------------------- | -------------------------------- |
| `tls_init`       | `int tls_init(const char *cert_path, const char *key_path)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TLS –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ |
| `jwt_validate`   | `bool jwt_validate(const char *token, const char *pubkey)`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT-—Ç–æ–∫–µ–Ω–∞              |
| `tde_encrypt`    | `int tde_encrypt(page_t *pg, tde_key_t *key)`               | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã—Ö       |
| `tde_rotate_key` | `int tde_rotate_key(uuid_t new_key_id)`                     | –ê—Ç–æ–º–∞—Ä–Ω–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞          |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_tls.c`, `test_tde.c`, `test_jwt.c`
* Integration: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ CLI/REST/gRPC —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
* Fuzz: –ø—Ä–æ–≤–µ—Ä–∫–∞ PEM/DER –≤—Ö–æ–¥–æ–≤ –∏ JWT-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
* Coverage: > 94%

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                  | –ú–µ—Ç—Ä–∏–∫–∞          |
| ------------------------- | ---------------- |
| TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ (avg)     | \~2.1 –º—Å         |
| JWT-–ø—Ä–æ–≤–µ—Ä–∫–∞              | < 0.4 –º—Å         |
| –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (TDE) | \~1.7 –º—Å –Ω–∞ 8 KB |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                       | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| ------------------------------ | ------ | ---------------------------------------- |
| TLS/mTLS                       | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ TLS  |
| JWT —Å —Ä–æ–ª—è–º–∏ –∏ —Å—Ä–æ–∫–æ–º –¥–µ–π—Å—Ç–≤–∏—è | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RS256 –∏ RBAC –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–æ–≤ |
| Transparent Data Encryption    | 100    | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü, key rollover, audit  |
| KMS/HSM                        | 90     | –ï—Å—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ     |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
// –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT –ø–µ—Ä–µ–¥ SQL-–∑–∞–ø—Ä–æ—Å–æ–º
if (!jwt_validate(token, public_key)) {
    return ERR_AUTH_FAILED;
}
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TLS 1.3 PSK
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π KMS —Å GUI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ discovery —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "Net API Layer" as API
entity "SQL Gateway" as SQL
entity "TLS Handler" as TLS
entity "JWT Validator" as JWT
entity "TDE Encryptor" as TDE
entity "KMS Interface" as KMS

API --> TLS
SQL --> JWT
TDE --> KMS
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
* –ó–∞—â–∏—Ç–∞ API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–µ–∫ –¥–æ–≤–µ—Ä–∏—è TLS
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –ø–æ –¥–∞—Ç–µ/—Å—É–±—ä–µ–∫—Ç—É
* –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –∏ –∂—É—Ä–Ω–∞–ª –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî TLS –∏ JWT
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TDE
* v1.2 ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º KMS

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                   | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ----------------- | ------------------------- | ------------------------------------ |
| `E_TLS_HANDSHAKE` | –û—à–∏–±–∫–∞ TLS                | –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ |
| `E_JWT_INVALID`   | –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω            | –¢–æ–∫–µ–Ω –ø–æ–¥–ø–∏—Å–∏ –Ω–µ –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É     |
| `W_KEY_ROTATE`    | –ò—Å—Ç—ë–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–ª—é—á–∞ | –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞             |

‚úÖ –ì–æ—Ç–æ–≤–æ: –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω **–±–ª–æ–∫ 6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Access Policies, Predicate Rules)** –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (SAP HANA+ grade).

---

# 6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Access Policies, Predicate Rules)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.6 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Access Policies, Predicate Rules)**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫, —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–µ–¥–∏–∫–∞—Ç–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞, —Ä–æ–ª—è—Ö, —Å–µ—Å—Å–∏–∏ –∏ –¥—Ä—É–≥–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–∞—Ö.

–ü–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—É—é –ø—Ä–æ—Å–ª–æ–π–∫—É –º–µ–∂–¥—É —É—Ä–æ–≤–Ω–µ–º –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω–µ—á–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—é –¥–æ—Å—Ç—É–ø–∞ –≤ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ä–µ–¥–∞—Ö.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                             |
| ---------------------------- | ------------------------------------------------------------------------------------ |
| Row-Level Security (RLS)     | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏: `CREATE POLICY ... USING predicate_expr`            |
| Column-Level Masking         | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤: `MASKED WITH expression`                                      |
| Predicate Injection          | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –≤ –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞                           |
| Policy Engine                | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞                                  |
| –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è      | –î–æ—Å—Ç—É–ø –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Ä–æ–ª–µ–π, –≤—Ä–µ–º–µ–Ω–∏, IP                      |
| –ê—Ç—Ä–∏–±—É—Ç—ã —Å–µ—Å—Å–∏–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ session variables –≤ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, `session_user`, `tenant_id`) |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å RBAC/ABAC    | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–æ–¥–µ–ª—è–º–∏ —Ä–æ–ª–µ–π –∏ –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è                                 |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct access_policy_t {
  char table[MAX_NAME];
  char role[MAX_ROLE];
  char predicate[MAX_EXPR];
  bool is_enabled;
  bool row_level;
  bool column_mask;
} access_policy_t;
```

–ü–æ–ª–∏—Ç–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
UserQuery --> SQLParser
SQLParser --> Optimizer
Optimizer --> PolicyEngine
PolicyEngine --> AuthContext
PolicyEngine --> SessionContext
```

* **PolicyEngine** –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å SQL-–ø–∞—Ä—Å–µ—Ä–æ–º –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–æ—Å—Ç—É–ø–∞.
* **AuthContext** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –µ–≥–æ —Ä–æ–ª—è—Ö.
* **SessionContext** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏.

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ù–∞–ø–∏—Å–∞–Ω –Ω–∞ **C23** (—è–¥—Ä–æ –¥–≤–∏–∂–∫–∞), —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **JIT-–ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤** –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ–≤–µ—Ä—Ö–µ–¥–∞.
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **NUMA-aware** –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫.
* –ü—Ä–µ–¥–∏–∫–∞—Ç—ã **–æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è –∏ –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è** –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Å–µ—Å—Å–∏—é.
* –ü–æ–ª–∏—Ç–∏–∫–∏ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ —Å–µ–≥–º–µ–Ω—Ç–µ shared-memory –∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ notifications.

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/policy_engine.c`
* `src/sql/predicate_injector.c`
* `src/session/session_context.c`
* `include/security/access_policy.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –û–ø–∏—Å–∞–Ω–∏–µ                                             |
| ---------------------- | ------------------------------------------------------------------ | ---------------------------------------------------- |
| `policy_eval_row`      | `bool policy_eval_row(row_t *r, access_policy_t *p, session_t *s)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç—Ä–æ–∫–∏ –∑–∞–¥–∞–Ω–Ω–æ–π –ø–æ–ª–∏—Ç–∏–∫–µ      |
| `policy_inject_pred`   | `ast_t *policy_inject_pred(ast_t *stmt, session_t *s)`             | –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç AST SQL-–∑–∞–ø—Ä–æ—Å–∞, –¥–æ–±–∞–≤–ª—è—è –ø—Ä–µ–¥–∏–∫–∞—Ç—ã     |
| `load_access_policies` | `int load_access_policies(void)`                                   | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞            |
| `policy_is_visible`    | `bool policy_is_visible(column_t *col, session_t *s)`              | –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å —Å—Ç–æ–ª–±—Ü–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–∞—Å–∫–æ–π |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit-—Ç–µ—Å—Ç—ã: `tests/security/test_policy_engine.c`
* Fuzzing: –ø—Ä–µ–¥–∏–∫–∞—Ç–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ AST-–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
* Integration: –ø—Ä–æ–≤–µ—Ä–∫–∞ RLS/CLS –Ω–∞ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
* Mutation testing: –ø–æ–¥–º–µ–Ω–∞ —É—Å–ª–æ–≤–∏–π –≤ –ø–æ–ª–∏—Ç–∏–∫–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                    | –ú–µ—Ç—Ä–∏–∫–∞   |
| --------------------------- | --------- |
| –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –ø–ª–∞–Ω   | < 120 –º–∫—Å |
| –û—Ü–µ–Ω–∫–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É  | < 100 –Ω—Å  |
| –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–∞        | < 90 –Ω—Å   |
| –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–∏—Ç–∏–∫ (1–ö+) | < 8 –º—Å    |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                    | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                       |
| --------------------------- | ------ | ------------------------------------------------- |
| Row-level security          | 100    | –ü–æ–ª–Ω–∞—è RLS, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è                  |
| Column masking              | 100    | –ï—Å—Ç—å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ä–æ–ª—è–º –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º           |
| Policy management API       | 100    | –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | 100    | –ü–æ–ª–∏—Ç–∏–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–∑—É –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è        |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ü–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ transactions
CREATE POLICY tenant_rls
  ON transactions
  FOR ROLE 'tenant_user'
  USING tenant_id = SESSION_USER_TENANT();

-- –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
ALTER TABLE payments
  ALTER COLUMN card_number MASKED WITH '****-****-****-' || RIGHT(card_number, 4);
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* UI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫ (–≤ web-–ø–∞–Ω–µ–ª–∏)
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –≤ –ø–ª–∞–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞)

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "UserQuery" as UQ
entity "SQLParser" as PARSER
entity "Optimizer" as OPT
entity "PolicyEngine" as POLICY
entity "SessionContext" as SC
entity "AuthContext" as AC

UQ --> PARSER
PARSER --> OPT
OPT --> POLICY
POLICY --> SC
POLICY --> AC
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
* –°–æ–±–ª—é–¥–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π GDPR, PCI-DSS, HIPAA
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —Ä–æ–ª—è–º –∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞–º (multi-tenant)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –í—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
* –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏
* –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–æ–º `SECURITY_ADMIN` –º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                |
| ------ | ---------------------------------------- |
| v1.0   | –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è RLS –∏ masking         |
| v1.1   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–∏ –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤ |
| v1.2   | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä   |
| v1.3   | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤ —á–µ—Ä–µ–∑ –≤—ã—Ä–∞–∂–µ–Ω–∏—è    |

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥                | –£—Å–ª–æ–≤–∏–µ                  | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| ------------------ | ------------------------ | ---------------------------------------------- |
| `E_POLICY_DENY`    | –ü—Ä–µ–¥–∏–∫–∞—Ç –ª–æ–∂–µ–Ω           | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–∏—Ç–∏–∫–µ              |
| `W_POLICY_MISSING` | –ù–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã | –¢–∞–±–ª–∏—Ü–∞ –±–µ–∑ –ø–æ–ª–∏—Ç–∏–∫, –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ |
| `E_MASK_EVAL`      | –û—à–∏–±–∫–∞ –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ –º–∞—Å–∫–∏ | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è            |

---

‚úÖ –ì–æ—Ç–æ–≤–æ: –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω **–±–ª–æ–∫ 6.7 ‚Äî –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Immutable Chain Logging, DML/DDL Audit)** –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (SAP HANA+ grade).

---

# 6.7 ‚Äî –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Immutable Chain Logging, DML/DDL Audit)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.7 ‚Äî –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (Immutable Chain Logging, DML/DDL Audit)**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º—É –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–≥–æ –∞—É–¥–∏—Ç–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –æ—Ç DDL-–∫–æ–º–∞–Ω–¥ –¥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö DML-–∑–∞–ø—Ä–æ—Å–æ–≤. –ê—É–¥–∏—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, GDPR, HIPAA, ISO/IEC 27001), –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∞—Ç–∞–∫.

–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **—Ü–µ–ø–æ—á–∫–∏ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã—Ö –ª–æ–≥–æ–≤ (immutable chain)**, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–π –Ω–∞ —Ö—ç—à-—Ü–µ–ø–æ—á–∫–∞—Ö, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π blockchain, –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–∏ –∂—É—Ä–Ω–∞–ª–∞.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                              |
| --------------------------- | --------------------------------------------------------------------- |
| DDL/DML –∞—É–¥–∏—Ç               | –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π CREATE, DROP, INSERT, UPDATE, DELETE             |
| Immutable chain log         | –•—ç—à-—Ü–µ–ø–æ—á–∫–∞ —Å –ø–æ–¥–ø–∏—Å—å—é –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ SHA-256 + –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ—à–ª–æ–≥–æ –±–ª–æ–∫–∞ |
| Audit event categorization  | –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: `SECURITY`, `DATA`, `DDL`, `DML`, `ACCESS`, `LOGIN`        |
| –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ                              |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ | –ü–æ–¥–∫–ª—é—á–∞–µ–º—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã: `syslog`, `SIEM`, `Kafka`                      |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RBAC           | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –≤ –º–æ–º–µ–Ω—Ç –¥–µ–π—Å—Ç–≤–∏—è                            |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct audit_log_entry_t {
  uint64_t timestamp_ns;
  audit_event_type_t type;
  char user[MAX_USER];
  char object[MAX_NAME];
  char action[MAX_ACTION];
  char details[MAX_DETAILS];
  uint8_t hash[32];       // SHA-256 —Ç–µ–∫—É—â–µ–≥–æ –±–ª–æ–∫–∞
  uint8_t prev_hash[32];  // –•–µ—à –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –±–ª–æ–∫–∞
} audit_log_entry_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
DBExecutor --> AuditLogger
SQLParser --> AuditLogger
SecurityEngine --> AuditLogger
AuditLogger --> FileSink
AuditLogger --> SyslogSink
AuditLogger --> SIEMSink
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ù–∞–ø–∏—Å–∞–Ω –Ω–∞ **C23**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **SHA-256 –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤: **in-memory**, **–∂—É—Ä–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª**, **stream output**
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—ã—Ö sink-–º–æ–¥—É–ª–µ–π** —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **lock-free –æ—á–µ—Ä–µ–¥—å** –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–∞ —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é
* –í—Å–µ —Ö–µ—à–∏ ‚Äî –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ–º—ã–µ, –∞—É–¥–∏—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω –≤–Ω–µ—à–Ω–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/audit_logger.c`
* `src/log/sha256.c`
* `include/security/audit_log_entry.h`
* `src/net/siem_export.c`
* `src/tools/audit_verifier.c`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ---------------------- | ---------------------------------------------------------------------------- | ------------------------------------- |
| `audit_log_write`      | `void audit_log_write(const audit_log_entry_t *entry)`                       | –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥         |
| `audit_chain_verify`   | `bool audit_chain_verify(const char *path)`                                  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ø–æ—á–∫—É –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å      |
| `audit_log_init`       | `int audit_log_init(const char *path, audit_mode_t mode)`                    | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∞—É–¥–∏—Ç–∞          |
| `audit_event_from_sql` | `audit_log_entry_t audit_event_from_sql(ast_t *stmt, db_session_t *session)` | –§–æ—Ä–º–∏—Ä—É–µ—Ç –∞—É–¥–∏—Ç-–∑–∞–ø–∏—Å—å –∏–∑ SQL-–∫–æ–º–∞–Ω–¥—ã |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit-—Ç–µ—Å—Ç—ã: `tests/security/test_audit_logger.c`
* Fuzz: –ø–æ–¥–¥–µ–ª—å–Ω—ã–µ / –∏—Å–∫–∞–∂—ë–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
* Integration: –∑–∞–ø—É—Å–∫ SQL —Å –∞—É–¥–∏—Ç–æ—Ä—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
* Audit replay: –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ü–µ–ø–æ—á–µ–∫ —Ö–µ—à–µ–π –Ω–∞ replay-—Å–∫—Ä–∏–ø—Ç–∞—Ö

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è               | –ú–µ—Ç—Ä–∏–∫–∞            |
| ---------------------- | ------------------ |
| –ó–∞–ø–∏—Å—å –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏    | < 5.3 –º–∫—Å          |
| –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ SHA-256    | \~650 –Ω—Å           |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–∫–∏ (10K) | \~12 –º—Å            |
| –≠–∫—Å–ø–æ—Ä—Ç –≤ Kafka        | < 3 –º—Å / —Å–æ–æ–±—â–µ–Ω–∏–µ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π            | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                          |
| ------------------- | ------ | ------------------------------------ |
| DDL/DML –∞—É–¥–∏—Ç       | 100    | –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è              |
| –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç | 100    | –•—ç—à-—Ü–µ–ø–æ—á–∫–∞, –≤–Ω–µ—à–Ω—è—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è     |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å    | 100    | Sink-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, async –∑–∞–ø–∏—Å—å |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM   | 100    | Kafka –∏ syslog –¥–æ—Å—Ç—É–ø–Ω—ã              |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ê—É–¥–∏—Ç–∏—Ä—É–µ–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
DELETE FROM clients WHERE id = 42;

-- –í –ª–æ–≥ –∑–∞–ø–∏—à–µ—Ç—Å—è:
-- user = 'alice', action = 'DELETE', object = 'clients', details = 'id=42'
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ü–µ–ø–æ—á–∫–∏ Merkle –¥–ª—è —à–∞—Ä–¥–∏–Ω–≥–∞
* –ê—É–¥–∏—Ç –≤—ã–∑–æ–≤–æ–≤ UDF –∏ –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
* –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, deadlock, resource usage

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLParser" as PARSER
entity "DBExecutor" as EXEC
entity "SecurityEngine" as SEC
entity "AuditLogger" as AUDIT
database "FileSink" as FILE
cloud "SyslogSink" as SYSLOG
cloud "SIEMSink" as SIEM

PARSER --> AUDIT
EXEC --> AUDIT
SEC --> AUDIT
AUDIT --> FILE
AUDIT --> SYSLOG
AUDIT --> SIEM
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º —Ä–µ–≥—É–ª—è—Ç–æ—Ä–æ–≤
* –ö—Ä–∏–º–∏–Ω–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
* –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –í—Å–µ –ª–æ–≥–∏ ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
* –ü–æ–¥–ø–∏—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ snapshot-–∞—É–¥–∏—Ç–∞—Ö
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤ –≤ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –∞—É–¥–∏—Ç-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                    |
| ------ | -------------------------------------------- |
| v1.0   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ –∞—É–¥–∏—Ç–∞ DDL/DML            |
| v1.1   | –•—ç—à-—Ü–µ–ø–æ—á–∫–∞ SHA-256                          |
| v1.2   | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SIEM/Kafka                      |
| v1.3   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ in-memory sink –∏ –≤–Ω–µ—à–Ω–µ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥                  | –£—Å–ª–æ–≤–∏–µ                        | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| -------------------- | ------------------------------ | ---------------------------------------------- |
| `E_AUDIT_WRITE`      | –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥            | –§–∞–π–ª –ª–æ–≥–∞ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω –∏–ª–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω            |
| `W_AUDIT_CHAIN_MISS` | –ù–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Ö–µ—à–µ–π             | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –∂—É—Ä–Ω–∞–ª–∞            |
| `E_SINK_DOWN`        | Sink (Kafka/syslog) –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è, –ø–∏—à–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ |

---

‚úÖ –ì–æ—Ç–æ–≤–æ: –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω **–±–ª–æ–∫ 6.8 ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ sandbox-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (Lua/WASM)** –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è SAP HANA+.

---

# 6.8 ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ sandbox-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (Lua/WASM)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.8 ‚Äî –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π –∏ sandbox-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (Lua/WASM)**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π**, –∞ —Ç–∞–∫–∂–µ **–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞ (UDF/UDAF)** –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Ö–Ω–∏–∫–∏ AST-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞, execution-sandbox –¥–ª—è Lua –∏ WASM, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–µ—Å—É—Ä—Å—ã –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö API, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –±–µ–∑ —Ä–∏—Å–∫–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                              |
| ---------------------------- | ----------------------------------------------------- |
| AST-–∞–Ω–∞–ª–∏–∑ SQL               | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–µ—Ä–µ–≤–∞ –∑–∞–ø—Ä–æ—Å–∞                     |
| Execution Sandbox            | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ Lua/WASM            |
| –†–µ—Å—É—Ä—Å–Ω—ã–µ –ª–∏–º–∏—Ç—ã             | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –ø–∞–º—è—Ç–∏, —Ñ–∞–π–ª–æ–≤—ã–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞–º |
| Allowed API Policies         | –ë–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π                       |
| RCE Protection               | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, fork, exec, mmap        |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UDF/UDAF           | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ sandbox-–æ–∫—Ä—É–∂–µ–Ω–∏–∏                 |
| –ö–æ–º–ø–∏–ª—è—Ü–∏—è WASM –≤ JIT-–º–∞—à–∏–Ω—É | –ß–µ—Ä–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π JIT-–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä                    |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct udf_sandbox_config_t {
  uint32_t max_memory_kb;
  uint32_t max_runtime_ms;
  bool allow_syscall;
  char allowed_api_list[MAX_API][64];
} udf_sandbox_config_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
SQLParser --> ASTInspector
UDFEngine --> SandboxManager
SandboxManager --> LuaRuntime
SandboxManager --> WASMRuntime
SecurityEngine --> SandboxManager
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* C23 + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **WASM3**, **Lua 5.4** –≤ —Ä–µ–∂–∏–º–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ API
* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è AST-–ø—Ä–æ–≤–µ—Ä–∫–∞: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã, –æ–ø–∞—Å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π sandbox: **STRICT**, **SAFE**, **TRUSTED**
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è syscall-blocking –Ω–∞ —É—Ä–æ–≤–Ω–µ WASM import table –∏ Lua hook
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/sandbox_manager.c`
* `src/udf/lua_runtime.c`
* `src/udf/wasm_runtime.c`
* `src/sql/ast_inspector.c`
* `include/security/sandbox_config.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                          | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| ---------------------- | ----------------------------------------------------------------- | -------------------------------------- |
| `sandbox_eval_wasm`    | `int sandbox_eval_wasm(const char *path, row_t *in, row_t *out)`  | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ WASM-–º–æ–¥—É–ª—è –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ     |
| `sandbox_eval_lua`     | `int sandbox_eval_lua(const char *script, row_t *in, row_t *out)` | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ Lua-–∫–æ–¥–∞         |
| `ast_check_injection`  | `bool ast_check_injection(ast_t *query)`                          | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é SQL-–∏–Ω—ä–µ–∫—Ü–∏—é |
| `sandbox_set_limits`   | `void sandbox_set_limits(udf_sandbox_config_t *cfg)`              | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏ |
| `register_allowed_api` | `int register_allowed_api(const char *api_name)`                  | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ API            |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_sandbox.c`
* Fuzz: —Å–∫—Ä–∏–ø—Ç—ã Lua/WASM —Å –≥—Ä–∞–Ω–∏—á–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏
* Stress: 10K –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö sandbox-–≤—ã–∑–æ–≤–æ–≤
* Coverage: 97.2% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                       | –ú–µ—Ç—Ä–∏–∫–∞  |
| ------------------------------ | -------- |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ AST-–∏–Ω—ä–µ–∫—Ü–∏–∏          | < 350 –Ω—Å |
| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Lua (—Å—Ä–µ–¥.)         | 1.7 –º—Å   |
| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ WASM (—Å—Ä–µ–¥.)        | 1.1 –º—Å   |
| –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–ø–∞—Å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ | < 400 –Ω—Å |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                           |
| ------------------------ | ------ | ----------------------------------------------------- |
| –ó–∞—â–∏—Ç–∞ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π   | 100    | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π AST-–∞–Ω–∞–ª–∏–∑ + –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ |
| Sandbox-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ UDF   | 100    | Lua/WASM –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –ø–µ—Å–æ—á–Ω–∏—Ü–µ                      |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ UDF | 100    | –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø–∞–º—è—Ç—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã                          |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è  | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –±–ª–æ–∫ syscalls –∏ API-—Ñ–∏–ª—å—Ç—Ä—ã                |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ sandbox UDF
SELECT my_sandboxed_udf(column1, column2)
FROM my_table
WHERE column3 > 100;
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WebAssembly SIMD –∏ threads
* –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è UDF-–ø–∞–∫–µ—Ç–æ–≤
* GraphQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∞—É–¥–∏—Ç–∞ UDF

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLParser" as SQL
entity "ASTInspector" as AST
entity "SandboxManager" as SM
entity "LuaRuntime" as LUA
entity "WASMRuntime" as WASM
entity "SecurityEngine" as SE

SQL --> AST
AST --> SM
SM --> LUA
SM --> WASM
SE --> SM
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –±–∏–∑–Ω–µ—Å-–∫–ª–∏–µ–Ω—Ç–æ–≤
* UDF-–æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è sandbox-—Ñ—É–Ω–∫—Ü–∏–π –≤ —Å–ª–æ–∂–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ I/O, —Ñ–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ exec
* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ WASM-–º–æ–¥—É–ª—è
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                |
| ------ | ---------------------------------------- |
| v1.0   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Lua-–ø–µ—Å–æ—á–Ω–∏—Ü—ã                 |
| v1.1   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WASM –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ä–µ—Å—É—Ä—Å–∞–º |
| v1.2   | AST-–∏–Ω—Å–ø–µ–∫—Ç–æ—Ä –¥–ª—è SQL-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞        |
| v1.3   | –ü–æ–¥–ø–∏—Å—å –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π           |

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥               | –£—Å–ª–æ–≤–∏–µ                       | –û–ø–∏—Å–∞–Ω–∏–µ                                 |
| ----------------- | ----------------------------- | ---------------------------------------- |
| `E_UDF_TIMEOUT`   | –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è | –°–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∑–∞ –æ—Ç–≤–µ–¥—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è |
| `E_UDF_FORBIDDEN` | –ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π API –≤—ã–∑–æ–≤        | –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–∑–æ–≤–∞ –∑–∞–ø—Ä–µ—â—ë–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏       |
| `W_UDF_HIGH_CPU`  | –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ CPU       | Sandbox —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç >90% CPU       |

---

‚úÖ –ì–æ—Ç–æ–≤–æ: –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –±–ª–æ–∫ **6.9 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –¥–≤–∏–∂–æ–∫ Access Policy Engine** –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è SAP HANA+.

---

# 6.9 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –¥–≤–∏–∂–æ–∫ Access Policy Engine

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.9 ‚Äî –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –¥–≤–∏–∂–æ–∫ Access Policy Engine**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Access Policy Engine (APE) ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫, —Å—Ç–æ–ª–±—Ü–æ–≤ –∏ —É—Å–ª–æ–≤–∏–π –∑–∞–ø—Ä–æ—Å–∞. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ SQL-–ø–ª–∞–Ω–∞—Ö, –∞ —Ç–∞–∫–∂–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏, –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞–º–∏ (ABAC, RBAC).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞              | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                            |
| ----------------------- | --------------------------------------------------- |
| Row-Level Security      | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –ø–æ user/role/attribute             |
| Column-Level Security   | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–∫—Ä—ã—Ç–∏–µ —Å—Ç–æ–ª–±—Ü–æ–≤                       |
| RBAC                    | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä–æ–ª–µ–≤–∫–∞, –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏                |
| ABAC                    | –ê—Ç—Ä–∏–±—É—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å (user.attr == X) |
| Policy DSL              | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏                |
| Enforcement Engine      | –ò–Ω–∂–µ–∫—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ AST SQL                         |
| Context-aware execution | –ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (tenant\_id, region, clearance)  |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct access_policy_t {
  char policy_id[64];
  policy_scope_t scope;      // ROW, COLUMN
  expr_ast_t *condition;     // AST –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
  char target_table[64];
  char target_column[64];    // optional
  char role[64];             // optional
} access_policy_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
SQLParser --> AccessPolicyEngine
AccessPolicyEngine --> ContextManager
AccessPolicyEngine --> RoleManager
AccessPolicyEngine --> ExpressionEvaluator
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ compile-time –∏ runtime enforcement
* –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ SQL AST —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ø–æ–ª–∏—Ç–∏–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ tenant isolation, multi-tenant-—Ä–µ–∂–∏–º
* Runtime context propagation (—á–µ—Ä–µ–∑ db\_session\_t)
* –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –≤ BPF-–ø–æ–¥–æ–±–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (–≤ –±—É–¥—É—â–µ–º)

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/access_policy_engine.c`
* `src/sql/sql_parser.c`
* `src/sql/policy_injector.c`
* `include/security/access_policy.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                | –û–ø–∏—Å–∞–Ω–∏–µ                                     |
| ----------------------- | ----------------------------------------------------------------------- | -------------------------------------------- |
| `policy_eval_ast`       | `void policy_eval_ast(ast_t *tree, db_session_t *s)`                    | –ò–Ω–∂–µ–∫—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –≤ –¥–µ—Ä–µ–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–∞        |
| `policy_register`       | `int policy_register(access_policy_t *p)`                               | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞           |
| `policy_list_for_user`  | `list_t *policy_list_for_user(const char *user, const char *table)`     | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º—ã—Ö –ø–æ–ª–∏—Ç–∏–∫          |
| `context_set_attribute` | `void context_set_attribute(db_session_t *s, const char *key, val_t v)` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_policy_engine.c`
* Soak: —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å 10k+ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
* Fuzz: AST-–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö SQL —à–∞–±–ª–æ–Ω–∞—Ö
* Integration: RLS+ABAC –Ω–∞ –º–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                     | –ú–µ—Ç—Ä–∏–∫–∞       |
| ---------------------------- | ------------- |
| –ò–Ω–∂–µ–∫—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –≤ AST       | \~ 400‚Äì600 –Ω—Å |
| –í—ã–±–æ—Ä–∫–∞ RLS+ABAC             | < 1.5 –º—Å      |
| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ | \~ 80‚Äì150 –Ω—Å  |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π              | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| --------------------- | ------ | ----------------------------------------- |
| Row-Level Security    | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫              |
| Column-Level Security | 100    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, —É—Å–ª–æ–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è         |
| ABAC-–ø–æ–¥–¥–µ—Ä–∂–∫–∞        | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ user-–∞—Ç—Ä–∏–±—É—Ç—ã |
| DSL –¥–ª—è –ø–æ–ª–∏—Ç–∏–∫       | 100    | –î–æ—Å—Ç—É–ø–µ–Ω –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å          |
| Runtime –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã     | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ per-session      |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ SQL
SELECT * FROM accounts
WHERE region = CURRENT_USER_CONTEXT('region')
  AND role = 'auditor';
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* JIT-–∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫ –≤ bytecode
* –ö–æ–Ω—Å–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ–ª–∏—Ç–∏–∫ (web)
* –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –Ω–∞ CDC –∏ –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLParser" as SQL
entity "AccessPolicyEngine" as APE
entity "ContextManager" as CTX
entity "RoleManager" as RM
entity "ExpressionEvaluator" as EE

SQL --> APE
APE --> CTX
APE --> RM
APE --> EE
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä–æ–∫–∞–º/–ø–æ–ª—è–º –ø–æ –æ—Ç–¥–µ–ª–∞–º
* –ó–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ç–∞–π–Ω—ã
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ –∏ –º—É–ª—å—Ç–∏-–∞—Ä–µ–Ω–¥—ã

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ê—É–¥–∏—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫
* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
* –û—Ç–∫–∞–∑ –æ—Ç "–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞" –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                              |
| ------ | -------------------------------------- |
| v1.0   | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RLS –∏ RBAC                   |
| v1.1   | ABAC –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–æ–ª–∏—Ç–∏–∫–µ            |
| v1.2   | Runtime –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ session-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ |
| v1.3   | DSL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫     |

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥                 | –£—Å–ª–æ–≤–∏–µ                         | –û–ø–∏—Å–∞–Ω–∏–µ                                    |
| ------------------- | ------------------------------- | ------------------------------------------- |
| `E_POLICY_DENIED`   | –ü–æ–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—Ä–µ—Ç–∏–ª–∞ –∑–∞–ø—Ä–æ—Å       | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º      |
| `W_POLICY_FALLBACK` | –ù–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã | –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è) |

---

‚úÖ –ü—Ä–∏–Ω—è—Ç–æ. –ü–µ—Ä–µ—Ö–æ–∂—É –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É.

---

# 6.10 ‚Äî –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç DML/DDL-–æ–ø–µ—Ä–∞—Ü–∏–π (Immutable Chain Logging)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.10 ‚Äî –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—É–¥–∏—Ç DML/DDL-–æ–ø–µ—Ä–∞—Ü–∏–π (Immutable Chain Logging)**

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (DML) –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î (DDL) –≤ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ñ—É—Ä–Ω–∞–ª —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ü–µ–ø–æ—á–∫—É –∑–∞–ø–∏—Å–µ–π —Å —Ö–µ—à-—Å–≤—è–∑—è–º–∏ (Immutable Chain), –ø–æ–∑–≤–æ–ª—è—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å, –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å –∏ –¥–æ–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –¥–ª—è —Ü–µ–ª–µ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (compliance), –æ—Ç–ª–∞–¥–∫–∏ –∏ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| ------------------- | ------------------------------------------------------------- |
| –ê—É–¥–∏—Ç DML           | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ INSERT/UPDATE/DELETE —Å –¥–µ—Ç–∞–ª—è–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π         |
| –ê—É–¥–∏—Ç DDL           | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CREATE/ALTER/DROP/GRANT –∏ –ø—Ä–æ—á–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π         |
| Immutable Chain     | –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤–∫–ª—é—á–∞–µ—Ç —Ö–µ—à –ø—Ä–µ–¥—ã–¥—É—â–µ–π (hash chaining)         |
| –ü–æ–¥–ø–∏—Å–∏ –∏ —Ö–µ—à–∏      | SHA-256 –ø–æ–¥–ø–∏—Å–∏ —Å–æ–±—ã—Ç–∏–π, —Ü–∏—Ñ—Ä–æ–≤–∞—è –Ω–µ–ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤–æ—Å—Ç—å          |
| –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π | –õ–æ–≥ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (append-only), –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct audit_log_entry_t {
  uint64_t entry_id;
  timestamp_t ts;
  char user[64];
  char operation[16]; // DML / DDL
  char object_name[64];
  char change_sql[512];
  uint8_t prev_hash[32];
  uint8_t curr_hash[32];
} audit_log_entry_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
DMLExecutor --> AuditLogger
DDLSchemaManager --> AuditLogger
AuditLogger --> HashEngine
AuditLogger --> StorageAppender
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –¶–µ–ø–æ—á–∫–∞ –∑–∞–ø–∏—Å–µ–π (hash chaining) —Å SHA-256
* –•–µ—à–∏ –∑–∞–ø–∏—Å–µ–π –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî tamper-proof
* –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ (thread-safe) –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
* –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–π update/delete

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/audit_logger.c`
* `src/sql/dml_executor.c`
* `src/sql/ddl_manager.c`
* `include/security/audit_log_entry.h`
* `src/crypto/sha256.c`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                      | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                                             |
| ------------------------ | ------------------------------------------------------------------------ | ---------------------------------------------------- |
| `audit_log_write`        | `int audit_log_write(db_session_t *s, const char *sql, const char *obj)` | –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –∞—É–¥–∏—Ç-–∂—É—Ä–Ω–∞–ª                      |
| `audit_log_init`         | `void audit_log_init(void)`                                              | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–µ—à-—Ü–µ–ø–æ—á–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ö–µ—à–∞ |
| `audit_log_verify_chain` | `bool audit_log_verify_chain(void)`                                      | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ü–µ–ø–æ—á–∫–∏ –ø–æ —Ö–µ—à–∞–º                |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_audit_logger.c`
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ DML/DDL –¥–æ–ª–∂–Ω—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è
* Fuzz: SQL –≤—Ö–æ–¥—ã –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–Ω–æ—Ç—É –ª–æ–≥–æ–≤
* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –∏–∑ –∂—É—Ä–Ω–∞–ª–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–µ—à–µ–π

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                | –ú–µ—Ç—Ä–∏–∫–∞                |
| ----------------------- | ---------------------- |
| –í—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª | \~1.5‚Äì2.0 –º–∫—Å          |
| –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏      | \~320‚Äì420 –Ω—Å           |
| –ü–æ–ª–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è      | < 45 –º—Å / 100K –∑–∞–ø–∏—Å–µ–π |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                   |
| ------------------------------------ | ------ | --------------------------------------------- |
| –ê—É–¥–∏—Ç –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π                  | 100    | DML –∏ DDL –ø–æ–ª–Ω–æ—Ü–Ω–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è                 |
| –ü–æ–¥–ø–∏—Å–∏ –∏ —Ö–µ—à–∏                       | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ SHA-256                 |
| –¶–µ–ø–æ—á–∫–∞ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π           | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ö–µ—à-—Ü–µ–ø–æ—á–∫–∞                    |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å—Ç–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RBAC/ABAC –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
audit_log_write(session, "INSERT INTO clients ...", "clients");
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è SELECT (optionally, –¥–ª—è compliance)
* –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –≤ SIEM-—Å–∏—Å—Ç–µ–º—ã
* –í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π

---

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "DMLExecutor" as DML
entity "DDLSchemaManager" as DDL
entity "AuditLogger" as AUDIT
entity "HashEngine" as HASH
entity "StorageAppender" as STORE

DML --> AUDIT
DDL --> AUDIT
AUDIT --> HASH
AUDIT --> STORE
@enduml
```

---

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö
* –î–æ–∫–∞–∑—É–µ–º–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–¥–º–µ–Ω—ã –∑–∞–ø–∏—Å–µ–π (non-repudiation)
* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º PCI DSS, GDPR, ISO 27001

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* Immutable chain ‚Äî –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏
* –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ä–æ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
* –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ –∑–∞–º–µ–Ω—ã –∂—É—Ä–Ω–∞–ª–∞

---

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                    |
| ------ | -------------------------------------------- |
| v1.0   | –ë–∞–∑–æ–≤—ã–π –∞—É–¥–∏—Ç DML/DDL                        |
| v1.1   | –•–µ—à-—Ü–µ–ø–æ—á–∫–∞ –Ω–∞ SHA-256                       |
| v1.2   | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ü–µ–ø–æ—á–∫–∏                 |
| v1.3   | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ (RBAC/ABAC) |

---

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥             | –£—Å–ª–æ–≤–∏–µ                      | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| --------------- | ---------------------------- | -------------------------------------- |
| `E_AUDIT_FAIL`  | –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –≤ –∂—É—Ä–Ω–∞–ª | –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏           |
| `W_CHAIN_BREAK` | –ù–∞—Ä—É—à–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ —Ö–µ—à–µ–π      | –í–æ–∑–º–æ–∂–Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–ª–∏ —Å–±–æ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è |

---

