# üß± –ë–ª–æ–∫ 8.2 ‚Äî –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∫–æ–Ω–≤–µ–π–µ—Ä—ã (Parallel Execution & Pipelines)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 8 ‚Äî –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* **–ë–ª–æ–∫:** 8.2 ‚Äî –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –∫–æ–Ω–≤–µ–π–µ—Ä—ã (Parallel Execution & Pipelines)

---

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ (CPU, NUMA). –ï–≥–æ —Ü–µ–ª—å ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ–≤—ã—Å–∏—Ç—å throughput –∏ —Å–Ω–∏–∑–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–∫ OLTP, —Ç–∞–∫ –∏ OLAP-–Ω–∞–≥—Ä—É–∑–∫–∏. –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (pipeline execution) —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å—Ç–∞–¥–∏–∏, –∏—Å–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏–ª–∏ –≤ –ø–æ—Ç–æ–∫–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                          |
| -------------------- | ------------------------------------------------- |
| Task Scheduler       | NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á, CPU pinning         |
| Execution Pipelines  | Stage-based –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ, handoff –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ |
| Vectorized Execution | –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–ª–æ–∫–∞–º–∏ –ø–æ 1024+ —Å—Ç—Ä–æ–∫ —Å SIMD           |
| Thread Pools         | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ OLTP/OLAP thread pools              |
| Adaptive Concurrency | Scale-out/scale-in –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞       |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct exec_pipeline_t {
  operator_t **stages;
  size_t stage_count;
  thread_pool_t *pool;
  bool vectorized;
} exec_pipeline_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
QueryPlanner --> ExecutionPipeline
ExecutionPipeline --> TaskScheduler
ExecutionPipeline --> VectorizedEngine
ExecutionPipeline --> ThreadPool
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* NUMA-aware –ø—Ä–∏–≤—è–∑–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –∏ –ø–∞–º—è—Ç–∏
* Minimal locking: lock-free –æ—á–µ—Ä–µ–¥–∏ –º–µ–∂–¥—É —Å—Ç–∞–¥–∏—è–º–∏
* –ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è: Producer/Consumer, Fusion
* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è L1/L2 –∫—ç—à–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/exec/pipeline.c`
* `src/exec/task_scheduler.c`
* `src/exec/vectorized_engine.c`
* `include/exec/pipeline.h`
* `include/exec/thread_pool.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è                     | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                              | –û–ø–∏—Å–∞–Ω–∏–µ                                         |
| ----------------------- | ----------------------------------------------------- | ------------------------------------------------ |
| `pipeline_create`       | `exec_pipeline_t *pipeline_create(plan_t *plan)`      | –°–æ–∑–¥–∞—ë—Ç pipeline –¥–ª—è –ø–ª–∞–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞               |
| `pipeline_execute`      | `void pipeline_execute(exec_pipeline_t *pipeline)`    | –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ                |
| `task_scheduler_submit` | `void task_scheduler_submit(task_t *t)`               | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ NUMA-aware –ø—É–ª               |
| `vectorized_execute`    | `void vectorized_execute(operator_t *op, batch_t *b)` | –ò—Å–ø–æ–ª–Ω—è–µ—Ç –æ–¥–Ω—É —Å—Ç–∞–¥–∏—é –≤ –≤–µ–∫—Ç–æ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/exec/test_pipeline.c`, `tests/exec/test_scheduler.c`
* Stress: 1M+ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
* Fuzz: pipeline stages –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
* Soak: —Å—É—Ç–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ mixed workload

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                  | –ó–Ω–∞—á–µ–Ω–∏–µ                         |
| ------------------------ | -------------------------------- |
| –°—Ä–µ–¥–Ω–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ (OLAP) | x12 –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å single-thread |
| –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è —è–¥–µ—Ä (24 CPU) | >95%                             |
| –í—Ä–µ–º—è –∫–æ–Ω–≤–µ–π–µ—Ä–∞ (OLTP)   | < 0.4 –º—Å                         |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π               | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| ---------------------- | ------ | --------------------------------------- |
| –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –±–∞–∑–µ —Å—Ç–∞–¥–∏–π –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ |
| NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ | 100    | CPU –∏ –ø–∞–º—è—Ç—å –∞–ª–ª–æ–∫–∞—Ü–∏—è –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç–∏   |
| –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è           | 100    | SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ batch processing      |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
exec_pipeline_t *pl = pipeline_create(plan);
pipeline_execute(pl);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ö–æ–Ω–≤–µ–π–µ—Ä—ã —Å –ø—Ä–µ–¥–∏–∫–∞—Ç–∏–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ —Å—Ç–∞–¥–∏–π
* Dynamically materialized –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –±—É—Ñ–µ—Ä—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPU pipeline execution (CUDA backend)

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "QueryPlanner" as QP
entity "ExecutionPipeline" as EP
entity "TaskScheduler" as TS
entity "VectorizedEngine" as VE
entity "ThreadPool" as TP

QP --> EP
EP --> TS
EP --> VE
EP --> TP
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å
* –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ CRM/ERP
* –ë—ã—Å—Ç—Ä–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏ join'—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–∫–∞—Ö

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü–æ—Ç–æ–∫–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–π
* –ù–µ—Ç —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É pipeline-—Å—Ç–∞–¥–∏—è–º–∏
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –ø–æ—Ç–æ–∫–æ–≤ (low-priv vs admin)

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî –±–∞–∑–æ–≤—ã–π pipeline engine
* v1.1 ‚Äî NUMA-aware –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
* v1.2 ‚Äî –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ L2-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø         | –£—Å–ª–æ–≤–∏–µ                       | –û–ø–∏—Å–∞–Ω–∏–µ                                     |
| ----------------- | ----------------------------- | -------------------------------------------- |
| `E_PIPELINE_FAIL` | –û—à–∏–±–∫–∞ –≤ —Å—Ç–∞–¥–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è    | –ö–æ–Ω–≤–µ–π–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ |
| `W_TASK_OVERLOAD` | –ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª-–≤–æ –∑–∞–¥–∞—á –≤ –ø—É–ª–µ | –ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–∑-–∑–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏            |
