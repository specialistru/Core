# üß± –ë–ª–æ–∫ 1.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–∞–±–ª–∏—Ü (catalog\_init)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

* **–ü–∞–∫–µ—Ç:** 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ
* **–ë–ª–æ–∫:** 1.6 ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–∞–±–ª–∏—Ü (catalog\_init)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–∞—Ç–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: —Å—Ö–µ–º—ã, —Ç–∏–ø—ã, –∏–Ω–¥–µ–∫—Å—ã, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–∏.
–§—É–Ω–∫—Ü–∏—è `catalog_init()` –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç in-memory —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–∞, –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                 |
| -------------------- | -------------------------------------------------------- |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | –í –ø–∞–º—è—Ç–∏, –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `catalog_t`                        |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü   | –ü–æ –∏–º–µ–Ω–∏, ID, —Ç–∏–ø—É –∏ —Ñ–ª–∞–≥–∞–º                              |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è           | B+ –¥–µ—Ä–µ–≤—å—è –∏ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞             |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å        | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `system-versioned`, `temporary`, `json` —Ç–∞–±–ª–∏—Ü |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct {
    table_t **tables;
    size_t table_count;
    hashmap_t *name_index;
    uint64_t catalog_version;
} catalog_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" #DDDDDD {
  [1.6 catalog_init] --> [1.1 config_init]
  [1.6 catalog_init] --> [1.5 snapshot_recovery]
  [1.6 catalog_init] --> [2.1 table_create]
  [1.6 catalog_init] --> [2.2 table_register]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –≥–æ—Ä—è—á–µ–º —Å–µ–≥–º–µ–Ω—Ç–µ
* –ó–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ read-write locks (–µ—Å–ª–∏ multi-thread init)
* –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ `catalog_version`
* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ `tables[]`

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/catalog.c`
* `include/catalog.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| ----------------- | ----------------------------------------- | ----------------------------------------- |
| catalog\_init     | `bool catalog_init(void);`                | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü |
| catalog\_free     | `void catalog_free(void);`                | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏                       |
| catalog\_get      | `table_t *catalog_get(const char *name);` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∏–º–µ–Ω–∏                |
| catalog\_register | `bool catalog_register(table_t *t);`      | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã                 |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/test_catalog.c`
* Fuzz-—Ç–µ—Å—Ç—ã: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
* Coverage: > 92%
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å `table_create`, `schema_validate`

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                   | –ó–∞–¥–µ—Ä–∂–∫–∞ (–Ω—Å) |
| -------------------------- | ------------- |
| –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∏–º–µ–Ω–∏ | < 300 ns      |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã        | < 1 –º–∫—Å       |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                            |
| ----------------------------- | ------ | -------------------------------------- |
| In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | 100    | –¢–æ–ª—å–∫–æ RAM, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –¥–∏—Å–∫—É      |
| –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ               | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `catalog_version` |
| –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø                | 100    | O(1) –ø–æ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ hash map           |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!catalog_init()) {
    log_error("catalog", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞");
    return false;
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ snapshot
* –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ UUID —Ç–∞–±–ª–∏—Ü
* –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –º–µ—Ç–∞-–∞—Ç—Ä–∏–±—É—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–ª–æ–Ω–æ–∫)

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class catalog_t {
  +table_t **tables
  +size_t table_count
  +hashmap_t *name_index
  +uint64_t catalog_version
}
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

–ö–∞—Ç–∞–ª–æ–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –±–∞–∑—ã: —Ç–∞–±–ª–∏—Ü, –∏—Ö –∫–æ–ª–æ–Ω–æ–∫, –∏–Ω–¥–µ–∫—Å–æ–≤. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ª—é–±—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π SELECT, INSERT, ANALYZE –∏ ALTER.

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v0.9: –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ (static array)
* v1.0: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç, hash-index, –≤–µ—Ä—Å–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –¢–∞–±–ª–∏—Ü—ã —Å —Ñ–ª–∞–≥–æ–º SYSTEM –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ superuser
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
* –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç                                       | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è                   |
| ------- | -------------------------------------------- | ----------------------------------- |
| INFO    | `[catalog] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞, –≤–µ—Ä. %lu` | –£—Å–ø–µ—à–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è              |
| ERROR   | `[catalog] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã: %s` | –°–±–æ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã |
| DEBUG   | `[catalog] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: %s`     | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π  |

