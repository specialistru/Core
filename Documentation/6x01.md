# 6.1 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RBAC, ABAC, RLS, CLS)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 6 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
**–ë–ª–æ–∫ 6.1 ‚Äî –ú–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (RBAC, ABAC, RLS, CLS)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–ª–∏—Ç–∏–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–æ–ª–µ–π –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª—è–º (RBAC), –∞—Ç—Ä–∏–±—É—Ç–∞–º (ABAC), –∞ —Ç–∞–∫–∂–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤ (RLS/CLS), —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –º–Ω–æ–≥–æ–∞—Ä–µ–Ω–¥–Ω—ã—Ö —Å—Ä–µ–¥–∞—Ö –∏ —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                             |
| --------------------------- | -------------------------------------------------------------------- |
| –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (RBAC)       | –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–æ–ª–µ–π, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, multiple role assignment               |
| –ê—Ç—Ä–∏–±—É—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å (ABAC)  | Access Policy Engine —Å eval-—Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ predicate expression        |
| RLS (Row-Level Security)    | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –Ω–∞ —Å—Ç–∞–¥–∏–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ |
| CLS (Column-Level Security) | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞, –∑–∞–ø—Ä–µ—Ç —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º            |

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct access_policy_t {
  char role[MAX_ROLE];
  char object[MAX_OBJECT];
  access_mode_t mode;    // READ, WRITE, EXEC
  char condition[MAX_EXPR]; // –ü—Ä–µ–¥–∏–∫–∞—Ç –¥–ª—è ABAC / RLS
} access_policy_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
Authentication --> AccessPolicyEngine
AccessPolicyEngine --> RBAC
AccessPolicyEngine --> ABAC
AccessPolicyEngine --> RLSFilter
AccessPolicyEngine --> CLSFilter
SQLExecutor --> RLSFilter
SQLExecutor --> CLSFilter
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (session-level attributes)
* –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º DSL
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫
* –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è overhead'–∞ —á–µ—Ä–µ–∑ inlined-–ø—Ä–µ–¥–∏–∫–∞—Ç—ã

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/security/rbac.c`
* `src/security/abac.c`
* `src/security/rls.c`
* `src/security/cls.c`
* `include/security/access_policy.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                 | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ------------------- | ------------------------------------------------------------------------ | ----------------------------------- |
| `check_rbac_access` | `bool check_rbac_access(user_t *u, const char *obj, access_mode_t m)`    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π    |
| `eval_abac_policy`  | `bool eval_abac_policy(session_t *s, const access_policy_t *p)`          | –û—Ü–µ–Ω–∫–∞ –ø—Ä–µ–¥–∏–∫–∞—Ç–∞ ABAC-–ø–æ–ª–∏—Ç–∏–∫–∏      |
| `apply_rls_filter`  | `query_plan_t *apply_rls_filter(session_t *s, const query_plan_t *plan)` | –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ RLS –≤ SQL-–ø–ª–∞–Ω   |
| `apply_cls_mask`    | `void apply_cls_mask(row_t *r, const cls_policy_t *p)`                   | –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ CLS –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/security/test_rbac.c`, `test_abac.c`, `test_rls.c`
* Fuzz: eval –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç–æ–≤
* Integration: –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è       | –ó–∞–¥–µ—Ä–∂–∫–∞          |
| -------------- | ----------------- |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ RBAC  | < 0.2 –º—Å          |
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è RLS | < 0.5 –º—Å / –∑–∞–ø—Ä–æ—Å |
| –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ CLS | < 0.3 –º—Å / —Å—Ç—Ä–æ–∫–∞ |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| ------------------------ | ------ | -------------------------------------------- |
| RBAC                     | 100    | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –≤–∫–ª—é—á–∞—è –∏–µ—Ä–∞—Ä—Ö–∏–∏          |
| ABAC                     | 100    | –ü–æ–ª–∏—Ç–∏–∫–∏ —Å eval DSL                          |
| Row-Level Security (RLS) | 100    | –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è              |
| Column-Level Security    | 100    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–ø—Ä–µ—Ç—ã –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ |

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π RLS
CREATE TABLE patients (
  id INT,
  name TEXT,
  diagnosis TEXT
) WITH RLS;

-- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏
CREATE POLICY rls_patient_access
  ON patients
  FOR SELECT
  USING (user_department = department);
```

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–ª–∏—Ç–∏–∫ RBAC/ABAC
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ (valid from / to)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ IAM-—Å–∏—Å—Ç–µ–º–∞–º–∏ (LDAP, OAuth)

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
package "6.1 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" {
  class Authentication
  class AccessPolicyEngine
  class RBAC
  class ABAC
  class RLSFilter
  class CLSFilter
  class SQLExecutor

  Authentication --> AccessPolicyEngine
  AccessPolicyEngine --> RBAC
  AccessPolicyEngine --> ABAC
  AccessPolicyEngine --> RLSFilter
  AccessPolicyEngine --> CLSFilter
  SQLExecutor --> RLSFilter
  SQLExecutor --> CLSFilter
}
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ó–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (GDPR, HIPAA)
* –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –≤ SaaS-—Å—Ä–µ–¥–∞—Ö
* –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RLS/CLS –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
* –ü–æ–ª–∏—Ç–∏–∫–∏ –Ω–µ–ª—å–∑—è –æ–±–æ–π—Ç–∏ –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä—è–º–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –¥–∞–Ω–Ω—ã–º
* –í—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è

## üïì –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0 ‚Äî RBAC + CLS
* v1.1 ‚Äî ABAC + –≤—ã—Ä–∞–∂–µ–Ω–∏—è
* v1.2 ‚Äî –ü–æ–ª–Ω—ã–π RLS + –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Å—Å–∏–∏
* v1.3 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏—Ç–∏–∫

## üõë –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

| –ö–æ–¥ / –¢–∏–ø          | –£—Å–ª–æ–≤–∏–µ                   | –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏                      |
| ------------------ | ------------------------- | ------------------------------------ |
| `E_POLICY_DENIED`  | –ù–∞—Ä—É—à–µ–Ω–∞ –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–æ—Å—Ç—É–ø–∞ | –ó–∞–ø—Ä–µ—â–µ–Ω–æ —Å–æ–≥–ª–∞—Å–Ω–æ RBAC/RLS/CLS      |
| `E_RLS_FILTER_ERR` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—Ä–µ–¥–∏–∫–∞—Ç     | –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —É—Å–ª–æ–≤–∏—è —Ñ–∏–ª—å—Ç—Ä–∞ |
| `W_CLS_MASKING`    | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö       | –°—Ç–æ–ª–±–µ—Ü –±—ã–ª —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω    |
