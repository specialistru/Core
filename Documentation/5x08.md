# 5.8 ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Data Clustering)

## üè¢ –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**–ü–∞–∫–µ—Ç 5 ‚Äî BI, ML –∏ OLAP**
**–ë–ª–æ–∫ 5.8 ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Data Clustering)**

## üåü –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã—è–≤–ª–µ–Ω–∏–µ —Å—Ö–æ–∂–∏—Ö –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø—É—Ç—ë–º –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ k-means, DBSCAN –∏ hierarchical clustering —Å SQL-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –≤—ã–∑–æ–≤–∞.

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                    |
| ----------------- | ------------------------------------------- |
| SQL-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | –§—É–Ω–∫—Ü–∏–∏: CLUSTER(), KMEANS(), DBSCAN()      |
| –ê–ª–≥–æ—Ä–∏—Ç–º—ã         | K-Means++, DBSCAN, Agglomerative Clustering |
| –û–±—Ä–∞–±–æ—Ç–∫–∞         | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ batch –∏ streaming –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏   |

## üíæ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

```c
typedef struct cluster_result_t {
  int cluster_id;
  float distance;
  row_t *input;
} cluster_result_t;
```

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```plantuml
SQLExecutor --> ClusterEngine
ClusterEngine --> KMeansLib
ClusterEngine --> DBSCANLib
ClusterEngine --> AggloClusterLib
```

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

* NUMA-aware —Ä–∞—Å—Å—á–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
* SIMD-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–π
* –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–µ—à –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/ml/clustering_engine.c`
* `src/sql/cluster_functions.c`
* `include/ml/cluster_result.h`

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –ò–º—è             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| --------------- | --------------------------------------------------------------------------- | ------------------------------------ |
| `cluster_eval`  | `result_t cluster_eval(db_session_t *s, row_t *r, const char *alg)`         | –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è —Å—Ç—Ä–æ–∫–∏ r |
| `cluster_batch` | `int cluster_batch(dataset_t *ds, const char *alg, cluster_result_t **out)` | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–∞—Ç—á-–Ω–∞–±–æ—Ä–æ–≤           |
| `cluster_init`  | `void cluster_init(void)`                                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞     |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit: `tests/ml/test_clustering_engine.c`
* Integration: `tests/sql/test_cluster_func.sql`
* Soak: –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü (10M+ —Å—Ç—Ä–æ–∫)

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è        | –ú–µ—Ç—Ä–∏–∫–∞  |
| --------------- | -------- |
| KMeans++ (100K) | \~9.8 –º—Å |
| DBSCAN (100K)   | \~22 –º—Å  |
| Agglo (50K)     | \~31 –º—Å  |

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ----------------- | ------ | ----------------------------------------- |
| SQL-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | 100    | CLUSTER(), KMEANS(), DBSCAN() —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã |
| Runtime –ø–æ–¥–¥–µ—Ä–∂–∫–∞ | 100    | SIMD, NUMA-aware                          |
| Batch + Streaming | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –∏ —Ä–µ–∂–∏–º–æ–≤  |

## üìå –ü—Ä–∏–º–µ—Ä SQL-–∫–æ–¥–∞

```sql
SELECT CLUSTER('kmeans', amount, age, region_id) FROM customers;
```

## üßå –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
* –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ HDBSCAN
* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

## üìä UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
entity "SQLExecutor" as SQL
entity "ClusterEngine" as CE
entity "KMeansLib" as KM
entity "DBSCANLib" as DB
entity "AggloClusterLib" as AG
SQL --> CE
CE --> KM
CE --> DB
CE --> AG
@enduml
```

## üîó –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥
* –ê–Ω–∞–ª–∏–∑ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –ö–ª–∞—Å—Ç–µ—Ä–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* RBAC-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–æ–¥–µ–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
* –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

## üïõ –í–µ—Ä—Å–∏–∏

* v1.0 ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è CLUSTER() –∏ KMeans
* v1.1 ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ DBSCAN
* v1.2 ‚Äî –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SIMD –∏ NUMA-aware

