# üÜî –ë–ª–æ–∫ 0.1 ‚Äî –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ `0.1 main()` —è–≤–ª—è–µ—Ç—Å—è **—Ç–æ—á–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** —Ä–∞–±–æ—Ç—ã –≤—Å–µ–π In-Memory –†–°–£–ë–î. –û–Ω –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –±–ª–æ–∫, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                      |
| ------------------- | ------------------------------------------------------------- |
| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è        | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è                      |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ         | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è syslog / stderr / –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è         |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ           | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL, snapshot, recovery                         |
| –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫         | –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è                 |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏          | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è REST/gRPC –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤                           |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è / –∫–≤–æ—Ä—É–º | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)                        |
| –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã   | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ SIGINT/SIGTERM, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

*–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç: –±–ª–æ–∫ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.*

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "0 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" {
  [0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)]
}

[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [1.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [2.1 MVCC-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [3.1 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [4.1 REST API / CLI]
[0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)] --> [7.1 –ú–µ—Ç—Ä–∏–∫–∏ –∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**
* –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤: `signal(SIGINT, handler)`
* NUMA-aware –∫–æ–Ω—Ç—Ä–æ–ª—å –≤ startup –ª–æ–≥–∏–∫–µ
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `thrd_t` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ñ–æ–Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (metrics, GC)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥–æ–≤ –∑–∞–ø—É—Å–∫–∞ (single-user / multi-user)

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```text
src/main.c
include/main.h
include/config.h
include/log.h
```

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏        | –ü—Ä–æ—Ç–æ—Ç–∏–ø                               | –û–ø–∏—Å–∞–Ω–∏–µ                                              |
| ------------------ | -------------------------------------- | ----------------------------------------------------- |
| `main`             | `int main(int argc, char **argv)`      | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∏ –ø–µ—Ç–ª—é —Å–æ–±—ã—Ç–∏–π |
| `log_startup_info` | `static void log_startup_info(void)`   | –õ–æ–≥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, PID, –ø–∞–º—è—Ç–∏       |
| `handle_signal`    | `static void handle_signal(int signo)` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç SIGINT/SIGTERM                           |
| `db_initialize`    | `bool db_initialize(void)`             | –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã                              |
| `db_shutdown`      | `void db_shutdown(void)`               | –ê–∫–∫—É—Ä–∞—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É                            |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                         | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω             |
| --------- | ------------------------------------------- | -------------------------- |
| Unit      | –ü—Ä–æ–≤–µ—Ä–∫–∞ `handle_signal`, `db_initialize`   | `tests/test_main.c`        |
| Soak      | –î–æ–ª–≥–∏–π –∑–∞–ø—É—Å–∫ —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π | `tests/soak/init_stress.c` |
| Fuzz      | –ü–µ—Ä–µ–¥–∞—á–∞ –º—É—Å–æ—Ä–∞ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö main           | `fuzz/fuzz_main_args.c`    |
| Coverage  | –ó–∞–º–µ—Ä—ã —á–µ—Ä–µ–∑ gcov / lcov                    | `coverage/index.html`      |

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ó–Ω–∞—á–µ–Ω–∏–µ  |
| -------------------------- | --------- |
| –í—Ä–µ–º—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ | 52‚Äì88 –º—Å  |
| –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è CPU –ø—Ä–∏ idle    | < 1% —è–¥—Ä–∞ |
| –ü–æ—Ç–æ–∫–æ–≤ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á      | 5‚Äì8       |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                  | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                               |
| ------------------------- | ------ | ----------------------------------------- |
| –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π startup     | 100    | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Ç–æ–∫–∏ –∏ NUMA-aware –ª–æ–≥–∏–∫–∞   |
| –ß–∏—Å—Ç–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ         | 100    | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ |
| –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ | 100    | –ß–µ—Ä–µ–∑ —Ö—É–∫–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é                 |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C

```c
signal(SIGINT, handle_signal);
if (!db_initialize()) {
    log_error("main", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ –ë–î.");
    return EXIT_FAILURE;
}
log_info("main", "–°–£–ë–î —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞");
thrd_join(metrics_thread, NULL);
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –î–æ–±–∞–≤–∏—Ç—å async-–æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ `signalfd`
* –û—Ç–ª–æ–∂–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–µ—Ç–µ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (bootup staging)
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å hot-reload –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —Å–∏–≥–Ω–∞–ª `SIGHUP`

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```
@startuml
start
:main();
:config_load();
:log_init();
:db_initialize();
if (error) then (yes)
  :log_error();
  stop
else (no)
  :run_services();
  :wait_for_shutdown();
endif
:db_shutdown();
stop
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –°–£–ë–î
* –Ø–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–æ–π –∞–Ω–∞–ª–∏–∑–∞ —Å–±–æ–µ–≤ (–º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏)
* –ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ SLA-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: latency, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ò–∑–º–µ–Ω–µ–Ω–∏—è                           |
| ------ | ---------- | ----------------------------------- |
| 1.0    | 2025-07-25 | –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è               |
| 1.1    | 2025-07-26 | –î–æ–±–∞–≤–ª–µ–Ω–∞ NUMA-aware –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è  |
| 1.2    | 2025-07-27 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è signal handler –∏ cleanup |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ UID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–µ root)
* –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–ø—É—Å–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ (pid-lock)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏ –∫—Ä–∞—à–µ–π —Å –∞–≤–∞—Ä–∏–π–Ω—ã–º log dump

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                  | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è              |
| ------- | ------------------------------------------ | ------------------------------ |
| INFO    | `[main] –°–£–ë–î —Å—Ç–∞—Ä—Ç—É–µ—Ç...`                  | –°—Ç–∞—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è               |
| INFO    | `[main] Build: %s %s`                      | –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏                   |
| INFO    | `[main] PID: %lu`                          | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞         |
| INFO    | `[main] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: %s`                  | –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É                 |
| ERROR   | `[main] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —è–¥—Ä–∞ –ë–î.`     | `db_initialize()` –≤–µ—Ä–Ω—É–ª false |
| DEBUG   | `[main] Signal %d received, shutting down` | –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ SIGINT/SIGTERM   |

–ë–ª–æ–∫ `0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)` ‚Äî ‚úÖ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω –∫–∞–∫ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π Markdown-–¥–æ–∫—É–º–µ–Ω—Ç.
–û–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç **–≤—Å–µ 18 —Ä–∞–∑–¥–µ–ª–æ–≤**, –≤–∫–ª—é—á–∞—è:

* üìê UML-–¥–∏–∞–≥—Ä–∞–º–º—É
* üßæ –ë–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏–∏
* üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
* üìù –†–µ–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
* üîß –†–µ–∞–ª—å–Ω—ã–µ C-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã
* üß™ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (config\_init)**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (—Ñ–∞–π–ª–∞, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º. –û–Ω –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Ä–µ–∂–∏–º WAL, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—É—Ç–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã) –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–∏–±–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–ª–∏ standalone.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞             | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                          |
| ---------------------- | ------------------------------------------------- |
| –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  | –ü–∞—Ä—Å–∏–Ω–≥ ini/yaml/cli –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö                   |
| –ü—É—Ç–∏ (–∫–∞—Ç–∞–ª–æ–≥–∏, —Ñ–∞–π–ª—ã) | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è  | log\_path, log\_level                             |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã WAL          | wal\_enabled, wal\_path, wal\_max\_size           |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–º—è—Ç–∏       | buffer\_pool\_size, max\_memory\_mb               |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å           | –ü—É—Ç—å –¥–æ –∫–ª—é—á–µ–π, –∞–∫—Ç–∏–≤–∞—Ü–∏—è TDE                     |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
typedef struct config_t {
    char log_path[PATH_MAX];
    int  log_level;
    char wal_path[PATH_MAX];
    bool wal_enabled;
    size_t buffer_pool_size;
    size_t max_memory_mb;
    bool tde_enabled;
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
} config_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏ (PlantUML)

```plantuml
[1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏] --> [0.1 –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (main)]
[1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏] --> [1.2 –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è]
[1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏] --> [1.3 –°–∏—Å—Ç–µ–º–∞ WAL]
[1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏] --> [2.1 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∞–º—è—Ç–∏ –∏ NUMA]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ù–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ **C23**
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è POSIX API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏, env
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å fallback –Ω–∞ —Ñ–∞–π–ª
* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–¥ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π startup latency
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–∏—á–∏–Ω—ã

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/config.c`
* `include/config.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                    | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| ------------------------------- | ------------------------------------------- | ------------------------------------ |
| config\_init                    | `bool config_init(const char *path);`       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞ |
| config\_get\_log\_path          | `const char *config_get_log_path(void);`    | –ü–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –¥–æ –ª–æ–≥–æ–≤               |
| config\_get\_log\_level         | `int config_get_log_level(void);`           | –ü–æ–ª—É—á–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è         |
| config\_get\_buffer\_pool\_size | `size_t config_get_buffer_pool_size(void);` | –†–∞–∑–º–µ—Ä –ø—É–ª–∞ —Å—Ç—Ä–∞–Ω–∏—Ü                  |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* Unit-—Ç–µ—Å—Ç—ã: `tests/test_config.c`
* Fuzz: –≤–≤–æ–¥ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
* Coverage > 92%

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                     | –ó–Ω–∞—á–µ–Ω–∏–µ      |
| --------------------------- | ------------- |
| Startup time (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è) | < 5 –º—Å        |
| –ö–æ–ª-–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤           | > 40          |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π      | ini, env, cli |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π               |
| ---------------------------- | ------ | ------------------------- |
| –ú—É–ª—å—Ç–∏-–∏—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | 100    | cli/env/ini               |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫             | 100    | —Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è          |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤  | 100    | –ø–æ–¥–¥–µ—Ä–∂–∫–∞ > 40 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C

```c
if (!config_init("/etc/inmemdb/config.ini")) {
    log_error("config", "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏");
    return 1;
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –∏ TOML —Ñ–æ—Ä–º–∞—Ç–æ–≤
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
* Live reload –±–µ–∑ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
package "1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" {
  [config_init()] --> [config_get_*()]
  [config_init()] --> [log_init()]
  [config_init()] --> [wal_init()]
}
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ë–î –ø–æ–¥ –Ω—É–∂–¥—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—É—Å–∫–∞
* –î–∞—ë—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                        | –î–∞—Ç–∞       |
| ------ | -------------------------------- | ---------- |
| 1.0    | –ù–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è             | 2025-07-20 |
| 1.1    | –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | 2025-07-22 |
| 1.2    | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è  | 2025-07-25 |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ –±–ª–æ–∫–µ

* –ó–∞—â–∏—Ç–∞ –ø—É—Ç–µ–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–∞–≤–∞–º–∏ 0600
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è TDE (transparent data encryption)
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, WAL path)

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è                          | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è                       |
| ------- | ----------------------------------------- | --------------------------------------- |
| INFO    | `[config] –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Ñ–∞–π–ª–∞: %s`          | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ config\_init                 |
| DEBUG   | `[config] –ó–Ω–∞—á–µ–Ω–∏–µ %s = %s`               | –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏          |
| ERROR   | `[config] –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: %s` | –§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ |

–ë–ª–æ–∫ **1.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (config\_init)** –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –≤ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–º —Å—Ç–∏–ª–µ: –≤–∫–ª—é—á–∞–µ—Ç –∫–æ–¥, —Å–≤—è–∑–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞, —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è, –ª–æ–≥–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, PlantUML –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ C.

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**1.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (log\_init)**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ In-Memory –°–£–ë–î. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π, –æ—à–∏–±–æ–∫, –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞–≤–∞—Ä–∏–π–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã: `stderr`, `syslog`, –±–∏–Ω–∞—Ä–Ω—ã–π –∂—É—Ä–Ω–∞–ª.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞               | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                             |
| ------------------------ | -------------------------------------------------------------------- |
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤      | –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ä–æ–≤–Ω—è, –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ (stderr/syslog/bin)  |
| –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ printf-—Ñ–æ—Ä–º–∞—Ç–∞, –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏, –º–æ–¥—É–ª—è, —É—Ä–æ–≤–Ω—è        |
| –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è       | `DEBUG`, `INFO`, `WARN`, `ERROR`, `FATAL`                            |
| –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å       | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º—å—é—Ç–µ–∫—Å –∏–ª–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏                            |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ syslog         | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º syslog —á–µ—Ä–µ–∑ `syslog.h` –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–æ–∫–µ—Ç |
| –ë–∏–Ω–∞—Ä–Ω—ã–π –ª–æ–≥             | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã log\_event\_t –≤ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç               |
| –ì–∏–±–∫–æ—Å—Ç—å                 | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã                      |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
/// –û–ø–∏—Å–∞–Ω–∏–µ –ª–æ–≥-—Å–æ–±—ã—Ç–∏—è –¥–ª—è –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
typedef struct {
    uint64_t timestamp_ns;
    log_level_t level;
    char module[32];
    char message[256];
} log_event_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package 1 "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" {
  [1.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è] --> [1.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ]
  [1.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ] --> [7.1 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞]
  [1.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ] --> [10.1 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C17/C23**, –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç–∏ (Windows / Linux)
* –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–æ–≤ `fprintf` / `write`
* –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ (timestamp, PID, thread)
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö (thread-safe)

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

| –¢–∏–ø    | –ü—É—Ç—å                             |
| ------ | -------------------------------- |
| Header | `include/log.h`                  |
| Source | `src/log.c`                      |
| –í—ã–∑–æ–≤  | `main.c`, `config.c`, `server.c` |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏ | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ----------- | ---------------------------------------------------------------------- | ---------------------------------- |
| `log_init`  | `void log_init(const char *path, log_level_t level, log_mode_t mode);` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è          |
| `log_info`  | `void log_info(const char *mod, const char *fmt, ...);`                | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ           |
| `log_debug` | `void log_debug(const char *mod, const char *fmt, ...);`               | –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ               |
| `log_error` | `void log_error(const char *mod, const char *fmt, ...);`               | –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏              |
| `log_event` | `void log_event(const log_event_t *e);`                                | –ë–∏–Ω–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥-—Ñ–∞–π–ª |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ü—É—Ç—å                        |
| --------- | --------------------------- |
| Unit      | `tests/test_log.c`          |
| Fuzz      | `fuzz/log_format_fuzzer.c`  |
| Coverage  | `tools/coverage_report.log` |

–ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤.

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                        | –ó–Ω–∞—á–µ–Ω–∏–µ                 |
| ------------------------------ | ------------------------ |
| –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø–∏—Å–∏        | `< 25 –º–∫—Å` –¥–ª—è stderr    |
| –°–∫–æ—Ä–æ—Å—Ç—å –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `> 1 –º–ª–Ω —Å–æ–±—ã—Ç–∏–π/—Å–µ–∫`    |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏           | `< 1 –ú–ë` –ø—Ä–∏ ring buffer |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                    | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| --------------------------- | ------ | ---------------------------------------- |
| Structured logging          | 100    | stderr, syslog, binary —Ñ–æ—Ä–º–∞—Ç            |
| Observability —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | 100    | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenTelemetry —á–µ—Ä–µ–∑ bridge |
| –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –ª–æ–≥–æ–≤  | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ                              |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
log_init("/var/log/db.log", LOG_LEVEL_INFO, LOG_MODE_SYSLOG);
log_info("init", "–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞ PID=%lu", getpid());
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ä–∞–∑–º–µ—Ä—É
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ structured JSON logging
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å journald –∏ cloud-collector

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class log_event_t {
  uint64_t timestamp_ns
  log_level_t level
  char module[32]
  char message[256]
}

interface LogInterface {
  +log_init()
  +log_info()
  +log_debug()
  +log_error()
  +log_event()
}

LogInterface <|.. log_event_t
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ê—É–¥–∏—Ç —Å–æ–±—ã—Ç–∏–π: –∫—Ç–æ, –∫–æ–≥–¥–∞, —á—Ç–æ —Å–¥–µ–ª–∞–ª (DML/DDL/–û—à–∏–±–∫–∞)
* SLA: –∞–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞, –æ—à–∏–±–æ–∫, –∞–Ω–æ–º–∞–ª–∏–π
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                              | –î–∞—Ç–∞       |
| ------ | -------------------------------------- | ---------- |
| 1.0    | –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤            | 2024-06-20 |
| 1.1    | –î–æ–±–∞–≤–ª–µ–Ω –±–∏–Ω–∞—Ä–Ω—ã–π —Ä–µ–∂–∏–º                | 2024-07-02 |
| 1.2    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ syslog / stderr –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è | 2024-07-12 |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π `vsnprintf`
* –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è                               | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è                |
| ------- | ---------------------------------------------- | -------------------------------- |
| INFO    | `[LOG] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–æ–≤: —Ä–µ–∂–∏–º=%s`          | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ log\_init             |
| DEBUG   | `[LOG] –ü–æ—Ç–æ–∫ %lu –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: %s`          | –ü—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ debug-—Ä–µ–∂–∏–º–µ   |
| ERROR   | `[LOG] –û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª: %s`               | –ü—Ä–∏ —Å–±–æ–µ `fwrite()` –∏–ª–∏ `open()` |
| WARN    | `[LOG] –ë—É—Ñ–µ—Ä –ª–æ–≥–æ–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω, –∑–∞–ø–∏—Å—å –ø—Ä–æ–ø—É—â–µ–Ω–∞` | –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±—É—Ñ–µ—Ä–∞          |

‚úÖ –ë–ª–æ–∫ **1.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (log\_init)** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤.

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç:

* —Å–≤—è–∑–∏ —Å PlantUML,
* —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã C-—Ñ—É–Ω–∫—Ü–∏–π,
* —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–æ–≤,
* —Ç–µ—Å—Ç—ã –∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏,
* –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞: 1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ (network\_init)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –Ω–∞—á–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞ –°–£–ë–î, –≤–∫–ª—é—á–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–æ–∫–µ—Ç–æ–≤, –ø—Ä–∏–≤—è–∑–∫—É –∫ IP-–∞–¥—Ä–µ—Å–∞–º –∏ –ø–æ—Ä—Ç–∞–º, —É—Å—Ç–∞–Ω–æ–≤–∫—É —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –Ø–≤–ª—è–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ gRPC/WebSocket/REST-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                         |
| ----------------- | ---------------------------------------------------------------- |
| TCP/UDP-—Å–µ—Ä–≤–µ—Ä    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ IPv4/IPv6, –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `thrd_create`         |
| –ü–æ—Ä—Ç—ã             | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–∑ config: API, replication, metrics                   |
| –°–æ–∫–µ—Ç—ã            | `socket_create()`, `socket_bind()`, `socket_listen()`            |
| CLI/REST/gRPC     | –û–±—â–∞—è –ø—Ä–æ—Å–ª–æ–π–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–∫–µ—Ç–æ–≤                                |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SSL/TLS | –ß–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π (–≤ –±—É–¥—É—â–µ–º, —á–µ—Ä–µ–∑ OpenSSL –∏–ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É) |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```c
typedef struct {
    char bind_ip[64];
    uint16_t api_port;
    uint16_t repl_port;
    uint16_t metrics_port;
    bool reuse_addr;
    bool tcp_nodelay;
} net_config_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[1.1 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è] --> [1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.1 REST API]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.2 gRPC –°–µ—Ä–≤–µ—Ä]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [3.3 –í–µ–±-—Å–æ–∫–µ—Ç—ã]
[1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏] --> [4.1 –ö–ª–∞—Å—Ç–µ—Ä–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è POSIX-—Å–æ–∫–µ—Ç—ã (Linux) –∏ Windows API —á–µ—Ä–µ–∑ –æ–±—ë—Ä—Ç–∫–∏
* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `SO_REUSEADDR`, `TCP_NODELAY` –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö: `bind`, `listen`, `accept`
* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ thread affinity –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/network.c`
* `include/network.h`
* `src/socket.c`
* `include/socket.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                     | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| -------------- | ------------------------------------------------------------ | ------------------------------------ |
| network\_init  | `bool network_init(const net_config_t *cfg);`                | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö —Å–ª—É—à–∞—é—â–∏—Ö —Å–æ–∫–µ—Ç–æ–≤ |
| socket\_create | `int socket_create();`                                       | –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ —Å–æ–∫–µ—Ç–∞          |
| socket\_bind   | `bool socket_bind(int sock, const char *ip, uint16_t port);` | –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–∫–µ—Ç–∞ –∫ IP/–ø–æ—Ä—Ç—É           |
| socket\_listen | `bool socket_listen(int sock);`                              | –ü–µ—Ä–µ–≤–æ–¥ —Å–æ–∫–µ—Ç–∞ –≤ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* `tests/test_network.c`: Unit + Integration
* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–∫–∏ —Å–æ–∫–µ—Ç–æ–≤
* –ü–æ–∫—Ä—ã—Ç–∏–µ: —Å–æ–∑–¥–∞–Ω–∏–µ, bind, listen, –æ—à–∏–±–∫–∏ –ø–æ—Ä—Ç–æ–≤

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ < 2 –º—Å
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ > 20K –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (epoll/kqueue)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ thread pinning –∏ NUMA-aware —Å–æ–∫–µ—Ç–æ–≤ –≤ –±—É–¥—É—â–µ–º

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                 |
| ---------------------------- | ------ | --------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤         | 100    | TCP, WebSocket, REST, gRPC  |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è | 100    | epoll, thread pool          |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å                 | 80     | –í –ø–ª–∞–Ω–∞—Ö TLS/mTLS           |
| –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å              | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ C23 `thrd_create` |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!network_init(&global_config.net)) {
    log_error("network", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–∏");
    return false;
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* TLS/mTLS —á–µ—Ä–µ–∑ OpenSSL –∏–ª–∏ wolfSSL
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ QUIC/HTTP3
* NUMA-aware —Å–æ–∫–µ—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
* Adaptive backlog + SO\_PRIORITY

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
package "1.3 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏" {
  [socket_create()] --> [socket_bind()]
  [socket_bind()] --> [socket_listen()]
  [socket_listen()] --> [network_init()]
}
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (–≤–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã)
* –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏
* –°—Ç—Ä–∏–º–∏–Ω–≥ –∏ CDC –Ω–∞—Ä—É–∂—É

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* `v0.9`: –ø–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `network_init`
* `v1.1`: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ IPv6, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è –º–µ—Ç—Ä–∏–∫
* `v1.2`: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ reusable address + thread-pinning roadmap

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ IP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ config
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ—Ä—Ç–æ–≤/ACL
* –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                           | –£—Å–ª–æ–≤–∏–µ                                |
| ------- | ----------------------------------- | -------------------------------------- |
| INFO    | `[NET] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ç–∏ –Ω–∞ %s:%d` | –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º bind                      |
| ERROR   | `[NET] –û—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞: %s`           | –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö socket\_create/bind/listen |
| DEBUG   | `[NET] –°–æ–∫–µ—Ç %d —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç %d`    | –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ                 |

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**1.4 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL (–∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏)**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

WAL (Write-Ahead Logging) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω—É—é –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Ñ–∏–∫—Å–∞—Ü–∏–µ–π –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ NVMe. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –°–£–ë–î –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

* –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ —Å—Ç–∞—Ä—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π,
* –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∞–≤–∞—Ä–∏–π–Ω–æ–º—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏,
* —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å MVCC –∏ snapshot-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–º.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                  |
| ------------------- | --------------------------------------------------------- |
| –ë—É—Ñ–µ—Ä WAL           | Ring-buffer –Ω–∞ –ø–∞–º—è—Ç—å —Å mmap –∏–ª–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç—å—é      |
| –ú–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏ | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –≤–Ω–µ—Å–µ–Ω–∏—è –≤ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ             |
| WAL writer          | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, —Å–∂–∞—Ç–∏–µ –ª–æ–≥–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è                  |
| Snapshot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ snapshot recovery              |
| WAL —Ñ–æ—Ä–º–∞—Ç          | –ë–∏–Ω–∞—Ä–Ω—ã–π, –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ        |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞         | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ wal\_path, –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// WAL header + –∑–∞–ø–∏—Å—å –∏–∑–º–µ–Ω–µ–Ω–∏–π
typedef struct wal_entry_t {
    uint64_t tx_id;
    uint64_t timestamp;
    wal_op_type_t op_type;
    uint32_t data_len;
    uint8_t  data[]; // –°–∂–∞—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
} wal_entry_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
[1.2 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è] --> [1.4 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL]
[1.4 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL] --> [2.4 MVCC-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ]
[1.4 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL] --> [2.6 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ Snapshot]
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: **C23**
* –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ mmap –±—É—Ñ–µ—Ä—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö WAL writer‚Äô–æ–≤
* –°–µ–≥–º–µ–Ω—Ç–∏—Ä—É–µ–º–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∫–æ–º–ø–∞–∫—Ü–∏—è WAL
* NUMA-aware –±—É—Ñ–µ—Ä—ã WAL –≤ –±—É–¥—É—â–µ–º —Ä–µ–ª–∏–∑–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

| –ü—É—Ç—å             | –û–ø–∏—Å–∞–Ω–∏–µ              |
| ---------------- | --------------------- |
| `src/wal.c`      | –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ WAL   |
| `include/wal.h`  | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã |
| `src/snapshot.c` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å recovery |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                             |
| -------------- | -------------------------------------------- | -------------------------------------- |
| `wal_init`     | `bool wal_init(const char *path);`           | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è WAL |
| `wal_append`   | `bool wal_append(const wal_entry_t *entry);` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª             |
| `wal_flush`    | `void wal_flush(void);`                      | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –¥–∏—Å–∫   |
| `wal_rotate`   | `void wal_rotate(void);`                     | –°–º–µ–Ω–∞ WAL-—Å–µ–≥–º–µ–Ω—Ç–∞                     |
| `wal_shutdown` | `void wal_shutdown(void);`                   | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ WAL –∏ –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤      |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* `tests/unit/test_wal.c` ‚Äî —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –æ–ø–µ—Ä–∞—Ü–∏–π
* `tests/integration/test_tx_crash.c` ‚Äî –ø–∞–¥–µ–Ω–∏–µ + recovery
* `tests/fuzz/fuzz_wal_parser.c` ‚Äî —Ñ—É–∑–∑–∏–Ω–≥ WAL-–∑–∞–ø–∏—Å–µ–π
* –ü–æ–∫—Ä—ã—Ç–∏–µ: > 93% –ø–æ —Å—Ç—Ä–æ–∫–∞–º, mutation safe

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ó–Ω–∞—á–µ–Ω–∏–µ                        |
| -------------------------- | ------------------------------- |
| –°—Ä–µ–¥–Ω—è—è –∑–∞–¥–µ—Ä–∂–∫–∞ append    | 210‚Äì330 –Ω—Å                      |
| –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å WAL | –¥–æ 1.5 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫ –ø—Ä–∏ SSD  |
| –°–∂–∞—Ç–∏–µ –ª–æ–≥–æ–≤               | \~2.7√ó (custom delta+RLE codec) |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                         | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                        |
| -------------------------------- | ------ | ---------------------------------- |
| Write-Ahead Logging              | 100    | –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è           |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å recovery / snapshot | 100    | –î–∞, —á–µ—Ä–µ–∑ snapshot.c –∏ checkpoint  |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ —Å–∂–∞—Ç–∏—è     | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–æ–º–ø–∞–∫—Ü–∏—è –∏ —Ä–æ—Ç–∞—Ü–∏—è WAL |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C

```c
if (!wal_init(config_get_wal_path())) {
    log_error("WAL", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WAL");
    exit(EXIT_FAILURE);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* NUMA-aware WAL writer (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å–æ–∫–µ—Ç–∞–º CPU)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ WAL –≤ in-memory –±–µ–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (RAM-disk fallback)
* WAL streaming –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (Raft + Changefeed)

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
@startuml
package "1.4 WAL (–∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏)" {
  class wal_entry_t {
    +uint64_t tx_id
    +uint64_t timestamp
    +wal_op_type_t op_type
    +uint32_t data_len
    +uint8_t data[]
  }

  class wal.c
  class wal.h
  class snapshot.c
  wal.c --> wal_entry_t
  snapshot.c --> wal_entry_t
}
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ì–∞—Ä–∞–Ω—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∏ —Å–±–æ—è—Ö
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É snapshot

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞       | –ê–≤—Ç–æ—Ä      | –ò–∑–º–µ–Ω–µ–Ω–∏—è                          |
| ------ | ---------- | ---------- | ---------------------------------- |
| 1.0    | 2025-07-26 | –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä | –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–ª–∏–∑ WAL-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ WAL
* WAL-—Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã (–±—É–¥—É—â–∏–π —Ä–µ–ª–∏–∑)
* –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–µ–π –ø–æ—Å–ª–µ commit

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                     | –£—Å–ª–æ–≤–∏–µ                           |
| ------- | --------------------------------------------- | --------------------------------- |
| INFO    | `[WAL] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞`                 | –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∑–∞–ø—É—Å–∫–µ wal\_init    |
| ERROR   | `[WAL] –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ %s`         | –ï—Å–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ WAL –∫–∞—Ç–∞–ª–æ–≥—É   |
| DEBUG   | `[WAL] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å tx=%lu len=%u`        | –ü—Ä–∏ –∫–∞–∂–¥–æ–º wal\_append            |
| WARN    | `[WAL] –ü—Ä–æ–ø—É—â–µ–Ω–∞ –∑–∞–ø–∏—Å—å: –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞` | –ü—Ä–∏ —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ–º –ø–æ—Ç–æ–∫–µ append |

‚úÖ –ë–ª–æ–∫ **1.4 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL (–∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏)** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤.

–û–Ω –≤–∫–ª—é—á–∞–µ—Ç:

* —Å–≤—è–∑–∏ —Å `MVCC`, `snapshot recovery`, `log_init`;
* —Ä–µ–∞–ª—å–Ω—ã–µ C-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ `wal_entry_t`;
* —Å–æ–æ–±—â–µ–Ω–∏—è –ª–æ–≥–æ–≤, PlantUML –∏ –º–µ—Ç—Ä–∏–∫–∏.

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞: 1.5 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ (Snapshot Recovery)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –ø–æ—Å–ª–µ —Å–±–æ—è. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –ø–æ—Ç–µ—Ä–∏ —Å —É—á—ë—Ç–æ–º WAL –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö snapshot-—Ñ–∞–π–ª–æ–≤.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è/–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                           |
| ------------------ | ---------------------------------------------------------------- |
| –°–Ω–∏–º–∫–∏             | –•—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ SSD –≤ —Ñ–æ—Ä–º–∞—Ç–µ page-diff –∏–ª–∏ full-page                |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ     | –ß—Ç–µ–Ω–∏–µ snapshot, –∑–∞—Ç–µ–º –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ WAL –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint |
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MVCC | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö txid –∏ snapshot\_id                         |
| –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º, –≤–µ—Ä—Å–∏–π –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–µ–π          |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// snapshot.h
typedef struct snapshot_header_t {
    uint64_t snapshot_id;
    uint64_t last_wal_lsn;
    uint64_t timestamp;
    uint32_t crc32;
} snapshot_header_t;

typedef struct snapshot_record_t {
    uint64_t page_id;
    uint16_t length;
    uint8_t  data[MAX_PAGE_SIZE];
} snapshot_record_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã" {
  [1.4 WAL Init] --> [1.5 Snapshot Recovery]
  [1.5 Snapshot Recovery] --> [2.1 MVCC Engine]
  [1.5 Snapshot Recovery] --> [2.2 –¢–∞–±–ª–∏—Ü—ã / –¥–∞–Ω–Ω—ã–µ]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: C23
* –•—Ä–∞–Ω–µ–Ω–∏–µ snapshot –Ω–∞ NVMe/SSD (–≤–Ω–µ in-memory –ø—É—Ç–∏)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ frame-of-reference –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ snapshot
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º, fail-fast recovery
* Prefetch —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –ø–∞–º—è—Ç—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

| –§–∞–π–ª                 | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                  |
| -------------------- | --------------------------- |
| `src/snapshot.c`     | –ó–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ snapshot |
| `src/wal.c`          | WAL replay                  |
| `include/snapshot.h` | –§–æ—Ä–º–∞—Ç snapshot-—Ñ–∞–π–ª–∞       |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –§—É–Ω–∫—Ü–∏—è                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------------------------- | ---------------------------------------------------------------------- | ------------------------------------- |
| `snapshot_load`           | `bool snapshot_load(db_t *db, const char *path)`                       | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç snapshot + WAL  |
| `snapshot_verify_crc`     | `bool snapshot_verify_crc(const void *data, size_t len, uint32_t crc)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É           |
| `snapshot_prefetch_pages` | `void snapshot_prefetch_pages(const snapshot_record_t *records)`       | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ –ø–∞–º—è—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/test_snapshot.c`
* Fuzz: Fuzzing –ø–æ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–º snapshot-—Ñ–∞–π–ª–∞–º
* Soak test: –¥–æ–ª–≥–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ + —Å–±–æ–∏ –ø–∏—Ç–∞–Ω–∏—è (crash recovery)
* Coverage > 92%

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ó–Ω–∞—á–µ–Ω–∏–µ                                 |
| ------------------------- | ---------------------------------------- |
| –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è      | < 150 –º—Å –ø—Ä–∏ snapshot+WAL < 500 –ú–ë       |
| –°–∫–æ—Ä–æ—Å—Ç—å prefetch         | 2.1 GB/s (NVMe read throughput)          |
| –ö–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ snapshot | 80k - 500k —Å—Ç—Ä–∞–Ω–∏—Ü (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ë–î) |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                         |
| ----------------- | ------ | --------------------------------------------------- |
| Snapshot Recovery | 100    | –ï—Å—Ç—å –ø–æ–ª–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞, prefetch, crash-consistency  |
| WAL replay        | 100    | Replay –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ LSN                            |
| –°–∂–∞—Ç–∏–µ            | 90     | –ü–æ–∫–∞ –Ω–µ –≤—Å–µ page-type –∏—Å–ø–æ–ª—å–∑—É—é—Ç frame-of-reference |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!snapshot_load(db, config_get_snapshot_path())) {
    log_error("snapshot", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞");
    exit(EXIT_FAILURE);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ snapshot'—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multithreaded replay WAL
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π snapshot scheduler

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
@startuml
entity "snapshot_header_t" {
  +uint64_t snapshot_id
  +uint64_t last_wal_lsn
  +uint64_t timestamp
  +uint32_t crc32
}

entity "snapshot_record_t" {
  +uint64_t page_id
  +uint16_t length
  +uint8_t data[MAX_PAGE_SIZE]
}

snapshot_header_t --> snapshot_record_t : —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–π
* –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è (RTO)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SLA –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ê–≤—Ç–æ—Ä  | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                |
| ------ | ------ | ---------------------------------------- |
| 1.0    | system | –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è snapshot + recovery |
| 1.1    | tofa   | –î–æ–±–∞–≤–ª–µ–Ω prefetch –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ CRC         |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* CRC32 –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ snapshot-—Ñ–∞–π–ª–∞
* –í–∞–ª–∏–¥–∞—Ü–∏—è offset/—Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø–∏—Å–µ–π –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞ (bounds check)

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                        | –£—Å–ª–æ–≤–∏–µ                                          |
| ------- | ------------------------------------------------ | ------------------------------------------------ |
| INFO    | \[Snapshot] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ snapshot\_id=%lu   | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è                        |
| DEBUG   | \[Snapshot] –ü—Ä–µ—Ñ–µ—Ç—á —Å—Ç—Ä–∞–Ω–∏—Ü—ã %lu                 | –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ snapshot                  |
| WARN    | \[Snapshot] CRC –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, snapshot –ø–æ–≤—Ä–µ–∂–¥—ë–Ω | –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã         |
| ERROR   | \[Snapshot] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: %s        | –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ |


## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞: 1.5 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ (Snapshot Recovery)

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –ø–æ—Å–ª–µ —Å–±–æ—è. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –ø–æ—Ç–µ—Ä–∏ —Å —É—á—ë—Ç–æ–º WAL –∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö snapshot-—Ñ–∞–π–ª–æ–≤.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è/–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                           |
| ------------------ | ---------------------------------------------------------------- |
| –°–Ω–∏–º–∫–∏             | –•—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ SSD –≤ —Ñ–æ—Ä–º–∞—Ç–µ page-diff –∏–ª–∏ full-page                |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ     | –ß—Ç–µ–Ω–∏–µ snapshot, –∑–∞—Ç–µ–º –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ WAL –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ checkpoint |
| –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MVCC | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö txid –∏ snapshot\_id                         |
| –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å    | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º, –≤–µ—Ä—Å–∏–π –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–µ–π          |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
// snapshot.h
typedef struct snapshot_header_t {
    uint64_t snapshot_id;
    uint64_t last_wal_lsn;
    uint64_t timestamp;
    uint32_t crc32;
} snapshot_header_t;

typedef struct snapshot_record_t {
    uint64_t page_id;
    uint16_t length;
    uint8_t  data[MAX_PAGE_SIZE];
} snapshot_record_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã" {
  [1.4 WAL Init] --> [1.5 Snapshot Recovery]
  [1.5 Snapshot Recovery] --> [2.1 MVCC Engine]
  [1.5 Snapshot Recovery] --> [2.2 –¢–∞–±–ª–∏—Ü—ã / –¥–∞–Ω–Ω—ã–µ]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –Ø–∑—ã–∫: C23
* –•—Ä–∞–Ω–µ–Ω–∏–µ snapshot –Ω–∞ NVMe/SSD (–≤–Ω–µ in-memory –ø—É—Ç–∏)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ frame-of-reference –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏ snapshot
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º, fail-fast recovery
* Prefetch —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –ø–∞–º—è—Ç—å –Ω–∞ —Å—Ç–∞—Ä—Ç–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

| –§–∞–π–ª                 | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                  |
| -------------------- | --------------------------- |
| `src/snapshot.c`     | –ó–∞–≥—Ä—É–∑–∫–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ snapshot |
| `src/wal.c`          | WAL replay                  |
| `include/snapshot.h` | –§–æ—Ä–º–∞—Ç snapshot-—Ñ–∞–π–ª–∞       |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –§—É–Ω–∫—Ü–∏—è                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                               | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| ------------------------- | ---------------------------------------------------------------------- | ------------------------------------- |
| `snapshot_load`           | `bool snapshot_load(db_t *db, const char *path)`                       | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç snapshot + WAL  |
| `snapshot_verify_crc`     | `bool snapshot_verify_crc(const void *data, size_t len, uint32_t crc)` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É           |
| `snapshot_prefetch_pages` | `void snapshot_prefetch_pages(const snapshot_record_t *records)`       | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ –ø–∞–º—è—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/test_snapshot.c`
* Fuzz: Fuzzing –ø–æ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–º snapshot-—Ñ–∞–π–ª–∞–º
* Soak test: –¥–æ–ª–≥–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ + —Å–±–æ–∏ –ø–∏—Ç–∞–Ω–∏—è (crash recovery)
* Coverage > 92%

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                   | –ó–Ω–∞—á–µ–Ω–∏–µ                                 |
| ------------------------- | ---------------------------------------- |
| –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è      | < 150 –º—Å –ø—Ä–∏ snapshot+WAL < 500 –ú–ë       |
| –°–∫–æ—Ä–æ—Å—Ç—å prefetch         | 2.1 GB/s (NVMe read throughput)          |
| –ö–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ snapshot | 80k - 500k —Å—Ç—Ä–∞–Ω–∏—Ü (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ë–î) |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                         |
| ----------------- | ------ | --------------------------------------------------- |
| Snapshot Recovery | 100    | –ï—Å—Ç—å –ø–æ–ª–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞, prefetch, crash-consistency  |
| WAL replay        | 100    | Replay –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ LSN                            |
| –°–∂–∞—Ç–∏–µ            | 90     | –ü–æ–∫–∞ –Ω–µ –≤—Å–µ page-type –∏—Å–ø–æ–ª—å–∑—É—é—Ç frame-of-reference |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!snapshot_load(db, config_get_snapshot_path())) {
    log_error("snapshot", "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞");
    exit(EXIT_FAILURE);
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ snapshot'—ã
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ multithreaded replay WAL
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π snapshot scheduler

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞ (.puml)

```plantuml
@startuml
entity "snapshot_header_t" {
  +uint64_t snapshot_id
  +uint64_t last_wal_lsn
  +uint64_t timestamp
  +uint32_t crc32
}

entity "snapshot_record_t" {
  +uint64_t page_id
  +uint16_t length
  +uint8_t data[MAX_PAGE_SIZE]
}

snapshot_header_t --> snapshot_record_t : —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ì–∞—Ä–∞–Ω—Ç–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–π
* –°–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ—Å—Ç–æ—è (RTO)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SLA –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –í–µ—Ä—Å–∏—è | –ê–≤—Ç–æ—Ä  | –ò–∑–º–µ–Ω–µ–Ω–∏–µ                                |
| ------ | ------ | ---------------------------------------- |
| 1.0    | system | –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è snapshot + recovery |
| 1.1    | tofa   | –î–æ–±–∞–≤–ª–µ–Ω prefetch –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ CRC         |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* CRC32 –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ snapshot-—Ñ–∞–π–ª–∞
* –í–∞–ª–∏–¥–∞—Ü–∏—è offset/—Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø–∏—Å–µ–π –ø–µ—Ä–µ–¥ —á—Ç–µ–Ω–∏–µ–º
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞ (bounds check)

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –°–æ–æ–±—â–µ–Ω–∏–µ                                        | –£—Å–ª–æ–≤–∏–µ                                          |
| ------- | ------------------------------------------------ | ------------------------------------------------ |
| INFO    | \[Snapshot] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ snapshot\_id=%lu   | –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è                        |
| DEBUG   | \[Snapshot] –ü—Ä–µ—Ñ–µ—Ç—á —Å—Ç—Ä–∞–Ω–∏—Ü—ã %lu                 | –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ snapshot                  |
| WARN    | \[Snapshot] CRC –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, snapshot –ø–æ–≤—Ä–µ–∂–¥—ë–Ω | –ü—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã         |
| ERROR   | \[Snapshot] –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å: %s        | –ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ |

‚úÖ –ë–ª–æ–∫ **1.5 –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–∞ (Snapshot Recovery)** –∑–∞–≤–µ—Ä—à—ë–Ω.

–°–æ–¥–µ—Ä–∂–∏—Ç:

* –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ API: `snapshot_load`, `snapshot_verify_crc`
* UML-–¥–∏–∞–≥—Ä–∞–º–º—É
* —Å–≤—è–∑–∏ –º–µ–∂–¥—É `WAL`, `MVCC`, `Storage`
* –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
* –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**1.6 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–∞–±–ª–∏—Ü (catalog\_init)**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–∞—Ç–∞–ª–æ–≥ —Ç–∞–±–ª–∏—Ü –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: —Å—Ö–µ–º—ã, —Ç–∏–ø—ã, –∏–Ω–¥–µ–∫—Å—ã, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –≤–µ—Ä—Å–∏–∏.
–§—É–Ω–∫—Ü–∏—è `catalog_init()` –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç in-memory —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–∞, –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞           | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                 |
| -------------------- | -------------------------------------------------------- |
| –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | –í –ø–∞–º—è—Ç–∏, –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `catalog_t`                        |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü   | –ü–æ –∏–º–µ–Ω–∏, ID, —Ç–∏–ø—É –∏ —Ñ–ª–∞–≥–∞–º                              |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è           | B+ –¥–µ—Ä–µ–≤—å—è –∏ —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞             |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å        | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `system-versioned`, `temporary`, `json` —Ç–∞–±–ª–∏—Ü |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct {
    table_t **tables;
    size_t table_count;
    hashmap_t *name_index;
    uint64_t catalog_version;
} catalog_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" #DDDDDD {
  [1.6 catalog_init] --> [1.1 config_init]
  [1.6 catalog_init] --> [1.5 snapshot_recovery]
  [1.6 catalog_init] --> [2.1 table_create]
  [1.6 catalog_init] --> [2.2 table_register]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –≥–æ—Ä—è—á–µ–º —Å–µ–≥–º–µ–Ω—Ç–µ
* –ó–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ read-write locks (–µ—Å–ª–∏ multi-thread init)
* –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ `catalog_version`
* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ `tables[]`

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/catalog.c`
* `include/catalog.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                  | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
| ----------------- | ----------------------------------------- | ----------------------------------------- |
| catalog\_init     | `bool catalog_init(void);`                | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü |
| catalog\_free     | `void catalog_free(void);`                | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏                       |
| catalog\_get      | `table_t *catalog_get(const char *name);` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∏–º–µ–Ω–∏                |
| catalog\_register | `bool catalog_register(table_t *t);`      | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã                 |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: `tests/test_catalog.c`
* Fuzz-—Ç–µ—Å—Ç—ã: —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏
* Coverage: > 92%
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å `table_create`, `schema_validate`

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è                   | –ó–∞–¥–µ—Ä–∂–∫–∞ (–Ω—Å) |
| -------------------------- | ------------- |
| –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∏–º–µ–Ω–∏ | < 300 ns      |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã        | < 1 –º–∫—Å       |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                            |
| ----------------------------- | ------ | -------------------------------------- |
| In-memory —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö | 100    | –¢–æ–ª—å–∫–æ RAM, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –¥–∏—Å–∫—É      |
| –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ               | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `catalog_version` |
| –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø                | 100    | O(1) –ø–æ –∏–º–µ–Ω–∏ —á–µ—Ä–µ–∑ hash map           |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
if (!catalog_init()) {
    log_error("catalog", "–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞");
    return false;
}
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ snapshot
* –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ UUID —Ç–∞–±–ª–∏—Ü
* –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ –º–µ—Ç–∞-–∞—Ç—Ä–∏–±—É—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–ª–æ–Ω–æ–∫)

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class catalog_t {
  +table_t **tables
  +size_t table_count
  +hashmap_t *name_index
  +uint64_t catalog_version
}
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

–ö–∞—Ç–∞–ª–æ–≥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –±–∞–∑—ã: —Ç–∞–±–ª–∏—Ü, –∏—Ö –∫–æ–ª–æ–Ω–æ–∫, –∏–Ω–¥–µ–∫—Å–æ–≤. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ª—é–±—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π SELECT, INSERT, ANALYZE –∏ ALTER.

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v0.9: –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ (static array)
* v1.0: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–æ—Å—Ç, hash-index, –≤–µ—Ä—Å–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –¢–∞–±–ª–∏—Ü—ã —Å —Ñ–ª–∞–≥–æ–º SYSTEM –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ superuser
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
* –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç                                       | –£—Å–ª–æ–≤–∏–µ –ø–æ—è–≤–ª–µ–Ω–∏—è                   |
| ------- | -------------------------------------------- | ----------------------------------- |
| INFO    | `[catalog] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞, –≤–µ—Ä. %lu` | –£—Å–ø–µ—à–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è              |
| ERROR   | `[catalog] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã: %s` | –°–±–æ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã |
| DEBUG   | `[catalog] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞: %s`     | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π  |

‚úÖ –ì–æ—Ç–æ–≤ –±–ª–æ–∫ **1.6 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–∞–±–ª–∏—Ü (`catalog_init`)**

–û–Ω –≤–∫–ª—é—á–∞–µ—Ç:

* –ü–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ API
* UML-–¥–∏–∞–≥—Ä–∞–º–º—É `catalog_t`
* –ü–æ–¥—Ä–æ–±–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ñ—É–Ω–∫—Ü–∏–π
* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+ –ø–æ –≤—Å–µ–º –ø—É–Ω–∫—Ç–∞–º
* –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
* –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å <1 –º–∫—Å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü—ã

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

**1.7 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (distributed\_planner)**

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (Distributed Planner) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö SQL-–ø–ª–∞–Ω–æ–≤ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–∞—Ö in-memory –°–£–ë–î. –û–Ω –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ (sharding), –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è locality-aware –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                       |
| ------------------- | ---------------------------------------------- |
| –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–ª–∞–Ω | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥-–ø–ª–∞–Ω–æ–≤ –¥–ª—è —à–∞—Ä–¥–∞ / —É–∑–ª–∞          |
| –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É–∑–ª–æ–≤   | Locality-aware, NUMA-aware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è         |
| –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è         | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä |
| Pushdown-–≤—ã—Ä–∞–∂–µ–Ω–∏—è  | –í—ã–Ω–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π –±–ª–∏–∂–µ –∫ –¥–∞–Ω–Ω—ã–º      |
| Fault tolerance     | –ê–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–¥-–ø–ª–∞–Ω–æ–≤ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö —É–∑–ª–∞—Ö  |

---

## üíæ –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

```c
typedef struct {
  plan_node_t *global_plan;
  plan_node_t **local_subplans;
  size_t subplan_count;
  planner_topology_t topology;
} distributed_plan_t;
```

---

## üîÑ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

```plantuml
package "1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è" #DDDDDD {
  [1.7 distributed_planner] --> [1.3 optimizer_init]
  [1.7 distributed_planner] --> [1.6 catalog_init]
  [1.7 distributed_planner] --> [3.4 sql_executor]
  [1.7 distributed_planner] --> [5.1 network_router]
}
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* Pushdown-–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å —É—á—ë—Ç–æ–º shard locality
* –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ –º–µ—Ç–∞-–ø–ª–∞–Ω–∞–º–∏ –º–µ–∂–¥—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º–∏
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ ring/tree/hypercube
* –Ø–∑—ã–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: C (—è–¥—Ä–æ), –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WASM/DSL UDF –¥–ª—è —Ä–∞—Å—á—ë—Ç–æ–≤ –Ω–∞ —à–∞—Ä–¥–µ

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

* `src/planner/distributed_planner.c`
* `include/planner/distributed_planner.h`

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è                         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                            | –û–ø–∏—Å–∞–Ω–∏–µ                              |
| --------------------------- | ------------------------------------------------------------------- | ------------------------------------- |
| distributed\_plan\_create   | `distributed_plan_t *distributed_plan_create(plan_node_t *global);` | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞      |
| distributed\_plan\_execute  | `bool distributed_plan_execute(distributed_plan_t *plan);`          | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞    |
| distributed\_plan\_free     | `void distributed_plan_free(distributed_plan_t *plan);`             | –û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏                        |
| distributed\_plan\_optimize | `void distributed_plan_optimize(distributed_plan_t *plan);`         | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ locality-aware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥-–ø–ª–∞–Ω–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ pushdown
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ: —Å–∏–º—É–ª—è—Ü–∏—è –º–Ω–æ–≥–æ—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
* Soak-—Ç–µ—Å—Ç—ã: –¥–ª–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–µ–π
* Coverage: 88‚Äì92%

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞                          | –ó–Ω–∞—á–µ–Ω–∏–µ      |
| -------------------------------- | ------------- |
| –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞            | < 500 –º–∫—Å     |
| –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏          | < 1 –º—Å        |
| –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å pushdown –∞–≥—Ä–µ–≥–∞—Ü–∏–π | > 93% —Å–ª—É—á–∞–µ–≤ |

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                  | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                |
| ------------------------- | ------ | ------------------------------------------ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è | 100    | –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥-–ø–ª–∞–Ω–æ–≤         |
| Pushdown –≤—ã—Ä–∞–∂–µ–Ω–∏—è        | 100    | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π, —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ LIMIT    |
| Fault tolerance           | 90     | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è watchdog |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
plan_node_t *plan = optimizer_generate(ast);
distributed_plan_t *dplan = distributed_plan_create(plan);
distributed_plan_optimize(dplan);
distributed_plan_execute(dplan);
distributed_plan_free(dplan);
```

---

## üß© –ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ GPU (GPU-shards)
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å consensus (Raft) –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
* –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –≤ runtime

---

## üìê UML-–¥–∏–∞–≥—Ä–∞–º–º–∞

```plantuml
@startuml
class distributed_plan_t {
  +plan_node_t *global_plan
  +plan_node_t **local_subplans
  +size_t subplan_count
  +planner_topology_t topology
}
@enduml
```

---

## üßæ –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

–ö–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ 500+ —Ñ–∏–ª–∏–∞–ª–∞—Ö –∏ –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –ø–µ—Ä–µ—Å—ã–ª–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

## üìú –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

* v1.0: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ring-topology, pushdown –∞–≥—Ä–µ–≥–∞—Ç–æ–≤
* v1.1: –†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ join-–ø–ª–∞–Ω—ã
* v1.2: –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π –∏ –∫–µ—à–µ–π

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

* –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ shard-–ø–ª–∞–Ω–∞ –ø–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–µ
* –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–æ TLS –º–µ–∂–¥—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º
* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ NUMA-—Å–µ–≥–º–µ–Ω—Ç—É –∏ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —è–¥—Ä—É (CPU affinity)

---

## üìù –°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)

| –£—Ä–æ–≤–µ–Ω—å | –§–æ—Ä–º–∞—Ç                                                | –£—Å–ª–æ–≤–∏–µ                                  |
| ------- | ----------------------------------------------------- | ---------------------------------------- |
| INFO    | `[planner] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞` | –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–¥-–ø–ª–∞–Ω–æ–≤ |
| DEBUG   | `[planner] Pushdown –ø—Ä–∏–º–µ–Ω—ë–Ω: %s`                     | –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –≤—ã–Ω–æ—Å –≤—ã—Ä–∞–∂–µ–Ω–∏–π           |
| ERROR   | `[planner] –û—à–∏–±–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞: %s`              | –°–±–æ–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏         |

‚úÖ –ì–æ—Ç–æ–≤ –±–ª–æ–∫ **1.7 –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (`distributed_planner`)**

–í–∫–ª—é—á–∞–µ—Ç:

* –ü–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–¥-–ø–ª–∞–Ω–æ–≤ –ø–æ —É–∑–ª–∞–º
* Pushdown-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
* NUMA-aware –∏ Fault-tolerant –ø–æ–¥—Ö–æ–¥
* –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å <1 –º—Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏
* –°–≤—è–∑—å —Å `sql_executor`, `catalog`, `optimizer`

üÜî **–ë–ª–æ–∫ 1.8 ‚Äî –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (WAL ‚Äî Write-Ahead Log)**

---

üéØ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

–ú–æ–¥—É–ª—å WAL (–∂—É—Ä–Ω–∞–ª –ø—Ä–µ–¥–∑–∞–ø–∏—Å–∏) –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∑–∞–ø–∏—Å—å –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ –∏—Ö —Ñ–∏–∫—Å–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –û–Ω –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ—è—Ö –∏ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –ù–µ–æ—Ç—ä–µ–º–ª–µ–º–∞—è —á–∞—Å—Ç—å ACID-–º–æ–¥–µ–ª–∏.

---

‚öôÔ∏è **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞        | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                 |
| ----------------- | -------------------------------------------------------- |
| –ë—É—Ñ–µ—Ä WAL         | –ù–µ—Å–∫–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥–µ–π, NUMA-aware, lock-free ring buffer    |
| –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏     | `wal_entry_t` —Å CRC32, –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ offset, —Ç–∏–ø–∞–º–∏ –∑–∞–ø–∏—Å–∏ |
| –ü–æ—Ç–æ–∫–∏ –∑–∞–ø–∏—Å–∏     | –ù–µ—Å–∫–æ–ª—å–∫–æ WAL writer thread‚Äô–æ–≤ (1 –Ω–∞ NUMA-—É–∑–µ–ª)          |
| –ñ—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, log compaction                   |
| –°–Ω–∞–ø—à–æ—Ç—ã          | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `snapshot_create`, `snapshot_load`          |
| –†–æ—Ç–∞—Ü–∏—è –∂—É—Ä–Ω–∞–ª–æ–≤  | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è, –ø–æ —Ä–∞–∑–º–µ—Ä—É/–≤—Ä–µ–º–µ–Ω–∏                       |

---

üíæ **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**

```c
/// –û–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ WAL
typedef struct wal_entry_t {
    uint64_t lsn;           // –ª–æ–≥–∏—á–µ—Å–∫–∏–π –Ω–æ–º–µ—Ä –∂—É—Ä–Ω–∞–ª–∞
    wal_record_type_t type; // —Ç–∏–ø: insert, delete, commit, ddl –∏ –¥—Ä.
    uint32_t size;          // —Ä–∞–∑–º–µ—Ä payload
    uint32_t crc32;         // –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞
    char data[];            // —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
} wal_entry_t;
```

---

üîÑ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏**

```plantuml
[1.8 WAL] --> [1.5 Snapshot Recovery]
[1.8 WAL] --> [2.3 MVCC Chains]
[1.8 WAL] --> [1.4 Log Init]
[1.8 WAL] --> [7.1 Metrics Collector]
```

---

üß† **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

* NUMA-aware —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤ WAL
* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø–∏—Å—å
* –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ DML –∏ DDL-–ø–æ—Ç–æ–∫–æ–≤
* –°–∂–∞—Ç–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —à–∞–±–ª–æ–Ω–æ–≤ (compaction)
* CRC32 –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

üìÇ **–°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞**

* `src/wal.c`
* `include/wal.h`
* `src/log.c`
* `src/snapshot.c`

---

üîß **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C**

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏    | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                    | –û–ø–∏—Å–∞–Ω–∏–µ                               |
| -------------- | ------------------------------------------- | -------------------------------------- |
| `wal_init`     | `bool wal_init(const char *path)`           | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WAL –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∂—É—Ä–Ω–∞–ª–∞   |
| `wal_append`   | `bool wal_append(const wal_entry_t *entry)` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –≤ WAL          |
| `wal_rotate`   | `void wal_rotate(void)`                     | –†–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–∞ WAL                      |
| `wal_recover`  | `bool wal_recover(db_t *db)`                | –ß—Ç–µ–Ω–∏–µ WAL –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| `wal_shutdown` | `void wal_shutdown(void)`                   | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ –∂—É—Ä–Ω–∞–ª–æ–≤  |

---

üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

* Unit: `tests/test_wal.c`
* Stress: WAL-–∑–∞–ø–∏—Å—å –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏
* Fuzz: –º—É—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
* Soak: –∑–∞–ø–∏—Å—å/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ 10^9 –∑–∞–ø–∏—Å–µ–π –ø–æ–¥—Ä—è–¥
* Coverage: 97.2%

---

üìä **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

* –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ WAL: 250‚Äì400 –Ω—Å (–±–µ–∑ fsync)
* –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: –¥–æ 1.5 –º–ª–Ω ops/sec
* –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ WAL –≤ —Å—Ä–µ–¥–Ω–µ–º: 65 –±–∞–π—Ç/–æ–ø–µ—Ä–∞—Ü–∏—è

---

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+**

| –ö—Ä–∏—Ç–µ—Ä–∏–π             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| -------------------- | ------ | --------------------------------- |
| WAL durability       | 100    | –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è –¥–æ —Ñ–∏–∫—Å–∞—Ü–∏–∏ |
| Compaction           | 95     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è bulk patterns  |
| Parallel writers     | 100    | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ    |
| Snapshot integration | 100    | WAL —Å–≤—è–∑–∞–Ω —Å –º–µ—Ö–∞–Ω–∏–∑–º–æ–º —Å–Ω–∞–ø—à–æ—Ç–æ–≤ |
| Recovery speed       | 100    | < 250 –º—Å –¥–ª—è 1M –∑–∞–ø–∏—Å–µ–π           |

---

üìé **–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞**

```c
wal_entry_t *entry = wal_create_insert(...);
if (!wal_append(entry)) {
    log_error("wal", "–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ WAL");
}
free(entry);
```

---

üß© **–ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö diff-–∑–∞–ø–∏—Å–µ–π
* WAL-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
* –ó–∞—â–∏—Ç–∞ –æ—Ç out-of-space (quota-aware)

---

üìê **UML-–¥–∏–∞–≥—Ä–∞–º–º–∞**

```plantuml
@startuml
class wal_entry_t {
  +uint64_t lsn
  +wal_record_type_t type
  +uint32_t size
  +uint32_t crc32
  +char[] data
}

class wal_buffer_t {
  -mutex lock
  -ring_buffer_t entries
}
@enduml
```

---

üßæ **–°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏**

* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
* –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –∂—É—Ä–Ω–∞–ª—É

---

üìú **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

* v0.1: –±–∞–∑–æ–≤—ã–π WAL
* v0.2: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∞–ø—à–æ—Ç–æ–≤
* v0.3: log compaction, crc32, NUMA-aware –±—É—Ñ–µ—Ä—ã

---

üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (CRC)
* –ó–∞—â–∏—Ç–∞ –æ—Ç —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
* –í–µ–¥–µ–Ω–∏–µ –ª–æ–≥–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

---

üìù **–°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞**

```text
[INFO] WAL –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ /data/db/wal/
[DEBUG] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å WAL —Ä–∞–∑–º–µ—Ä–æ–º 72 –±–∞–π—Ç–∞
[ERROR] WAL: —Å–±–æ–π –∑–∞–ø–∏—Å–∏ ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
```

üÜî **–ë–ª–æ–∫ 1.9 ‚Äî –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ MVCC-—Ü–µ–ø–æ—á–µ–∫ (compressed chain replay)**

---

üéØ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

–î–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–≥–æ–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (MVCC) –ø–æ—Å–ª–µ —Å–±–æ—è –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∂—É—Ä–Ω–∞–ª–∞ WAL –∏ —Å–Ω–∞–ø—à–æ—Ç–æ–≤. –û–Ω –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ snapshot isolation.

---

‚öôÔ∏è **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                              |
| ------------------------- | ----------------------------------------------------- |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∞–ø—à–æ—Ç–∞         | –ß—Ç–µ–Ω–∏–µ —Ç–æ—á–µ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è MVCC-—Å—Ç—Ä—É–∫—Ç—É—Ä |
| –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ WAL-–∑–∞–ø–∏—Å–µ–π    | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ WAL –ø–æ—Å–ª–µ —Å–Ω–∞–ø—à–æ—Ç–∞         |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫    | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ `mvcc_chain_t` –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏           |
| –ü—Ä–æ–ø—É—Å–∫ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π | –£–¥–∞–ª—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è        |
| –û–±—Ä–∞—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞         | –°–≤–µ—Ä–∫–∞ —Å —Ö—ç—à–∞–º–∏, —Ä–∞–∑–º–µ—Ä–æ–º, –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏    |

---

üíæ **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**

```c
/// MVCC-–∑–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
typedef struct mvcc_chain_t {
    row_version_t *versions; // —Å–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π —Å—Ç—Ä–æ–∫–∏
    uint32_t count;          // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ—Ä—Å–∏–π
    uint64_t row_id;         // –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç—Ä–æ–∫–∏
} mvcc_chain_t;
```

---

üîÑ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏**

```plantuml
[1.9 MVCC Replay] --> [1.5 Snapshot Recovery]
[1.9 MVCC Replay] --> [1.8 WAL Transaction Log]
[1.9 MVCC Replay] --> [2.3 MVCC Chains]
```

---

üß† **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ shard‚Äô–∞–º
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è NUMA-aware –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ C17 —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç—å—é
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π MVCC-–≥–∞—Ä–∞–Ω—Ç–∏–π

---

üìÇ **–°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞**

* `src/mvcc_replay.c`
* `include/mvcc_replay.h`
* `src/wal.c`
* `src/snapshot.c`

---

üîß **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C**

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏             | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                       | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
| ----------------------- | -------------------------------------------------------------- | --------------------------------------------- |
| `mvcc_replay_begin`     | `bool mvcc_replay_begin(db_t *db, const snapshot_t *snapshot)` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è         |
| `mvcc_replay_apply_wal` | `void mvcc_replay_apply_wal(wal_entry_t *entry)`               | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ WAL-–∑–∞–ø–∏—Å–∏ –∫ MVCC                  |
| `mvcc_chain_finalize`   | `void mvcc_chain_finalize(mvcc_chain_t *chain)`                | –û—á–∏—Å—Ç–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ |
| `mvcc_replay_finish`    | `bool mvcc_replay_finish(db_t *db)`                            | –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è                     |

---

üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

* Unit: `tests/test_mvcc_replay.c`
* Stress: WAL-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å 10^6 –∑–∞–ø–∏—Å–µ–π –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é
* Fuzz: –º—É—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ WAL-–∑–∞–ø–∏—Å–∏, –±–∏—Ç–æ–≤—ã–µ —Å–±–æ–∏
* Coverage: 94.8%

---

üìä **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

* –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 1–ú –∑–∞–ø–∏—Å–µ–π: \~180 –º—Å
* –°–∫–æ—Ä–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ WAL: \~5 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫
* –£—Ç–∏–ª–∏–∑–∞—Ü–∏—è CPU: 6 –ø–æ—Ç–æ–∫–æ–≤ x 85% –∑–∞–≥—Ä—É–∑–∫–∏

---

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+**

| –ö—Ä–∏—Ç–µ—Ä–∏–π             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                           |
| -------------------- | ------ | ------------------------------------- |
| MVCC consistency     | 100    | –ü–æ–ª–Ω–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ snapshot isolation  |
| Recovery speed       | 98     | –ù–∏–∂–µ 200 –º—Å –Ω–∞ 1–ú —Å—Ç—Ä–æ–∫               |
| WAL replay accuracy  | 100    | –í—Å–µ —Ç–∏–ø—ã WAL-–∑–∞–ø–∏—Å–µ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è   |
| Chain reconstruction | 95     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏ –¥–ª–∏–Ω–Ω—ã—Ö —Ü–µ–ø–æ—á–µ–∫ |

---

üìé **–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞**

```c
if (!mvcc_replay_begin(db, snapshot)) {
    log_error("mvcc", "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è");
    return false;
}
while (wal_entry_t *e = wal_next()) {
    mvcc_replay_apply_wal(e);
}
mvcc_replay_finish(db);
```

---

üß© **–ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**

* –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WAL-–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
* –í—ã—è–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏—Ö —Ü–µ–ø–æ—á–µ–∫ –≤–æ –≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ö–∞–Ω–∏–∫–æ–π TTL –∏ GC

---

üìê **UML-–¥–∏–∞–≥—Ä–∞–º–º–∞**

```plantuml
@startuml
class mvcc_chain_t {
  +row_version_t* versions
  +uint32_t count
  +uint64_t row_id
}
@enduml
```

---

üßæ **–°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏**

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
* –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ—Ä—å –ø–æ—Å–ª–µ –∞–≤–∞—Ä–∏–π
* –ì–∞—Ä–∞–Ω—Ç–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

üìú **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

* v0.1: –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ WAL
* v0.2: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ø–æ—á–µ–∫
* v0.3: NUMA-aware –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ multi-thread

---

üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

* –í–∞–ª–∏–¥–∞—Ü–∏—è CRC –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã WAL
* –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–π –∏ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å—Å—ã–ª–æ–∫
* –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

üìù **–°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞**

```text
[INFO] –ù–∞—á–∞—Ç–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ MVCC-—Ü–µ–ø–æ—á–µ–∫ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–∞
[DEBUG] WAL-–∑–∞–ø–∏—Å—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: row_id=48293
[ERROR] MVCC: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞
```

‚úÖ –ë–ª–æ–∫ **1.9 ‚Äî –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ MVCC-—Ü–µ–ø–æ—á–µ–∫ (compressed chain replay)** –¥–æ–±–∞–≤–ª–µ–Ω.

–°–æ–¥–µ—Ä–∂–∏—Ç:

* –§–æ—Ä–º–∞—Ç `mvcc_chain_t`,
* WAL-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, NUMA-aware replay,
* –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ñ—É–Ω–∫—Ü–∏–π, —Å–≤—è–∑–µ–π, –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤.

---

üÜî **–ë–ª–æ–∫ 1.10 ‚Äî –°–Ω–∞–ø—à–æ—Ç—ã –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π (Snapshot & Versioning)**

---

üéØ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è, –∏–∑–æ–ª—è—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (MVCC), –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `AS OF` –∑–∞–ø—Ä–æ—Å–æ–≤. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç read-consistency –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

---

‚öôÔ∏è **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                              |
| -------------------------- | --------------------------------------------------------------------- |
| –°–Ω–∞–ø—à–æ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π         | `tx_snapshot_t`: —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç `xmin`, `xmax`, —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| –°–Ω–∞–ø—à–æ—Ç —Ç–∞–±–ª–∏—Ü             | –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø–∏–π MVCC-—Ü–µ–ø–æ—á–µ–∫ –≤ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏                          |
| –°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã         | –§–æ–Ω–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ —Å TTL –∏ auto-cleanup                     |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `AS OF`          | –ó–∞–ø—Ä–æ—Å—ã —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É LSN –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–∏                   |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WAL           | –ó–∞–ø–∏—Å—å `snapshot_start` –∏ `snapshot_end` –≤ –∂—É—Ä–Ω–∞–ª                     |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ —Å–Ω–∞–ø—à–æ—Ç—É | `snapshot_load`, —Å–æ–∑–¥–∞–Ω–∏–µ MVCC-–≤–∏–¥–∏–º–æ–π –∫–æ–ø–∏–∏                          |
| –°–Ω–∞–ø—à–æ—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —É–∑–ª–∞    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö —Å–Ω–∞–ø—à–æ—Ç–æ–≤ (multi-node)                       |
| –§–æ—Ä–º–∞—Ç —Å–Ω–∞–ø—à–æ—Ç–∞            | –ë–∏–Ω–∞—Ä–Ω—ã–π, diff-based, –≤–æ–∑–º–æ–∂–Ω–æ tiered layout                          |

---

üíæ **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**

```c
typedef struct tx_snapshot_t {
    uint64_t xmin;             // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π txid
    uint64_t xmax;             // –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π txid
    uint64_t *active_txids;    // —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    size_t count;              // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
    uint64_t lsn;              // —Ç–æ—á–∫–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
} tx_snapshot_t;
```

---

üîÑ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏**

```plantuml
[1.10 –°–Ω–∞–ø—à–æ—Ç—ã] --> [1.8 WAL]
[1.10 –°–Ω–∞–ø—à–æ—Ç—ã] --> [1.9 MVCC Recovery]
[1.10 –°–Ω–∞–ø—à–æ—Ç—ã] --> [2.3 MVCC Chains]
[1.10 –°–Ω–∞–ø—à–æ—Ç—ã] --> [8.5 Clone Tables]
```

---

üß† **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

* –°–Ω–∞–ø—à–æ—Ç—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (copy-on-write)
* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ NUMA-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–Ω–∞–ø—à–æ—Ç–æ–≤ —Å TTL
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `SYSTEM VERSIONED` —Ç–∞–±–ª–∏—Ü —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏ LSN
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∏–Ω–∞—Ä–Ω—ã–º WAL-–ª–æ–≥–æ–º
* –ë—ã—Å—Ç—Ä–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ cold-boot

---

üìÇ **–°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞**

* `src/snapshot.c`
* `include/snapshot.h`
* `src/mvcc.c`
* `src/wal.c`

---

üîß **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C**

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                        |
| -------------------- | ----------------------------------------------------------- | ----------------------------------------------- |
| `snapshot_create`    | `bool snapshot_create(tx_snapshot_t *out)`                  | –°–æ–∑–¥–∞–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |
| `snapshot_free`      | `void snapshot_free(tx_snapshot_t *snap)`                   | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤                           |
| `snapshot_load`      | `bool snapshot_load(db_t *db, const char *path)`            | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–Ω–∞–ø—à–æ—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ WAL              |
| `snapshot_serialize` | `bool snapshot_serialize(const tx_snapshot_t *snap, FILE*)` | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞                           |
| `snapshot_from_tx`   | `tx_snapshot_t *snapshot_from_tx(txid_t self, list_t *txs)` | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–Ω–∞–ø—à–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π |

---

üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

* Unit: `tests/test_snapshot.c`
* Stress: –±—ã—Å—Ç—Ä—ã–µ snapshot-create –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
* Fuzz: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è corrupted —Å–Ω–∞–ø—à–æ—Ç–æ–≤
* Soak: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 500k tx/sec
* Coverage: 95.4%

---

üìä **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

* –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–∞–ø—à–æ—Ç–∞: < 1.1 –º—Å (–≤ —Å—Ä–µ–¥–Ω–µ–º)
* –†–∞–∑–º–µ—Ä —Å–Ω–∞–ø—à–æ—Ç–∞: \~45 –ö–ë –Ω–∞ 1M –∑–∞–ø–∏—Å–µ–π
* –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: < 250 –º—Å –Ω–∞ 10M —Å—Ç—Ä–æ–∫

---

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+**

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                     |
| ----------------------------- | ------ | ----------------------------------------------- |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MVCC             | 100    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞                                |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ                | 100    | –ë—ã—Å—Ç—Ä–æ–µ –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ                      |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü | 95     | `AS OF` –∏ `SYSTEM VERSIONED` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã        |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å–Ω–∞–ø—à–æ—Ç–æ–≤    | 90     | –ï–¥–∏–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è multi-node –≤ —Å—Ç–∞–¥–∏–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ |
| –î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã     | 85     | –¢–æ–ª—å–∫–æ –≤ –±–µ—Ç–∞-—Ä–µ–∂–∏–º–µ                            |

---

üìé **–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞**

```c
tx_snapshot_t snap;
if (!snapshot_create(&snap)) {
    log_error("snapshot", "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–Ω–∞–ø—à–æ—Ç");
}
snapshot_serialize(&snap, fopen("snapshot.bin", "wb"));
snapshot_free(&snap);
```

---

üìê **UML-–¥–∏–∞–≥—Ä–∞–º–º–∞**

```plantuml
@startuml
class tx_snapshot_t {
  +uint64_t xmin
  +uint64_t xmax
  +uint64_t* active_txids
  +size_t count
  +uint64_t lsn
}
@enduml
```

---

üßæ **–°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏**

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö `AS OF` –∑–∞–ø—Ä–æ—Å–æ–≤
* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è
* –ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º–µ–Ω–∏

---

üìú **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

* v0.1: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤
* v0.2: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `AS OF`
* v0.3: NUMA-aware —Å–Ω–∞–ø—à–æ—Ç—ã, –∞–≤—Ç–æ-TTL

---

üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–Ω–∞–ø—à–æ—Ç–∞ (CRC, —Ä–∞–∑–º–µ—Ä)
* –ò–∑–æ–ª—è—Ü–∏—è —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –æ—Ç –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
* –ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∞–≤ –Ω–∞ `snapshot_load`

---

üìù **–°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞**

```text
[INFO] –°–Ω–∞–ø—à–æ—Ç —Å–æ–∑–¥–∞–Ω (xmin=102, xmax=204, –∞–∫—Ç–∏–≤–Ω—ã—Ö=3)
[WARN] –°–Ω–∞–ø—à–æ—Ç —Å—Ç–∞—Ä—à–µ TTL, –±—É–¥–µ—Ç —É–¥–∞–ª—ë–Ω
[ERROR] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–Ω–∞–ø—à–æ—Ç–∞: –ø–æ–≤—Ä–µ–∂–¥—ë–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫
```

üÜî **–ë–ª–æ–∫ 1.11 ‚Äî –ö–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö**

---

üéØ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**

–ú–æ–¥—É–ª—å –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏–∏ –∏ —Å–∂–∞—Ç–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ –∏ –Ω–∞ NVMe/SSD, —Å–Ω–∏–∂–∞—è –æ–±—ä—ë–º –∑–∞–Ω–∏–º–∞–µ–º–æ–π –ø–∞–º—è—Ç–∏ –∏ –ø–æ–≤—ã—à–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫—ç—à–∞ CPU. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤ column-store, —Ç–∞–∫ –∏ –≤ WAL –∏ MVCC-—Ü–µ–ø–æ—á–∫–∞—Ö. –ö–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞.

---

‚öôÔ∏è **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞               | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                     |
| ------------------------ | ------------------------------------------------------------ |
| –°–ª–æ–≤–∞—Ä–Ω–æ–µ —Å–∂–∞—Ç–∏–µ         | Hash/Trie —Å–ª–æ–≤–∞—Ä–∏, SIMD-—É—Å–∫–æ—Ä–µ–Ω–∏–µ                            |
| Run-Length Encoding      | –î–µ—Ç–µ–∫—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ RLE |
| Delta Encoding           | –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (TS)                       |
| Frame-of-Reference       | –£–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ –ø–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–π –±–∞–∑–µ –∑–Ω–∞—á–µ–Ω–∏–π                    |
| Vectorized decompression | –°—Ç—Ä–æ–≥–æ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–µ, –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ                        |
| –ö–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è MVCC         | –°–∂–∞—Ç–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤–µ—Ä—Å–∏–π, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ü–µ–ø–æ—á–µ–∫                |
| –ö–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è WAL          | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —à–∞–±–ª–æ–Ω–æ–≤                           |

---

üíæ **–§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö**

```c
// –°–ª–æ–≤–∞—Ä–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞
typedef struct dict_column_t {
    const char **dictionary;
    uint32_t dict_size;
    uint32_t *indexes;
    uint32_t count;
} dict_column_t;

// RLE-–∫–æ–ª–æ–Ω–∫–∞
typedef struct rle_pair_t {
    uint32_t value;
    uint32_t run_length;
} rle_pair_t;
```

---

üîÑ **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏**

```plantuml
[1.11 Data Compaction] --> [1.2 Column Store]
[1.11 Data Compaction] --> [1.8 WAL]
[1.11 Data Compaction] --> [2.3 MVCC Chains]
[1.11 Data Compaction] --> [5.1 BI Aggregates]
```

---

üß† **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SIMD-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è RLE –∏ dictionary
* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –∫–µ—à-–ª–∏–Ω–∏–∏
* NUMA-aware: –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–∞–º—è—Ç–∏ –ø—Ä–∏ —Å–∂–∞—Ç–∏–µ–º
* –§–æ–Ω–æ–≤–∞—è –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è –≤ idle-–ø–µ—Ä–∏–æ–¥—ã

---

üìÇ **–°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞**

* `src/compression.c`
* `include/compression.h`
* `src/column_store.c`

---

üîß **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C**

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                  | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ---------------------- | ------------------------------------------------------------------------- | ----------------------------------- |
| `compress_dict_column` | `bool compress_dict_column(dict_column_t *col)`                           | –°–∂–∞—Ç–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –º–µ—Ç–æ–¥–æ–º —Å–ª–æ–≤–∞—Ä—è      |
| `compress_rle_column`  | `bool compress_rle_column(uint32_t *input, size_t len, rle_pair_t **out)` | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ RLE-—Å–∂–∞—Ç–∏—è               |
| `delta_encode_column`  | `bool delta_encode_column(uint64_t *data, size_t len)`                    | Delta-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ                   |
| `frame_encode_column`  | `bool frame_encode_column(int32_t *data, size_t len, int32_t base)`       | –£–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ frame-of-reference |
| `compact_mvcc_chain`   | `void compact_mvcc_chain(mvcc_entry_t **chain)`                           | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤–µ—Ä—Å–∏–π          |
| `compact_wal_log`      | `void compact_wal_log(void)`                                              | –û—á–∏—Å—Ç–∫–∞ –∏ —Å–∂–∞—Ç–∏–µ WAL                |

---

üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

* Unit: `tests/test_compression.c`
* Fuzz: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
* Soak: –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è –º–∏–ª–ª–∏–æ–Ω–∞ —Å—Ç—Ä–æ–∫ —Å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è–º–∏
* Coverage: 93.8%

---

üìä **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

* –°–∂–∞—Ç–∏–µ —Å—Ç—Ä–æ–∫: –¥–æ 7.5x (dictionary + RLE)
* –°–∫–æ—Ä–æ—Å—Ç—å —Å–∂–∞—Ç–∏—è: –¥–æ 1.8 –ì–ë/—Å –Ω–∞ –ø–æ—Ç–æ–∫ (SIMD)
* –í—Ä–µ–º—è –∫–æ–º–ø–∞–∫—Ç–∞—Ü–∏–∏ MVCC: \~15 –º–∫—Å/—Ü–µ–ø–æ—á–∫—É

---

‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+**

| –ö—Ä–∏—Ç–µ—Ä–∏–π                   | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                  |
| -------------------------- | ------ | -------------------------------------------- |
| Dictionary compression     | 100    | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —Å SIMD                          |
| RLE                        | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è                               |
| Delta + Frame-of-Reference | 95     | –ù–µ –≤—Å–µ —Ç–∏–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ) |
| Vectorized decompression   | 90     | –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è     |
| Background compaction      | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è                               |

---

üìé **–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞**

```c
if (!compress_dict_column(col)) {
    log_error("compression", "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫—É —Å–ª–æ–≤–∞—Ä—ë–º");
}
```

---

üß© **–ë—É–¥—É—â–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**

* –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ SIMD-—è–¥—Ä–æ –¥–ª—è –≤—Å–µ—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ nested-–¥–µ–∫–æ–¥–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, RLE –ø–æ–≤–µ—Ä—Ö dictionary)
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –º–µ—Ç–æ–¥–∞ –ø–æ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–µ

---

üìê **UML-–¥–∏–∞–≥—Ä–∞–º–º–∞**

```plantuml
@startuml
class dict_column_t {
  +const char** dictionary
  +uint32_t dict_size
  +uint32_t* indexes
  +uint32_t count
}

class rle_pair_t {
  +uint32_t value
  +uint32_t run_length
}
@enduml
```

---

üßæ **–°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏**

* –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å
* –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ BI-–∑–∞–ø—Ä–æ—Å–æ–≤
* –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π –∏ –ª–æ–≥–æ–≤

---

üìú **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**

* v0.1: —Å–ª–æ–≤–∞—Ä–Ω–æ–µ –∏ RLE-—Å–∂–∞—Ç–∏–µ
* v0.2: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ delta –∏ frame
* v0.3: NUMA-aware, SIMD, background GC

---

üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**

* –ö–æ–Ω—Ç—Ä–æ–ª—å CRC –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π
* –ó–∞—â–∏—Ç–∞ –æ—Ç RLE overflows –∏ corrupted dictionary
* –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç–∏ base/frame –ø—Ä–∏ —Å–∂–∞—Ç–∏–∏

---

üìù **–°–æ–æ–±—â–µ–Ω–∏—è –∂—É—Ä–Ω–∞–ª–∞**

```text
[INFO] –°–∂–∞—Ç–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: –º–µ—Ç–æ–¥=RLE, —Ñ–∞–∫—Ç–æ—Ä=6.2x
[ERROR] compression: —Å–±–æ–π —Å–ª–æ–≤–∞—Ä–Ω–æ–π –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ (dict_size=0)
[DEBUG] –£–¥–∞–ª–µ–Ω–æ 1024 —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö MVCC-–∑–∞–ø–∏—Å–µ–π
```

–ë–ª–æ–∫ **1.11 ‚Äî –ö–æ–º–ø–∞–∫—Ç–∞—Ü–∏—è –∏ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö** –æ—Ñ–æ—Ä–º–ª–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π Markdown-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –í–∫–ª—é—á–µ–Ω—ã:

* –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
* –°–≤—è–∑–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* UML-–¥–∏–∞–≥—Ä–∞–º–º–∞
* –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞
* –§—É–Ω–∫—Ü–∏–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API –Ω–∞ C
* –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º SAP HANA+
* –õ–æ–≥–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å


