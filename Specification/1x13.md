# ‚è≥ –ë–ª–æ–∫ 1.13 ‚Äî TTL, Eviction, Auto-tiering

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                           |
| --------- | ---------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ        |
| üî¢ –ë–ª–æ–∫   | 1.13 ‚Äî TTL, Eviction, Auto-tiering |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∏–ª–∏ —Ä–µ–¥–∫–æ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –∏–∑ in-memory –æ–±–ª–∞—Å—Ç–∏ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ (TTL), —É—Ä–æ–≤–Ω—è–º —Ö—Ä–∞–Ω–µ–Ω–∏—è (auto-tiering) –∏–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è (Eviction). –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è:

* —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é,
* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏,
* —Å–æ–±–ª—é–¥–µ–Ω–∏—è SLA –∏ –ø–æ–ª–∏—Ç–∏–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (GDPR, DPA).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                           |
| ------------------ | ------------------------------------------------------------------ |
| TTL (time-to-live) | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫–∏, —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã      |
| Eviction Engine    | –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ LRU/ARC, –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏ |
| Auto-tiering       | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ö–æ–ª–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ SSD/NVMe –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏  |
| Expired Scan       | –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (TTL Garbage Collector)         |
| Adaptive Policy    | –£—á—ë—Ç —á–∞—Å—Ç–æ—Ç—ã –¥–æ—Å—Ç—É–ø–∞, –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏                 |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏         | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                             | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                              |
| ------------------- | ---------------------------------------------------- | --------------------------------------- |
| `ttl_register()`    | `void ttl_register(object_t *obj, time_t expire_ts)` | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ä–æ–∫–∞ –∂–∏–∑–Ω–∏                   |
| `ttl_check()`       | `bool ttl_check(const object_t *obj)`                | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL                  |
| `eviction_run()`    | `void eviction_run(size_t pages)`                    | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü       |
| `tiering_migrate()` | `void tiering_migrate(page_t *pg, tier_level_t dst)` | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π tier    |
| `ttl_gc_loop()`     | `void *ttl_gc_loop(void *arg)`                       | –§–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                       | –ò—Å—Ç–æ—á–Ω–∏–∫        | –¶–µ–ª—å                 |
| ----------------------------- | --------------- | -------------------- |
| `ttl_expired_objects_per_min` | GC Thread       | ‚â• 10k/min            |
| `evicted_pages_per_sec`       | Eviction Engine | > 5k/—Å–µ–∫             |
| `tier_migration_events`       | Tiering Manager | ‚â• 90% –ø–æ cold –¥–∞–Ω–Ω—ã–º |
| `avg_ttl_ms`                  | TTL subsystem   | > 120 000            |
| `memory_freed_by_eviction_mb` | Page Manager    | ‚â• 500 –ú–ë             |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/ttl.c
src/eviction.c
src/tiering.c
include/ttl.h
include/eviction.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è wheel timer / hashed-timer –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è TTL
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `ttl_expr = NOW() + INTERVAL 'N SECONDS'` –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL
* –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (lock-free queues + atomic mark)
* Eviction –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ page-level hotness –∏ ARC/LRU –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö
* Auto-tiering –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ latency-aware cost-–º–æ–¥–µ–ª—è—Ö

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                          | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω              |
| --------- | -------------------------------------------- | --------------------------- |
| Unit      | TTL expiry, eviction –ø–æ –ª–∏–º–∏—Ç–∞–º              | `tests/ttl/test_expiry.c`   |
| Stress    | –ù–∞–≥—Ä—É–∑–∫–∞ 10M TTL-—Å—Ç—Ä–æ–∫ / –º–∞—Å—Å–æ–≤–æ–µ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ | `tests/stress/evict_ttl.c`  |
| Fuzz      | –†–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ ttl, temperature, access   | `fuzz/fuzz_eviction.c`      |
| Soak      | –ú–µ—Å—è—á–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≥–æ—Ä—è—á–∏–µ/—Ö–æ–ª–æ–¥–Ω—ã–µ tier'—ã | `tests/soak/auto_tiering.c` |

---

## üìê UML ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ TTL + Eviction

```plantuml
@startuml
class Object {
  +expire_ts : time_t
}

class TTLManager {
  +ttl_check()
  +ttl_gc_loop()
}

class EvictionEngine {
  +eviction_run()
}

Object --> TTLManager
TTLManager --> EvictionEngine
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                            |
| ---------------------------- | ------ | -------------------------------------- |
| TTL –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫–∏/—Ç–∞–±–ª–∏—Ü—ã | 100    | –ï—Å—Ç—å –∏ TTL GC                          |
| –ü–æ–ª–∏—Ç–∏–∫–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è          | 90     | LRU/ARC + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å temperature     |
| Auto-tiering SSD             | 95     | latency-aware + configurable migration |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
ttl_register(obj, time(NULL) + 3600); // –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 1 —á–∞—Å
if (ttl_check(obj)) {
    log_info("ttl", "–û–±—ä–µ–∫—Ç —É—Å—Ç–∞—Ä–µ–ª");
}
eviction_run(128); // –≤—ã—Ç–µ—Å–Ω–∏—Ç—å 128 —Å—Ç—Ä–∞–Ω–∏—Ü
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è (compliance)
* –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è in-memory –æ–±—ä–µ–º–∞
* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ OOM / degradation –ø–æ–¥ –ø–∏–∫–æ–≤—ã–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏
