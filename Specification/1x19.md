# üßÆ –ë–ª–æ–∫ 1.19 ‚Äî Frame-of-Reference –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å–∂–∞—Ç–∏–µ

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                     |
| --------- | -------------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ                  |
| üî¢ –ë–ª–æ–∫   | 1.19 ‚Äî Frame-of-Reference –∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Å–∂–∞—Ç–∏–µ |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è, –≤–∫–ª—é—á–∞—è:

* **Frame-of-Reference (FoR)**: —Å–∂–∞—Ç–∏–µ —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–∞–∑–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (frame),
* **Delta + Bitpacking**: —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ—Å—Ç–µ–π —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º –±–∏—Ç,
* **Vectorized Encoding**: —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–µ —Å–∂–∞—Ç–∏–µ/–¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è —Ü–µ–ª—ã–º–∏ –≤–µ–∫—Ç–æ—Ä–∞–º–∏,
* **Adaptivity**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å—Ö–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (TS, OLAP).

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞               | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                 |
| ------------------------ | ------------------------------------------------------------------------ |
| FoR Encoding             | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ int32/int64/float64, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä base/frame           |
| Delta Encoding           | –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ—Å—Ç–µ–π                                       |
| Bit-Packed Compression   | –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –±–∏—Ç –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ: 1‚Äì64 –±–∏—Ç–∞                                   |
| Vectorized Decompression | SIMD / AVX2 / AVX-512 –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è —Ü–µ–ª—ã–º–∏ –±–ª–æ–∫–∞–º–∏                        |
| Fallback mechanism       | –ï—Å–ª–∏ —Å–∂–∞—Ç–∏–µ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ raw –∏–ª–∏ dictionary |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                   | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                                           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
| ----------------------------- | ---------------------------------------------------------------------------------- | ---------------------------- |
| `for_encode_vector()`         | `size_t for_encode_vector(const int32_t *in, size_t count, uint8_t *out)`          | –°–∂–∞—Ç–∏–µ FoR + delta + bitpack |
| `for_decode_vector()`         | `size_t for_decode_vector(const uint8_t *in, size_t count, int32_t *out)`          | –†–∞—Å–ø–∞–∫–æ–≤–∫–∞ FoR               |
| `bitpack_vector()`            | `void bitpack_vector(uint64_t *in, uint8_t *out, size_t count, uint8_t bits)`      | –ü–æ–±–∏—Ç–æ–≤–æ–µ —É–ø–ª–æ—Ç–Ω–µ–Ω–∏–µ         |
| `unpack_vector()`             | `void unpack_vector(const uint8_t *in, uint64_t *out, size_t count, uint8_t bits)` | –û–±—Ä–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ      |
| `compression_estimate_gain()` | `double compression_estimate_gain(const int64_t *in, size_t n)`                    | –û—Ü–µ–Ω–∫–∞ –≤—ã–≥–æ–¥—ã —Å–∂–∞—Ç–∏—è         |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ò—Å—Ç–æ—á–Ω–∏–∫             | –¶–µ–ª—å            |
| -------------------------- | -------------------- | --------------- |
| `compression_ratio`        | Compression Engine   | > 4:1           |
| `decompression_throughput` | Vector Exec Profiler | > 1 –ì–ë/—Å        |
| `encoding_latency_ns`      | Benchmarks           | < 500 –Ω—Å/–∑–∞–ø–∏—Å—å |
| `adaptive_mode_usage_rate` | Runtime Optimizer    | > 80%           |
| `bitpacking_efficiency`    | Bit Analyzer         | > 90%           |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/compress_for.c
src/bitpacking.c
include/compress_for.h
include/bitpacking.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è AVX2 / AVX-512 –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã, —á–µ—Ä–µ–∑ inline assembly –∏–ª–∏ intrinsics
* Memory-aligned –±—É—Ñ–µ—Ä—ã –ø–æ–¥ SIMD-–æ–ø–µ—Ä–∞—Ü–∏–∏
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–µ–∂–¥—É raw, RLE, FoR –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç entropy
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è/–¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –≤ scan-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞—Ö
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ FoR –≤–Ω—É—Ç—Ä–∏ column-store –∏ Arrow batches

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                        | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                  |
| --------- | ---------------------------------------------------------- | ------------------------------- |
| Unit      | –ü—Ä–æ–≤–µ—Ä–∫–∞ encode/decode + bit-level –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è             | `tests/compression/test_for.c`  |
| SIMD      | –ü—Ä–æ–≤–µ—Ä–∫–∞ SIMD-–¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –Ω–∞ –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã—Ö –±–ª–æ–∫–∞—Ö           | `tests/compression/test_simd.c` |
| Fuzz      | –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å –≥—Ä–∞–Ω–∏—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏       | `fuzz/compress/fuzz_bitpack.c`  |
| Perf      | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–∞ –º–∏–ª–ª–∏–∞—Ä–¥–∞—Ö –∑–Ω–∞—á–µ–Ω–∏–π | `bench/compression/bench.c`     |

---

## üìê UML ‚Äî –°–∂–∞—Ç–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```plantuml
@startuml
class Encoder {
  +for_encode_vector()
  +bitpack_vector()
}

class Decoder {
  +for_decode_vector()
  +unpack_vector()
}

Encoder --> Decoder : compress/decompress stream
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                               | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                             |
| -------------------------------------- | ------ | --------------------------------------- |
| Frame-of-Reference / Delta Encoding    | 100    | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞                        |
| Vectorized Compression / Decompression | 95     | SIMD/AVX —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Arrow / Column Store         | 90     | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å batch API                  |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
int32_t values[1024] = { /* ... */ };
uint8_t buffer[8192];

size_t size = for_encode_vector(values, 1024, buffer);

int32_t out[1024];
for_decode_vector(buffer, 1024, out);
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –°–Ω–∏–∂–∞–µ—Ç –æ–±—ä—ë–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏ in-memory –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
* –ü–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å—á—ë—Ç —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è I/O
* –£—Å–∫–æ—Ä—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ join –∑–∞ —Å—á—ë—Ç –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
