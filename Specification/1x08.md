# üß¨ –ë–ª–æ–∫ 1.8 ‚Äî –°–∂–∞—Ç–∏–µ: Dictionary, RLE, Delta

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                             |
| --------- | ------------------------------------ |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ          |
| üî¢ –ë–ª–æ–∫   | 1.8 ‚Äî –°–∂–∞—Ç–∏–µ: Dictionary, RLE, Delta |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–¶–µ–ª—å –¥–∞–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ ‚Äî —Å–Ω–∏–∂–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–°–∂–∞—Ç–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ:

* **–ö–æ–ª–æ–Ω–æ–∫** (column-store),
* **–°—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π** (materialized views),
* **–ò–Ω–¥–µ–∫—Å–æ–≤**, –µ—Å–ª–∏ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ,
* **–ü–µ—Ä–µ–¥ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –≤ –∫—ç—à**.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞          | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                    |
| ------------------- | ----------------------------------------------------------- |
| Dictionary Encoding | –î–ª—è —Å—Ç—Ä–æ–∫ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π         |
| RLE (Run-Length)    | –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—É–ª–µ–≤—ã–µ –ø–æ–ª—è) |
| Delta Encoding      | –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (timestamp, ID, counters)  |
| Hybrid              | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ–≥–º–µ–Ω—Ç–∞     |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ      | –í—ã–±–æ—Ä –∫–æ–¥–µ–∫–∞ –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ —Å–µ–≥–º–µ–Ω—Ç–∞ (NDV, entropy, freq)    |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                               |
| -------------------- | ----------------------------------------------------------- | ---------------------------------------- |
| `compress_column()`  | `bool compress_column(column_t *, compression_type_t)`      | –°–∂–∞—Ç–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏                |
| `decompress_value()` | `value_t decompress_value(compressed_t *, size_t pos)`      | –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Å–∂–∞—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏     |
| `rle_encode()`       | `compressed_t *rle_encode(value_t *values, size_t count)`   | RLE-—Å–∂–∞—Ç–∏–µ –º–∞—Å—Å–∏–≤–∞ –∑–Ω–∞—á–µ–Ω–∏–π              |
| `dict_build()`       | `dict_t *dict_build(value_t *values, size_t count)`         | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è –¥–ª—è Dictionary-—Å–∂–∞—Ç–∏—è |
| `delta_encode()`     | `compressed_t *delta_encode(int64_t *values, size_t count)` | Delta-—Å–∂–∞—Ç–∏–µ –¥–ª—è int64                   |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                       | –ò—Å—Ç–æ—á–Ω–∏–∫         | –¶–µ–ª—å                          |
| ----------------------------- | ---------------- | ----------------------------- |
| `compression_ratio_avg`       | Column Stats     | ‚â• 3.0x                        |
| `decompression_latency_ns`    | Execution        | < 100 –Ω—Å –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ          |
| `segment_compression_time_ms` | Storage Layer    | ‚â§ 1 –º—Å                        |
| `compressed_memory_saving_mb` | Memory Monitor   | > 40% –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ —Å low-NDV   |
| `codec_selection_accuracy`    | Planner Feedback | ‚â• 90% –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/compression.c
src/compression_dict.c
src/compression_rle.c
src/compression_delta.c
include/compression.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ–≥–º–µ–Ω—Ç–∞ (–ø–æ 4‚Äì64K —Å—Ç—Ä–æ–∫)
* –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞ —ç—Ç–∞–ø–µ INSERT/INGEST —Ä–µ—à–∞–µ—Ç, –∫–∞–∫–æ–π –∫–æ–¥–µ–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≥–æ—Ä—è—á–∞—è –¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –ø–æ —Å—Ç—Ä–æ—á–Ω—ã–º –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞–º
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è—Ö

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                        | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                  |
| --------- | ------------------------------------------ | ------------------------------- |
| Unit      | –°–∂–∞—Ç–∏–µ/–¥–µ–∫–æ–º–ø—Ä–µ—Å—Å–∏—è —Å—Ç—Ä–æ–∫, —á–∏—Å–µ–ª, –±—É–ª–µ–≤—ã—Ö  | `tests/compression/test_all.c`  |
| Fuzz      | –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ RLE –∏ —Å–ª–æ–≤–∞—Ä–µ        | `fuzz/fuzz_compression.c`       |
| Bench     | –ó–∞–º–µ—Ä CPU –ø—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∂–∞—Ç—ã—Ö –¥–∞–Ω–Ω—ã—Ö   | `bench/bench_colscan_compr.c`   |
| Soak      | –ú–∞—Å—Å–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ-–∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π | `tests/stress/compress_write.c` |

---

## üìê UML ‚Äî –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∂–∞—Ç–∏—è

```plantuml
@startuml
interface CompressionCodec
CompressionCodec <|.. DictionaryCodec
CompressionCodec <|.. RLECodec
CompressionCodec <|.. DeltaCodec

class ColumnSegment {
  +CompressionCodec codec
  +compressed_data
}
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                    | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| --------------------------- | ------ | ---------------------------------------- |
| Dictionary encoding         | 100    | –î–ª—è —Å—Ç—Ä–æ–∫, enum, –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π |
| RLE                         | 95     | –£—Å–∫–æ—Ä—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã              |
| Delta encoding              | 90     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ int/long/ts                    |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∫–æ–¥–µ–∫–∞ | 90     | –ù–∞ –æ—Å–Ω–æ–≤–µ NDV/–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º                 |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
column_t *col = table_get_column(tbl, "status");
compress_column(col, COMPR_DICT);
value_t val = decompress_value(col->compressed, 42);
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤ 2‚Äì5 —Ä–∞–∑ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –±–µ–∑ –ø–æ—Ç–µ—Ä—å —Ç–æ—á–Ω–æ—Å—Ç–∏
* –£—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ OLAP-–∑–∞–ø—Ä–æ—Å–∞—Ö
* –ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–Ω–æ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ (—Å—á—ë—Ç—á–∏–∫–∏, —Å–æ–±—ã—Ç–∏—è, –¥–∞—Ç—ã)
