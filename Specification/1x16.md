# üß† –ë–ª–æ–∫ 1.16 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞ –ø–∞–º—è—Ç–∏

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                |
| --------- | --------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ             |
| üî¢ –ë–ª–æ–∫   | 1.16 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä–µ–º–∞ –ø–∞–º—è—Ç–∏ |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Ä–∞–±–æ—Ç—É In-Memory –°–£–ë–î –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö —Å **–º–∞—Å—Å–∏–≤–Ω—ã–º –æ–±—ä—ë–º–æ–º –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏** (1+ –¢–ë, –¥–æ 5+ –ü–ë), –≤–∫–ª—é—á–∞—è NUMA-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, RDIMM/3DS DIMM, –∏ PMEM (Persistent Memory).

–ü–æ–∑–≤–æ–ª—è–µ—Ç:

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –û–ó–£,
* –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å latencies –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ,
* –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–º–µ—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Ñ–æ–Ω–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ NUMA-–Ω–æ–¥–∞–º,
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–æ–Ω–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –ø–∞–º—è—Ç—å –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                  | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                             |
| --------------------------- | -------------------------------------------------------------------- |
| NUMA-aware allocation       | –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –±—É—Ñ–µ—Ä–æ–≤ –ø–æ –Ω–æ–¥–∞–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–ø–æ–ª–æ–≥–∏–∏     |
| Huge Pages / 1G Pages       | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Transparent / Explicit Huge Pages (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ config) |
| Memory manager              | –ê—Ä–µ–Ω–Ω—ã–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ä–µ–≥–∏–æ–Ω–æ–≤ –∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏                |
| Per-node memory quota       | –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –Ω–∞ NUMA-–Ω–æ–¥—É                        |
| Memory statistics           | –ì–ª—É–±–æ–∫–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º, –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞–º, —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º               |
| Load balancing (allocation) | –£—á–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–π –ø–∞–º—è—Ç–∏, –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–∞ (DDR5/PMEM)     |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                 | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                     |
| --------------------------- | ---------------------------------------------------------- | ------------------------------ |
| `memory_init()`             | `void memory_init(void)`                                   | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–∞–º—è—Ç–∏ |
| `memory_alloc_numa()`       | `void *memory_alloc_numa(size_t size, int node_id)`        | –í—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ NUMA-–Ω–æ–¥—É  |
| `memory_get_available_mb()` | `uint64_t memory_get_available_mb(void)`                   | –û–±—â–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –æ–±—ä—ë–º –ø–∞–º—è—Ç–∏   |
| `memory_report_stats()`     | `void memory_report_stats(FILE *out)`                      | –í—ã–≤–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏               |
| `memory_enforce_limits()`   | `bool memory_enforce_limits(session_t *sess, size_t size)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                        | –ò—Å—Ç–æ—á–Ω–∏–∫        | –¶–µ–ª—å                      |
| ------------------------------ | --------------- | ------------------------- |
| `mem_total_mb`                 | Memory Manager  | > 1 000 000 (1 –¢–ë)        |
| `mem_used_per_node_mb`         | NUMA Tracker    | —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ |
| `mem_fragmentation_ratio`      | Allocator Stats | < 1.5                     |
| `hugepage_utilization_percent` | Kernel / perf   | > 90%                     |
| `allocation_latency_ns`        | Memtrace        | < 500 –Ω—Å                  |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/memory.c
src/memory_numa.c
src/memory_debug.c
include/memory.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **libnuma**, `mbind()`, `numa_alloc_onnode()` (–∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ mmap-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã)
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü: `MADV_HUGEPAGE`, `MAP_HUGETLB`, `MAP_POPULATE`
* –ö–æ–Ω—Ç—Ä–æ–ª—å OOM —á–µ—Ä–µ–∑ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä, –Ω–µ –¥–æ–ø—É—Å–∫–∞—è –∞–≤–∞—Ä–∏–π–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–æ–∫
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Memory Pressure Trigger ‚Äî backpressure –≤ WAL / ingest

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞   | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                      | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                   |
| ----------- | -------------------------------------------------------- | -------------------------------- |
| Unit        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–π, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è, HugePages              | `tests/memory/test_alloc.c`      |
| NUMA        | –í—ã–¥–µ–ª–µ–Ω–∏–µ/–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º –Ω–æ–¥—ã, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ | `tests/memory/test_numa.c`       |
| Stress      | –í—ã–¥–µ–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ 1 –º–ª—Ä–¥ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º –Ω–æ–¥–∞–º     | `tests/stress/hugepages_alloc.c` |
| Performance | –ë–µ–Ω—á–º–∞—Ä–∫ latency alloc vs NUMA node distance             | `bench/memory/bench_latency.c`   |

---

## üìê UML ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

```plantuml
@startuml
class MemoryManager {
  +memory_init()
  +memory_alloc_numa()
  +memory_report_stats()
}

class NUMA_Node {
  +id
  +total_mb
  +used_mb
}

MemoryManager --> NUMA_Node : alloc_on_node()
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                     |
| ------------------------------------ | ------ | ------------------------------- |
| NUMA-aware —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ                | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ mbind, distance-aware |
| HugePages                            | 90     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 2–ú –∏ 1–ì —Å—Ç—Ä–∞–Ω–∏—Ü       |
| –¢–æ–Ω–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –ª–∏–º–∏—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | 95     | session-level + per-node        |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
memory_init();
void *ptr = memory_alloc_numa(4 * 1024 * 1024, 1); // 4MB –Ω–∞ NUMA-–Ω–æ–¥—É 1
memory_report_stats(stdout);
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–≤
* –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö in-memory
* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–æ–¥ –≤—ã—Å–æ–∫–∏–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏
