–í–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –±–ª–æ–∫—É **1.6 ‚Äî –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏–∑ –ü–∞–∫–µ—Ç–∞ 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ.

---

# üåê –ë–ª–æ–∫ 1.6 ‚Äî –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                             |
| --------- | ------------------------------------ |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ          |
| üî¢ –ë–ª–æ–∫   | 1.6 ‚Äî –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Å—á—ë—Ç:

* **–†–∞–∑–¥–µ–ª–µ–Ω–∏—è (sharding)** —Ç–∞–±–ª–∏—Ü –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ shard-–µ–¥–∏–Ω–∏—Ü–∞–º,
* **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–±–∞–ª–∞–Ω—Å–∏–Ω–≥–∞** shard'–æ–≤ –ø–æ —É–∑–ª–∞–º –∏ NUMA-—É–∑–ª–∞–º,
* –ü–æ–¥–¥–µ—Ä–∂–∫–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è** –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤—Å—Ç–∞–≤–æ–∫,
* **–†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ shard'–æ–≤** –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏,
* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–æ–º –∫–ª–∞—Å—Ç–µ—Ä–∞.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞       | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                        |
| ---------------- | --------------------------------------------------------------- |
| –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ     | –¢–∞–±–ª–∏—Ü—ã —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ shard'—ã –ø–æ hash, range –∏–ª–∏ —Å–ø–∏—Å–∫—É        |
| –ú–µ—Ö–∞–Ω–∏–∑–º shard   | –ö–∞–∂–¥—ã–π shard —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, –∂—É—Ä–Ω–∞–ª WAL, MVCC –∏ –∫–µ—à |
| –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ     | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ shard'–∞–º —á–µ—Ä–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä            |
| –ê–≤—Ç–æ-—Ä–µ–±–∞–ª–∞–Ω—Å    | –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ shard'–æ–≤ –ø–æ —É–∑–ª–∞–º/NUMA –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ               |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è shard | active-passive –∏–ª–∏ active-active —Ä–µ–∂–∏–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)           |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏       | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                 | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                             |
| ----------------- | -------------------------------------------------------- | -------------------------------------- |
| `shard_create()`  | `shard_t *shard_create(table_t *, shard_policy_t)`       | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ shard'–∞                |
| `shard_insert()`  | `bool shard_insert(shard_t *, row_t *)`                  | –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π shard      |
| `shard_route()`   | `shard_t *shard_route(table_t *, row_t *)`               | –í—ã–±–æ—Ä shard –¥–ª—è –∑–∞–ø–∏—Å–∏/–∑–∞–ø—Ä–æ—Å–∞         |
| `shard_migrate()` | `bool shard_migrate(shard_t *, node_id_t dst)`           | –ú–∏–≥—Ä–∞—Ü–∏—è shard'–∞ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ –∏–ª–∏ NUMA |
| `shard_scan()`    | `row_iter_t *shard_scan(shard_t *, const predicate_t *)` | –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É shard      |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                     | –ò—Å—Ç–æ—á–Ω–∏–∫   | –¶–µ–ª—å                               |
| --------------------------- | ---------- | ---------------------------------- |
| `shard_count_total`         | Meta       | ‚â• 5000 –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏        |
| `shard_migration_time_ms`   | Rebalancer | < 250 –º—Å –ø—Ä–∏ –∂–∏–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏        |
| `shard_imbalance_ratio`     | Monitor    | < 10% –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –ø–æ shard-–Ω–∞–≥—Ä—É–∑–∫–µ |
| `insert_latency_by_shard`   | WAL/logger | < 500 –º–∫—Å                          |
| `rebalance_events_per_hour` | Rebalancer | ‚â§ 5‚Äì10 –≤ —Ä–∞–±–æ—á–µ–º –∫–ª–∞—Å—Ç–µ—Ä–µ          |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/shard.c
src/shard_router.c
src/cluster.c
src/rebalancer.c
src/partition.c
include/shard.h
include/cluster.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ö–∞–∂–¥–æ–º—É shard —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–≤–æ—è WAL-–∂—É—Ä–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∏ –±—É—Ñ–µ—Ä
* –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å multi-level (–Ω–∞–ø—Ä–∏–º–µ—Ä, per-branch ‚Üí per-date)
* –°–æ—Å—Ç–æ—è–Ω–∏–µ shard'–æ–≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–Ω–æ–º —Ä–µ–µ—Å—Ç—Ä–µ (–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –Ω–∞–≥—Ä—É–∑–∫–∞)
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–æ—Ä—è—á–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ shard'–∞ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π WAL –∏ MVCC
* –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç "—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ" –∫–ª—é—á–µ–π –Ω–∞ shard'—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞   | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                       | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω               |
| ----------- | ----------------------------------------- | ---------------------------- |
| Unit        | –°–æ–∑–¥–∞–Ω–∏–µ, –≤—Å—Ç–∞–≤–∫–∞ –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ shard'–æ–≤ | `tests/shard/test_basic.c`   |
| Integration | –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ shard –º–µ–∂–¥—É NUMA –∏ —É–∑–ª–∞–º–∏    | `tests/shard/test_migrate.c` |
| Soak        | 100K TPS —Å –∞–≤—Ç–æ-—Ä–µ–±–∞–ª–∞–Ω—Å–æ–º                | `tests/stress/shard_load.c`  |
| Fault-inj   | –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–æ –≤—Ä–µ–º—è WAL          | `fuzz/fuzz_shard_migrate.c`  |

---

## üìê UML ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è

```plantuml
@startuml
entity "Table" {
  +id
  +schema
}

rectangle "Shard 0" {
  WAL_0
  MVCC_0
  DATA_0
}
rectangle "Shard 1" {
  WAL_1
  MVCC_1
  DATA_1
}

[Table] --> "Shard 0"
[Table] --> "Shard 1"

component Router
Router --> "Shard 0"
Router --> "Shard 1"
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                 |
| ---------------------------- | ------ | ------------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è    | 100    | Linear scaling —á–µ—Ä–µ–∑ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ           |
| Live shard migration         | 95     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å WAL sync                   |
| Router + Planner integration | 100    | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç shard metadata       |
| –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ HA-—Ä–µ–∂–∏–º—ã       | 90     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±–∞ —Ä–µ–∂–∏–º–∞ (—Å quorum engine) |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
table_t *tbl = table_create(schema, STORE_ROW);
shard_policy_t pol = {.type = SHARD_HASH, .key = "branch_id"};
shard_create(tbl, pol);
row_t row = generate_row();
shard_t *target = shard_route(tbl, &row);
shard_insert(target, &row);
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å **500+ —Ñ–∏–ª–∏–∞–ª–æ–≤** –∏ **2+ —Ç—Ä–ª–Ω –∑–∞–ø–∏—Å–µ–π/–≥–æ–¥** —Å –Ω–∏–∑–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏ / –∫–ª–∏–µ–Ω—Ç–∞–º–∏ / —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

–ì–æ—Ç–æ–≤ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –±–ª–æ–∫–æ–º: **1.7 ‚Äî –ò–Ω–¥–µ–∫—Å—ã: B+tree, Bitmap, Inverted**? –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

