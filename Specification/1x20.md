# ‚è≥ –ë–ª–æ–∫ 1.20 ‚Äî TTL / Eviction / Auto-tiering

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                             |
| --------- | ------------------------------------ |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ          |
| üî¢ –ë–ª–æ–∫   | 1.20 ‚Äî TTL / Eviction / Auto-tiering |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç **–∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –¥–∞–Ω–Ω—ã—Ö** –≤ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ:

* —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ TTL (Time-To-Live),
* –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Eviction) –ø—Ä–∏ –¥–∞–≤–ª–µ–Ω–∏–∏ –Ω–∞ –ø–∞–º—è—Ç—å,
* –º–∏–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è (Auto-tiering): –≥–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ DRAM, —Ö–æ–ª–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –Ω–∞ SSD / NVMe.

–¶–µ–ª—å ‚Äî **–±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —ë–º–∫–æ—Å—Ç—å—é —Ö—Ä–∞–Ω–µ–Ω–∏—è**, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º real-time –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ OLTP.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                        |
| ------------------------- | --------------------------------------------------------------- |
| TTL –ø–æ –∫–æ–ª–æ–Ω–∫–∞–º / —Å—Ç—Ä–æ–∫–∞–º | –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è, –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ —Ñ–æ–Ω–µ –∏–ª–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ |
| Eviction Engine           | –û—á–∏—Å—Ç–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ LRU/LFU –∏ –ø—Ä–∏ memory pressure                 |
| Auto-tiering Engine       | –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É DRAM, NVMe, SSD –Ω–∞ –æ—Å–Ω–æ–≤–µ access heatmap  |
| Page Demotion             | –î–µ–º–æ—É—Ç–∏–Ω–≥ —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ NVMe tier                          |
| Hot/Cold Scoring          | –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ¬´–≥–æ—Ä—è—á–µ—Å—Ç–∏¬ª –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —á–∞—Å—Ç–æ—Ç–µ |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏               | –ü—Ä–æ—Ç–æ—Ç–∏–ø                              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                            |
| ------------------------- | ------------------------------------- | ------------------------------------- |
| `ttl_check_and_purge()`   | `void ttl_check_and_purge(table_t *)` | –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ —Å –∏—Å—Ç–µ–∫—à–∏–º TTL         |
| `eviction_run_cycle()`    | `void eviction_run_cycle(void)`       | –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è               |
| `tiering_migrate_pages()` | `void tiering_migrate_pages(void)`    | –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –º–µ–∂–¥—É DRAM ‚Üî SSD     |
| `page_mark_access()`      | `void page_mark_access(page_id_t)`    | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ score –¥–ª—è page –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ |
| `cold_data_compact()`     | `void cold_data_compact(table_t *)`   | –°–∂–∞—Ç–∏–µ –∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ö–æ–ª–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ò—Å—Ç–æ—á–Ω–∏–∫           | –¶–µ–ª—å                        |
| -------------------------- | ------------------ | --------------------------- |
| `expired_rows_removed`     | TTL engine         | > 99% –æ—Ç –≤—Å–µ—Ö –ø–æ —Å—Ä–æ–∫—É      |
| `eviction_latency_ms`      | Eviction subsystem | < 10 –º—Å / —Ü–∏–∫–ª              |
| `cold_data_migration_rate` | Tiering engine     | ‚â• 100 MB/–º–∏–Ω                |
| `ram_pressure_level`       | Memory monitor     | ‚â§ 75% –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ |
| `page_hot_score_avg`       | Page stats         | –°—Ä–µ–¥–Ω–µ–µ > 0.7 –¥–ª—è hot       |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/ttl.c
src/eviction.c
src/tiering.c
include/ttl.h
include/eviction.h
include/tiering.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* TTL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫ –∏ —Ç–∞–±–ª–∏—Ü (`EXPIRE AFTER` –≤ DDL)
* –í—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è LRU —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ snapshot‚Äô—ã
* Tiering –∏—Å–ø–æ–ª—å–∑—É–µ—Ç mmap-—Ñ–∞–π–ª—ã, NVMe SSD –∏ NUMA-–ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã
* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ—Å—Ç—É–ø–∞–º —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ lightweight page counters
* –ì–æ—Ä—è—á–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –Ω–∞ node-local –ø–∞–º—è—Ç–∏

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                            | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                 |
| --------- | ---------------------------------------------- | ------------------------------ |
| Unit      | –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –ø–æ TTL                 | `tests/ttl/test_ttl.c`         |
| Soak      | –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Å –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ–º –∏ eviction | `tests/soak/eviction_stress.c` |
| Tiering   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∏ –ø—Ä–æ—Å—Ç–æ–µ —á—Ç–µ–Ω–∏–µ | `tests/tiering/test_migrate.c` |
| Fuzz      | –°—Ç—Ä–æ–∫–∏ —Å TTL=0, –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏       | `fuzz/fuzz_ttl_fields.c`       |

---

## üìê UML ‚Äî –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã

```plantuml
@startuml
start
:page allocated;
if (TTL expired?) then (yes)
  :purge row;
elseif (low memory?) then (yes)
  :evict page;
elseif (cold score > 0.8?) then (yes)
  :migrate to NVMe;
endif
stop
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                     | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                     |
| ---------------------------- | ------ | ----------------------------------------------- |
| TTL –¥–ª—è —Å—Ç—Ä–æ–∫/—Ç–∞–±–ª–∏—Ü         | 100    | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DDL –∏ –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏—è                    |
| Auto-tiering –ø–æ hot/cold     | 95     | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π engine, heatmap-based                |
| Eviction –ø–æ–¥ memory pressure | 95     | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ –∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ thresholds |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
// –ü–æ–º–µ—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
page_mark_access(page_id);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∏—Å—Ç—ë–∫—à–∏–µ –∑–∞–ø–∏—Å–∏
ttl_check_and_purge(table);

// –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –∏ –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏–µ
eviction_run_cycle();
tiering_migrate_pages();
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ retention policy –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ –ª–æ–≥–æ–≤
* –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è—Ö (RAM ‚Üí SSD)
* –ü–æ–≤—ã—à–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ in-memory –ø—Ä–æ—Ñ–∏–ª—è
