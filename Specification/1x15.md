# üïì –ë–ª–æ–∫ 1.15 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (AS OF)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                  |
| --------- | ----------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ               |
| üî¢ –ë–ª–æ–∫   | 1.15 ‚Äî –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (AS OF) |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **"–≤–µ—Ä—Å–∏–π —Ç–∞–±–ª–∏—Ü –≤–æ –≤—Ä–µ–º–µ–Ω–∏"**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö timestamp‚Äô–∞—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å:

* **"AS OF" –∑–∞–ø—Ä–æ—Å—ã** –∫ –¥–∞–Ω–Ω—ã–º –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏,
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π,
* –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                    | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                              |
| ----------------------------- | --------------------------------------------------------------------- |
| System-Versioned Tables       | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ `VALID_FROM` / `VALID_TO` –∫–æ–ª–æ–Ω–∫–∏, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ANSI SQL:2011 |
| AS OF Queries                 | –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–∞ `SELECT ... FROM table FOR SYSTEM_TIME AS OF TIMESTAMP`  |
| Temporal Indexing             | –ò–Ω–¥–µ–∫—Å—ã –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏                                         |
| Insert/Update with history    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö                      |
| Garbage Collection –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π                                       |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                      | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                |
| -------------------------------- | ---------------------------------------------------------------- | ----------------------------------------- |
| `temporal_init()`                | `void temporal_init(void)`                                       | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π |
| `temporal_insert()`              | `bool temporal_insert(table_t *, const row_t *, timestamp_t ts)` | –í—Å—Ç–∞–≤–∫–∞ –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫–∏                     |
| `temporal_scan_as_of()`          | `iterator_t *temporal_scan_as_of(table_t *, timestamp_t ts)`     | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏        |
| `temporal_prune_old_versions()`  | `void temporal_prune_old_versions(timestamp_t threshold)`        | –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤–µ—Ä—Å–∏–π                 |
| `temporal_is_enabled(table_t *)` | `bool temporal_is_enabled(const table_t *tbl)`                   | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∏—Å—Ç–µ–º–Ω—É—é –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å        |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                    | –ò—Å—Ç–æ—á–Ω–∏–∫         | –¶–µ–ª—å                              |
| -------------------------- | ---------------- | --------------------------------- |
| `as_of_query_latency_ms`   | Query Planner    | < 2 –º—Å                            |
| `temporal_versions_count`  | Catalog Stats    | –ù–µ –±–æ–ª–µ–µ 1000/—Å—Ç—Ä–æ–∫—É (—Å –æ—á–∏—Å—Ç–∫–æ–π) |
| `temporal_data_bytes`      | Storage Analyzer | ‚â§ 20% –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞      |
| `gc_old_versions_per_hour` | GC Engine        | ‚â• 50k/—á                           |
| `temporal_enabled_tables`  | Metadata Manager | ‚â• 80% –±–∏–∑–Ω–µ—Å-—Ç–∞–±–ª–∏—Ü               |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/temporal.c
src/temporal_index.c
src/gc_temporal.c
include/temporal.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* MVCC –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—Å–Ω–æ–≤—ã –¥–ª—è –≤–µ—Ä—Å–∏–π
* –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –≤–µ—Ä—Å–∏–π —Å RLE / dictionary encoding
* –°–∂–∞—Ç–∏–µ inactive-–≤–µ—Ä—Å–∏–π cold-–¥–∞–Ω–Ω—ã—Ö
* –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ WAL –∏ snapshot‚Äô—ã
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `SYSTEM_TIME` —Å—Ç–∞–Ω–¥–∞—Ä—Ç SQL

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞   | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                            | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                 |
| ----------- | ---------------------------------------------- | ------------------------------ |
| Unit        | –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å insert/update/delete              | `tests/temporal/test_insert.c` |
| Snapshot    | –ü—Ä–æ–≤–µ—Ä–∫–∞ rollback –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –ª—é–±–æ–π ts | `tests/temporal/test_as_of.c`  |
| GC          | –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞    | `tests/gc/test_temporal_gc.c`  |
| Integration | –°–∫–≤–æ–∑–Ω–æ–π –∞—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ SQL             | `tests/integration/temporal.c` |

---

## üìê UML ‚Äî AS OF –∏ Versioning

```plantuml
@startuml
class Table {
  +rows : Row[]
  +temporal_enabled : bool
}

class Row {
  +valid_from : timestamp_t
  +valid_to : timestamp_t
}

class TemporalManager {
  +scan_as_of(ts)
  +prune_old()
}

Table --> TemporalManager
Row --> Table
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                      | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                              |
| ----------------------------- | ------ | ---------------------------------------- |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ AS OF (SYSTEM TIME) | 100    | –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å SQL:2011+         |
| –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π             | 95     | –ù–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–æ–∫, —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π —Ö—Ä–∞–Ω–µ–Ω–∏—è |
| –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –≤–µ—Ä—Å–∏–π     | 90     | –ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–∏—Ç–∏–∫–∏ TTL –∏ last-access     |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
timestamp_t ts = now() - HOURS(4);
iterator_t *it = temporal_scan_as_of(tbl, ts);
while (row_t *r = iter_next(it)) {
    process_row(r);
}
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–∞—É–¥–∏—Ç** –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π **–æ—Ç—á—ë—Ç –ø–æ –¥–∞–Ω–Ω—ã–º**
* –£—Å–∫–æ—Ä—è–µ—Ç **–∞–Ω–∞–ª–∏–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π** –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
* –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (GDPR, SOC2, ISO27001)
