# üìÇ –ë–ª–æ–∫ 1.2 ‚Äî Row-store –∏ Column-store

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                       |
| --------- | ------------------------------ |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ    |
| üî¢ –ë–ª–æ–∫   | 1.2 ‚Äî Row-store –∏ Column-store |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **—Ñ–∏–∑–∏—á–µ—Å–∫—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫** –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

* **Row-store** –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö OLTP-–≤—Å—Ç–∞–≤–æ–∫, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ —Ç–æ—á–µ—á–Ω—ã—Ö SELECT,
* **Column-store** –¥–ª—è –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö OLAP-–æ–ø–µ—Ä–∞—Ü–∏–π: scan, group-by, –∞–≥—Ä–µ–≥–∞—Ç–æ–≤,
* **–ì–∏–±—Ä–∏–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ**, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º–æ–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –¥–∞–∂–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞   | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                               |
| ------------ | ---------------------------------------------------------------------- |
| Row-store    | Array-of-structures (AOS), –±—ã—Å—Ç—Ä—ã–µ –≤—Å—Ç–∞–≤–∫–∏, MVCC-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å         |
| Column-store | Structure-of-arrays (SOA), dictionary/RLE/delta —Å–∂–∞—Ç–∏–µ, SIMD-–∞–≥—Ä–µ–≥–∞—Ü–∏–∏ |
| –ì–∏–±—Ä–∏–¥       | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è (–Ω–∞ —Ç–∞–±–ª–∏—Ü—É/—à–∞—Ä–¥/–∫–æ–ª–æ–Ω–∫—É)             |
| –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å | –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –ø–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ (write/read ratio)                |
| –¢–∏–ø–∏–∑–∞—Ü–∏—è    | –û–±—â–∏–π layout –¥–ª—è INT, FLOAT, STRING, TIMESTAMP, JSON                   |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                               | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           |
| ---------------------- | ------------------------------------------------------ | ------------------------------------ |
| `table_create()`       | `table_t *table_create(schema_t *, store_mode_t)`      | –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å row/column layout |
| `table_insert()`       | `bool table_insert(table_t *, const row_t *)`          | –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏                       |
| `table_scan()`         | `bool table_scan(table_t *, scan_cb_t cb, void *ctx)`  | –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ç–∞–±–ª–∏—Ü–µ              |
| `row_store_fetch()`    | `row_t *row_store_fetch(row_store_t *, rowid_t)`       | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏                     |
| `column_store_fetch()` | `row_t *column_store_fetch(column_store_t *, rowid_t)` | –†–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∫–æ–ª–æ–Ω–æ–∫      |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                       | –ò—Å—Ç–æ—á–Ω–∏–∫          | –¶–µ–ª—å                     |
| ----------------------------- | ----------------- | ------------------------ |
| `row_insert_latency_ns`       | row\_store insert | < 250 –Ω—Å                 |
| `column_scan_throughput_mb_s` | full scan         | > 500 –ú–ë/—Å               |
| `write_vs_read_ratio`         | query planner     | –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –≤ row/column |
| `column_compression_ratio`    | dictionary + RLE  | > 2.5x                   |
| `mixed_mode_support`          | system metadata   | 100%                     |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/table.c
src/row_store.c
src/column_store.c
src/compression.c
src/schema.c
include/table.h
include/row_store.h
include/column_store.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ store-—Ä–µ–∂–∏–º–µ (`store_mode_t`)
* –í Column-store –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:

  * `frame-of-reference`,
  * `delta-encoding`,
  * `dictionary compression`
* Row-store –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ insert-only —Ä–µ–∂–∏–º–∞—Ö
* Column-store —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–æ batch ‚Üí SIMD –∞–≥—Ä–µ–≥–∞—Ç—ã ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
* Store layout –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞  | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω             |
| ---------- | -------------------------------------------------- | -------------------------- |
| Unit       | Create, insert, scan, compress                     | `tests/test_store.c`       |
| Fuzz       | –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ row/column layout                      | `fuzz/fuzz_store_format.c` |
| Stress     | 1 –º–ª—Ä–¥ –∑–∞–ø–∏—Å–µ–π –ø–æ–æ—á–µ—Ä—ë–¥–Ω–æ –≤ row –∏ column           | `tests/stress/store_mix.c` |
| Benchmarks | insert latency, scan throughput, compression ratio | `bench/column_vs_row.c`    |

---

## üìê UML ‚Äî –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è row / column store

```plantuml
@startuml
entity "Table" {
  +schema
  +store_mode
}
entity "Row Store"
entity "Column Store"
entity "Row"
entity "Column Chunk"

Table --> Row Store : row mode
Table --> Column Store : column mode
Row Store --> Row
Column Store --> Column Chunk
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                  | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                           |
| ------------------------- | ------ | ------------------------------------- |
| Dual store (row + column) | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±–∞ —Ä–µ–∂–∏–º–∞             |
| SIMD scan + aggregation   | 95     | –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Column-store           |
| –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä layout   | 90     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ workload |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∂–∞—Ç–∏—è          | 95     | RLE, Dictionary, Delta                |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
table_t *t = table_create(schema, STORE_COLUMN);
row_t row = row_init(schema);
row_set(&row, "amount", 123.45);
table_insert(t, &row);
table_scan(t, print_row, NULL);
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å OLTP (row) –∏ OLAP (column) –≤ –æ–¥–Ω–æ–π –ë–î
* –£—Å–∫–æ—Ä—è–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∏ –æ—Ç—á—ë—Ç—ã –ø–æ –±–æ–ª—å—à–∏–º —Ç–∞–±–ª–∏—Ü–∞–º –±–µ–∑ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
* –ö–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç –≥–∏–±—Ä–∏–¥–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã HTAP
