–í–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –±–ª–æ–∫—É **1.7 ‚Äî –ò–Ω–¥–µ–∫—Å—ã: B+tree, Bitmap, Inverted** –∏–∑ –ü–∞–∫–µ—Ç–∞ 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ.

---

# üóÉÔ∏è –ë–ª–æ–∫ 1.7 ‚Äî –ò–Ω–¥–µ–∫—Å—ã: B+tree, Bitmap, Inverted

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                |
| --------- | --------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ             |
| üî¢ –ë–ª–æ–∫   | 1.7 ‚Äî –ò–Ω–¥–µ–∫—Å—ã: B+tree, Bitmap, Inverted |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ò–Ω–¥–µ–∫—Å—ã ‚Äî –∫–ª—é—á–µ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –î–∞–Ω–Ω—ã–π –±–ª–æ–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç:

* **B+tree –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–µ–π (range, point lookup),
* **Bitmap –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—É–ª–µ–≤—ã—Ö, –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π,
* **Inverted –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä,
* –ú–µ—Ö–∞–Ω–∏–∑–º—ã **—Å–æ–∑–¥–∞–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤** –ø—Ä–∏ DML,
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–æ–º –¥–ª—è **–≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ –¥–æ—Å—Ç—É–ø–∞**.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞     | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                               |
| -------------- | ------------------------------------------------------ |
| B+tree Index   | Balanced-–¥–µ—Ä–µ–≤–æ, leaf-level scan, range lookup         |
| Bitmap Index   | –°–∂–∞—Ç—ã–π (RLE/WAH), –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π AND/OR/XOR        |
| Inverted Index | –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è, –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JSON-–ø—É—Ç–µ–π  |
| Index Planner  | –í—ã–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —ç—Ç–∞–ø–µ cost-based –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏          |
| MVCC Support   | –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö DML |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏            | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                        | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                    |
| ---------------------- | --------------------------------------------------------------- | ----------------------------- |
| `index_create()`       | `index_t *index_create(index_type_t, table_t *, column_t *)`    | –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞              |
| `index_insert()`       | `bool index_insert(index_t *, const row_t *)`                   | –í—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∏–Ω–¥–µ–∫—Å       |
| `index_search_range()` | `rowid_list_t *index_search_range(index_t *, value_t from, to)` | –ü–æ–∏—Å–∫ –≤ B+tree                |
| `bitmap_index_eval()`  | `bitmap_t *bitmap_index_eval(index_t *, predicate_t *)`         | –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –±–∏—Ç–º–∞–ø–∞            |
| `inverted_query()`     | `rowid_list_t *inverted_query(index_t *, const char *query)`    | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–ª–∏ JSON-–ø–æ–∏—Å–∫ |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                        | –ò—Å—Ç–æ—á–Ω–∏–∫        | –¶–µ–ª—å                       |
| ------------------------------ | --------------- | -------------------------- |
| `bptree_lookup_latency_us`     | Index subsystem | < 5 –º–∫—Å                    |
| `bitmap_filter_cardinality`    | Planner stats   | ‚â§ 0.01 (–¥–ª—è AND/OR/NOT)    |
| `inverted_search_latency_ms`   | Fulltext engine | < 10 –º—Å                    |
| `index_build_time_ms`          | Index Builder   | ‚â§ 500 –º—Å (–¥–ª—è 1 –º–ª–Ω —Å—Ç—Ä–æ–∫) |
| `index_storage_overhead_ratio` | Storage stats   | ‚â§ 20%                      |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/index_bptree.c
src/index_bitmap.c
src/index_inverted.c
src/index_common.c
src/planner_index.c
include/index.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* B+tree: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ upper-bound/lower-bound –ø–æ–∏—Å–∫–∞, leaf chaining
* Bitmap: –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ sorted –∫–æ–ª–æ–Ω–∫–∞–º, —É–º–µ–µ—Ç —É—Å–∫–æ—Ä—è—Ç—å `GROUP BY`
* Inverted: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–µ–∫—Å–µ–º, stop-—Å–ª–æ–≤, –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏ phrase search
* –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã MVCC-aware: –≤–µ—Ä—Å–∏–∏ –≤ –ª–∏—Å—Ç–∞—Ö, –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ txn-id
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–Ω–¥–µ–∫—Å–∞ –≤–æ –≤—Ä–µ–º—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è query plan

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞   | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                   | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω              |
| ----------- | ----------------------------------------------------- | --------------------------- |
| Unit        | –í—Å—Ç–∞–≤–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ, range scan –ø–æ B+tree               | `tests/index/test_bptree.c` |
| Integration | –°–æ–≤–º–µ—â–µ–Ω–∏–µ bitmap –∏ MVCC                              | `tests/index/test_mvcc.c`   |
| Perf        | 100 –º–ª–Ω —Å—Ç—Ä–æ–∫, 10K TPS –ø–æ–∏—Å–∫–∞                         | `bench/index_lookup.c`      |
| Fuzz        | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ JSON —Å inverted index | `fuzz/fuzz_inverted.c`      |

---

## üìê UML ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–∞

```plantuml
@startuml
class Table
class Index <<abstract>>
class BPlusTreeIndex
class BitmapIndex
class InvertedIndex

Index <|-- BPlusTreeIndex
Index <|-- BitmapIndex
Index <|-- InvertedIndex
Table --> Index
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                 | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                         |
| ------------------------ | ------ | ----------------------------------- |
| B+tree —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è        | 100    | –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å range scan |
| Bitmap –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è        | 95     | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ RLE, fast bitmap eval     |
| Inverted index           | 90     | –ü–æ–∏—Å–∫ –ø–æ JSON –∏ fulltext            |
| MVCC –∏ –≤–µ—Ä—Å–∏–∏ –≤ –∏–Ω–¥–µ–∫—Å–∞—Ö | 95     | –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞                    |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
index_t *idx = index_create(INDEX_BPTREE, table, column);
index_insert(idx, &row);
rowid_list_t *matches = index_search_range(idx, int32_val(10), int32_val(20));
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* B+tree –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ ID, –¥–∞—Ç–µ, –∫–ª—é—á—É –∫–ª–∏–µ–Ω—Ç–∞
* Bitmap —É—Å–∫–æ—Ä—è–µ—Ç –º–∞—Å—Å–æ–≤—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –≤—ã–±–æ—Ä–∫–∏ –ø–æ –±—É–ª–µ–≤—ã–º –ø–æ–ª—è–º
* Inverted –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è ERP/CRM-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–º –∏ JSON

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É: **1.8 ‚Äî –°–∂–∞—Ç–∏–µ: Dictionary, RLE, Delta**? –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

