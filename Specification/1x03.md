# üßæ –ë–ª–æ–∫ 1.3 ‚Äî JSON-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                    |
| --------- | --------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ |
| üî¢ –ë–ª–æ–∫   | 1.3 ‚Äî JSON-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ        |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ë–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ **JSON** –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü in-memory –°–£–ë–î.
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

* –í—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ **JSON-–ø–æ–ª–µ** –≤–Ω—É—Ç—Ä–∏ row/column —Ç–∞–±–ª–∏—Ü,
* **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ JSON path** —Å –ø–æ–º–æ—â—å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—ã ValueIndex,
* **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è** –ø–æ –∫–ª—é—á–∞–º, –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—è–º –∏ –º–∞—Å—Å–∏–≤–∞–º,
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å SQL (`JSON_VALUE`, `JSON_QUERY`, `->`, `#>`),
* –°–∂–∞—Ç–∏–µ JSON-–æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞     | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                               |
| -------------- | ---------------------------------------------------------------------- |
| –ü–∞—Ä—Å–∏–Ω–≥        | Zero-copy DOM-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è                      |
| –•—Ä–∞–Ω–µ–Ω–∏–µ       | Raw-–±–∏–Ω–∞—Ä–Ω–æ–µ –∏ —Å–∂–∞—Ç–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ offset-—Ç–∞–±–ª–∏—Ü–∞–º–∏        |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è     | –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏, path-based –∏–Ω–¥–µ–∫—Å (JSONPath trie)                     |
| SQL-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | JSON\_VALUE, JSON\_EXISTS, JSON\_OBJECT, JSON\_ARRAY, JSON\_TABLE      |
| API            | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ `json_get(json_t *, const char *path)` |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏           | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
| --------------------- | ---------------------------------------------------------- | ---------------------------- |
| `json_parse()`        | `json_t *json_parse(const char *raw)`                      | –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ JSON          |
| `json_get()`          | `bool json_get(json_t *, const char *path, json_node_t *)` | –î–æ—Å—Ç—É–ø –∫ –≤–ª–æ–∂–µ–Ω–Ω–æ–º—É –ø–æ–ª—é     |
| `json_index_add()`    | `void json_index_add(index_t *, json_t *)`                 | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ –∏–Ω–¥–µ–∫—Å  |
| `json_value_as_int()` | `int json_value_as_int(json_node_t *)`                     | –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∫ —á–∏—Å–ª–∞ |
| `json_compress()`     | `void *json_compress(json_t *)`                            | –°–∂–∞—Ç–∏–µ JSON-–æ–±—ä–µ–∫—Ç–∞          |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                  | –ò—Å—Ç–æ—á–Ω–∏–∫        | –¶–µ–ª—å                              |
| ------------------------ | --------------- | --------------------------------- |
| `json_lookup_latency_ns` | JSON\_GET       | < 1 –º–∫—Å                           |
| `json_compression_ratio` | compressed size | > 2x                              |
| `json_index_build_time`  | on insert       | < 100 –º–∫—Å                         |
| `json_path_hit_ratio`    | query planner   | > 90% –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∏–Ω–¥–µ–∫—Å–æ–≤  |
| `json_query_exec_time`   | SQL ‚Üí JSON      | < 10 –º—Å –Ω–∞ –±–æ–ª—å—à–∏–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/json.c
src/json_index.c
src/datatype.c
src/sql_expr_json.c
include/json.h
include/json_index.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* Compact DOM-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å memory arena
* –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø—É—Ç—è–º —Å –ø–æ–º–æ—â—å—é trie + hashmap
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–æ–≥–æ–π —Å—Ö–µ–º—ã JSON-–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ (–ø–æ –æ–ø—Ü–∏–∏)
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RLE/dict compression –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö
* –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SQL —á–µ—Ä–µ–∑ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–∏–∫–∞—Ç—ã

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                     | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω              |
| --------- | --------------------------------------- | --------------------------- |
| Unit      | –ü–∞—Ä—Å–∏–Ω–≥, –¥–æ—Å—Ç—É–ø, —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è           | `tests/test_json.c`         |
| Fuzz      | –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ JSON-–¥–æ–∫—É–º–µ–Ω—Ç—ã             | `fuzz/fuzz_json_parse.c`    |
| Stress    | 1 –º–ª–Ω JSON –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –≤—Å—Ç–∞–≤–∫—É + –∏–Ω–¥–µ–∫—Å | `tests/stress/json_store.c` |
| SQL       | –ó–∞–ø—Ä–æ—Å—ã –≤–∏–¥–∞ `SELECT JSON_VALUE(...)`   | `tests/sql/json_sql.c`      |

---

## üìê JSON + SQL —Å—Ö–µ–º–∞

```plantuml
@startuml
entity "Table"
entity "Column (JSON)"
entity "JSON Index"
entity "Query"

Table --> "Column (JSON)" : —Å–æ–¥–µ—Ä–∂–∏—Ç JSON-–ø–æ–ª–µ
"Column (JSON)" --> "JSON Index" : –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø–æ path
Query --> "JSON Index" : SELECT JSON_VALUE(...)
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                        | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                     |
| ------------------------------- | ------ | ------------------------------- |
| –•—Ä–∞–Ω–µ–Ω–∏–µ JSON –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö        | 100    | –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞            |
| JSON\_VALUE, JSON\_EXISTS –≤ SQL | 100    | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è               |
| –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ JSON path         | 95     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è trie-based index |
| –°–∂–∞—Ç–∏–µ JSON                     | 90     | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ        |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
json_t *obj = json_parse("{\"a\": {\"b\": 42}}");
json_node_t node;
if (json_get(obj, "a.b", &node)) {
    int v = json_value_as_int(&node);
    printf("a.b = %d\n", v);
}
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ semi-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±—ã—Ç–∏—è, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤, webhooks)
* –£–ø—Ä–æ—â–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é —Å NoSQL —Ä–µ—à–µ–Ω–∏–π (MongoDB, Firebase)
* –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ö–µ–º—ã –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
