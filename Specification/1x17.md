# üß© –ë–ª–æ–∫ 1.17 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ CPU / IOPS / Memory (multi-tenant)

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                             |
| --------- | ---------------------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ                          |
| üî¢ –ë–ª–æ–∫   | 1.17 ‚Äî –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ CPU/IOPS/Memory (multi-tenant) |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–∏–∑–æ–ª—è—Ü–∏—é —Ä–µ—Å—É—Ä—Å–æ–≤** –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –≤ –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ä–µ–¥–µ. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å:

* –ª–∏–º–∏—Ç—ã –Ω–∞ CPU-–≤—Ä–µ–º—è, –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å, IOPS –∏ –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å,
* SLA-–∫–æ–Ω—Ç—Ä–æ–ª—å –∏ –∑–∞—â–∏—Ç—É –æ—Ç resource starvation,
* –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–¥–∞—á –∏ —Ñ–æ–Ω–æ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞                 | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                             |
| -------------------------- | -------------------------------------------------------------------- |
| CPU Quotas                 | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ CPU –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —Å–µ—Å—Å–∏—è–º / –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º                   |
| Memory Limits              | –ñ—ë—Å—Ç–∫–∏–π –∏ –º—è–≥–∫–∏–π –ª–∏–º–∏—Ç –Ω–∞ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏             |
| IOPS / IO BW Limits        | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –æ–±—ä—ë–º –¥–∏—Å–∫–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–≤ –±–∞–π—Ç–∞—Ö / —Å–µ–∫) |
| Multi-tenant Classifier    | –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –ø–æ –≥—Ä—É–ø–ø–∞–º / –∫–≤–æ—Ç–∞–º / –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º                  |
| Priority Scheduling        | –ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ         |
| Resource Violation Logging | –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ –∏–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ SLA              |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏                | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                                           | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                 |
| -------------------------- | ------------------------------------------------------------------ | ------------------------------------------ |
| `resource_control_init()`  | `void resource_control_init(void)`                                 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤ |
| `session_set_quota()`      | `void session_set_quota(session_t *, quota_t *)`                   | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Å–µ—Å—Å–∏–∏               |
| `resource_check_limits()`  | `bool resource_check_limits(session_t *, op_type_t, size_t usage)` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤                |
| `resource_tick()`          | `void resource_tick(void)`                                         | –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç –∏ —É—á—ë—Ç –º–µ—Ç—Ä–∏–∫       |
| `log_resource_violation()` | `void log_resource_violation(session_t *, const char *metric)`     | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π                      |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                      | –ò—Å—Ç–æ—á–Ω–∏–∫         | –¶–µ–ª—å           |
| ---------------------------- | ---------------- | -------------- |
| `cpu_time_exceeded_total`    | Scheduler        | ‚â§ 0            |
| `mem_quota_usage_percent`    | Session Manager  | < 90%          |
| `iops_quota_exceeded`        | IO Monitor       | ‚â§ 1% –æ—Ç —Å–µ—Å—Å–∏–π |
| `avg_sla_violation_duration` | SLA Engine       | < 50 –º—Å        |
| `violations_per_hour`        | Resource Monitor | ‚â§ 10           |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/resource_control.c
src/quota.c
src/iomonitor.c
include/resource_control.h
include/quota.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* CPU-–ª–∏–º–∏—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `getrusage()` + –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
* IOPS –∏–∑–º–µ—Ä—è—é—Ç—Å—è per-session —á–µ—Ä–µ–∑ hooks –≤ storage engine
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö, –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∏ —Å–µ—Å—Å–∏–æ–Ω–Ω—ã—Ö –∫–≤–æ—Ç
* –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ ‚Äî graceful degradation –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `rlimit`, `cgroup v2` (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏) –∏–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π tracking

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                                | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω                 |
| --------- | -------------------------------------------------- | ------------------------------ |
| Unit      | –ü—Ä–æ–≤–µ—Ä–∫–∞ CPU, IOPS, memory –ª–∏–º–∏—Ç–æ–≤                 | `tests/resource/test_limits.c` |
| Soak      | –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π | `tests/soak/multi_sla.c`       |
| Fuzz      | –ù–∞—Ä—É—à–µ–Ω–∏—è –∫–≤–æ—Ç –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è                 | `fuzz/fuzz_quota.c`            |
| Perf      | –ó–∞–º–µ—Ä latencies –ø—Ä–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤           | `bench/resource/limit_test.c`  |

---

## üìê UML ‚Äî –ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ —Å–µ—Å—Å–∏—è–º

```plantuml
@startuml
class Session {
  +cpu_time
  +memory_used
  +iops_used
  +quota : Quota
}

class Quota {
  +max_cpu
  +max_mem
  +max_iops
}

Session --> Quota
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                             | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                      |
| ------------------------------------ | ------ | ------------------------------------------------ |
| CPU / Memory / IO –ª–∏–º–∏—Ç—ã per session | 95     | –ü–æ—á—Ç–∏ –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤     |
| SLA-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ     | 90     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ scheduler + metrics     |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑–æ–ª—è—Ü–∏–∏                | 95     | –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
quota_t quota = {
    .max_cpu_ms = 5000,
    .max_mem_bytes = 512 * 1024 * 1024,
    .max_iops = 1000
};
session_set_quota(sess, &quota);

if (!resource_check_limits(sess, OP_INSERT, 4096)) {
    log_resource_violation(sess, "mem_quota_exceeded");
    return ERROR_LIMIT_EXCEEDED;
}
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç "—à—É–º–Ω—ã—Ö —Å–æ—Å–µ–¥–µ–π" (noisy neighbors)
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å SLA –∏ QoS –≤ –æ–±–ª–∞—á–Ω—ã—Ö –∏ shared —Å—Ä–µ–¥–∞—Ö
* –£–ø—Ä–æ—â–∞–µ—Ç –º–æ–¥–µ–ª—å —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –±–∏–ª–ª–∏–Ω–≥–∞ per session
