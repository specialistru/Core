–í–æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –±–ª–æ–∫—É **1.9 ‚Äî Page Cache / –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è: LRU, ARC** –∏–∑ –ü–∞–∫–µ—Ç–∞ 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ.

---

# üßÆ –ë–ª–æ–∫ 1.9 ‚Äî Page Cache / –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è: LRU, ARC

---

## üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±–ª–æ–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ó–Ω–∞—á–µ–Ω–∏–µ                                 |
| --------- | ---------------------------------------- |
| üì¶ –ü–∞–∫–µ—Ç  | 1 ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –•—Ä–∞–Ω–∏–ª–∏—â–µ              |
| üî¢ –ë–ª–æ–∫   | 1.9 ‚Äî Page Cache / –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è: LRU, ARC |

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π –±–ª–æ–∫ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏,
* –í—ã–¥–µ–ª–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞–º–∏ (page frames),
* –í—ã–±–æ—Ä–æ—á–Ω—É—é –∑–∞–º–µ–Ω—É —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ LRU –∏–ª–∏ ARC –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º,
* –ö–æ–Ω—Ç—Ä–æ–ª—å –≥—Ä—è–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (dirty tracking),
* –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∏–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.

–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —É—Å–∫–æ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∏ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ NVMe / Tiered Storage –ø—Ä–∏ fallback.

---

## ‚öôÔ∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞         | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è / –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏                                                |
| ------------------ | ----------------------------------------------------------------------- |
| Page Frame Manager | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ (4K‚Äì64K)                           |
| LRU Cache          | –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö–æ–ª–æ–¥–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü          |
| ARC Cache          | Adaptive Replacement Cache ‚Äî –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —á–∞—Å—Ç–æ –∏ –Ω–µ–¥–∞–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö |
| Dirty Tracking     | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è WAL / snapshot                      |
| Prefetching        | –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —à–∞–±–ª–æ–Ω–∞–º –¥–æ—Å—Ç—É–ø–∞ (scan, join, sequential read)          |

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ C

| –ò–º—è —Ñ—É–Ω–∫—Ü–∏–∏          | –ü—Ä–æ—Ç–æ—Ç–∏–ø                                          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           |
| -------------------- | ------------------------------------------------- | ------------------------------------ |
| `page_cache_init()`  | `void page_cache_init(size_t total_pages)`        | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü      |
| `page_fetch()`       | `page_t *page_fetch(page_id_t id, bool readonly)` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ –∫—ç—à–∞ –∏–ª–∏ –¥–∏—Å–∫–∞ |
| `page_mark_dirty()`  | `void page_mark_dirty(page_t *page)`              | –ü–æ–º–µ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∫ ¬´–≥—Ä—è–∑–Ω–æ–π¬ª       |
| `page_flush_dirty()` | `void page_flush_dirty(void)`                     | –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü       |
| `page_release()`     | `void page_release(page_t *page)`                 | –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã         |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞                  | –ò—Å—Ç–æ—á–Ω–∏–∫       | –¶–µ–ª—å            |
| ------------------------ | -------------- | --------------- |
| `page_hit_ratio`         | Cache stats    | ‚â• 95%           |
| `dirty_pages_flushed`    | WAL subsystem  | < 10% –≤ –º–æ–º–µ–Ω—Ç–µ |
| `eviction_count`         | Page cache     | ‚â§ 1000 / —Å–µ–∫    |
| `avg_page_fetch_time_us` | Profiler       | < 30 –º–∫—Å        |
| `prefetch_success_rate`  | Page predictor | ‚â• 80%           |

---

## üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–æ–¥–∞

```
src/page_cache.c
src/buffer_pool.c
src/page_eviction.c
src/page_prefetch.c
include/page.h
```

---

## üß† –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pool –∏–∑ page frame (allocator + pin count)
* Dirty-–±–∏—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏; flush –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
* –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã—Ç–µ—Å–Ω–µ–Ω–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (LRU –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
* ARC –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É frequently used –∏ recently used
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ hot/hot+dirty/cold –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| –í–∏–¥ —Ç–µ—Å—Ç–∞ | –ú–µ—Ç–æ–¥–∏–∫–∞ / –ø–æ–∫—Ä—ã—Ç–∏–µ                             | –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω             |
| --------- | ----------------------------------------------- | -------------------------- |
| Unit      | –í—ã–¥–µ–ª–µ–Ω–∏–µ, fetch, flush —Å—Ç—Ä–∞–Ω–∏—Ü                 | `tests/page/test_cache.c`  |
| Perf      | –°–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–∞ –∏ hit/miss ratio               | `bench/page_cache_bench.c` |
| Stress    | –ú–∞—Å—Å–∏–≤–Ω—ã–π insert+update –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º           | `tests/stress/page_io.c`   |
| Fuzz      | –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ dirty —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ | `fuzz/fuzz_dirty_pages.c`  |

---

## üìê UML ‚Äî –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Page Cache

```plantuml
@startuml
class PageCache {
  +fetch(id)
  +release(page)
  +flush_dirty()
}

class PageFrame {
  +data
  +dirty
  +pin_count
}

PageCache --> PageFrame
@enduml
```

---

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SAP HANA+

| –ö—Ä–∏—Ç–µ—Ä–∏–π                          | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                |
| --------------------------------- | ------ | ------------------------------------------ |
| LRU-–∞–ª–≥–æ—Ä–∏—Ç–º                      | 100    | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ                  |
| ARC-–∞–ª–≥–æ—Ä–∏—Ç–º                      | 90     | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ                   |
| Dirty tracking –∏ async flush      | 95     | –°–æ–≤–º–µ—Å—Ç–Ω–æ —Å WAL –∏ snapshot                 |
| Prefetch –∏ pattern-based –∑–∞–≥—Ä—É–∑–∫–∞ | 85     | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –≤–æ–∑–º–æ–∂–Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π |

---

## üìé –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```c
page_cache_init(100000); // 100k —Å—Ç—Ä–∞–Ω–∏—Ü
page_t *pg = page_fetch(42, true);
memcpy(pg->data, new_data, 4096);
page_mark_dirty(pg);
page_release(pg);
page_flush_dirty();
```

---

## üìå –°–≤—è–∑—å —Å –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏—è–º–∏

* –ü–æ–≤—ã—à–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è –≤ HTAP / OLAP –∑–∞–ø—Ä–æ—Å–∞—Ö
* –ö–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ö–æ–ª–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å fallback
* –ö—ç—à –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 20‚Äì30% –≤ —Ç–∏–ø–∏—á–Ω–æ–π ERP-–Ω–∞–≥—Ä—É–∑–∫–µ

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É: **1.10 ‚Äî Write-Ahead Logging (WAL)**? –ù–∞–ø–∏—à–∏ **"–¥–∞"**.

